var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertyNames,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(s,a,t)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,o=(e,s)=>{for(var a in s||(s={}))l.call(s,a)&&i(e,a,s[a]);if(r)for(var a of r(s))n.call(s,a)&&i(e,a,s[a]);return e},c=(e,t)=>s(e,a(t)),d=(e,s)=>{var a={};for(var t in e)l.call(e,t)&&s.indexOf(t)<0&&(a[t]=e[t]);if(null!=e&&r)for(var t of r(e))s.indexOf(t)<0&&n.call(e,t)&&(a[t]=e[t]);return a},m=(e,s,a)=>i(e,"symbol"!=typeof s?s+"":s,a),h=(e,s,a)=>new Promise((t,r)=>{var l=e=>{try{i(a.next(e))}catch(s){r(s)}},n=e=>{try{i(a.throw(e))}catch(s){r(s)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(l,n);i((a=a.apply(e,s)).next())});import{j as u,P as x,c as p,a as g,u as f,B as j,b as v,d as b,e as N,f as y,R as w,g as S,h as _,i as D,S as P,O as C,k,C as T,l as F,T as A,D as E,m as I,n as U,o as G,A as M,p as R,q as $,r as L,s as O,t as B,F as V,v as z,w as W,x as q,y as J,z as Y,L as H,E as K,G as Z,H as Q,I as X,J as ee,K as se,M as ae,N as te,Q as re,U as le,V as ne,W as ie,X as oe,Y as ce,Z as de,_ as me}from"./ui-components.DRwxDWe8.js";import{r as he,a as ue,u as xe,d as pe,N as ge,L as fe,O as je,e as ve,f as be,R as Ne,B as ye,g as we,h as Se}from"./router.BPgNsn1V.js";import{a as _e,g as De}from"./react-vendor.D1VVuCdH.js";import{c as Pe}from"./supabase.DcSZChnc.js";import{c as Ce,t as ke}from"./utils.CyEiEXQb.js";import{X as Te,E as Fe,a as Ae,T as Ee,M as Ie,C as Ue,L as Ge,B as Me,U as Re,H as $e,b as Le,c as Oe,d as Be,e as Ve,f as ze,g as We,h as qe,i as Je,S as Ye,j as He,D as Ke,k as Ze,l as Qe,m as Xe,n as es,o as ss,F as as,A as ts,p as rs,q as ls,r as ns,P as is,s as os,t as cs,u as ds,v as ms,w as hs,x as us,y as xs,z as ps,G as gs,I as fs,J as js,K as vs,N as bs,O as Ns,Q as ys,R as ws,V as Ss,W as _s,Y as Ds,Z as Ps,_ as Cs,$ as ks,a0 as Ts,a1 as Fs,a2 as As,a3 as Es,a4 as Is,a5 as Us,a6 as Gs,a7 as Ms,a8 as Rs,a9 as $s,aa as Ls,ab as Os,ac as Bs,ad as Vs,ae as zs,af as Ws,ag as qs,ah as Js,ai as Ys,aj as Hs,ak as Ks,al as Zs,am as Qs,an as Xs,ao as ea}from"./icons.BuydtrNC.js";import{Q as sa,a as aa}from"./query.BsNGtoLU.js";var ta,ra,la=(ta={"assets/index.BDBsfRbO.js"(e){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var s,a={},t=function(){if(s)return a;s=1;var e=_e();return a.createRoot=e.createRoot,a.hydrateRoot=e.hydrateRoot,a}();const r=De(t),l="https://iugjtokydvbcvmrpeziv.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1Z2p0b2t5ZHZiY3ZtcnBleml2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU3MTk3NjUsImV4cCI6MjA2MTI5NTc2NX0.XCNQoJbGQiXuyR_CFevro1Y8lqvh2_jmjrD181UYtY4";let i=null;const ta=i||(console.log("Initializing Supabase client:",{url:l,keyLength:208,timestamp:(new Date).toISOString()}),i=Pe(l,n,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storage:window.localStorage},global:{headers:{"X-Client-Info":"dasboard-app"}}}),i),ra=new Map;let la=new Set;const na=()=>h(null,null,function*(){try{const{data:{user:e},error:s}=yield ta.auth.getUser();if(s)return console.error("Error getting user:",s),null;if(!e)return null;if(ra.has(e.id)){const s=ra.get(e.id);return console.log("Using cached role for user:",{userId:e.id,role:s}),c(o({},e),{role:s})}const a=`role-${e.id}`;if(la.has(a))return console.warn("Avoiding duplicate role request for user:",e.id),c(o({},e),{role:null});la.add(a);try{const{data:s,error:a}=yield ta.from("profiles").select("role").eq("id",e.id).single();if(a){console.error("Error fetching user role:",a);const{data:s,error:t}=yield ta.from("users").select("role_id").eq("id",e.id).single();if(!t&&(null==s?void 0:s.role_id)){const{data:a}=yield ta.from("roles").select("name").eq("id",s.role_id).single();if(null==a?void 0:a.name)return ra.set(e.id,a.name),c(o({},e),{role:a.name})}return ra.set(e.id,"viewer"),c(o({},e),{role:"viewer"})}return ra.set(e.id,s.role),c(o({},e),{role:s.role})}finally{la.delete(a)}}catch(e){return console.error("Error in getCurrentUser:",e),null}}),ia=e=>/(@exampletest\.com|@example\.com|test.*@)/.test(e.toLowerCase()),oa=(e,s)=>h(null,null,function*(){try{if(console.log(`[supabaseClient] Logging in test user: ${e}`),!ia(e))return console.warn("[supabaseClient] This is not a test email, should use regular login"),{error:new Error("Not a test email")};const r=e.toLowerCase().includes("group")&&e.toLowerCase().includes("@exampletest.com");r&&(console.log(`[supabaseClient] ${e} - detected as a group admin by email pattern`),localStorage.setItem("force_redirect_after_login","/group-admin"),localStorage.setItem("force_redirect_timestamp",Date.now().toString()));const{data:l,error:n}=yield ta.auth.signInWithPassword({email:e,password:s,options:{persistSession:!0}});if(!n&&(null==l?void 0:l.user)){if(console.log(`[supabaseClient] Sign-in successful for ${e}, checking group admin status`),r){console.log(`[supabaseClient] Setting group admin metadata for ${e}`);try{const{data:e,error:s}=yield ta.auth.updateUser({data:{is_group_admin:!0,role:"dealer_group_admin"}});s?console.warn("[supabaseClient] Could not update user metadata:",s):console.log("[supabaseClient] Updated user metadata for group admin:",e);const{error:a}=yield ta.from("profiles").update({is_group_admin:!0,role:"dealer_group_admin"}).eq("id",l.user.id);a?console.warn("[supabaseClient] Could not update profile:",a):console.log("[supabaseClient] Updated profile for group admin")}catch(a){console.error("[supabaseClient] Error setting group admin status:",a)}return console.log("[supabaseClient] Performing immediate redirect for group admin test user"),sessionStorage.setItem("auth_redirect_authorized","true"),setTimeout(()=>{window.location.href="/test-login-redirect"},500),{data:c(o({},l),{user:c(o({},l.user),{user_metadata:c(o({},l.user.user_metadata),{is_group_admin:!0,role:"dealer_group_admin"})})}),isGroupAdmin:!0,forceRedirect:!0,redirectPath:"/test-login-redirect",message:"Group admin test user logged in successfully"}}console.log(`[supabaseClient] Checking group admin status for ${e}`);try{const{data:s,error:a}=yield ta.from("profiles").select("is_group_admin, role, dealership_id").eq("id",l.user.id).maybeSingle();if(console.log("[supabaseClient] Test user profile data:",s),null==s?void 0:s.is_group_admin){console.log(`[supabaseClient] User ${e} is a group admin`);const{data:a,error:t}=yield ta.auth.updateUser({data:{is_group_admin:!0,role:s.role||"dealer_group_admin"}});return t?console.warn("[supabaseClient] Could not update user metadata:",t):console.log("[supabaseClient] Updated user metadata for group admin"),{data:l,isGroupAdmin:!0,message:"Group admin test user logged in successfully"}}}catch(t){console.error("[supabaseClient] Error checking group admin status:",t)}return{data:l,message:"Test user logged in successfully"}}return(null==l?void 0:l.session)?{data:l,message:"Test user logged in successfully"}:{error:n,message:"Failed to log in test user"}}catch(r){return console.error("[supabaseClient] Exception in loginTestUser:",r),{error:r instanceof Error?r:new Error("Unknown error during test login")}}});var ca=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),da=he.forwardRef((e,s)=>u.jsx(x.span,c(o({},e),{ref:s,style:o(o({},ca),e.style)})));da.displayName="VisuallyHidden";var ma="ToastProvider",[ha,ua,xa]=g("Toast"),[pa,ga]=p("Toast",[xa]),[fa,ja]=pa(ma),va=e=>{const{__scopeToast:s,label:a="Notification",duration:t=5e3,swipeDirection:r="right",swipeThreshold:l=50,children:n}=e,[i,o]=he.useState(null),[c,d]=he.useState(0),m=he.useRef(!1),h=he.useRef(!1);return a.trim()||console.error(`Invalid prop \`label\` supplied to \`${ma}\`. Expected non-empty \`string\`.`),u.jsx(ha.Provider,{scope:s,children:u.jsx(fa,{scope:s,label:a,duration:t,swipeDirection:r,swipeThreshold:l,toastCount:c,viewport:i,onViewportChange:o,onToastAdd:he.useCallback(()=>d(e=>e+1),[]),onToastRemove:he.useCallback(()=>d(e=>e-1),[]),isFocusedToastEscapeKeyDownRef:m,isClosePausedRef:h,children:n})})};va.displayName=ma;var ba="ToastViewport",Na=["F8"],ya="toast.viewportPause",wa="toast.viewportResume",Sa=he.forwardRef((e,s)=>{const a=e,{__scopeToast:t,hotkey:r=Na,label:l="Notifications ({hotkey})"}=a,n=d(a,["__scopeToast","hotkey","label"]),i=ja(ba,t),m=ua(t),h=he.useRef(null),p=he.useRef(null),g=he.useRef(null),v=he.useRef(null),b=f(s,v,i.onViewportChange),N=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),y=i.toastCount>0;he.useEffect(()=>{const e=e=>{var s;0!==r.length&&r.every(s=>e[s]||e.code===s)&&(null==(s=v.current)||s.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r]),he.useEffect(()=>{const e=h.current,s=v.current;if(y&&e&&s){const a=()=>{if(!i.isClosePausedRef.current){const e=new CustomEvent(ya);s.dispatchEvent(e),i.isClosePausedRef.current=!0}},t=()=>{if(i.isClosePausedRef.current){const e=new CustomEvent(wa);s.dispatchEvent(e),i.isClosePausedRef.current=!1}},r=s=>{!e.contains(s.relatedTarget)&&t()},l=()=>{e.contains(document.activeElement)||t()};return e.addEventListener("focusin",a),e.addEventListener("focusout",r),e.addEventListener("pointermove",a),e.addEventListener("pointerleave",l),window.addEventListener("blur",a),window.addEventListener("focus",t),()=>{e.removeEventListener("focusin",a),e.removeEventListener("focusout",r),e.removeEventListener("pointermove",a),e.removeEventListener("pointerleave",l),window.removeEventListener("blur",a),window.removeEventListener("focus",t)}}},[y,i.isClosePausedRef]);const w=he.useCallback(({tabbingDirection:e})=>{const s=m().map(s=>{const a=s.ref.current,t=[a,...Va(a)];return"forwards"===e?t:t.reverse()});return("forwards"===e?s.reverse():s).flat()},[m]);return he.useEffect(()=>{const e=v.current;if(e){const s=s=>{var a,t,r;const l=s.altKey||s.ctrlKey||s.metaKey;if("Tab"===s.key&&!l){const l=document.activeElement,n=s.shiftKey;if(s.target===e&&n)return void(null==(a=p.current)||a.focus());const i=w({tabbingDirection:n?"backwards":"forwards"}),o=i.findIndex(e=>e===l);za(i.slice(o+1))?s.preventDefault():n?null==(t=p.current)||t.focus():null==(r=g.current)||r.focus()}};return e.addEventListener("keydown",s),()=>e.removeEventListener("keydown",s)}},[m,w]),u.jsxs(j,{ref:h,role:"region","aria-label":l.replace("{hotkey}",N),tabIndex:-1,style:{pointerEvents:y?void 0:"none"},children:[y&&u.jsx(Da,{ref:p,onFocusFromOutsideViewport:()=>{za(w({tabbingDirection:"forwards"}))}}),u.jsx(ha.Slot,{scope:t,children:u.jsx(x.ol,c(o({tabIndex:-1},n),{ref:b}))}),y&&u.jsx(Da,{ref:g,onFocusFromOutsideViewport:()=>{za(w({tabbingDirection:"backwards"}))}})]})});Sa.displayName=ba;var _a="ToastFocusProxy",Da=he.forwardRef((e,s)=>{const a=e,{__scopeToast:t,onFocusFromOutsideViewport:r}=a,l=d(a,["__scopeToast","onFocusFromOutsideViewport"]),n=ja(_a,t);return u.jsx(da,c(o({"aria-hidden":!0,tabIndex:0},l),{ref:s,style:{position:"fixed"},onFocus:e=>{var s;const a=e.relatedTarget;!(null==(s=n.viewport)?void 0:s.contains(a))&&r()}}))});Da.displayName=_a;var Pa="Toast",Ca=he.forwardRef((e,s)=>{const a=e,{forceMount:t,open:r,defaultOpen:l,onOpenChange:n}=a,i=d(a,["forceMount","open","defaultOpen","onOpenChange"]),[m,h]=v({prop:r,defaultProp:null==l||l,onChange:n,caller:Pa});return u.jsx(b,{present:t||m,children:u.jsx(Fa,c(o({open:m},i),{ref:s,onClose:()=>h(!1),onPause:y(e.onPause),onResume:y(e.onResume),onSwipeStart:N(e.onSwipeStart,e=>{e.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:N(e.onSwipeMove,e=>{const{x:s,y:a}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${s}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${a}px`)}),onSwipeCancel:N(e.onSwipeCancel,e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:N(e.onSwipeEnd,e=>{const{x:s,y:a}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${s}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${a}px`),h(!1)})}))})});Ca.displayName=Pa;var[ka,Ta]=pa(Pa,{onClose(){}}),Fa=he.forwardRef((e,s)=>{const a=e,{__scopeToast:t,type:r="foreground",duration:l,open:n,onClose:i,onEscapeKeyDown:m,onPause:h,onResume:p,onSwipeStart:g,onSwipeMove:j,onSwipeCancel:v,onSwipeEnd:b}=a,S=d(a,["__scopeToast","type","duration","open","onClose","onEscapeKeyDown","onPause","onResume","onSwipeStart","onSwipeMove","onSwipeCancel","onSwipeEnd"]),_=ja(Pa,t),[D,P]=he.useState(null),C=f(s,e=>P(e)),k=he.useRef(null),T=he.useRef(null),F=l||_.duration,A=he.useRef(0),E=he.useRef(F),I=he.useRef(0),{onToastAdd:U,onToastRemove:G}=_,M=y(()=>{var e;(null==D?void 0:D.contains(document.activeElement))&&(null==(e=_.viewport)||e.focus()),i()}),R=he.useCallback(e=>{e&&e!==1/0&&(window.clearTimeout(I.current),A.current=(new Date).getTime(),I.current=window.setTimeout(M,e))},[M]);he.useEffect(()=>{const e=_.viewport;if(e){const s=()=>{R(E.current),null==p||p()},a=()=>{const e=(new Date).getTime()-A.current;E.current=E.current-e,window.clearTimeout(I.current),null==h||h()};return e.addEventListener(ya,a),e.addEventListener(wa,s),()=>{e.removeEventListener(ya,a),e.removeEventListener(wa,s)}}},[_.viewport,F,h,p,R]),he.useEffect(()=>{n&&!_.isClosePausedRef.current&&R(F)},[n,F,_.isClosePausedRef,R]),he.useEffect(()=>(U(),()=>G()),[U,G]);const $=he.useMemo(()=>D?La(D):null,[D]);return _.viewport?u.jsxs(u.Fragment,{children:[$&&u.jsx(Aa,{__scopeToast:t,role:"status","aria-live":"foreground"===r?"assertive":"polite","aria-atomic":!0,children:$}),u.jsx(ka,{scope:t,onClose:M,children:ue.createPortal(u.jsx(ha.ItemSlot,{scope:t,children:u.jsx(w,{asChild:!0,onEscapeKeyDown:N(m,()=>{_.isFocusedToastEscapeKeyDownRef.current||M(),_.isFocusedToastEscapeKeyDownRef.current=!1}),children:u.jsx(x.li,c(o({role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":n?"open":"closed","data-swipe-direction":_.swipeDirection},S),{ref:C,style:o({userSelect:"none",touchAction:"none"},e.style),onKeyDown:N(e.onKeyDown,e=>{"Escape"===e.key&&(null==m||m(e.nativeEvent),e.nativeEvent.defaultPrevented||(_.isFocusedToastEscapeKeyDownRef.current=!0,M()))}),onPointerDown:N(e.onPointerDown,e=>{0===e.button&&(k.current={x:e.clientX,y:e.clientY})}),onPointerMove:N(e.onPointerMove,e=>{if(!k.current)return;const s=e.clientX-k.current.x,a=e.clientY-k.current.y,t=Boolean(T.current),r=["left","right"].includes(_.swipeDirection),l=["left","up"].includes(_.swipeDirection)?Math.min:Math.max,n=r?l(0,s):0,i=r?0:l(0,a),o="touch"===e.pointerType?10:2,c={x:n,y:i},d={originalEvent:e,delta:c};t?(T.current=c,Oa("toast.swipeMove",j,d,{discrete:!1})):Ba(c,_.swipeDirection,o)?(T.current=c,Oa("toast.swipeStart",g,d,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(s)>o||Math.abs(a)>o)&&(k.current=null)}),onPointerUp:N(e.onPointerUp,e=>{const s=T.current,a=e.target;if(a.hasPointerCapture(e.pointerId)&&a.releasePointerCapture(e.pointerId),T.current=null,k.current=null,s){const a=e.currentTarget,t={originalEvent:e,delta:s};Ba(s,_.swipeDirection,_.swipeThreshold)?Oa("toast.swipeEnd",b,t,{discrete:!0}):Oa("toast.swipeCancel",v,t,{discrete:!0}),a.addEventListener("click",e=>e.preventDefault(),{once:!0})}})}))})}),_.viewport)})]}):null}),Aa=e=>{const s=e,{__scopeToast:a,children:t}=s,r=d(s,["__scopeToast","children"]),l=ja(Pa,a),[n,i]=he.useState(!1),[m,h]=he.useState(!1);return function(e=()=>{}){const s=y(e);_(()=>{let e=0,a=0;return e=window.requestAnimationFrame(()=>a=window.requestAnimationFrame(s)),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(a)}},[s])}(()=>i(!0)),he.useEffect(()=>{const e=window.setTimeout(()=>h(!0),1e3);return()=>window.clearTimeout(e)},[]),m?null:u.jsx(S,{asChild:!0,children:u.jsx(da,c(o({},r),{children:n&&u.jsxs(u.Fragment,{children:[l.label," ",t]})}))})},Ea=he.forwardRef((e,s)=>{const a=e,{__scopeToast:t}=a,r=d(a,["__scopeToast"]);return u.jsx(x.div,c(o({},r),{ref:s}))});Ea.displayName="ToastTitle";var Ia=he.forwardRef((e,s)=>{const a=e,{__scopeToast:t}=a,r=d(a,["__scopeToast"]);return u.jsx(x.div,c(o({},r),{ref:s}))});Ia.displayName="ToastDescription";var Ua="ToastAction",Ga=he.forwardRef((e,s)=>{const a=e,{altText:t}=a,r=d(a,["altText"]);return t.trim()?u.jsx($a,{altText:t,asChild:!0,children:u.jsx(Ra,c(o({},r),{ref:s}))}):(console.error(`Invalid prop \`altText\` supplied to \`${Ua}\`. Expected non-empty \`string\`.`),null)});Ga.displayName=Ua;var Ma="ToastClose",Ra=he.forwardRef((e,s)=>{const a=e,{__scopeToast:t}=a,r=d(a,["__scopeToast"]),l=Ta(Ma,t);return u.jsx($a,{asChild:!0,children:u.jsx(x.button,c(o({type:"button"},r),{ref:s,onClick:N(e.onClick,l.onClose)}))})});Ra.displayName=Ma;var $a=he.forwardRef((e,s)=>{const a=e,{__scopeToast:t,altText:r}=a,l=d(a,["__scopeToast","altText"]);return u.jsx(x.div,c(o({"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0},l),{ref:s}))});function La(e){const s=[];return Array.from(e.childNodes).forEach(e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&s.push(e.textContent),function(e){return e.nodeType===e.ELEMENT_NODE}(e)){const a=e.ariaHidden||e.hidden||"none"===e.style.display,t=""===e.dataset.radixToastAnnounceExclude;if(!a)if(t){const a=e.dataset.radixToastAnnounceAlt;a&&s.push(a)}else s.push(...La(e))}}),s}function Oa(e,s,a,{discrete:t}){const r=a.originalEvent.currentTarget,l=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:a});s&&r.addEventListener(e,s,{once:!0}),t?D(r,l):r.dispatchEvent(l)}var Ba=(e,s,a=0)=>{const t=Math.abs(e.x),r=Math.abs(e.y),l=t>r;return"left"===s||"right"===s?l&&t>a:!l&&r>a};function Va(e){const s=[],a=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const s="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||s?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)s.push(a.currentNode);return s}function za(e){const s=document.activeElement;return e.some(e=>e===s||(e.focus(),document.activeElement!==s))}var Wa=Sa,qa=Ca,Ja=Ea,Ya=Ia,Ha=Ga,Ka=Ra;const Za=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,Qa=Ce,Xa=(e,s)=>a=>{var t;if(null==(null==s?void 0:s.variants))return Qa(e,null==a?void 0:a.class,null==a?void 0:a.className);const{variants:r,defaultVariants:l}=s,n=Object.keys(r).map(e=>{const s=null==a?void 0:a[e],t=null==l?void 0:l[e];if(null===s)return null;const n=Za(s)||Za(t);return r[e][n]}),i=a&&Object.entries(a).reduce((e,s)=>{let[a,t]=s;return void 0===t||(e[a]=t),e},{}),c=null==s||null===(t=s.compoundVariants)||void 0===t?void 0:t.reduce((e,s)=>{let a=s,{class:t,className:r}=a,n=d(a,["class","className"]);return Object.entries(n).every(e=>{let[s,a]=e;return Array.isArray(a)?a.includes(o(o({},l),i)[s]):o(o({},l),i)[s]===a})?[...e,t,r]:e},[]);return Qa(e,n,c,null==a?void 0:a.class,null==a?void 0:a.className)};function et(...e){return ke(Ce(e))}const st=va,at=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(Wa,o({ref:s,className:et("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t)},r))});at.displayName=Wa.displayName;const tt=Xa("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),rt=he.forwardRef((e,s)=>{var a=e,{className:t,variant:r}=a,l=d(a,["className","variant"]);return u.jsx(qa,o({ref:s,className:et(tt({variant:r}),t)},l))});rt.displayName=qa.displayName,he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(Ha,o({ref:s,className:et("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t)},r))}).displayName=Ha.displayName,he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(Ka,c(o({ref:s,className:et("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":""},r),{children:u.jsx(Te,{className:"h-4 w-4"})}))}).displayName=Ka.displayName,he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(Ja,o({ref:s,className:et("text-sm font-semibold [&+div]:text-xs",t)},r))}).displayName=Ja.displayName,he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(Ya,o({ref:s,className:et("text-sm opacity-90",t)},r))}).displayName=Ya.displayName;let lt=0;const nt=new Map,it=(e,s)=>{switch(s.type){case"ADD_TOAST":return c(o({},e),{toasts:[s.toast,...e.toasts].slice(0,3)});case"UPDATE_TOAST":return c(o({},e),{toasts:e.toasts.map(e=>e.id===s.toast.id?o(o({},e),s.toast):e)});case"DISMISS_TOAST":{const{toastId:a}=s;return c(o({},e),void 0===a?{toasts:e.toasts.map(e=>c(o({},e),{open:!1}))}:{toasts:e.toasts.map(e=>e.id===a?c(o({},e),{open:!1}):e)})}case"REMOVE_TOAST":{const{toastId:a}=s;return c(o({},e),void 0===a?{toasts:[]}:{toasts:e.toasts.filter(e=>e.id!==a)})}}},ot=he.createContext(null);let ct=null;function dt(){const e=he.useContext(ot);if(!e)throw console.error("[ToastContext] useToast called outside of ToastProvider"),new Error("useToast must be used within a ToastProvider");return e}function mt({children:e}){const[s,a]=he.useReducer(it,{toasts:[]});he.useEffect(()=>(console.log("[ToastContext] Provider mounted"),()=>{console.log("[ToastContext] Provider unmounted")}),[]);const t=he.useCallback(e=>{const s=(lt=(lt+1)%Number.MAX_SAFE_INTEGER,lt.toString());console.log(`[ToastContext] Adding toast: ${s}`,e);const t=c(o({},e),{id:s,open:!0,onOpenChange:e=>{e||l(s)}});return a({type:"ADD_TOAST",toast:t}),s},[a]),r=he.useCallback(e=>{console.log(`[ToastContext] Updating toast: ${e.id}`,e),a({type:"UPDATE_TOAST",toast:e})},[a]),l=he.useCallback(e=>{console.log(`[ToastContext] Dismissing toast: ${e||"all"}`),a({type:"DISMISS_TOAST",toastId:e})},[a]),n=he.useCallback(e=>{console.log(`[ToastContext] Removing toast: ${e||"all"}`),void 0!==e&&nt.has(e)&&(clearTimeout(nt.get(e)),nt.delete(e)),a({type:"REMOVE_TOAST",toastId:e})},[a]);he.useEffect(()=>{s.toasts.forEach(e=>{if(!e.open&&!nt.has(e.id)){const s=setTimeout(()=>{n(e.id)},1e6);nt.set(e.id,s)}})},[s.toasts,n]);const i={toasts:s.toasts,addToast:t,removeToast:n,updateToast:r,dismissToast:l};return ct=i,console.log("[ToastContext] Rendering with state:",s),u.jsxs(ot.Provider,{value:i,children:[e,u.jsxs(st,{children:[s.toasts.map(e=>{var s=e,{id:a,title:t,description:r,action:l}=s,n=d(s,["id","title","description","action"]);return u.jsxs(rt,c(o({},n),{children:[t&&u.jsx("div",{className:"grid gap-1",children:t}),r&&u.jsx("div",{className:"text-sm opacity-90",children:r}),l]}),a)}),u.jsx(at,{})]})]})}function ht(e){try{return ct?ct.addToast(e):(console.warn("[ToastContext] Toast context not available yet. Toast will not be displayed."),console.log("[ToastContext] Toast props:",e),"")}catch(s){return console.error("[ToastContext] Error displaying toast:",s),console.log("[ToastContext] Toast props:",e),""}}ht.success=function(e){return ht(c(o({},e),{variant:"default"}))},ht.error=function(e){return ht(c(o({},e),{variant:"destructive"}))},ht.warning=function(e){return ht(c(o({},e),{variant:"warning"}))},ht.info=function(e){return ht(c(o({},e),{variant:"info"}))};const ut=(e,s)=>h(null,null,function*(){try{console.log(`[apiService] Logging schema operation: ${e}`,s);try{const{data:a,error:t}=yield ta.from("logs").insert({action:e,details:s}).select().single();return t?(console.log("[apiService] Error logging schema operation, continuing silently:",t.message),!0):(console.log("[apiService] Logged schema operation:",a),!0)}catch(a){return console.log("[apiService] Schema operation logging failed, continuing silently"),!0}}catch(t){return console.log("[apiService] Exception in logSchemaOperation, continuing silently"),!0}}),xt=(e,s,a)=>h(null,null,function*(){console.log("[apiService] Getting deals for user:",e,"from:",s,"to:",a);try{const{data:t,error:r}=yield ta.from("deals").select("*").eq("salesperson_id",e).gte("sale_date",s).lte("sale_date",a);if(r)throw console.error("[apiService] Error fetching deals:",r),r;return console.log(`[apiService] Found ${(null==t?void 0:t.length)||0} deals`),t||[]}catch(t){throw console.error("[apiService] Unexpected error fetching deals:",t),t}}),pt=(e,s,a)=>h(null,null,function*(){console.log("[apiService] Getting days off for user:",e);try{const{data:t,error:r}=yield ta.from("schedule").select("*").eq("user_id",e).gte("date",s).lte("date",a).eq("is_day_off",!0);if(r)return console.error("[apiService] Error fetching schedule:",r),[5,8,15,18,25,27,29];const l=(null==t?void 0:t.map(e=>new Date(e.date).getDate()))||[];return console.log("[apiService] Days off this month:",l),0===l.length?(console.log("[apiService] No days off found, using default pattern"),[5,8,15,18,25,27,29]):l}catch(t){return console.error("[apiService] Unexpected error fetching schedule:",t),[5,8,15,18,25,27,29]}}),gt=(e,s,a,t=15)=>{const r=((e,s)=>{let a=0;for(let t=1;t<=Math.min(10,e);t++)s.includes(t)||t%3!=0||a++;if(e>10)for(let t=11;t<=Math.min(20,e);t++)s.includes(t)||t%2!=0||a++;if(e>20)for(let t=21;t<=e;t++)s.includes(t)||a++;return console.log(`[apiService] Expected sales by day ${e}:`,a),a})(s,a),l=e.length,n=l/(r||1);let i="neutral";i=n>=1?"on-track":n>=.8?"slightly-behind":"behind";const o=Math.min(100,Math.round(l/t*100));return console.log("[apiService] Goal progress calculation:",{currentDay:s,expectedSales:r,actualSales:l,progressRatio:n,status:i,progressPercentage:o}),{expected:r,actual:l,progress:o,status:i,progressRatio:n}},ft=[{id:"test-admin-id",email:"testadmin@example.com",role:"admin",isAdmin:!0,name:"Test Admin"},{id:"group-admin-id",email:"group1.admin@exampletest.com",role:"dealer_group_admin",isGroupAdmin:!0,name:"Group Admin"},{id:"dealership-admin-id",email:"dealer1.admin@exampletest.com",role:"dealership_admin",dealershipId:1,name:"Dealership Admin"},{id:"sales-manager-id",email:"sales.manager@exampletest.com",role:"sales_manager",dealershipId:1,name:"Sales Manager"},{id:"sales-id",email:"sales@exampletest.com",role:"salesperson",dealershipId:1,name:"Salesperson"},{id:"finance-manager-1-id",email:"finance@exampletest.com",role:"finance_manager",dealershipId:1,name:"Finance Manager"},{id:"finance-manager-2-id",email:"testfinance@example.com",role:"single_finance_manager",dealershipId:1,name:"Single Finance Manager"},{id:"finance-manager-3-id",email:"finance1@exampletest.com",role:"single_finance_manager",dealershipId:1,name:"Single Finance Manager 2"},{id:"avp-id",email:"avp@exampletest.com",role:"area_vice_president",name:"Area Vice President"},{id:"avp-id",email:"avp@exampletest.com",role:"area_vice_president",name:"Area Vice President"}],jt="direct_auth_user",vt="directauth_user";let bt,Nt=0;function yt(){const e=Date.now();return void 0!==bt&&e-Nt<1e3||(bt=function(){const e=localStorage.getItem(jt);if(e)try{return JSON.parse(e)}catch(a){}const s=localStorage.getItem(vt);if(s)try{return console.log("[directAuth] Found user from dashboard selector"),JSON.parse(s)}catch(a){}return null}(),Nt=e),bt}function wt(){return null!==yt()}function St(){console.log("[directAuth] Logging out - clearing all auth keys"),localStorage.removeItem(jt),localStorage.removeItem(vt),localStorage.removeItem("directauth_timestamp"),bt=void 0}function _t(e){const s=ft.find(s=>s.email.toLowerCase()===e.toLowerCase());return s?(localStorage.setItem(jt,JSON.stringify(s)),{success:!0,message:`Logged in as ${s.name||s.email}`}):{success:!1,message:`No test account found for ${e}`}}function Dt(e){return e.isAdmin?"/master-admin":e.isGroupAdmin?"/group-admin":"dealership_admin"===e.role?"/dashboard/admin":"sales_manager"===e.role?"/dashboard/sales-manager":"finance_manager"===e.role?"/dashboard/finance":"single_finance_manager"===e.role?"/dashboard/single-finance":"general_manager"===e.role?"/dashboard/gm":"area_vice_president"===e.role?"/avp-full-dashboard":"/dashboard/sales"}const Pt=he.createContext(void 0),Ct="salesperson",kt="finance_manager",Tt=new Map,Ft=(e,s)=>{const a=(new Date).toISOString();console.log(`[AuthContext][${a}] ${e}`,c(o({},s),{app_version:"1.0.0",environment:"production",timestamp:a}));try{"undefined"!=typeof window&&(window.authEvents||(window.authEvents=[]),window.authEvents.length>100&&window.authEvents.shift(),window.authEvents.push({event:e,details:s,timestamp:a}))}catch(t){console.error("[AuthContext] Error logging auth event to window object:",t)}},At=(e,s)=>{const a=(new Date).toISOString();console.warn(`[SecurityEvent][${a}] ${e}`,c(o({},s),{user_agent:navigator.userAgent,app_url:window.location.href,timestamp:a}))},Et=({children:e})=>{const[s,a]=he.useState(null),[t,r]=he.useState(null),[l,n]=he.useState(!0),[i,o]=he.useState(!1),[c,d]=he.useState(!1),m=he.useRef(0),x=he.useRef(!1),[p,g]=he.useState(null),[f,j]=he.useState(null),[v,b]=he.useState(null),[N,y]=he.useState(null),[w,S]=he.useState(!1),[_,D]=he.useState(!1),P=e=>h(null,null,function*(){var a;try{console.warn(`[DEBUG AUTH] Fetching profile data for user ${e}`);const{data:t,error:r}=yield ta.from("profiles").select("*").eq("id",e).maybeSingle();return r?(console.error("[DEBUG AUTH] Error fetching profile:",r),null):t?(console.warn("[DEBUG AUTH] Profile data found:",t),console.warn("[DEBUG AUTH] Group admin detection:",{isGroupAdmin:!!t.is_group_admin,userEmail:t.email,userRole:t.role,userData:t,userMetadata:null==s?void 0:s.user_metadata}),!t.is_group_admin&&(null==(a=null==s?void 0:s.user_metadata)?void 0:a.is_group_admin)&&(console.warn("[DEBUG AUTH] Group admin flag found in user metadata"),S(!0)),t.is_group_admin?(console.warn("[DEBUG AUTH] User is a group admin!"),S(!0)):(console.warn("[DEBUG AUTH] User is not a group admin"),S(!1)),t):(console.warn("[DEBUG AUTH] No profile data found"),null)}catch(t){return console.error("[DEBUG AUTH] Error in fetchProfileData:",t),null}}),C=he.useCallback(e=>{Ft("Setting dealership context",{dealership_id:e,previous_id:v,user_id:null==s?void 0:s.id,user_email:null==s?void 0:s.email}),b(e),ta.from("dealerships").select("name").eq("id",e).single().then(({data:s,error:a})=>{a?console.error("[AuthContext] Error fetching dealership name:",a):s&&(y(s.name),Ft("Dealership name fetched",{dealership_id:e,dealership_name:s.name}))}),ut("set_dealership_context",{userId:null==s?void 0:s.id,dealershipId:e,timestamp:(new Date).toISOString()}).catch(e=>{console.error("[AuthContext] Error logging dealership context change:",e)})},[s,v]),k=he.useCallback((e,s)=>{try{ht({title:e,description:s,variant:"default"})}catch(a){console.error("[AuthContext] Error showing success toast:",a)}},[]),T=he.useCallback((e,s)=>{try{ht({title:e,description:s,variant:"destructive"})}catch(a){console.error("[AuthContext] Error showing error toast:",a)}},[]),F=he.useCallback((e,s)=>{try{ht({title:e,description:s,variant:"info"})}catch(a){console.error("[AuthContext] Error showing info toast:",a)}},[]),A=he.useCallback(e=>h(null,null,function*(){var s,a;try{Ft("Fetching user dealership",{user_id:e});const{data:t,error:l}=yield ta.from("users").select("dealership_id, role_id, roles(name)").eq("id",e).maybeSingle();if(!l&&(null==t?void 0:t.dealership_id)){if(Ft("Fetched dealership from users table",{user_id:e,dealership_id:t.dealership_id,role_id:t.role_id,role_name:null==(s=t.roles)?void 0:s.name}),null==(a=t.roles)?void 0:a.name){const s=t.roles.name.toLowerCase();r(s),j(s),Ft("Set user role from users table",{user_id:e,role:s})}return t.dealership_id}const{data:n,error:i}=yield ta.from("profiles").select("dealership_id, role").eq("id",e).maybeSingle();if(i)return Ft("Error fetching user dealership from profiles",{user_id:e,error:i.message,code:i.code}),null;if(null==n?void 0:n.role){const s=n.role.toLowerCase();r(s),j(s),Ft("Set user role from profiles table",{user_id:e,role:s})}return Ft("Fetched dealership from profiles table",{user_id:e,dealership_id:null==n?void 0:n.dealership_id}),(null==n?void 0:n.dealership_id)&&ta.from("dealerships").select("name").eq("id",n.dealership_id).single().then(({data:e,error:s})=>{s?Ft("Error fetching dealership name",{dealership_id:n.dealership_id,error:s.message}):e&&(y(e.name),Ft("Set dealership name",{dealership_id:n.dealership_id,dealership_name:e.name}))}),(null==n?void 0:n.dealership_id)||null}catch(t){return Ft("Exception fetching user dealership",{user_id:e,error:t instanceof Error?t.message:String(t)}),null}}),[]),E=he.useCallback(e=>h(null,null,function*(){var s,a,r,l,n;if(console.log("[AuthContext] fetchUserRole called for userId:",e,{timestamp:(new Date).toISOString()}),console.log("[AuthContext] Role debugging - current states:",{currentRole:t,hasSession:i,dealershipId:v,userId:e}),x.current)return console.log("[AuthContext] Profile operation already in progress, waiting...",{userId:e,timestamp:(new Date).toISOString()}),m.current<3?(m.current++,yield new Promise(e=>setTimeout(e,500)),E(e)):(console.warn("[AuthContext] Max retries reached for fetchUserRole, using fallback role",{userId:e,timestamp:(new Date).toISOString()}),kt);x.current=!0,m.current=0;try{const t=yield(e=>h(null,null,function*(){try{Ft("Checking profile existence",{user_id:e});const{data:s,error:a}=yield ta.from("profiles").select("id").eq("id",e).maybeSingle();if(a)return Ft("Profile check error",{user_id:e,error:a.message,code:a.code}),!1;const t=!!s;return Ft("Profile check result",{user_id:e,exists:t,data:s?"found":"not found"}),t}catch(s){return Ft("Profile check exception",{user_id:e,error:s instanceof Error?s.message:String(s)}),!1}}))(e);if(t){console.log("[AuthContext] Profile exists, fetching role",{userId:e,timestamp:(new Date).toISOString()});try{const{data:t,error:r}=yield ta.from("profiles").select("role, dealership_id").eq("id",e).maybeSingle();if(r)return console.error("[AuthContext] Error fetching role:",r,{userId:e,timestamp:(new Date).toISOString()}),kt;if(console.log("[AuthContext] Profile data retrieved:",{profileData:t,hasRole:!!(null==t?void 0:t.role),rawRole:null==t?void 0:t.role,normalizedRole:null==(s=null==t?void 0:t.role)?void 0:s.toLowerCase(),isDealershipAdmin:"dealership_admin"===(null==(a=null==t?void 0:t.role)?void 0:a.toLowerCase()),timestamp:(new Date).toISOString()}),(null==t?void 0:t.dealership_id)&&(b(t.dealership_id),console.log("[AuthContext] Set dealership ID:",t.dealership_id)),null==t?void 0:t.role){const s=t.role.toLowerCase();return console.log("[AuthContext] Role found:",t.role,{normalizedRole:s,userId:e,timestamp:(new Date).toISOString()}),s}return console.log("[AuthContext] Profile exists but no role found, using fallback role",{userId:e,timestamp:(new Date).toISOString()}),kt}catch(o){return console.error("[AuthContext] Exception fetching role:",o,{userId:e,timestamp:(new Date).toISOString()}),kt}}console.log("[AuthContext] Creating profile with default role",{userId:e,timestamp:(new Date).toISOString()}),Tt.set(e,!0);try{const{data:s}=yield ta.auth.getUser(),a={id:e,role:Ct,email:(null==(r=s.user)?void 0:r.email)||"",name:(null==(n=null==(l=s.user)?void 0:l.user_metadata)?void 0:n.name)||"",dealership_id:1};console.log("[AuthContext] Inserting profile with data:",JSON.stringify(a),{timestamp:(new Date).toISOString()});const t=()=>h(null,null,function*(){try{const{error:e}=yield ta.from("profiles").insert([a]);return{error:e}}catch(o){return{error:o}}}),i=new Promise(e=>{setTimeout(()=>{e({error:new Error("Profile insertion timeout")})},5e3)}),{error:c}=yield Promise.race([t(),i]);return c?(console.error("[AuthContext] Error inserting profile:",c,{userId:e,timestamp:(new Date).toISOString()}),kt):(console.log("[AuthContext] Profile insertion successful",{userId:e,timestamp:(new Date).toISOString()}),b(1),ut("profile_creation",{userId:e,role:Ct,dealershipId:1,timestamp:(new Date).toISOString()}).catch(e=>{console.error("[AuthContext] Error logging profile creation:",e)}),Ct)}catch(o){return console.error("[AuthContext] Error in profile creation:",o,{userId:e,timestamp:(new Date).toISOString()}),kt}finally{x.current=!1}}catch(o){return console.error("[AuthContext] Unexpected error in fetchUserRole:",o,{userId:e,timestamp:(new Date).toISOString()}),x.current=!1,kt}}),[t]),I=he.useCallback(e=>h(null,null,function*(){var s,t;console.log("[AuthContext] Auth state changed, session exists:",!!e,{timestamp:(new Date).toISOString(),userId:(null==(s=null==e?void 0:e.user)?void 0:s.id)||"none",event:"auth_state_change"});try{if(o(!!e),null==e?void 0:e.user){if(a(e.user),console.log("[AuthContext] User set from session:",e.user.email,{userId:e.user.id,timestamp:(new Date).toISOString()}),null==(t=e.user.user_metadata)?void 0:t.is_group_admin)console.warn("[AuthContext] Group admin flag found in user metadata, setting isGroupAdmin=true"),S(!0),r("dealer_group_admin"),j("dealer_group_admin");else try{if(console.warn("[DEBUG AUTH] Checking group admin status during auth state change"),yield P(e.user.id),!w&&e.user.email&&e.user.email.toLowerCase().includes("group")&&e.user.email.toLowerCase().includes("@exampletest.com")){console.warn("[AuthContext] Email pattern suggests group admin but not set in profile/metadata"),S(!0),r("dealer_group_admin"),j("dealer_group_admin");try{yield ta.from("profiles").update({is_group_admin:!0,role:"dealer_group_admin"}).eq("id",e.user.id),yield ta.auth.updateUser({data:{is_group_admin:!0,role:"dealer_group_admin"}}),console.warn("[AuthContext] Updated profile and metadata for detected group admin")}catch(l){console.error("[AuthContext] Error updating group admin data:",l)}}}catch(i){console.error("[DEBUG AUTH] Error checking group admin status:",i)}try{m.current=0;const s=yield E(e.user.id);if(console.log("[AuthContext] Role fetched successfully:",s,{userId:e.user.id,timestamp:(new Date).toISOString()}),r(s),null===v){const s=yield A(e.user.id);s&&(b(s),console.log("[AuthContext] Dealership ID set from profile:",s),ut("dealership_assignment",{userId:e.user.id,dealershipId:s,timestamp:(new Date).toISOString()}).catch(e=>{console.error("[AuthContext] Error logging dealership assignment:",e)}))}}catch(c){console.error("[AuthContext] Error fetching role, using fallback:",c,{userId:e.user.id,timestamp:(new Date).toISOString()}),r(kt)}}else console.log("[AuthContext] No session, clearing user and role",{timestamp:(new Date).toISOString()}),a(null),r(null),b(null)}catch(c){console.error("[AuthContext] Error in handleAuthStateChange:",c,{sessionExists:!!e,timestamp:(new Date).toISOString()})}finally{n(!1),D(!0)}}),[E,A,v,w]);he.useEffect(()=>{let e=!0,i=null;h(null,null,function*(){var l;if(!c)try{if(console.log("[AuthContext] Initializing auth context",{timestamp:(new Date).toISOString()}),wt&&wt()){const s=yt();if(s){if(console.log("[AuthContext] Direct auth detected during initialization:",s.email),e){const e={id:s.id,email:s.email,user_metadata:{role:s.role},app_metadata:{},aud:"authenticated",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};a(e),r(s.role),S(s.isGroupAdmin||!1),n(!1),D(!0),o(!0),console.log("[AuthContext] Direct auth initialization completed with user data",{email:s.email,role:s.role,isGroupAdmin:s.isGroupAdmin})}return}}const{data:{session:c},error:x}=yield ta.auth.getSession();if(x)return console.error("[AuthContext] Error getting initial session:",x,{timestamp:(new Date).toISOString()}),void(e&&(n(!1),D(!0),g(x)));if(e&&(console.log("[AuthContext] Initial session exists:",!!c,{userId:(null==(l=null==c?void 0:c.user)?void 0:l.id)||"none",timestamp:(new Date).toISOString()}),o(!!c)),(null==c?void 0:c.user)&&e){console.log("[AuthContext] Found initial session for user:",c.user.email,{userId:c.user.id,timestamp:(new Date).toISOString()}),a(c.user);try{console.warn("[DEBUG AUTH] Checking group admin status during initialization"),yield P(c.user.id)}catch(m){console.error("[DEBUG AUTH] Error checking group admin status:",m)}try{const s=yield E(c.user.id);e&&(console.log("[AuthContext] Setting initial role:",s,{userId:c.user.id,timestamp:(new Date).toISOString()}),r(s))}catch(u){console.error("[AuthContext] Error fetching initial role, using fallback:",u,{userId:c.user.id,timestamp:(new Date).toISOString()}),e&&(console.log("[AuthContext] Setting fallback role due to error",{role:kt,timestamp:(new Date).toISOString()}),r(kt))}}e&&(n(!1),D(!0)),e&&(i=yield ta.auth.onAuthStateChange((a,r)=>h(null,null,function*(){var l,n;e&&(console.log("[AuthContext] Auth event:",a,{userId:(null==(l=null==r?void 0:r.user)?void 0:l.id)||"none",email:(null==(n=null==r?void 0:r.user)?void 0:n.email)||"none",timestamp:(new Date).toISOString()}),o(!!r),"INITIAL_SESSION"===a&&s&&t?console.log("[AuthContext] Skipping INITIAL_SESSION - already initialized",{userId:s.id,role:t,timestamp:(new Date).toISOString()}):yield I(r))}))),e&&d(!0)}catch(u){console.error("[AuthContext] Error in initialization:",u,{timestamp:(new Date).toISOString()}),e&&(n(!1),D(!0),g(u instanceof Error?u:new Error("Unknown initialization error")))}});const m=setTimeout(()=>{if(e&&l){if(wt&&wt())return console.log("[AuthContext] Safety timeout reached but direct auth is active - completing auth state"),n(!1),D(!0),void o(!0);console.error("[AuthContext] Safety timeout reached - forcing loading state to false"),n(!1),D(!0)}},5e3);return()=>{var s;e=!1,clearTimeout(m),(null==(s=null==i?void 0:i.data)?void 0:s.subscription)&&i.data.subscription.unsubscribe()}},[I,c,E]);const U=he.useCallback((e,s,...a)=>h(null,[e,s,...a],function*(e,s,a={}){try{console.log(`[AuthContext] Fetching data from schema for dealership: ${e}, table: ${s}`,{timestamp:(new Date).toISOString(),query:a});const{data:t,error:r}=yield ta.from("dealerships").select("schema_name").eq("id",e).single();if(r||!(null==t?void 0:t.schema_name))return console.error(`[AuthContext] Error fetching schema name for dealership ${e}:`,r),{data:null,error:r||new Error("No schema name found for dealership")};const l=t.schema_name;console.log(`[AuthContext] Using schema: ${l} for dealership: ${e}`);let n=ta.from(`${l}.${s}`);if(n=a.select?n.select(a.select):n.select("*"),a.filters)for(const e of a.filters)"eq"===e.type?n=n.eq(e.column,e.value):"in"===e.type?n=n.in(e.column,e.value):"gt"===e.type?n=n.gt(e.column,e.value):"lt"===e.type&&(n=n.lt(e.column,e.value));a.order&&(n=n.order(a.order.column,{ascending:a.order.ascending})),a.limit&&(n=n.limit(a.limit));const{data:i,error:o}=yield n;return o?(console.error(`[AuthContext] Error fetching data from ${l}.${s}:`,o),{data:null,error:o}):(console.log(`[AuthContext] Successfully fetched data from ${l}.${s}:`,{count:null==i?void 0:i.length}),{data:i,error:null})}catch(t){return console.error("[AuthContext] Exception in fetchFromDealershipSchema:",t),{data:null,error:t instanceof Error?t:new Error("Unknown error")}}}),[]),G={user:s,role:t,signIn:(e,s,t)=>h(null,null,function*(){var l,i,c,d,m;try{if(Ft("Sign in attempt",{email:e,remember_me:!!t,timestamp:(new Date).toISOString()}),n(!0),g(null),console.log("[AuthContext] Signing in user:",e,{timestamp:(new Date).toISOString(),rememberMe:!!t}),ia(e)){console.log("[AuthContext] Test email detected, using special login flow");const t=yield oa(e,s);if(t.error)throw t.error;const c=null==(l=t.data)?void 0:l.session;if(!c)throw new Error("No session returned from test login");console.log("[AuthContext] Test login successful for:",e,t),a(c.user),o(!0);const d=localStorage.getItem("force_redirect_after_login"),m=localStorage.getItem("force_redirect_timestamp"),h=m&&Date.now()-parseInt(m)<1e4;if(d&&h)return console.log("[AuthContext] Force redirect detected for test user to:",d),localStorage.removeItem("force_redirect_after_login"),localStorage.removeItem("force_redirect_timestamp"),n(!1),k("Welcome Back!","Login successful - redirecting..."),void(window.location.href=d);if(e.toLowerCase().includes("group")&&e.toLowerCase().includes("@exampletest.com"),w||t.isGroupAdmin)return console.warn("[AuthContext] GROUP ADMIN test account detected, forcing immediate redirect"),n(!1),k("Welcome Back!","Group Admin login successful"),void(window.location.href="/group-admin");if(t.isGroupAdmin)console.log("[AuthContext] Direct group admin flag detected, setting isGroupAdmin=true"),S(!0),r("dealer_group_admin"),j("dealer_group_admin");else if(console.warn("[DEBUG AUTH] Checking group admin status after test login"),null==(i=c.user)?void 0:i.id){const e=yield P(c.user.id),s=yield A(c.user.id);if(s&&b(s),null==e?void 0:e.role){const s=e.role.toLowerCase();r(s),j(s)}}return k("Welcome back!","You have successfully signed in as a test user."),void n(!1)}const{data:h,error:u}=yield ta.auth.signInWithPassword({email:e,password:s,options:{persistSession:null!=t&&t}});if(u)throw console.error("[AuthContext] Sign in error:",u),u;if(!h.user)throw console.error("[AuthContext] No user returned from authentication"),new Error("No user returned from authentication");console.log("[AuthContext] User authenticated successfully:",h.user.id),a(h.user),o(!0),console.warn("[DEBUG AUTH] Checking group admin status after login");const x=yield P(h.user.id),p=(null==(c=h.user.email)?void 0:c.toLowerCase().includes("group"))&&(null==(d=h.user.email)?void 0:d.toLowerCase().includes("@exampletest.com"));if(w||(null==x?void 0:x.is_group_admin)||p||(null==(m=h.user.user_metadata)?void 0:m.is_group_admin))return console.warn("[DEBUG AUTH] Group admin detected, forcing immediate redirect"),n(!1),k("Sign In Successful","Welcome, Group Admin!"),void setTimeout(()=>{window.location.href="/group-admin"},100);const f=yield A(h.user.id);f?(b(f),console.log(`[AuthContext] User belongs to dealership: ${f}`)):(console.log("[AuthContext] No dealership found for user, using default"),b(1)),k("Sign In Successful",`Welcome back, ${e}!`)}catch(h){Ft("Sign in error",{email:e,error:h instanceof Error?h.message:String(h)}),At("Failed login attempt",{email:e,error:h instanceof Error?h.message:String(h),ip_address:"client-side"}),g(h instanceof Error?h:new Error("Unknown error occurred during sign in")),T("Sign In Failed",h instanceof Error?h.message:"Unknown error occurred during sign in")}finally{n(!1)}}),signUp:(e,s,a)=>h(null,null,function*(){if(console.log("[AuthContext] Signing up:",e,{timestamp:(new Date).toISOString()}),e&&s&&a)try{n(!0);const{data:r,error:l}=yield ta.auth.signUp({email:e,password:s,options:{data:{first_name:a.firstName,last_name:a.lastName}}});if(l)return console.error("[AuthContext] Sign up error:",l.message,{code:l.name,timestamp:(new Date).toISOString()}),g(l),void T("Sign up failed",l.message);if(r.user){try{console.log("[AuthContext] Creating profile for new user:",r.user.id,{email:e,timestamp:(new Date).toISOString()});const{error:s}=yield ta.from("profiles").insert([{id:r.user.id,email:e,name:`${a.firstName} ${a.lastName}`,role:Ct,dealership_id:1}]);s?console.error("[AuthContext] Error creating profile during signup:",s,{userId:r.user.id,timestamp:(new Date).toISOString()}):console.log("[AuthContext] Profile successfully created during signup",{userId:r.user.id,timestamp:(new Date).toISOString()})}catch(t){console.error("[AuthContext] Exception creating profile during signup:",t,{userId:r.user.id,timestamp:(new Date).toISOString()})}console.log("[AuthContext] Sign up successful for:",e,{userId:r.user.id,timestamp:(new Date).toISOString()}),k("Account created","Your account has been created successfully")}}catch(r){console.error("[AuthContext] Error in signUp:",r,{email:e,timestamp:(new Date).toISOString()});const s=r instanceof Error?r.message:String(r);g(r instanceof Error?r:new Error(s)),T("Sign up failed",s)}finally{n(!1)}}),signOut:()=>h(null,null,function*(){try{Ft("Sign out initiated",{user_id:null==s?void 0:s.id,email:null==s?void 0:s.email}),console.log("[AuthContext] Signing out user:",null==s?void 0:s.email,{userId:null==s?void 0:s.id,timestamp:(new Date).toISOString()});try{localStorage.setItem("logout_in_progress","true"),n(!0),F("Signing Out","Please wait while we sign you out...")}catch(e){console.error("[AuthContext] Error during pre-logout cleanup:",e)}return console.log("[AuthContext] Redirecting to logout page"),void(window.location.href="/logout")}catch(a){Ft("Sign out error",{user_id:null==s?void 0:s.id,error:a instanceof Error?a.message:String(a)}),console.error("[AuthContext] Error during signOut:",a),g(a instanceof Error?a:new Error("Unknown error occurred during sign out")),T("Sign Out Failed",a instanceof Error?a.message:"Unknown error occurred"),window.location.href="/logout"}finally{n(!1)}}),loading:l,hasSession:i,error:p,userRole:f,dealershipId:v,setDealershipContext:C,currentDealershipName:N,fetchFromDealershipSchema:U,magicLinkLogin:e=>h(null,null,function*(){console.log(`[AuthContext] Magic link login attempt for ${e}`),n(!0),g(null);try{const{data:s,error:a}=yield ta.auth.signInWithOtp({email:e,options:{shouldCreateUser:!1}});if(a)throw console.error("[AuthContext] Magic link error:",a),a;console.log("[AuthContext] Magic link sent successfully"),k("Magic Link Sent",`Check your email (${e}) for a login link. For test accounts, you can check the console for the magic link.`)}catch(s){if(console.error("[AuthContext] Magic link process failed:",s),s instanceof Error)g(s),T("Magic Link Failed",s.message);else{const e=new Error("An unknown error occurred during magic link generation");g(e),T("Magic Link Failed","An unknown error occurred")}}finally{n(!1)}}),loginTestAccount:oa,logAccessAttempt:(e,a,r)=>{Ft(a?"Access granted":"Access denied",{path:e,user_id:null==s?void 0:s.id,email:null==s?void 0:s.email,role:t||f,dealership_id:v,dealership_name:N,details:r,allowed:a}),a||At("Unauthorized access attempt",{path:e,user_id:null==s?void 0:s.id,email:null==s?void 0:s.email,role:t||f})},isGroupAdmin:w,authCheckComplete:_};return u.jsx(Pt.Provider,{value:G,children:e})},It=()=>{const e=he.useContext(Pt);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e},Ut=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("div",o({ref:s,className:et("rounded-xl border bg-card text-card-foreground shadow",t)},r))});Ut.displayName="Card";const Gt=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("div",o({ref:s,className:et("flex flex-col space-y-1.5 p-6",t)},r))});Gt.displayName="CardHeader";const Mt=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("div",o({ref:s,className:et("font-semibold leading-none tracking-tight",t)},r))});Mt.displayName="CardTitle";const Rt=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("div",o({ref:s,className:et("text-sm text-muted-foreground",t)},r))});Rt.displayName="CardDescription";const $t=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("div",o({ref:s,className:et("p-6 pt-0",t)},r))});$t.displayName="CardContent";const Lt=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("div",o({ref:s,className:et("flex items-center p-6 pt-0",t)},r))});Lt.displayName="CardFooter";const Ot=Xa("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Bt=he.forwardRef((e,s)=>{var a=e,{className:t,variant:r,size:l,asChild:n=!1}=a,i=d(a,["className","variant","size","asChild"]);const c=n?P:"button";return u.jsx(c,o({className:et(Ot({variant:r,size:l,className:t})),ref:s},i))});Bt.displayName="Button";const Vt=he.forwardRef((e,s)=>{var a=e,{className:t,type:r}=a,l=d(a,["className","type"]);return u.jsx("input",o({type:r,className:et("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s},l))});Vt.displayName="Input";var zt=he.forwardRef((e,s)=>u.jsx(x.label,c(o({},e),{ref:s,onMouseDown:s=>{var a;s.target.closest("button, input, select, textarea")||(null==(a=e.onMouseDown)||a.call(e,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}})));zt.displayName="Label";var Wt=zt;const qt=Xa("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Jt=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(Wt,o({ref:s,className:et(qt(),t)},r))});function Yt(){const{signIn:e,magicLinkLogin:s,hasSession:a,user:t,role:r,userRole:l}=It(),[n,i]=he.useState(""),[o,c]=he.useState(""),[d,m]=he.useState(""),[x,p]=he.useState(!1),[g,f]=he.useState(0),[j,v]=he.useState(!1),[b,N]=he.useState(!1),[y,w]=he.useState(!1);xe();const S=pe();he.useEffect(()=>{console.log("[LoginForm] Component mounted/updated:",{hasSession:a,userEmail:null==t?void 0:t.email,role:r,userRole:l,timestamp:(new Date).toISOString()})},[a,t,r,l]);const _=(e,s,a,t)=>h(null,null,function*(){var r;try{console.log(`[LoginForm] Creating test user: ${e}`);const{data:l,error:n}=yield ta.auth.signUp({email:e,password:s,options:{data:{name:t}}});if(n&&!n.message.includes("already registered"))return console.error("[LoginForm] Signup error:",n),{success:!1,error:n.message};if(l.user||(null==n?void 0:n.message.includes("already registered"))){const s=(null==(r=l.user)?void 0:r.id)||(null==n?void 0:n.message.includes("already registered"))?"existing":null;if("existing"!==s){const{error:r}=yield ta.from("profiles").upsert({id:s,email:e,role:a,name:t,dealership_id:a.includes("group")?null:1,is_group_admin:a.includes("group")||e.includes("group")});r&&console.error("[LoginForm] Profile creation error:",r)}}return{success:!0}}catch(l){return console.error("[LoginForm] Create test user error:",l),{success:!1,error:(null==l?void 0:l.message)||"Unknown error"}}});return b?u.jsxs("div",{className:"text-center space-y-4",children:[u.jsxs("div",{className:"p-4 bg-green-50 text-green-700 rounded-md",children:[u.jsx("h3",{className:"font-medium",children:"Magic link sent!"}),u.jsxs("p",{className:"text-sm mt-1",children:["Check your email (",n,") for a login link."]})]}),u.jsx(Bt,{variant:"outline",onClick:()=>N(!1),className:"w-full",children:"Back to Login"})]}):u.jsx("div",{className:"space-y-6",children:u.jsxs("form",{onSubmit:e=>h(null,null,function*(){e.preventDefault(),p(!0),m(""),f(e=>e+1);try{const e=n?n.includes("@")?o?o.length<6?"Password must be at least 6 characters":null:"Password is required":"Invalid email format":"Email is required";if(e)return void m(e);console.log("[LoginForm] Starting login attempt:",{email:n,attempt:g+1,timestamp:(new Date).toISOString()});const{data:a,error:t}=yield ta.auth.signInWithPassword({email:n.trim(),password:o});if(t)return console.error("[LoginForm] Authentication error:",t),void(t.message.includes("Invalid login credentials")?m("Invalid email or password. Please check your credentials and try again."):t.message.includes("Email not confirmed")?m("Please check your email and click the confirmation link before logging in."):t.message.includes("Too many requests")?m("Too many login attempts. Please wait a few minutes before trying again."):m(`Login failed: ${t.message}`));if(!a.user)return void m("Login failed: No user data received");console.log("[LoginForm] Login successful:",{userId:a.user.id,email:a.user.email,timestamp:(new Date).toISOString()}),console.log("[LoginForm] Fetching user profile to determine role-based redirect");const{data:r,error:l}=yield ta.from("profiles").select("role, is_group_admin").eq("id",a.user.id).single();if(l)return console.error("[LoginForm] Error fetching user profile:",l),void S("/dashboard",{replace:!0});const i=null==r?void 0:r.role,c=null==r?void 0:r.is_group_admin;console.log("[LoginForm] User role from database:",{userRole:i,isGroupAdmin:c,email:n}),localStorage.setItem("recent_supabase_login","true"),console.log("[LoginForm] Set recent_supabase_login flag for ProtectedRoute coordination"),localStorage.setItem("last_login_email",n);let d="/dashboard";"testfinance@example.com"===n.toLowerCase()?(d="/dashboard/single-finance",console.log("[LoginForm] Test finance user detected, redirecting to single finance dashboard")):"testadmin@example.com"===n.toLowerCase()||"admin@thedasboard.com"===n.toLowerCase()||"admin@example.com"===n.toLowerCase()||n.toLowerCase().includes("admin@example.com")?(d="/master-admin",console.log("[LoginForm] Admin user detected, redirecting to master admin")):(s=n).toLowerCase().includes("group")&&s.toLowerCase().includes("@exampletest.com")?(d="/group-admin",console.log("[LoginForm] Group admin detected, redirecting to group admin")):n.toLowerCase().includes("admin@exampletest.com")?(d="/dashboard/admin",console.log("[LoginForm] Dealership admin detected, redirecting to dealership admin")):n.toLowerCase().includes("finance")?d="/dashboard/finance":n.toLowerCase().includes("sales")&&(d="/dashboard/sales"),console.log("[LoginForm] Redirecting to:",d),S(d,{replace:!0})}catch(a){console.error("[LoginForm] Login error:",a);const e=a instanceof Error?a.message:"An unexpected error occurred";m(`Login failed: ${e}`)}finally{p(!1)}var s}),className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"email",children:"Email"}),u.jsx(Vt,{id:"email",type:"email",value:n,onChange:e=>i(e.target.value.trim()),placeholder:"Enter your email",required:!0,disabled:x,className:"mt-1"})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"password",children:"Password"}),u.jsxs("div",{className:"relative",children:[u.jsx(Vt,{id:"password",type:j?"text":"password",value:o,onChange:e=>c(e.target.value),placeholder:"Enter your password",required:!0,disabled:x,className:"mt-1 pr-10"}),u.jsx("button",{type:"button",className:"absolute right-2 top-[calc(50%-6px)] text-gray-500 hover:text-gray-700",onClick:()=>v(!j),children:j?u.jsx(Fe,{size:16}):u.jsx(Ae,{size:16})})]})]}),u.jsx("div",{className:"flex items-center justify-between mt-2",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("input",{id:"remember-me",name:"remember-me",type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary",checked:y,onChange:e=>w(e.target.checked)}),u.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-900",children:"Remember me"})]})}),d&&u.jsxs("div",{className:"p-3 rounded bg-red-50 text-red-600 text-sm flex items-start gap-2",children:[u.jsx(Ee,{size:16,className:"mt-0.5 flex-shrink-0"}),u.jsx("span",{children:d})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx(Bt,{type:"submit",disabled:x,className:"flex-1",children:x?"Signing in...":"Sign in"}),u.jsxs(Bt,{type:"button",variant:"outline",disabled:x||!n,onClick:()=>h(null,null,function*(){if(n)try{p(!0);const{error:e}=yield ta.auth.signInWithOtp({email:n.trim(),options:{emailRedirectTo:`${window.location.origin}/auth/callback`}});if(e)return void m(`Magic link failed: ${e.message}`);N(!0),m("")}catch(e){console.error("[LoginForm] Magic link error:",e);const s=e instanceof Error?e.message:"Failed to send magic link";m(`Magic link failed: ${s}`)}finally{p(!1)}else m("Please enter your email address")}),className:"flex items-center",children:[u.jsx(Ie,{className:"mr-2 h-4 w-4"}),"Magic Link"]})]}),u.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[u.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Quick Test Login:"}),u.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{email:"testadmin@example.com",password:"Password123!",label:"Test Admin"},{email:"group1.admin@exampletest.com",password:"Password123!",label:"Group Admin"},{email:"dealer1.admin@exampletest.com",password:"Password123!",label:"Dealer Admin"},{email:"finance1@exampletest.com",password:"Password123!",label:"Finance Manager"},{email:"sales@exampletest.com",password:"Password123!",label:"Sales Person"}].map(e=>u.jsx(Bt,{variant:"outline",size:"sm",onClick:()=>(e=>{i(e.email),c(e.password)})(e),className:"text-xs",children:e.label},e.email))}),u.jsx(Bt,{variant:"secondary",size:"sm",onClick:()=>h(null,null,function*(){p(!0),m("Setting up test users...");const e=[{email:"testfinance@example.com",password:"Password123!",role:"single_finance_manager",name:"Test Finance Manager"},{email:"testadmin@example.com",password:"Password123!",role:"admin",name:"Master Admin"},{email:"group1.admin@exampletest.com",password:"Password123!",role:"admin",name:"Group Admin"},{email:"dealer1.admin@exampletest.com",password:"Password123!",role:"dealership_admin",name:"Dealer Admin"},{email:"sales@exampletest.com",password:"Password123!",role:"salesperson",name:"Sales Person"}];for(const s of e)yield _(s.email,s.password,s.role,s.name),yield new Promise(e=>setTimeout(e,1e3));m("Test users setup complete! Try logging in now."),p(!1)}),className:"w-full mt-2",disabled:x,children:"Setup Test Users (First Time)"})]})]})})}Jt.displayName=Wt.displayName;const Ht=()=>{var e,s,a;const{user:t,loading:r,hasSession:l,isGroupAdmin:n}=It(),i=pe(),o=xe(),[c,d]=he.useState(!1),m=new URLSearchParams(o.search),h=m.has("noredirect"),x=m.has("forcelogin");if(he.useEffect(()=>{let e;return r&&(console.log("[AuthPage] Setting safety timeout for loading state"),e=window.setTimeout(()=>{console.error("[AuthPage] Loading timeout reached"),d(!0)},1e4)),()=>{e&&window.clearTimeout(e)}},[r]),he.useEffect(()=>{var e,s;if(h||x)console.log("[AuthPage] Skipping redirects due to query parameters");else if(t&&t.email&&!r){const a=t.email.toLowerCase().includes("group")&&t.email.toLowerCase().includes("@exampletest.com");(a||n||(null==(e=t.user_metadata)?void 0:e.is_group_admin))&&(console.log("[AuthPage] *** GROUP ADMIN DETECTED - FORCING DIRECT REDIRECT ***",{email:t.email,byEmail:a,byFlag:n,byMetadata:null==(s=t.user_metadata)?void 0:s.is_group_admin}),window.location.href="/group-admin")}},[t,r,n,h,x]),he.useEffect(()=>{var e,s,a;if(console.log("[AuthPage] Auth state changed:",{hasUser:!!t,hasSession:l,loading:r,email:null==t?void 0:t.email,isGroupAdmin:n,noRedirect:h,forceLogin:x,timestamp:(new Date).toISOString()}),h||x)console.log("[AuthPage] Skipping redirects due to query parameters");else if(t&&l&&!r){if((null==(e=t.email)?void 0:e.toLowerCase().includes("group"))&&(null==(s=t.email)?void 0:s.toLowerCase().includes("@exampletest.com"))||n||(null==(a=t.user_metadata)?void 0:a.is_group_admin))return;console.log("[AuthPage] Regular user authenticated, redirecting to dashboard"),i("/dashboard",{replace:!0})}},[t,l,r,i,n,h,x]),r)return u.jsx("div",{className:"flex items-center justify-center min-h-screen bg-orange-500",children:u.jsxs("div",{className:"flex flex-col items-center gap-3",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"}),c&&u.jsxs("div",{className:"text-sm text-white max-w-md text-center mt-4 flex items-center gap-2 bg-orange-600 p-2 rounded border border-orange-400",children:[u.jsx(Ue,{className:"h-4 w-4 text-orange-200"}),u.jsx("span",{children:"Taking longer than expected. Please try refreshing the page if this continues."})]})]})});if(x||h)console.log("[AuthPage] Showing login form due to query parameters");else if(t&&l)return(null==(e=t.email)?void 0:e.toLowerCase().includes("group"))&&(null==(s=t.email)?void 0:s.toLowerCase().includes("@exampletest.com"))||n||(null==(a=t.user_metadata)?void 0:a.is_group_admin)?(console.log("[AuthPage] Group admin authenticated, redirecting to group admin dashboard"),u.jsx(ge,{to:"/group-admin",replace:!0})):(console.log("[AuthPage] User is already authenticated, redirecting to dashboard"),u.jsx(ge,{to:"/dashboard",replace:!0}));return u.jsxs("div",{className:"min-h-screen bg-orange-500",children:[u.jsx("div",{className:"h-12 bg-black flex items-center",children:u.jsx("h1",{className:"text-white text-3xl font-bold ml-6",children:"The DAS Board"})}),u.jsx("div",{className:"flex items-center justify-center py-12",children:u.jsx("div",{className:"w-full max-w-md",children:u.jsxs(Ut,{className:"bg-white",children:[u.jsxs(Gt,{className:"space-y-1",children:[u.jsx(Mt,{className:"text-2xl font-bold text-center text-gray-800",children:"The DAS Board Login"}),(x||h)&&u.jsx("p",{className:"text-sm text-center text-green-600",children:"Force login mode active - you can log in again"})]}),u.jsx($t,{children:u.jsx(Yt,{})}),u.jsx(Lt,{className:"flex flex-col gap-2",children:u.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Don't have an account? Contact your administrator."})})]})})})]})},Kt=({children:e,requiredRoles:s=[],requiredDealership:a})=>{var t;const{user:r,loading:l,hasSession:n,userRole:i,dealershipId:o,logAccessAttempt:c,authCheckComplete:d}=It(),m=xe(),x="production",[p,g]=he.useState(null);if(he.useEffect(()=>{if("/logout"===m.pathname)return void console.log("[ProtectedRoute] Logout page accessed, skipping detailed access logging");const e=(new Date).toISOString();console.log(`[ProtectedRoute][${e}] Checking access to ${m.pathname}`,{user_email:null==r?void 0:r.email,user_id:null==r?void 0:r.id,user_role:i,has_session:n,required_roles:s,user_dealership_id:o,required_dealership:a,is_loading:l,auth_check_complete:d,environment:x,source_path:m.pathname,source_query:m.search})},[r,l,m,i,n,o,s,a,x,d]),"/logout"===m.pathname)return console.log("[ProtectedRoute] Allowing access to logout page without auth checks"),u.jsx(u.Fragment,{children:e});if("true"===localStorage.getItem("logout_in_progress")&&"/auth"!==m.pathname)return console.log("[ProtectedRoute] Logout in progress detected, allowing access"),u.jsx(u.Fragment,{children:e});const f=yt(),j=wt(),v="true"===localStorage.getItem("recent_login_cleared"),b="true"===localStorage.getItem("recent_supabase_login");if(console.log("[ProtectedRoute] Direct auth check:",{directAuthUser:f,isDirectlyAuthenticated:j,recentLoginCleared:v,recentSupabaseLogin:b,path:m.pathname}),b&&(!r||!n)){console.log("[ProtectedRoute] Recent Supabase login detected, waiting for auth state to propagate...");const e=()=>h(null,null,function*(){var e;try{const{data:{session:s}}=yield ta.auth.getSession();if("testfinance@example.com"===(null==(e=null==s?void 0:s.user)?void 0:e.email))return console.log("[ProtectedRoute] Direct Supabase check confirmed finance user, allowing access"),localStorage.removeItem("recent_supabase_login"),!0}catch(s){console.error("[ProtectedRoute] Direct auth check failed:",s)}return!1});"/dashboard/single-finance"===m.pathname&&e().then(e=>{e&&window.location.reload()}),p||g(Date.now());const s=p?Date.now()-p:0;return s>8e3?(console.warn("[ProtectedRoute] Auth state timeout reached, clearing flags and redirecting to login"),localStorage.removeItem("recent_supabase_login"),g(null),u.jsx(ge,{to:"/",replace:!0,state:{from:m}})):(console.log("[ProtectedRoute] Waiting for auth state...",{timeElapsed:s,user:(null==r?void 0:r.email)||"none",hasSession:n,loading:l,authCheckComplete:d}),u.jsx("div",{className:"flex h-screen items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx(Ge,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),u.jsx("p",{className:"text-sm text-gray-500",children:"Completing authentication..."}),u.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Please wait (",Math.round((8e3-s)/1e3),"s)"]})]})}))}if(r&&n&&p&&(g(null),localStorage.removeItem("recent_supabase_login")),n&&r&&b)console.log("[ProtectedRoute] Recent Supabase login detected, skipping direct auth check"),localStorage.removeItem("recent_supabase_login");else if(j&&f)return console.log("[ProtectedRoute] Direct auth user detected:",f.email),"/logout"===m.pathname?(console.log("[ProtectedRoute] Allowing logout for direct auth user"),u.jsx(u.Fragment,{children:e})):s.length>0&&!s.some(e=>e.toLowerCase()===f.role.toLowerCase())?(console.warn("[ProtectedRoute] Direct auth user doesn't have required role. Redirecting to correct dashboard."),u.jsx(ge,{to:Dt(f),replace:!0})):a&&f.dealershipId!==a?(console.warn("[ProtectedRoute] Direct auth user doesn't belong to required dealership. Redirecting."),u.jsx(ge,{to:Dt(f),replace:!0})):(console.log(`[ProtectedRoute] Direct auth access granted to ${m.pathname}`),u.jsx(u.Fragment,{children:e}));if(l||!d)return console.log(`[ProtectedRoute] Still loading authentication state for ${m.pathname}`,{loading:l,authCheckComplete:d,path:m.pathname}),u.jsx("div",{className:"flex h-screen items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx(Ge,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),u.jsx("p",{className:"text-sm text-gray-500",children:"Verifying your access..."})]})});const N=document.referrer.includes("/")||"/"!==m.pathname;if(r||n||!N||p||(console.log("[ProtectedRoute] Detected navigation from login without auth state, adding delay..."),g(Date.now())),p&&!r&&!n){const e=Date.now()-p;return e<2e3?u.jsx("div",{className:"flex h-screen items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx(Ge,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),u.jsx("p",{className:"text-sm text-gray-500",children:"Completing authentication..."}),u.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Please wait (",Math.round((2e3-e)/1e3),"s)"]})]})}):(console.warn("[ProtectedRoute] Auth state timeout reached, redirecting to login"),g(null),u.jsx(ge,{to:"/",replace:!0,state:{from:m}}))}if((r||n)&&p&&g(null),(null==r?void 0:r.email)&&ia(r.email)){if(console.log(`[ProtectedRoute] Test user detected: ${r.email}`),"testfinance@example.com"!==r.email&&"finance1@exampletest.com"!==r.email||console.warn("[ProtectedRoute] FINANCE USER DETECTED:",{email:r.email,currentPath:m.pathname,willBeRedirectedToMaster:"testadmin@example.com"===r.email}),"testadmin@example.com"===r.email)return console.log("[ProtectedRoute] Test admin account detected"),"/master-admin"===m.pathname?(console.log("[ProtectedRoute] Allowing test admin to access master-admin panel"),u.jsx(u.Fragment,{children:e})):(console.log("[ProtectedRoute] Redirecting test admin to master-admin panel"),u.jsx(ge,{to:"/master-admin",replace:!0}));if(r.email.includes("group")&&r.email.includes("@exampletest.com"))return console.log("[ProtectedRoute] Group admin test account detected"),"/group-admin"===m.pathname?(console.log("[ProtectedRoute] Allowing group admin to access group-admin panel"),u.jsx(u.Fragment,{children:e})):(console.log("[ProtectedRoute] Redirecting group admin to group-admin panel"),u.jsx(ge,{to:"/group-admin",replace:!0}))}if(!r||!n)return console.warn(`[ProtectedRoute] Access denied - Not authenticated for ${m.pathname}`),c(m.pathname,!1,{reason:"Not authenticated",has_session:n,redirect_to:"/"}),u.jsx(ge,{to:"/",replace:!0,state:{from:m}});if(s.length>0&&i){const e=i.toLowerCase();let a=s.some(s=>s.toLowerCase()===e);if(s.includes("dealer_group_admin")&&"/group-admin"===m.pathname&&(console.log("[ProtectedRoute] This is the group admin route, checking is_group_admin flag"),!0===(null==(t=r.user_metadata)?void 0:t.is_group_admin)?(console.log("[ProtectedRoute] User has is_group_admin flag in metadata, granting access"),a=!0):(console.log("[ProtectedRoute] User does not have is_group_admin flag, checking database"),h(null,null,function*(){try{const{data:e,error:s}=yield ta.from("profiles").select("is_group_admin").eq("id",r.id).maybeSingle();s||!0!==(null==e?void 0:e.is_group_admin)||(console.log("[ProtectedRoute] User has is_group_admin=true in profile table"),a=!0)}catch(e){console.error("[ProtectedRoute] Error checking is_group_admin flag:",e)}}))),!a&&s.includes("admin")&&"dealership_admin"===e&&(console.log("[ProtectedRoute] Dealership admin accessing route requiring 'admin' - checking compatibility"),a=!0),!a)return console.warn(`[ProtectedRoute] Access denied - User role ${i} not in required roles: ${s.join(", ")}`),c(m.pathname,!1,{reason:"Insufficient role permissions",user_role:i,required_roles:s,redirect_to:"/dashboard"}),u.jsx(ge,{to:"/dashboard",replace:!0})}if(a&&o!==a)return console.warn(`[ProtectedRoute] Access denied - User dealership ${o} doesn't match required dealership ${a}`),c(m.pathname,!1,{reason:"Dealership mismatch",user_dealership:o,required_dealership:a,redirect_to:"/dashboard"}),u.jsx(ge,{to:"/dashboard",replace:!0});if("/dashboard/single-finance"===m.pathname&&!r&&!n&&!l){console.log("[ProtectedRoute] Single finance route accessed without immediate auth state, waiting..."),p||g(Date.now());const e=p?Date.now()-p:0;if(e<2e3)return u.jsx("div",{className:"flex h-screen items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx(Ge,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),u.jsx("p",{className:"text-sm text-gray-500",children:"Loading your dashboard..."}),u.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Please wait (",Math.round((2e3-e)/1e3),"s)"]})]})})}return console.log(`[ProtectedRoute] Access granted to ${m.pathname}`),c(m.pathname,!0,{user_role:i,dealership_id:o}),u.jsx(u.Fragment,{children:e})},Zt=({children:e,title:s="The DAS Board"})=>{const{signOut:a,user:t,userRole:r,dealershipId:l,currentDealershipName:n}=It(),i=xe(),o=e=>i.pathname===e||i.pathname.startsWith(`${e}/`),c=i.pathname.startsWith("/dealership/"),d=c?i.pathname.split("/")[2]:null;return u.jsxs("div",{className:"flex h-screen bg-gray-100",children:[u.jsxs("div",{className:"w-64 bg-black shadow-md text-white",children:[u.jsxs("div",{className:"p-4 border-b border-gray-700",children:[u.jsx("h1",{className:"text-2xl font-bold text-orange-500",children:s}),n&&u.jsxs("div",{className:"flex items-center mt-2 text-sm text-orange-300",children:[u.jsx(Me,{size:14,className:"mr-1"}),u.jsx("span",{children:n})]})]}),u.jsxs("div",{className:"p-4",children:[u.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[u.jsx("div",{className:"bg-blue-900 p-2 rounded-full",children:u.jsx(Re,{size:20,className:"text-blue-300"})}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-medium text-white",children:null==t?void 0:t.email}),u.jsx("p",{className:"text-xs text-gray-300",children:r||"User"})]})]}),u.jsxs("nav",{className:"space-y-1",children:[u.jsx(fe,{to:c?`/dealership/${d}`:"/dashboard",children:u.jsxs("button",{className:"flex items-center w-full px-4 py-2 text-left text-sm rounded-md "+(o("/dashboard")&&!o("/dashboard/deals")&&!o("/dashboard/schedule")||c&&!i.pathname.includes("/deals")&&!i.pathname.includes("/schedule")?"bg-gray-800 text-white":"text-gray-300 hover:bg-gray-800 hover:text-white"),children:[u.jsx($e,{size:18,className:"mr-2"}),"Home"]})}),u.jsx(fe,{to:c?`/dealership/${d}/deals`:"/dashboard/deals",children:u.jsxs("button",{className:"flex items-center w-full px-4 py-2 text-left text-sm rounded-md "+(o("/dashboard/deals")||c&&i.pathname.includes("/deals")?"bg-gray-800 text-white":"text-gray-300 hover:bg-gray-800 hover:text-white"),children:[u.jsx(Le,{size:18,className:"mr-2"}),"Deals"]})}),u.jsx(fe,{to:c?`/dealership/${d}/schedule`:"/dashboard/schedule",children:u.jsxs("button",{className:"flex items-center w-full px-4 py-2 text-left text-sm rounded-md "+(o("/dashboard/schedule")||c&&i.pathname.includes("/schedule")?"bg-gray-800 text-white":"text-gray-300 hover:bg-gray-800 hover:text-white"),children:[u.jsx(Oe,{size:18,className:"mr-2"}),"Schedule"]})}),"admin"===r&&!l&&u.jsx(fe,{to:"/master-admin",children:u.jsxs("button",{className:"flex items-center w-full px-4 py-2 text-left text-sm rounded-md "+(o("/master-admin")?"bg-gray-800 text-white":"text-gray-300 hover:bg-gray-800 hover:text-white"),children:[u.jsx(Me,{size:18,className:"mr-2"}),"Master Admin"]})})]})]}),u.jsx("div",{className:"absolute bottom-0 w-64 p-4 border-t border-gray-700",children:u.jsxs(Bt,{variant:"outline",className:"w-full flex items-center justify-center bg-gray-800 text-white border-gray-600 hover:bg-gray-700",onClick:()=>{window.location.href="/logout"},children:[u.jsx(Be,{size:18,className:"mr-2"}),"Sign Out"]})})]}),u.jsx("div",{className:"flex-1 overflow-auto",children:u.jsxs("main",{className:"p-6",children:[e||u.jsx(je,{}),!e&&!i.pathname.includes("/admin")&&!i.pathname.includes("/sales")&&u.jsxs("div",{style:{padding:"20px",backgroundColor:"#fff3cd",color:"#856404",border:"1px solid #ffeeba",borderRadius:"4px"},children:[u.jsx("p",{children:"Warning: No content to display for this route."}),u.jsxs("p",{children:["Current path: ",i.pathname]})]})]})})]})};function Qt(){return u.jsx(mt,{})}const Xt=new sa({defaultOptions:{queries:{refetchOnWindowFocus:!1,staleTime:3e5}}}),er=()=>{const{user:e}=It(),[s,a]=he.useState([]),[t,r]=he.useState(!0),[l,n]=he.useState([5,8,15,18,25,27,29]),[i,o]=he.useState({expected:0,actual:0,progress:0,status:"neutral",progressRatio:0}),[c,d]=he.useState((new Date).getDate()),[m,x]=he.useState(new Date((new Date).getFullYear(),(new Date).getMonth()+1,0).getDate());he.useEffect(()=>(console.log("[GoalTracking] Component mounted",{userId:null==e?void 0:e.id,currentDay:c,daysInMonth:m,timestamp:(new Date).toISOString()}),p(),()=>{console.log("[GoalTracking] Component unmounting")}),[e]);const p=()=>h(null,null,function*(){try{if(r(!0),!(null==e?void 0:e.id))return console.log("[GoalTracking] No user ID available"),void r(!1);console.log("[GoalTracking] Fetching goal data for user:",e.id);const t=yield(s=e.id,h(null,null,function*(){const e=new Date,a=e.getFullYear(),t=e.getMonth(),r=e.getDate(),l=new Date(a,t,1).toISOString().split("T")[0],n=new Date(a,t+1,0).toISOString().split("T")[0];try{const[e,i]=yield Promise.all([xt(s,l,n),pt(s,l,n)]);return{deals:e,daysOff:i,progressMetrics:gt(e,r,i),daysInMonth:new Date(a,t+1,0).getDate(),currentDay:r}}catch(i){throw console.error("[apiService] Error in getGoalTrackingData:",i),i}}));a(t.deals),n(t.daysOff),o(t.progressMetrics),d(t.currentDay),x(t.daysInMonth),console.log("[GoalTracking] Goal data loaded:",t)}catch(t){console.error("[GoalTracking] Error fetching goal data:",t)}finally{r(!1)}var s}),g=m-c,f=Math.max(0,15-i.actual),j=g>0?(f/g).toFixed(1):"0",v=()=>Math.min(100,Math.round(i.actual/15*100));return u.jsxs(Ut,{className:"border hover:shadow-md transition-shadow",children:[u.jsx(Gt,{className:"pb-2 border-b",children:u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs(Mt,{className:"text-lg font-medium flex items-center",children:[u.jsx(Ve,{className:"mr-2 h-5 w-5 text-blue-600"}),"Goal Tracker"]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsxs("div",{className:"text-sm",children:[c,"/",m]}),u.jsx("div",{className:`w-3 h-3 rounded-full ${"on-track"===i.status?"bg-green-500":"slightly-behind"===i.status?"bg-amber-500":"behind"===i.status?"bg-red-500":"bg-gray-400"} animate-pulse shadow-md`,title:`Status: ${i.status}`})]})]})}),u.jsx($t,{className:"pt-4",children:t?u.jsxs("div",{className:"py-8 text-center",children:[u.jsx(ze,{className:"h-8 w-8 mx-auto mb-2 animate-pulse text-gray-400"}),u.jsx("p",{className:"text-sm text-gray-500",children:"Loading goal data..."})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"flex flex-col items-center mb-6",children:[u.jsx("div",{className:`w-32 h-32 rounded-full flex items-center justify-center mb-4 transition-all duration-500 ${(()=>{switch(i.status){case"on-track":return"bg-green-100";case"slightly-behind":return"bg-amber-100";case"behind":return"bg-red-100";default:return"bg-gray-100"}})()}`,children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"text-3xl font-bold",children:i.actual}),u.jsxs("div",{className:"text-sm",children:["of ",15]})]})}),u.jsx("div",{className:`text-lg font-bold ${(()=>{switch(i.status){case"on-track":return"text-green-600";case"slightly-behind":return"text-amber-500";case"behind":return"text-red-500";default:return"text-gray-500"}})()}`,children:(()=>{switch(i.status){case"on-track":return u.jsxs("span",{className:"flex items-center",children:[u.jsx(qe,{className:"h-4 w-4 mr-1"}),"On Track"]});case"slightly-behind":return u.jsxs("span",{className:"flex items-center",children:[u.jsx(We,{className:"h-4 w-4 mr-1"}),"Slightly Behind"]});case"behind":return u.jsxs("span",{className:"flex items-center",children:[u.jsx(We,{className:"h-4 w-4 mr-1"}),"Behind Target"]});default:return u.jsx("span",{className:"flex items-center",children:"Getting Started"})}})()}),u.jsxs("div",{className:"text-sm text-gray-600 mt-1 text-center",children:["You've sold ",i.actual," units this month.",i.expected>0&&` Expected by day ${c}: ${i.expected} units.`]})]}),u.jsxs("div",{className:"mb-6",children:[u.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[u.jsx("span",{children:"Progress"}),u.jsxs("span",{children:[v(),"%"]})]}),u.jsx("div",{className:"w-full h-3 bg-gray-200 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full rounded-full transition-all duration-500 "+("on-track"===i.status?"bg-green-500":"slightly-behind"===i.status?"bg-amber-500":"bg-red-500"),style:{width:`${v()}%`}})})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[u.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[u.jsx("div",{className:"text-xs text-blue-600 mb-1",children:"Days Remaining"}),u.jsxs("div",{className:"text-xl font-bold",children:[g," days"]}),u.jsx("div",{className:"text-xs text-gray-500",children:"Until end of month"})]}),u.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[u.jsx("div",{className:"text-xs text-purple-600 mb-1",children:"Daily Pace Needed"}),u.jsx("div",{className:"text-xl font-bold",children:j}),u.jsx("div",{className:"text-xs text-gray-500",children:"Units per day to reach goal"})]})]}),i.actual>0&&u.jsxs("div",{className:"mt-5 bg-gradient-to-r from-blue-50 to-indigo-50 p-3 rounded-lg border border-blue-100",children:[u.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Achievements"}),u.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.actual>=1&&u.jsx("div",{className:"bg-white/80 px-2 py-1 rounded-full text-xs backdrop-blur-sm border border-blue-100",children:" First Sale"}),i.actual>=5&&u.jsx("div",{className:"bg-white/80 px-2 py-1 rounded-full text-xs backdrop-blur-sm border border-blue-100",children:" Consistent Performer"}),i.actual>=10&&u.jsx("div",{className:"bg-white/80 px-2 py-1 rounded-full text-xs backdrop-blur-sm border border-blue-100",children:" Sales Machine"}),i.actual>=15&&u.jsx("div",{className:"bg-gradient-to-r from-green-100 to-emerald-100 px-2 py-1 rounded-full text-xs font-bold border border-green-200",children:" Monthly Goal Achieved!"})]})]}),u.jsxs("div",{className:"text-xs text-gray-400 text-right mt-4",children:[u.jsx(Oe,{className:"h-3 w-3 inline mr-1"}),"Data updated: ",(new Date).toLocaleString()]})]})})]})},sr=(e,s)=>{if(!e.isSplitDeal)return{hasCredit:e.primarySalespersonId===s,creditPercentage:e.primarySalespersonId===s?100:0,splitWith:null};const a=e.primarySalespersonId===s||e.secondarySalespersonId===s;return{hasCredit:a,creditPercentage:a?50:0,splitWith:e.primarySalespersonId===s?e.secondarySalespersonId:e.primarySalespersonId}},ar=(e,s={})=>{const{dashboardType:a="sales",userRole:t="salesperson",salespersonId:r=null}=s;try{const s={id:e.id||e.dealNumber||`D${Date.now()}`,dealNumber:e.dealNumber||e.id,stockNumber:e.stockNumber||"",vinLast8:e.vinLast8||e.vin||"",vehicleType:e.vehicleType||"U",lastName:e.lastName||e.customer||"",dealDate:e.dealDate||e.saleDate||(new Date).toISOString().split("T")[0],frontEndGross:parseFloat(e.frontEndGross)||0,backEndGross:parseFloat(e.backEndGross)||parseFloat(e.profit)||0,totalGross:parseFloat(e.totalGross)||parseFloat(e.amount)||0,vscProfit:parseFloat(e.vscProfit)||0,ppmProfit:parseFloat(e.ppmProfit)||0,gapProfit:parseFloat(e.gapProfit)||0,tireAndWheelProfit:parseFloat(e.tireAndWheelProfit)||0,appearanceProfit:parseFloat(e.appearanceProfit)||0,otherProfit:parseFloat(e.otherProfit)||0,reserveFlat:parseFloat(e.reserveFlat)||0,dealType:e.dealType||"Finance",dealStatus:e.dealStatus||e.status||"Pending",lender:e.lender||"",outsideFunding:e.outsideFunding||!1,primarySalespersonId:e.salespersonId||e.primarySalespersonId||"",secondarySalespersonId:e.secondSalespersonId||e.secondarySalespersonId||"",isSplitDeal:e.isSplitDeal||!1,salesManagerId:e.salesManagerId||"",products:e.products||[],salesperson:e.salesperson||""},a=(e=>{switch(e){case"N":return"New";case"U":case"C":return"Used";default:return"Unknown"}})(s.vehicleType),t=(e=>{const s=[];return[{name:"VSC/Extended Warranty",profit:e.vscProfit||0},{name:"GAP Insurance",profit:e.gapProfit||0},{name:"Paint Protection",profit:e.appearanceProfit||0},{name:"Tire & Wheel",profit:e.tireAndWheelProfit||0},{name:"Prepaid Maintenance",profit:e.ppmProfit||0},{name:"Other Products",profit:e.otherProfit||0}].forEach(e=>{const a=parseFloat(e.profit)||0;a>0&&s.push({name:e.name,profit:a})}),s})(s),l=(e=>{const s=e.status||e.dealStatus;return{countsForSold:"Funded"===s,countsForBooked:"Funded"===s,countsForTracking:"Pending"===s,countsForPVR:"Funded"===s||"Pending"===s,excludeFromMetrics:"Unwound"===s||"Dead Deal"===s}})(s),n=r?sr(s,r):{hasCredit:!0,creditPercentage:100,splitWith:null},i=s.frontEndGross*(n.creditPercentage/100),o=s.backEndGross*(n.creditPercentage/100),c=s.totalGross*(n.creditPercentage/100);return{raw:e,id:s.id,dealNumber:s.dealNumber,stockNumber:s.stockNumber,vinLast8:s.vinLast8,vehicleType:s.vehicleType,vehicleTypeDisplay:a,lastName:s.lastName,dealDate:s.dealDate,frontEndGross:s.frontEndGross,backEndGross:s.backEndGross,totalGross:s.totalGross,adjustedFrontGross:i,adjustedBackGross:o,adjustedTotalGross:c,productMix:t,productsPerDeal:t.length,vscProfit:s.vscProfit,ppmProfit:s.ppmProfit,gapProfit:s.gapProfit,tireAndWheelProfit:s.tireAndWheelProfit,appearanceProfit:s.appearanceProfit,otherProfit:s.otherProfit,reserveFlat:s.reserveFlat,dealType:s.dealType,dealStatus:s.dealStatus,lender:s.lender,outsideFunding:s.outsideFunding,primarySalespersonId:s.primarySalespersonId,secondarySalespersonId:s.secondarySalespersonId,isSplitDeal:s.isSplitDeal,salesManagerId:s.salesManagerId,splitCredit:n,metricFlags:l,isNew:"N"===s.vehicleType,isUsed:"U"===s.vehicleType||"C"===s.vehicleType,isFunded:l.countsForSold,isPending:l.countsForTracking,isActive:!l.excludeFromMetrics,pvr:t.length>0?Math.round(s.backEndGross/t.length):0,customer:s.lastName,vehicle:`${a} - Stock #${s.stockNumber}`,vin:s.vinLast8,saleDate:s.dealDate,salesperson:s.salesperson,amount:s.totalGross,status:s.dealStatus,products:s.products||t.map(e=>e.name),profit:s.backEndGross,created_at:e.created_at||(new Date).toISOString()}}catch(l){return console.error("Error mapping deal data:",l),{id:e.id||"unknown",dealNumber:e.id||"unknown",error:"Failed to map deal data",raw:e,isActive:!1,metricFlags:{countsForSold:!1,countsForBooked:!1,countsForTracking:!1,countsForPVR:!1,excludeFromMetrics:!0}}}},tr=(e="financeDeals")=>{try{const s=localStorage.getItem(e);if(!s)return[];const a=JSON.parse(s);return Array.isArray(a)?a:[]}catch(s){return console.error("Error loading deals from localStorage:",s),[]}},rr=(e,s={})=>{let a=[];return a=tr("single-finance"===e?"singleFinanceDeals":"financeDeals"),((e,s={})=>{const{dashboardType:a="sales",userRole:t="salesperson",salespersonId:r=null,timePeriod:l="this-month",includeInactive:n=!1}=s;try{let s=e.map(e=>ar(e,{dashboardType:a,userRole:t,salespersonId:r})).filter(e=>{if(!n&&!e.isActive)return!1;if(r){const s=sr(e,r);if(!s.hasCredit)return!1;e.splitCredit=s}return!0});if("all-time"!==l){const e=new Date,a=e.getFullYear(),t=e.getMonth();s=s.filter(e=>{const s=new Date(e.dealDate);switch(l){case"this-month":return s.getFullYear()===a&&s.getMonth()===t;case"last-month":const e=0===t?11:t-1,r=0===t?a-1:a;return s.getFullYear()===r&&s.getMonth()===e;case"ytd":return s.getFullYear()===a;case"last-year":return s.getFullYear()===a-1;default:return!0}})}const i=s.length,o=s.filter(e=>e.isFunded).length,c=s.filter(e=>e.isPending).length,d=s.filter(e=>e.isNew).length,m=s.filter(e=>e.isUsed).length,h=s.reduce((e,s)=>e+s.adjustedFrontGross,0),u=s.reduce((e,s)=>e+s.adjustedBackGross,0),x=s.reduce((e,s)=>e+s.adjustedTotalGross,0),p=i>0?h/i:0,g=i>0?u/i:0,f=s.reduce((e,s)=>e+s.pvr,0);return{deals:s,metrics:{totalDeals:i,fundedDeals:o,pendingDeals:c,newVehicleDeals:d,usedVehicleDeals:m,totalFrontGross:h,totalBackGross:u,totalGross:x,avgFrontGross:p,avgBackGross:g,totalPVR:f,avgPVR:i>0?f/i:0},lastUpdated:(new Date).toISOString()}}catch(i){return console.error("Error aggregating deals for dashboard:",i),{deals:[],metrics:{totalDeals:0,fundedDeals:0,pendingDeals:0,newVehicleDeals:0,usedVehicleDeals:0,totalFrontGross:0,totalBackGross:0,totalGross:0,avgFrontGross:0,avgBackGross:0,totalPVR:0,avgPVR:0},error:i.message,lastUpdated:(new Date).toISOString()}}})(a,o({dashboardType:e},s))},lr=(e={})=>{const{dashboardType:s="sales",userRole:a="salesperson",salespersonId:t=null,timePeriod:r="this-month",includeInactive:l=!1,autoRefresh:n=!1,refreshInterval:i=3e4}=e,[o,c]=he.useState(null),[d,m]=he.useState(!0),[u,x]=he.useState(null),[p,g]=he.useState(r),f=he.useCallback(()=>h(null,null,function*(){var e;m(!0),x(null);try{console.log(`[useDealsData] Loading deals for ${s} dashboard`,{userRole:a,salespersonId:t,timePeriod:p,includeInactive:l});const r=rr(s,{userRole:a,salespersonId:t,timePeriod:p,includeInactive:l});c(r),r.error&&(console.warn("[useDealsData] Deal data warning:",r.error),x(`Warning: ${r.error}`)),console.log(`[useDealsData] Loaded ${(null==(e=r.deals)?void 0:e.length)||0} deals with metrics:`,r.metrics)}catch(r){console.error("[useDealsData] Error loading deal data:",r),x("Failed to load deal data"),c({deals:[],metrics:{totalDeals:0,fundedDeals:0,pendingDeals:0,newVehicleDeals:0,usedVehicleDeals:0,totalFrontGross:0,totalBackGross:0,totalGross:0,avgFrontGross:0,avgBackGross:0,totalPVR:0,avgPVR:0},error:r instanceof Error?r.message:"Unknown error",lastUpdated:(new Date).toISOString()})}finally{m(!1)}}),[s,a,t,p,l]);return he.useEffect(()=>{f()},[f]),he.useEffect(()=>{if(!n)return;const e=setInterval(()=>{console.log("[useDealsData] Auto-refreshing deal data"),f()},i);return()=>clearInterval(e)},[n,i,f]),he.useEffect(()=>{const e=e=>{"financeDeals"!==e.key&&"singleFinanceDeals"!==e.key||(console.log("[useDealsData] localStorage changed, refreshing deal data"),f())};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[f]),{dealData:o,loading:d,error:u,refresh:f,setTimePeriod:g}},nr=(e,s="this-month")=>{const[a,t]=he.useState(null),[r,l]=he.useState(!0),[n,i]=he.useState(null),d=he.useCallback(()=>h(null,null,function*(){var a;l(!0),i(null);try{console.log("[useManagerDealsData] Loading deals for sales manager dashboard",{dealershipId:e,timePeriod:s});const r=((e,s,a="this-month")=>{try{let t=e.map(e=>ar(e,{dashboardType:"sales-manager",userRole:"sales_manager"})).filter(e=>(!s||!e.raw.dealershipId||e.raw.dealershipId===s)&&e.isActive);if("all-time"!==a){const e=new Date,s=e.getFullYear(),r=e.getMonth();t=t.filter(e=>{const t=new Date(e.dealDate);switch(a){case"this-month":return t.getFullYear()===s&&t.getMonth()===r;case"last-month":const e=0===r?11:r-1,a=0===r?s-1:s;return t.getFullYear()===a&&t.getMonth()===e;case"ytd":return t.getFullYear()===s;case"last-year":return t.getFullYear()===s-1;default:return!0}})}const r=t.length,l=t.filter(e=>e.metricFlags.countsForSold).length,n=t.filter(e=>e.metricFlags.countsForTracking).length,i=t.filter(e=>"N"===e.vehicleType).length,d=t.filter(e=>"U"===e.vehicleType||"C"===e.vehicleType).length,m=t.reduce((e,s)=>e+s.frontEndGross,0),h=t.reduce((e,s)=>e+s.backEndGross,0),u=t.reduce((e,s)=>e+s.totalGross,0),x={};return t.forEach(e=>{var s;const a=e.primarySalespersonId||"unknown";x[a]||(x[a]={salespersonId:a,salespersonName:e.raw.salespersonName||e.raw.salesperson||`SP-${a}`,totalDeals:0,fundedDeals:0,totalFrontGross:0,totalBackGross:0,totalGross:0,newVehicleDeals:0,usedVehicleDeals:0});const t=x[a],r=(null==(s=e.splitCredit)?void 0:s.creditPercentage)||100;t.totalDeals+=r/100,e.metricFlags.countsForSold&&(t.fundedDeals+=r/100),t.totalFrontGross+=e.frontEndGross*(r/100),t.totalBackGross+=e.backEndGross*(r/100),t.totalGross+=e.totalGross*(r/100),"N"===e.vehicleType?t.newVehicleDeals+=r/100:t.usedVehicleDeals+=r/100}),Object.values(x).forEach(e=>{e.avgFrontGross=e.totalDeals>0?e.totalFrontGross/e.totalDeals:0,e.avgBackGross=e.totalDeals>0?e.totalBackGross/e.totalDeals:0,e.avgPerDeal=e.totalDeals>0?e.totalGross/e.totalDeals:0,e.goalPercentage=e.totalDeals/15*100}),{deals:t.map(e=>c(o({},e),{dealNumber:e.dealNumber,stockNumber:e.stockNumber,customer:e.lastName,date:e.dealDate,vehicleType:e.vehicleTypeDisplay,salesperson:e.raw.salespersonName||e.raw.salesperson||"Unknown",frontGross:e.frontEndGross,financeGross:e.backEndGross,totalGross:e.totalGross,status:e.dealStatus})),metrics:{totalDeals:r,fundedDeals:l,pendingDeals:n,newVehicleDeals:i,usedVehicleDeals:d,totalFrontGross:m,totalBackGross:h,totalGross:u,avgFrontGross:r>0?m/r:0,avgBackGross:r>0?h/r:0,avgPerDeal:r>0?u/r:0,salesGoal:100,salesPerformance:r/100*100},salespersonMetrics:Object.values(x),lastUpdated:(new Date).toISOString()}}catch(n){return console.error("Error mapping manager dashboard data:",n),{deals:[],metrics:{totalDeals:0,fundedDeals:0,pendingDeals:0,newVehicleDeals:0,usedVehicleDeals:0,totalFrontGross:0,totalBackGross:0,totalGross:0,avgFrontGross:0,avgBackGross:0,avgPerDeal:0,salesGoal:100,salesPerformance:0},salespersonMetrics:[],error:n.message,lastUpdated:(new Date).toISOString()}}})(tr("financeDeals"),e,s);t(r),r.error&&(console.warn("[useManagerDealsData] Deal data warning:",r.error),i(`Warning: ${r.error}`)),console.log(`[useManagerDealsData] Loaded ${(null==(a=r.deals)?void 0:a.length)||0} deals with metrics:`,r.metrics)}catch(r){console.error("[useManagerDealsData] Error loading manager deal data:",r),i("Failed to load manager deal data"),t({deals:[],metrics:{totalDeals:0,fundedDeals:0,pendingDeals:0,newVehicleDeals:0,usedVehicleDeals:0,totalFrontGross:0,totalBackGross:0,totalGross:0,avgFrontGross:0,avgBackGross:0,avgPerDeal:0,salesGoal:100,salesPerformance:0},salespersonMetrics:[],error:r instanceof Error?r.message:"Unknown error",lastUpdated:(new Date).toISOString()})}finally{l(!1)}}),[e,s]);return he.useEffect(()=>{d()},[d]),he.useEffect(()=>{const e=e=>{"financeDeals"===e.key&&(console.log("[useManagerDealsData] localStorage changed, refreshing deal data"),d())};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[d]),{dealData:a,loading:r,error:n,refresh:d,setTimePeriod:e=>{}}},ir=[{id:"D5421",stockNumber:"A7831",lastName:"Johnson",frontGross:1200,backEndGross:700,date:"2023-06-10",isNew:!0},{id:"D5398",stockNumber:"B2241",lastName:"Martinez",frontGross:800,backEndGross:900,date:"2023-06-08",isNew:!1},{id:"D5376",stockNumber:"C5532",lastName:"Williams",frontGross:0,backEndGross:500,date:"2023-06-05",isNew:!1},{id:"D5342",stockNumber:"A1277",lastName:"Garcia",frontGross:1500,backEndGross:800,date:"2023-06-01",isNew:!1},{id:"D5321",stockNumber:"B8773",lastName:"Miller",frontGross:950,backEndGross:600,date:"2023-05-29",isNew:!1},{id:"D5310",stockNumber:"C9912",lastName:"Davis",frontGross:0,backEndGross:450,date:"2023-05-27",isNew:!1},{id:"D5298",stockNumber:"A5523",lastName:"Rodriguez",frontGross:1300,backEndGross:750,date:"2023-05-25",isNew:!1}],or=[{emoji:"",name:"Compact",threshold:0},{emoji:"",name:"Sedan",threshold:20},{emoji:"",name:"SUV",threshold:40},{emoji:"",name:"Sports Car",threshold:60},{emoji:"",name:"Premium",threshold:80},{emoji:"",name:"Supercar",threshold:95}],cr=[{day:"Monday",date:"12",shift:"Off",team:""},{day:"Tuesday",date:"13",shift:"10am - 7pm",team:"Team A"},{day:"Wednesday",date:"14",shift:"9am - 6pm",team:"Team A"},{day:"Thursday",date:"15",shift:"12pm - 9pm",team:"Team A"},{day:"Friday",date:"16",shift:"9am - 6pm",team:"Team B"},{day:"Saturday",date:"17",shift:"9am - 8pm",team:"Team B"},{day:"Sunday",date:"18",shift:"Off",team:""}],dr={frontEndGrossPercent:25,backEndGrossPercent:5,spiffs:350,bonusThreshold:12,bonusAmount:500},mr=()=>{var e,s,a;const{user:t,role:r,dealershipId:l}=It(),[n,i]=he.useState(!0),[o,c]=he.useState(!0),[d,m]=he.useState(60),[h,x]=he.useState("this-month"),p=(null==t?void 0:t.id)||(null==(e=null==t?void 0:t.user_metadata)?void 0:e.salesperson_id),{dealData:g,loading:f,error:j,setTimePeriod:v}=((e,s="this-month")=>lr({dashboardType:"sales",userRole:"salesperson",salespersonId:e,timePeriod:s,includeInactive:!1,autoRefresh:!0}))(p,h);he.useEffect(()=>{if(null==g?void 0:g.metrics){const e=g.metrics.totalDeals>0?Math.min(g.metrics.totalDeals/15*100,100):0;m(e)}},[g]);const b=(null==g?void 0:g.deals)||ir,N=(null==g?void 0:g.metrics)||{},y=N.totalFrontGross||0,w=N.totalBackGross||0,S=N.totalGross||y+w;N.totalDeals;const _=b.filter(e=>0===(e.frontGross||e.frontEndGross||0)).length;(e=>{for(let s=or.length-1;s>=0;s--)if(e>=or[s].threshold)return or[s]})(d);const D=(()=>{const e=(new Date).getDate(),s=new Date((new Date).getFullYear(),(new Date).getMonth()+1,0).getDate(),a=Math.round(e/s*15),t=ir.length;return t<a-2?"red":t<a?"yellow":"green"})(),P=y*(dr.frontEndGrossPercent/100)+w*(dr.backEndGrossPercent/100)+dr.spiffs,C=new Date((new Date).getFullYear(),(new Date).getMonth()+1,0).getDate()/(new Date).getDate(),k=P*C,T=(N.totalDeals||ir.length)*C,F=k+(T>=dr.bonusThreshold?dr.bonusAmount:0);he.useEffect(()=>(console.log("[SalesDashboard] Rendering sales dashboard",{userId:null==t?void 0:t.id,role:r,dealershipId:l,timestamp:(new Date).toISOString()}),()=>{console.log("[SalesDashboard] Unmounting sales dashboard")}),[t,r,l]);const A=e=>{const s=(new Date).getDay();return{Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6}[e]===s};return u.jsxs("div",{className:"container py-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h1",{className:"text-3xl font-bold",children:"Sales Dashboard"}),u.jsx("div",{className:"bg-blue-50 px-3 py-1 rounded-md text-center flex-1 mx-8 border border-blue-100",children:u.jsxs("p",{className:"text-xs italic text-blue-800 truncate",children:[u.jsx(Je,{className:"h-3 w-3 inline-block mr-1"}),u.jsx("strong",{children:"Daily Tip:"})," ",["Listen twice as much as you talk. You have two ears and one mouth for a reason.","The first 5 minutes with a customer sets the tone for the entire deal.","Be the expert they can trust, not just the salesperson they deal with.","Follow up with past customers - they're your best source of referrals.","Know your inventory better than anyone else on the floor.","Sell the experience and lifestyle, not just the vehicle.","Always ask for referrals - it's the easiest way to grow your business."][(new Date).getDay()]]})})]}),u.jsx("div",{className:"mb-6",children:u.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[u.jsxs("div",{className:"flex flex-row items-center gap-4",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:(e=>{const s=new Date,a=s.toLocaleString("default",{month:"long"}),t=s.getFullYear();switch(e){case"this-month":default:return`${a} ${t}`;case"last-month":return`${0===s.getMonth()?"December":new Date(s.getFullYear(),s.getMonth()-1,1).toLocaleString("default",{month:"long"})} ${0===s.getMonth()?s.getFullYear()-1:s.getFullYear()}`;case"last-quarter":const e=Math.floor(s.getMonth()/3);return`Q${0===e?4:e} ${0===e?t-1:t}`;case"ytd":return`Year to Date ${t}`;case"last-year":return""+(t-1)}})(h)}),u.jsxs("div",{className:"flex items-center",children:[u.jsx(Oe,{className:"h-5 w-5 text-gray-500 mr-1"}),u.jsxs("select",{value:h,onChange:e=>{const s=e.target.value;x(s),v(s)},className:"p-2 border rounded-md shadow-sm",children:[u.jsx("option",{value:"this-month",children:"This Month"}),u.jsx("option",{value:"last-month",children:"Last Month"}),u.jsx("option",{value:"last-quarter",children:"Last Quarter"}),u.jsx("option",{value:"ytd",children:"Year to Date"}),u.jsx("option",{value:"last-year",children:"Last Year"})]})]}),u.jsx("p",{className:"text-gray-500",children:"Sales Performance"})]}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-2",children:u.jsx(Re,{className:"h-4 w-4 text-blue-600"})}),u.jsxs("div",{children:[u.jsx("div",{className:"font-semibold",children:(null==(s=null==t?void 0:t.email)?void 0:s.split("@")[0])||"Sales Associate"}),u.jsx("div",{className:"text-xs text-gray-500",children:r||"Salesperson"})]})]})]})}),j&&u.jsx("div",{className:"mb-6",children:u.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:u.jsxs("div",{className:"flex",children:[u.jsx(Ee,{className:"h-5 w-5 text-red-400 mr-2 mt-0.5"}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Deal Data Warning"}),u.jsx("p",{className:"text-sm text-red-700 mt-1",children:j}),u.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Showing fallback data. New deals will update automatically."})]})]})})}),f&&u.jsx("div",{className:"mb-6",children:u.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),u.jsx("p",{className:"text-sm text-blue-700",children:"Loading deal data..."})]})})}),u.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[u.jsxs(Ut,{className:"border-l-4 border-l-blue-500",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(Ye,{className:"mr-2 h-4 w-4 text-blue-500"}),"Total Deals This Month"]})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:(null==(a=null==g?void 0:g.metrics)?void 0:a.totalDeals)||ir.length}),u.jsxs("p",{className:"text-xs text-green-600 flex items-center mt-1",children:[u.jsx(He,{className:"h-3 w-3 mr-1"}),"8% from last month"]})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-green-500",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(Ke,{className:"mr-2 h-4 w-4 text-green-500"}),"Gross"]})}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:["$",S.toLocaleString()]}),u.jsxs("div",{className:"flex flex-col text-xs mt-1",children:[n&&u.jsxs("span",{className:"text-green-600",children:["Front: $",y.toLocaleString()]}),o&&u.jsxs("span",{className:"text-blue-600",children:["Back: $",w.toLocaleString()]})]})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-amber-500",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(Ee,{className:"mr-2 h-4 w-4 text-amber-500"}),"Minis"]})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:_}),u.jsx("p",{className:"text-xs text-amber-600 flex items-center mt-1",children:_>2?u.jsxs(u.Fragment,{children:[u.jsx(He,{className:"h-3 w-3 mr-1"}),"Focus on higher gross deals"]}):u.jsxs(u.Fragment,{children:[u.jsx(Ze,{className:"h-3 w-3 mr-1"}),"Good job keeping minis low"]})})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-purple-500",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(Ve,{className:"mr-2 h-4 w-4 text-purple-500"}),"Monthly Goal Progress"]})}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:[d,"%"]}),u.jsx("div",{className:"w-full h-2 bg-gray-200 mt-2 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full rounded-full",style:{width:`${d}%`,background:`linear-gradient(90deg, #4338ca, #3b82f6 ${d}%)`}})})]})]})]}),u.jsx("div",{className:"mb-6",children:u.jsxs(Ut,{className:"border hover:shadow-md transition-shadow",children:[u.jsx(Gt,{className:"py-2 px-4 border-b",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(Qe,{className:"mr-2 h-4 w-4 text-indigo-500"}),"Schedule"]})}),u.jsxs($t,{className:"py-2 px-0 relative",children:[u.jsx(Bt,{variant:"ghost",size:"sm",className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 h-full",children:u.jsx(Xe,{className:"h-4 w-4"})}),u.jsx("div",{className:"grid grid-cols-7 text-center px-6",children:cr.map((e,s)=>u.jsxs("div",{className:"p-1 "+(A(e.day)?"bg-blue-50 border-b-2 border-blue-500":""),children:[u.jsxs("div",{className:"font-medium text-xs text-gray-800",children:[e.day.substring(0,3)," ",u.jsx("span",{className:"text-gray-500",children:e.date})]}),u.jsx("div",{className:"mt-1 text-xs "+("Off"===e.shift?"text-gray-400":"text-gray-800 font-medium"),children:"Off"===e.shift?"Off":e.shift.replace("am - ","-").replace("pm","").replace("am","")})]},s))}),u.jsx(Bt,{variant:"ghost",size:"sm",className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 h-full",children:u.jsx(es,{className:"h-4 w-4"})})]})]})}),u.jsx("div",{className:"mb-6",children:u.jsxs(Ut,{className:"border hover:shadow-md transition-shadow",children:[u.jsx(Gt,{className:"py-2 px-4 border-b",children:u.jsx("div",{className:"flex justify-between items-center",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(ss,{className:"mr-2 h-4 w-4 text-yellow-500"}),"The Das Board"]})})}),u.jsxs($t,{className:"py-1",children:[u.jsxs("div",{className:"flex items-center text-xs font-medium text-white border-b py-2 px-1",children:[u.jsx("div",{className:"w-10 text-center bg-gray-600 py-2 rounded-l-md",children:"#"}),u.jsx("div",{className:"w-40 flex-shrink-0 bg-gray-600 py-2 px-2",children:"Salesperson"}),u.jsxs("div",{className:"w-28 text-center bg-purple-600 py-2 flex items-center justify-center cursor-pointer hover:bg-purple-700",children:["PVR ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-36 text-center bg-green-600 py-2 flex items-center justify-center cursor-pointer hover:bg-green-700",children:["Total Gross ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-blue-600 py-2 flex items-center justify-center cursor-pointer hover:bg-blue-700",children:["Avg/Mo ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-blue-500 py-2 flex items-center justify-center cursor-pointer hover:bg-blue-600",children:["Last Mo ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-blue-600 py-2 flex items-center justify-center cursor-pointer hover:bg-blue-700",children:["YTD ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-blue-500 py-2 flex items-center justify-center cursor-pointer hover:bg-blue-600",children:["Annual ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-24 text-center bg-green-600 py-2 flex items-center justify-center cursor-pointer hover:bg-green-700",children:["New ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-24 text-center bg-amber-600 py-2 flex items-center justify-center cursor-pointer hover:bg-amber-700",children:["Used ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-36 text-right bg-indigo-600 py-2 pr-3 flex items-center justify-end cursor-pointer hover:bg-indigo-700 font-semibold rounded-r-md",children:["Current Month ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]})]}),u.jsx("div",{children:[{name:"Michael Scott",units:14,frontGross:18200,backGross:14300,totalGross:32500,avgMonth:12,lastMonth:15,ytd:82,annualPace:144,newUnits:9,usedUnits:5,pvr:2321},{name:"Jim Halpert",units:12,frontGross:16400,backGross:12500,totalGross:28900,avgMonth:10,lastMonth:11,ytd:65,annualPace:120,newUnits:7,usedUnits:5,pvr:2408},{name:"Dwight Schrute",units:11,frontGross:14800,backGross:11600,totalGross:26400,avgMonth:9,lastMonth:10,ytd:58,annualPace:108,newUnits:4,usedUnits:7,pvr:2400},{name:"Pam Beesly",units:9,frontGross:11900,backGross:9800,totalGross:21700,avgMonth:8,lastMonth:7,ytd:48,annualPace:96,newUnits:5,usedUnits:4,pvr:2411},{name:"Stanley Hudson",units:8,frontGross:10500,backGross:8700,totalGross:19200,avgMonth:7,lastMonth:9,ytd:42,annualPace:84,newUnits:3,usedUnits:5,pvr:2400}].map((e,s)=>u.jsxs("div",{className:`flex items-center py-2 px-1 ${4!==s?"border-b":""} border-gray-100 text-sm hover:bg-gray-50`,children:[u.jsx("div",{className:"w-10 flex justify-center",children:u.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center\n                      "+(0===s?"bg-yellow-100 text-yellow-600":1===s?"bg-gray-100 text-gray-600":2===s?"bg-amber-100 text-amber-600":"bg-blue-50 text-blue-500"),children:u.jsx("span",{className:"text-xs font-bold",children:s+1})})}),u.jsx("div",{className:"w-40 flex-shrink-0 font-medium truncate px-2",children:e.name}),u.jsxs("div",{className:"w-28 text-center bg-purple-50",children:["$",e.pvr]}),u.jsxs("div",{className:"w-36 text-center bg-green-50",children:["$",e.totalGross.toLocaleString()]}),u.jsx("div",{className:"w-28 text-center bg-blue-50",children:e.avgMonth}),u.jsx("div",{className:"w-28 text-center",children:e.lastMonth}),u.jsx("div",{className:"w-28 text-center bg-blue-50",children:e.ytd}),u.jsx("div",{className:"w-28 text-center",children:e.annualPace}),u.jsx("div",{className:"w-24 text-center bg-green-50",children:e.newUnits}),u.jsx("div",{className:"w-24 text-center bg-amber-50",children:e.usedUnits}),u.jsx("div",{className:"w-36 text-right pr-3",children:u.jsx("span",{className:"text-lg font-bold text-indigo-700",children:e.units})})]},s))}),u.jsx("div",{className:"mt-2 pt-2 text-center",children:u.jsx(Bt,{variant:"ghost",size:"sm",className:"text-xs text-blue-600",children:"View All Salespeople"})})]})]})}),u.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[u.jsxs(Ut,{className:"flex-grow border hover:shadow-md transition-shadow",children:[u.jsx(Gt,{className:"pb-2 border-b",children:u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs(Mt,{className:"text-lg font-medium flex items-center",children:[u.jsx(as,{className:"mr-2 h-5 w-5 text-blue-500"}),"My Deals"]}),u.jsx("div",{className:"h-3 w-3 rounded-full "+("green"===D?"bg-green-500":"yellow"===D?"bg-yellow-500":"bg-red-500")})]})}),u.jsxs($t,{className:"pt-4",children:[u.jsx("div",{className:"overflow-hidden",children:u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"w-full",children:[u.jsx("thead",{children:u.jsxs("tr",{className:"text-left border-b",children:[u.jsx("th",{className:"pb-2 font-medium text-xs text-gray-500",children:"STOCK #"}),u.jsx("th",{className:"pb-2 font-medium text-xs text-gray-500",children:"CUSTOMER"}),u.jsx("th",{className:"pb-2 font-medium text-xs text-gray-500 text-right",children:"FRONT"}),u.jsx("th",{className:"pb-2 font-medium text-xs text-gray-500 text-right",children:"BACK"}),u.jsx("th",{className:"pb-2 font-medium text-xs text-gray-500 text-right",children:"TOTAL"})]})}),u.jsx("tbody",{children:b.slice(0,10).map((e,s)=>u.jsxs("tr",{className:`${s!==b.slice(0,10).length-1?"border-b":""} ${"N"===e.vehicleType||e.isNew?"bg-blue-50":""}`,children:[u.jsx("td",{className:"py-3 text-sm",children:e.stockNumber}),u.jsx("td",{className:"py-3 text-sm",children:e.lastName||e.customer}),u.jsxs("td",{className:"py-3 text-sm text-right "+(0===(e.frontEndGross||e.frontGross||0)?"text-red-500 font-medium":""),children:["$",(e.frontEndGross||e.frontGross||0).toLocaleString()]}),u.jsxs("td",{className:"py-3 text-sm text-right",children:["$",(e.backEndGross||e.profit||0).toLocaleString()]}),u.jsxs("td",{className:"py-3 text-sm font-medium text-right",children:["$",((e.frontEndGross||e.frontGross||0)+(e.backEndGross||e.profit||0)).toLocaleString()]})]},e.id||e.dealNumber))})]})})}),u.jsx("div",{className:"mt-8",children:u.jsxs("div",{className:"bg-blue-50 rounded-lg border border-blue-100 p-4",children:[u.jsx("h3",{className:"font-semibold text-blue-700 mb-2",children:"Deal Performance"}),u.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[u.jsxs("div",{children:[u.jsx("div",{className:"text-xs text-gray-500",children:"Avg Front"}),u.jsxs("div",{className:"font-bold text-blue-700",children:["$",Math.round(y/ir.length).toLocaleString()]})]}),u.jsxs("div",{children:[u.jsx("div",{className:"text-xs text-gray-500",children:"Avg Back"}),u.jsxs("div",{className:"font-bold text-blue-700",children:["$",Math.round(w/ir.length).toLocaleString()]})]}),u.jsxs("div",{children:[u.jsx("div",{className:"text-xs text-gray-500",children:"Avg Total"}),u.jsxs("div",{className:"font-bold text-blue-700",children:["$",Math.round(S/ir.length).toLocaleString()]})]})]})]})})]}),u.jsx(Lt,{className:"border-t px-6 py-3",children:u.jsxs(Bt,{variant:"ghost",size:"sm",className:"ml-auto flex items-center text-blue-600 text-sm",children:["View All Deals",u.jsx(ts,{className:"ml-1 h-4 w-4"})]})})]}),u.jsxs("div",{className:"flex flex-col gap-6 h-full",children:[u.jsx(er,{}),u.jsxs(Ut,{className:"border hover:shadow-md transition-shadow overflow-hidden bg-white z-10 relative",children:[u.jsx(Gt,{className:"pb-2 border-b bg-gradient-to-r from-green-400 to-teal-500",children:u.jsxs(Mt,{className:"text-lg font-medium flex items-center text-white",children:[u.jsx(rs,{className:"mr-2 h-5 w-5 text-white"}),"Pay Calculator"]})}),u.jsxs($t,{className:"pt-4 bg-white",children:[u.jsx("div",{className:"flex items-center justify-center mb-3",children:u.jsxs("div",{className:"text-center",children:[u.jsxs("div",{className:"text-3xl font-bold text-green-600",children:["$",Math.round(P).toLocaleString()]}),u.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Month-to-Date Earnings"})]})}),u.jsxs("div",{className:"space-y-2 mt-2",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsxs("span",{className:"text-xs text-gray-600",children:["Front End (",dr.frontEndGrossPercent,"%)"]}),u.jsxs("span",{className:"text-xs font-medium",children:["$",Math.round(y*(dr.frontEndGrossPercent/100)).toLocaleString()]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsxs("span",{className:"text-xs text-gray-600",children:["Back End (",dr.backEndGrossPercent,"%)"]}),u.jsxs("span",{className:"text-xs font-medium",children:["$",Math.round(w*(dr.backEndGrossPercent/100)).toLocaleString()]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-xs text-gray-600",children:"Spiffs & Bonuses"}),u.jsxs("span",{className:"text-xs font-medium",children:["$",dr.spiffs.toLocaleString()]})]}),u.jsxs("div",{className:"pt-2 border-t",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Potential Monthly Total"}),u.jsxs("span",{className:"text-xs font-bold text-green-600",children:["$",Math.round(F).toLocaleString()]})]}),u.jsx("div",{className:"text-xs text-gray-500 mt-1",children:T>=dr.bonusThreshold&&u.jsxs("div",{className:"text-green-600 mt-1 font-medium text-xs",children:["Includes $",dr.bonusAmount," volume bonus!"]})})]})]}),u.jsx("div",{className:"mt-3 pt-2 border-t",children:u.jsxs("p",{className:"text-[10px] text-gray-400 italic",children:[u.jsx("strong",{children:"Disclaimer:"})," These figures are estimates only and not actual earnings. Final compensation may vary based on dealership policies and deal structures."]})})]})]})]})]})]})},hr=[{day:"Monday",date:"12",shift:"Off",team:""},{day:"Tuesday",date:"13",shift:"9am - 6pm",team:"Team A"},{day:"Wednesday",date:"14",shift:"10am - 7pm",team:"Team A"},{day:"Thursday",date:"15",shift:"9am - 6pm",team:"Team A"},{day:"Friday",date:"16",shift:"11am - 8pm",team:"Team B"},{day:"Saturday",date:"17",shift:"9am - 5pm",team:"Team B"},{day:"Sunday",date:"18",shift:"Off",team:""}],ur=()=>{const[e,s]=he.useState("this-month"),[a,t]=he.useState({start:"",end:""}),[r,l]=he.useState(!1),[n,i]=he.useState([]),[d,m]=he.useState([]),[h,x]=he.useState([]),[p,g]=he.useState({mtdRevenue:0,dealsProcessed:0,productsPerDeal:0,pvr:0,productMix:{extendedWarranty:0,gapInsurance:0,paintProtection:0,tireWheel:0,ppm:0,other:0},avgProfits:{extendedWarranty:0,gapInsurance:0,paintProtection:0,tireWheel:0,ppm:0,other:0}}),{dealData:f}=((e="this-month")=>lr({dashboardType:"finance",userRole:"finance_manager",timePeriod:e,includeInactive:!1,autoRefresh:!0}))(e),j=(null==f?void 0:f.deals)||[],v=(null==f?void 0:f.metrics)||{totalDeals:0,totalBackGross:0,totalPVR:0,avgPVR:0},b=n.length>0?n:j,N=p.mtdRevenue>0?p:{mtdRevenue:v.totalBackGross,dealsProcessed:v.totalDeals,productsPerDeal:v.totalDeals>0?v.totalPVR/v.totalDeals:0,pvr:v.avgPVR,productMix:{extendedWarranty:0,gapInsurance:0,paintProtection:0,tireWheel:0,ppm:0,other:0},avgProfits:{extendedWarranty:0,gapInsurance:0,paintProtection:0,tireWheel:0,ppm:0,other:0}};b.filter(e=>e.isFunded),h.length>0||b.filter(e=>e.isPending);const y=e=>{const{name:s,value:a}=e.target;t(e=>c(o({},e),{[s]:a}))};he.useEffect(()=>{try{const e=localStorage.getItem("financeDeals");if(e){const s=JSON.parse(e);i(s);const a=s.filter(e=>"Pending"===e.status||"Bank Approval"===e.status||"Pending Documents"===e.status||"Contract Review"===e.status||"Insurance Verification"===e.status);x(a)}}catch(e){console.error("Error loading deals from localStorage:",e)}},[]),he.useEffect(()=>{n.length>0&&w()},[e,a,n]);const w=()=>{if(!n.length)return;const{startDate:s,endDate:t}=(e=>{const s=new Date;let t=new Date,r=new Date;switch(e){case"this-month":t=new Date(s.getFullYear(),s.getMonth(),1),r=s;break;case"last-month":t=new Date(s.getFullYear(),s.getMonth()-1,1),r=new Date(s.getFullYear(),s.getMonth(),0);break;case"last-quarter":const e=Math.floor(s.getMonth()/3);t=new Date(s.getFullYear(),3*e-3,1),r=new Date(s.getFullYear(),3*e,0);break;case"ytd":t=new Date(s.getFullYear(),0,1),r=s;break;case"last-year":t=new Date(s.getFullYear()-1,0,1),r=new Date(s.getFullYear()-1,11,31);break;case"custom":a.start&&a.end&&(t=new Date(a.start),r=new Date(a.end))}return{startDate:t,endDate:r}})(e),r=n.filter(e=>{const a=new Date(e.saleDate);return a>=s&&a<=t});m(r),S(r)},S=e=>{if(0===e.length)return void g({mtdRevenue:0,dealsProcessed:0,productsPerDeal:0,pvr:0,productMix:{extendedWarranty:0,gapInsurance:0,paintProtection:0,tireWheel:0,ppm:0,other:0},avgProfits:{extendedWarranty:0,gapInsurance:0,paintProtection:0,tireWheel:0,ppm:0,other:0}});const s=e.reduce((e,s)=>e+(s.back_end_gross||s.profit||0),0),a=e.length;let t=0,r=0,l=0,n=0,i=0,o=0,c=0,d=0,m=0,h=0,u=0,x=0;e.forEach(e=>{const s=e.vsc_profit||e.vscProfit||0;s>0&&(t++,r+=s);const a=e.gap_profit||e.gapProfit||0;a>0&&(l++,n+=a);const p=e.appearance_profit||e.appearanceProfit||0;p>0&&(i++,o+=p);const g=e.tire_wheel_profit||e.tireWheelProfit||0;g>0&&(c++,d+=g);const f=e.ppm_profit||e.ppmProfit||0;f>0&&(m++,h+=f);const j=(e.ext_warranty_profit||e.extWarrantyProfit||0)+(e.key_replacement_profit||e.keyReplacementProfit||0)+(e.theft_profit||e.theftProfit||0)+(e.windshield_profit||e.windshieldProfit||0)+(e.lojack_profit||e.lojackProfit||0)+(e.other_profit||e.otherProfit||0);j>0&&(u++,x+=j)});const p=e=>a>0?Math.round(e/a*100):0,f=(e,s)=>s>0?Math.round(e/s):0,j=a>0?(t+l+i+c+m+u)/a:0,v=a>0?s/a:0,b={extendedWarranty:p(t),gapInsurance:p(l),paintProtection:p(i),tireWheel:p(c),ppm:p(m),other:p(u)},N={extendedWarranty:f(r,t),gapInsurance:f(n,l),paintProtection:f(o,i),tireWheel:f(d,c),ppm:f(h,m),other:f(x,u)};g({mtdRevenue:s,dealsProcessed:a,productsPerDeal:j,pvr:v,productMix:b,avgProfits:N})},_=e=>{const s=(new Date).getDay();return{Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6}[e]===s};return u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"mb-6",children:u.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[u.jsx("div",{className:"flex items-center gap-4",children:u.jsx("div",{})}),u.jsx("div",{className:"flex flex-col md:flex-row gap-3",children:r&&u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("input",{type:"date",name:"start",value:a.start,onChange:y,className:"p-2 border rounded-md shadow-sm"}),u.jsx("span",{children:"to"}),u.jsx("input",{type:"date",name:"end",value:a.end,onChange:y,className:"p-2 border rounded-md shadow-sm"}),u.jsx(Bt,{size:"sm",onClick:()=>{a.start&&a.end&&w()},children:"Apply"})]})})]})}),u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[u.jsxs(Ut,{className:"border-l-4 border-l-green-500 hover:shadow-md transition-shadow",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(Ke,{className:"mr-2 h-4 w-4 text-green-500"}),"F&I Gross"]})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:N.mtdRevenue>0?`$${N.mtdRevenue.toLocaleString()}`:"No data yet"}),N.mtdRevenue>0&&u.jsxs("div",{className:"flex items-center pt-1 text-green-500",children:[u.jsx(He,{className:"h-3 w-3 mr-1"}),u.jsx("span",{className:"text-xs",children:"8.2% from previous period"})]})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-blue-500 hover:shadow-md transition-shadow",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(ls,{className:"mr-2 h-4 w-4 text-blue-500"}),"Deals Processed"]})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:N.dealsProcessed>0?N.dealsProcessed:"No deals yet"}),N.dealsProcessed>0&&u.jsxs("div",{className:"flex items-center pt-1 text-green-500",children:[u.jsx(He,{className:"h-3 w-3 mr-1"}),u.jsx("span",{className:"text-xs",children:"10.5% from previous period"})]})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-purple-500 hover:shadow-md transition-shadow",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(ns,{className:"mr-2 h-4 w-4 text-purple-500"}),"Pay Calculator MTD"]})}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:["$",Math.round(.15*N.mtdRevenue).toLocaleString()]}),N.dealsProcessed>0&&u.jsxs("div",{className:"flex items-center pt-1 text-green-500",children:[u.jsx(He,{className:"h-3 w-3 mr-1"}),u.jsx("span",{className:"text-xs",children:"15% of F&I revenue"})]})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-amber-500 hover:shadow-md transition-shadow",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(is,{className:"mr-2 h-4 w-4 text-amber-500"}),"PVR"]})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:N.dealsProcessed>0?`$${N.pvr.toLocaleString()}`:"No data yet"}),N.dealsProcessed>0&&u.jsxs("div",{className:"flex items-center pt-1 text-green-500",children:[u.jsx(He,{className:"h-3 w-3 mr-1"}),u.jsx("span",{className:"text-xs",children:"$120 from previous period"})]})]})]})]}),u.jsx("div",{children:u.jsxs(Ut,{className:"border hover:shadow-md transition-shadow",children:[u.jsx(Gt,{className:"py-2 px-4 border-b",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(Qe,{className:"mr-2 h-4 w-4 text-indigo-500"}),"Finance Schedule"]})}),u.jsxs($t,{className:"py-2 px-0 relative",children:[u.jsx(Bt,{variant:"ghost",size:"sm",className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 h-full",children:u.jsx(Xe,{className:"h-4 w-4"})}),u.jsx("div",{className:"grid grid-cols-7 text-center px-6",children:hr.map((e,s)=>u.jsxs("div",{className:"p-1 "+(_(e.day)?"bg-blue-50 border-b-2 border-blue-500":""),children:[u.jsxs("div",{className:"font-medium text-xs text-gray-800",children:[e.day.substring(0,3)," ",u.jsx("span",{className:"text-gray-500",children:e.date})]}),u.jsx("div",{className:"mt-1 text-xs "+("Off"===e.shift?"text-gray-400":"text-gray-800 font-medium"),children:"Off"===e.shift?"Off":e.shift.replace("am - ","-").replace("pm","").replace("am","")})]},s))}),u.jsx(Bt,{variant:"ghost",size:"sm",className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 h-full",children:u.jsx(es,{className:"h-4 w-4"})})]})]})}),u.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[u.jsxs(Ut,{className:"border hover:shadow-md transition-shadow",children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center text-lg font-medium",children:[u.jsx(ns,{className:"mr-2 h-5 w-5 text-blue-500"}),"F&I Product Mix & Avg. Profit"]})}),u.jsx($t,{children:N.dealsProcessed>0?u.jsxs("div",{className:"space-y-2",children:[[{name:"Vehicle Service Contract (VSC)",percent:N.productMix.extendedWarranty,value:`$${N.avgProfits.extendedWarranty.toLocaleString()}`,color:"bg-teal-600"},{name:"PrePaid Maintenance (PPM)",percent:N.productMix.ppm,value:`$${N.avgProfits.ppm.toLocaleString()}`,color:"bg-purple-600"},{name:"GAP Insurance",percent:N.productMix.gapInsurance,value:`$${N.avgProfits.gapInsurance.toLocaleString()}`,color:"bg-green-600"},{name:"Paint and Fabric Protection",percent:N.productMix.paintProtection,value:`$${N.avgProfits.paintProtection.toLocaleString()}`,color:"bg-blue-600"},{name:"Tire & Wheel Bundle",percent:N.productMix.tireWheel,value:`$${N.avgProfits.tireWheel.toLocaleString()}`,color:"bg-amber-600"},{name:"Other Products",percent:N.productMix.other,value:`$${N.avgProfits.other.toLocaleString()}`,color:"bg-gray-600"}].map((e,s)=>u.jsxs("div",{className:"space-y-1",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"font-medium flex items-center text-sm",children:[u.jsx("div",{className:`w-3 h-3 ${e.color} rounded-full mr-2`}),e.name]}),u.jsxs("div",{className:"text-right",children:[u.jsx("div",{className:"text-xs text-gray-500",children:"Avg. Profit"}),u.jsx("div",{className:"font-medium text-sm",children:e.value})]})]}),u.jsx("div",{className:"relative h-1.5 w-full overflow-hidden rounded-full bg-gray-100",children:u.jsx("div",{className:`absolute inset-y-0 left-0 rounded-full ${e.color}`,style:{width:`${e.percent}%`}})}),u.jsxs("div",{className:"text-right text-xs text-gray-500",children:[e.percent,"%"]})]},s)),u.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("div",{className:"font-medium text-sm",children:"Products Per Deal (PPD)"}),u.jsx("div",{className:"font-bold text-lg text-purple-600",children:N.productsPerDeal.toFixed(1)})]})})]}):u.jsx("div",{className:"py-8 text-center text-gray-500",children:"No F&I product data available yet. Log deals with products to see the mix."})})]}),u.jsxs(Ut,{className:"border hover:shadow-md transition-shadow",children:[u.jsx(Gt,{className:"py-2 px-4 border-b",children:u.jsx("div",{className:"flex justify-between items-center",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(ss,{className:"mr-2 h-4 w-4 text-yellow-500"}),"Finance Das Board"]})})}),u.jsxs($t,{className:"py-1",children:[u.jsxs("div",{className:"flex items-center text-xs font-medium text-white border-b py-2 px-1",children:[u.jsx("div",{className:"w-10 text-center bg-gray-600 py-2 rounded-l-md",children:"#"}),u.jsx("div",{className:"w-36 flex-shrink-0 bg-gray-600 py-2 px-2",children:"F&I Manager"}),u.jsxs("div",{className:"w-28 text-center bg-purple-600 py-2 flex items-center justify-center cursor-pointer hover:bg-purple-700",children:["PVR ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-teal-600 py-2 flex items-center justify-center cursor-pointer hover:bg-teal-700",children:["VSC % ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-green-600 py-2 flex items-center justify-center cursor-pointer hover:bg-green-700",children:["GAP % ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-purple-600 py-2 flex items-center justify-center cursor-pointer hover:bg-purple-700",children:["PPM % ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-24 text-center bg-pink-600 py-2 flex items-center justify-center cursor-pointer hover:bg-pink-700",children:["PPD ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-36 text-right bg-indigo-600 py-2 pr-3 flex items-center justify-end cursor-pointer hover:bg-indigo-700 font-semibold rounded-r-md",children:["Profit ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]})]}),u.jsx("div",{children:[{name:"Ashley Rodriguez",pvr:2650,vscPen:68,gapPen:72,ppmPen:54,ppd:3.2,profit:143200},{name:"Michael Parker",pvr:2450,vscPen:65,gapPen:70,ppmPen:48,ppd:2.9,profit:127500},{name:"Sophia Martinez",pvr:2320,vscPen:61,gapPen:68,ppmPen:45,ppd:2.7,profit:115300},{name:"James Wilson",pvr:2200,vscPen:58,gapPen:65,ppmPen:42,ppd:2.5,profit:96500},{name:"Emma Johnson",pvr:2100,vscPen:55,gapPen:62,ppmPen:38,ppd:2.4,profit:89200}].map((e,s)=>u.jsxs("div",{className:`flex items-center py-2 px-1 ${4!==s?"border-b":""} border-gray-100 text-sm hover:bg-gray-50`,children:[u.jsx("div",{className:"w-10 flex justify-center",children:u.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center\n                        "+(0===s?"bg-yellow-100 text-yellow-600":1===s?"bg-gray-100 text-gray-600":2===s?"bg-amber-100 text-amber-600":"bg-blue-50 text-blue-500"),children:u.jsx("span",{className:"text-xs font-bold",children:s+1})})}),u.jsx("div",{className:"w-36 flex-shrink-0 font-medium truncate px-2",children:e.name}),u.jsxs("div",{className:"w-28 text-center bg-purple-50",children:["$",e.pvr.toLocaleString()]}),u.jsxs("div",{className:"w-28 text-center bg-teal-50",children:[e.vscPen,"%"]}),u.jsxs("div",{className:"w-28 text-center bg-green-50",children:[e.gapPen,"%"]}),u.jsxs("div",{className:"w-28 text-center bg-purple-50",children:[e.ppmPen,"%"]}),u.jsx("div",{className:"w-24 text-center bg-pink-50",children:e.ppd}),u.jsx("div",{className:"w-36 text-right pr-3",children:u.jsxs("span",{className:"text-lg font-bold text-green-600",children:["$",e.profit.toLocaleString()]})})]},s))})]})]})]}),u.jsxs(Ut,{className:"border hover:shadow-md transition-shadow",children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2 border-b",children:[u.jsxs(Mt,{className:"text-lg font-medium flex items-center",children:[u.jsx(as,{className:"mr-2 h-5 w-5 text-blue-500"}),"Deals Log"]}),u.jsx(Bt,{variant:"outline",size:"sm",asChild:!0,children:u.jsx(fe,{to:"/dashboard/finance/deals",children:"View All"})})]}),u.jsx($t,{className:"pt-4 px-0",children:b.length>0?u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"w-full text-sm",children:[u.jsx("thead",{children:u.jsxs("tr",{className:"text-xs",children:[u.jsx("th",{className:"font-medium text-white py-2 pl-3 text-center bg-gray-600 w-12",children:"#"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-left bg-gray-600",children:"Last Name"}),u.jsx("th",{className:"font-medium text-white py-2 pl-4 pr-2 text-left bg-blue-600",children:"Deal #"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-left bg-gray-600",children:"Stock #"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-gray-600",children:"Date"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-left bg-gray-600",children:"VIN"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-indigo-600",children:"N/U/CPO"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-left bg-gray-600",children:"Lender"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-blue-600",children:"Front End"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-teal-600",children:"VSC"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-purple-600",children:"PPM"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-green-600",children:"GAP"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-amber-600",children:"T&W/Bundle"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-pink-600",children:"PPD"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-purple-600",children:"PVR"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-green-600",children:"Total"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-gray-600 w-20",children:"Status"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-red-600 rounded-tr-md w-16",children:"Delete"})]})}),u.jsx("tbody",{children:b.slice(0,10).map((e,s)=>{const a=e,t=e.customer.split(" ").pop()||"",r=a.dealDate||e.saleDate,l=new Date(r).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"}),n=a.vehicleType||(e.vehicle.toLowerCase().includes("new")?"N":e.vehicle.toLowerCase().includes("cpo")?"C":"U"),d="number"==typeof a.vscProfit?a.vscProfit:parseFloat(a.vscProfit)||(e.products.includes("Extended Warranty")||e.products.includes("Vehicle Service Contract (VSC)")?Math.round(.35*e.profit):0),m="number"==typeof a.ppmProfit?a.ppmProfit:parseFloat(a.ppmProfit)||(e.products.includes("Paint Protection")||e.products.includes("Paint and Fabric Protection")||e.products.includes("PPM")||e.products.includes("PrePaid Maintenance (PPM)")?Math.round(.2*e.profit):0),h="number"==typeof a.gapProfit?a.gapProfit:parseFloat(a.gapProfit)||(e.products.includes("GAP Insurance")?Math.round(.25*e.profit):0),x="number"==typeof a.tireAndWheelProfit?a.tireAndWheelProfit:parseFloat(a.tireAndWheelProfit)||(e.products.includes("Tire & Wheel")||e.products.includes("Tire & Wheel Bundle")?Math.round(.2*e.profit):0),p=e.products.length,g=Math.round(e.profit/(p||1)),f="Complete"===e.status||"Funded"===e.status?"Funded":"Canceled"===e.status||"Unwound"===e.status?"Unwound":"Pending",j="Funded"===f?"bg-green-100 text-green-800 border-green-200":"Unwound"===f?"bg-red-100 text-red-800 border-red-200":"bg-amber-100 text-amber-800 border-amber-200";return u.jsxs("tr",{className:`border-b ${s%2==1?"bg-gray-50":""} hover:bg-blue-50`,children:[u.jsx("td",{className:"py-2 px-2 text-center font-medium",children:b.length-s}),u.jsx("td",{className:"py-2 px-2 text-left font-medium",children:t}),u.jsx("td",{className:"py-2 pl-4 pr-2 text-left font-medium text-blue-600",children:a.dealNumber||e.id}),u.jsx("td",{className:"py-2 px-2 text-left font-mono",children:a.stockNumber||e.id.replace("D","S")}),u.jsx("td",{className:"py-2 px-2 text-center text-gray-600",children:l}),u.jsx("td",{className:"py-2 px-2 text-left font-mono text-xs",children:e.vin?`...${e.vin.slice(-8)}`:a.vinLast8||"N/A"}),u.jsx("td",{className:"py-2 px-2 text-center",children:u.jsx("span",{className:"px-1.5 py-0.5 rounded text-xs font-medium "+("N"===n?"bg-green-100 text-green-800":"C"===n?"bg-blue-100 text-blue-800":"bg-amber-100 text-amber-800"),children:n})}),u.jsx("td",{className:"py-2 px-2 text-left",children:a.lender||"N/A"}),u.jsxs("td",{className:"py-2 px-2 text-right bg-blue-50 font-medium",children:["$",(a.frontEndGross||Math.round(.7*e.amount)).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-teal-50",children:["$",d.toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-purple-50",children:["$",m.toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-green-50",children:["$",h.toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-amber-50",children:["$",x.toLocaleString()]}),u.jsx("td",{className:"py-2 px-2 text-center bg-pink-50 font-medium",children:p}),u.jsxs("td",{className:"py-2 px-2 text-right bg-purple-50",children:["$",g.toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right font-medium text-green-600",children:["$",e.profit.toLocaleString()]}),u.jsx("td",{className:"py-2 px-2 text-center",children:u.jsxs("select",{value:f,onChange:s=>((e,s)=>{try{const a=localStorage.getItem("financeDeals"),t=(a?JSON.parse(a):[]).map(a=>a.id===e?c(o({},a),{status:s}):a);localStorage.setItem("financeDeals",JSON.stringify(t)),i(t),console.log(`[FinanceHomePage] Updated deal ${e} status to ${s}`)}catch(a){console.error("[FinanceHomePage] Error updating deal status:",a)}})(e.id,s.target.value),className:`text-xs px-2 py-1 rounded border-0 focus:ring-1 focus:ring-blue-500 ${j}`,children:[u.jsx("option",{value:"Pending",children:"Pending"}),u.jsx("option",{value:"Funded",children:"Funded"}),u.jsx("option",{value:"Unwound",children:"Unwound"}),u.jsx("option",{value:"Dead Deal",children:"Dead Deal"})]})}),u.jsx("td",{className:"py-2 px-2 text-center",children:u.jsx("input",{type:"checkbox",onChange:s=>((e,s)=>{if(s&&confirm("Are you sure you want to delete this deal? This action cannot be undone."))try{const s=localStorage.getItem("financeDeals"),a=(s?JSON.parse(s):[]).filter(s=>s.id!==e);localStorage.setItem("financeDeals",JSON.stringify(a)),i(a),console.log(`[FinanceHomePage] Deleted deal ${e}`)}catch(a){console.error("[FinanceHomePage] Error deleting deal:",a)}})(e.id,s.target.checked),className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"})})]},e.id)})}),u.jsx("tfoot",{children:u.jsxs("tr",{className:"bg-gray-100 border-t border-t-gray-200 font-medium",children:[u.jsx("td",{colSpan:9,className:"py-2 pl-4 text-left",children:"TOTALS"}),u.jsxs("td",{className:"py-2 px-2 text-right bg-teal-50",children:["$",b.slice(0,10).reduce((e,s)=>{const a=s;return e+("number"==typeof a.vscProfit?a.vscProfit:parseFloat(a.vscProfit)||(s.products.includes("Extended Warranty")||s.products.includes("Vehicle Service Contract (VSC)")?Math.round(.35*s.profit):0))},0).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-purple-50",children:["$",b.slice(0,10).reduce((e,s)=>{const a=s;return e+("number"==typeof a.ppmProfit?a.ppmProfit:parseFloat(a.ppmProfit)||(s.products.includes("Paint Protection")||s.products.includes("Paint and Fabric Protection")||s.products.includes("PPM")||s.products.includes("PrePaid Maintenance (PPM)")?Math.round(.2*s.profit):0))},0).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-green-50",children:["$",b.slice(0,10).reduce((e,s)=>{const a=s;return e+("number"==typeof a.gapProfit?a.gapProfit:parseFloat(a.gapProfit)||(s.products.includes("GAP Insurance")?Math.round(.25*s.profit):0))},0).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-amber-50",children:["$",b.slice(0,10).reduce((e,s)=>{const a=s;return e+("number"==typeof a.tireAndWheelProfit?a.tireAndWheelProfit:parseFloat(a.tireAndWheelProfit)||(s.products.includes("Tire & Wheel")||s.products.includes("Tire & Wheel Bundle")?Math.round(.2*s.profit):0))},0).toLocaleString()]}),u.jsx("td",{className:"py-2 px-2 text-center bg-pink-50",children:(b.slice(0,10).reduce((e,s)=>e+s.products.length,0)/Math.max(1,b.slice(0,10).length)).toFixed(1)}),u.jsxs("td",{className:"py-2 px-2 text-right bg-purple-50",children:["$",Math.round(b.slice(0,10).reduce((e,s)=>e+s.profit,0)/Math.max(1,b.slice(0,10).length)).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right font-medium text-green-600",children:["$",b.slice(0,10).reduce((e,s)=>e+s.profit,0).toLocaleString()]}),u.jsx("td",{className:"py-2 px-2"}),u.jsx("td",{className:"py-2 px-2"})]})})]})}):u.jsx("div",{className:"py-8 text-center text-gray-500",children:'No deals logged yet. Use the "Log New Deal" button to add deals.'})})]}),u.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[u.jsxs(Ut,{className:"border hover:shadow-md transition-shadow",children:[u.jsx(Gt,{className:"pb-2 border-b bg-gradient-to-r from-green-400 to-teal-500",children:u.jsxs(Mt,{className:"text-lg font-medium flex items-center text-white",children:[u.jsx(rs,{className:"mr-2 h-5 w-5 text-white"}),"Pay Tracker"]})}),u.jsxs($t,{className:"pt-4",children:[u.jsx("div",{className:"flex items-center justify-center mb-3",children:u.jsxs("div",{className:"text-center",children:[u.jsxs("div",{className:"text-3xl font-bold text-green-600",children:["$",Math.round(.25*N.mtdRevenue).toLocaleString()]}),u.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Month-to-Date Earnings"})]})}),u.jsxs("div",{className:"space-y-2 mt-2",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-xs text-gray-600",children:"Base Commission (25%)"}),u.jsxs("span",{className:"text-xs font-medium",children:["$",Math.round(.25*N.mtdRevenue).toLocaleString()]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-xs text-gray-600",children:"Volume Bonus"}),u.jsxs("span",{className:"text-xs font-medium",children:["$",N.dealsProcessed>=20?"500":"0"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-xs text-gray-600",children:"PPD Bonus"}),u.jsxs("span",{className:"text-xs font-medium",children:["$",N.productsPerDeal>=2.5?"300":"0"]})]}),u.jsxs("div",{className:"pt-2 border-t",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{className:"text-xs font-semibold text-gray-700",children:"Potential Monthly Total"}),u.jsxs("span",{className:"text-xs font-bold text-green-600",children:["$",Math.round(.25*N.mtdRevenue*2.2+(N.dealsProcessed>=20?500:0)+(N.productsPerDeal>=2.5?300:0)).toLocaleString()]})]}),(N.dealsProcessed>=20||N.productsPerDeal>=2.5)&&u.jsxs("div",{className:"text-xs text-green-600 mt-1 font-medium",children:[N.dealsProcessed>=20&&"Volume bonus earned! ",N.productsPerDeal>=2.5&&"PPD bonus earned!"]})]})]}),u.jsx("div",{className:"mt-3 pt-2 border-t",children:u.jsxs("p",{className:"text-[10px] text-gray-400 italic",children:[u.jsx("strong",{children:"Disclaimer:"})," These figures are estimates only and not actual earnings. Final compensation may vary based on dealership policies and deal structures."]})})]})]}),u.jsxs(Ut,{className:"border hover:shadow-md transition-shadow",children:[u.jsx(Gt,{className:"pb-2 border-b",children:u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs(Mt,{className:"text-lg font-medium flex items-center",children:[u.jsx(Ve,{className:"mr-2 h-5 w-5 text-blue-600"}),"Goal Tracker"]}),u.jsxs(os,{variant:"outline",className:"text-xs",children:[Math.round(N.dealsProcessed/25*100),"% Complete"]})]})}),u.jsx($t,{className:"pt-4",children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsx("span",{className:"text-sm font-medium",children:"Monthly Deals"}),u.jsxs("span",{className:"text-sm text-gray-600",children:[N.dealsProcessed," / 25"]})]}),u.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:u.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,N.dealsProcessed/25*100)}%`}})})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsx("span",{className:"text-sm font-medium",children:"Products Per Deal"}),u.jsxs("span",{className:"text-sm text-gray-600",children:[N.productsPerDeal," / 2.5"]})]}),u.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:u.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,N.productsPerDeal/2.5*100)}%`}})})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsx("span",{className:"text-sm font-medium",children:"Per Vehicle Retail"}),u.jsxs("span",{className:"text-sm text-gray-600",children:["$",N.pvr," / $1,500"]})]}),u.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:u.jsx("div",{className:"bg-green-600 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(100,N.pvr/1500*100)}%`}})})]}),u.jsx("div",{className:"pt-3 border-t",children:u.jsx("div",{className:"text-center",children:N.dealsProcessed>=25&&N.productsPerDeal>=2.5&&N.pvr>=1500?u.jsx("div",{className:"text-green-600 font-medium text-sm",children:" All goals achieved!"}):u.jsxs("div",{className:"text-gray-600 text-sm",children:[25-N.dealsProcessed>0&&25-N.dealsProcessed+" more deals needed",N.productsPerDeal<2.5&&N.dealsProcessed<25&&"  ",N.productsPerDeal<2.5&&`PPD needs ${(2.5-N.productsPerDeal).toFixed(1)} improvement`]})})})]})})]})]})]})]})},xr=Xa("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function pr(e){var s=e,{className:a,variant:t}=s,r=d(s,["className","variant"]);return u.jsx("div",o({className:et(xr({variant:t}),a)},r))}const gr=()=>{const e=pe(),[s,a]=he.useState([]),[t,r]=he.useState(""),[l,n]=he.useState("All"),[i,d]=he.useState("saleDate"),[m,h]=he.useState("desc");he.useEffect(()=>{try{const e=localStorage.getItem("financeDeals");if(e){const s=JSON.parse(e);a(s)}}catch(e){console.error("Error loading deals from localStorage:",e)}},[]);const x=s.filter(e=>{const s=e.customer.toLowerCase().includes(t.toLowerCase())||e.vehicle.toLowerCase().includes(t.toLowerCase())||e.id.toLowerCase().includes(t.toLowerCase())||e.vin&&e.vin.toLowerCase().includes(t.toLowerCase()),a="All"===l||e.status===l;return s&&a}).sort((e,s)=>{const a=e[i],t=s[i];return"string"==typeof a&&"string"==typeof t?"asc"===m?a.localeCompare(t):t.localeCompare(a):"number"==typeof a&&"number"==typeof t?"asc"===m?a-t:t-a:0}),p=e=>{i===e?h("asc"===m?"desc":"asc"):(d(e),h("asc"))};return u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"flex items-center mb-6",children:[u.jsxs("button",{type:"button",onClick:()=>{e("/dashboard/finance")},className:"mr-4 flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[u.jsx(cs,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),u.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Finance Deals"})]}),u.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4 mb-6",children:[u.jsxs("div",{className:"relative flex-1",children:[u.jsx(ds,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),u.jsx(Vt,{placeholder:"Search deals by customer, vehicle, ID, or VIN",className:"pl-9 border-gray-300",value:t,onChange:e=>r(e.target.value)})]}),u.jsx("div",{className:"flex gap-2",children:u.jsxs("div",{className:"flex items-center gap-2 bg-white border border-gray-200 rounded-md px-2",children:[u.jsx(ms,{size:16,className:"text-gray-500"}),u.jsxs("select",{className:"border-0 rounded p-2 text-sm focus:ring-0 focus:outline-none",value:l,onChange:e=>n(e.target.value),children:[u.jsx("option",{value:"All",children:"All Statuses"}),u.jsx("option",{value:"Bank Approval",children:"Bank Approval"}),u.jsx("option",{value:"Pending Documents",children:"Pending Documents"}),u.jsx("option",{value:"Contract Review",children:"Contract Review"}),u.jsx("option",{value:"Insurance Verification",children:"Insurance Verification"}),u.jsx("option",{value:"Complete",children:"Complete"})]})]})})]}),u.jsx(Ut,{className:"border hover:shadow-md transition-shadow",children:u.jsx($t,{className:"p-0",children:u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"w-full text-sm",children:[u.jsx("thead",{children:u.jsxs("tr",{className:"text-xs",children:[u.jsx("th",{className:"font-medium text-white py-2 pl-3 text-center bg-gray-600 w-12",children:"#"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-left bg-gray-600",children:"Last Name"}),u.jsx("th",{className:"font-medium text-white py-2 pl-4 pr-2 text-left bg-blue-600",children:u.jsxs("button",{className:"flex items-center",onClick:()=>p("id"),children:["Deal #","id"===i&&u.jsx(hs,{size:14,className:"ml-1 text-white"})]})}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-left bg-gray-600",children:"Stock #"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-gray-600",children:u.jsxs("button",{className:"flex items-center",onClick:()=>p("saleDate"),children:["Date","saleDate"===i&&u.jsx(hs,{size:14,className:"ml-1 text-white"})]})}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-left bg-gray-600",children:"VIN"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-indigo-600",children:"N/U/CPO"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-left bg-gray-600",children:"Lender"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-blue-600",children:"Front End"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-teal-600",children:"VSC"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-purple-600",children:"PPM"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-green-600",children:"GAP"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-amber-600",children:"T&W/Bundle"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-pink-600",children:"PPD"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-purple-600",children:"PVR"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-green-600",children:u.jsxs("button",{className:"flex items-center justify-end ml-auto",onClick:()=>p("profit"),children:["Total","profit"===i&&u.jsx(hs,{size:14,className:"ml-1 text-white"})]})}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-gray-600 w-20",children:"Status"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-red-600 rounded-tr-md w-16",children:"Delete"})]})}),u.jsx("tbody",{children:x.length>0?x.map((e,s)=>{const t=e,r=e.customer.split(" ").pop()||"",l=t.dealDate||e.saleDate,n=new Date(l).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"}),i=t.vehicleType||(e.vehicle.toLowerCase().includes("new")?"N":e.vehicle.toLowerCase().includes("cpo")?"C":"U"),d="number"==typeof t.vscProfit?t.vscProfit:parseFloat(t.vscProfit)||(e.products.includes("Extended Warranty")||e.products.includes("Vehicle Service Contract (VSC)")?Math.round(.35*e.profit):0),m="number"==typeof t.ppmProfit?t.ppmProfit:parseFloat(t.ppmProfit)||(e.products.includes("Paint Protection")||e.products.includes("Paint and Fabric Protection")||e.products.includes("PPM")||e.products.includes("PrePaid Maintenance (PPM)")?Math.round(.2*e.profit):0),h="number"==typeof t.gapProfit?t.gapProfit:parseFloat(t.gapProfit)||(e.products.includes("GAP Insurance")?Math.round(.25*e.profit):0),p="number"==typeof t.tireAndWheelProfit?t.tireAndWheelProfit:parseFloat(t.tireAndWheelProfit)||(e.products.includes("Tire & Wheel")||e.products.includes("Tire & Wheel Bundle")?Math.round(.2*e.profit):0),g=e.products.length,f=Math.round(e.profit/(g||1)),j="Complete"===e.status||"Funded"===e.status?"Funded":"Canceled"===e.status||"Unwound"===e.status?"Unwound":"Dead Deal"===e.status?"Dead Deal":"Pending",v="Funded"===j?"bg-green-100 text-green-800 border-green-200":"Unwound"===j?"bg-red-100 text-red-800 border-red-200":"Dead Deal"===j?"bg-gray-100 text-gray-800 border-gray-200":"bg-amber-100 text-amber-800 border-amber-200";return u.jsxs("tr",{className:`border-b ${s%2==1?"bg-gray-50":""} hover:bg-blue-50`,children:[u.jsx("td",{className:"py-2 px-2 text-center font-medium",children:x.length-s}),u.jsx("td",{className:"py-2 px-2 text-left font-medium",children:r}),u.jsx("td",{className:"py-2 pl-4 pr-2 text-left font-medium text-blue-600",children:t.dealNumber||e.id}),u.jsx("td",{className:"py-2 px-2 text-left font-mono",children:t.stockNumber||e.id.replace("D","S")}),u.jsx("td",{className:"py-2 px-2 text-center text-gray-600",children:n}),u.jsx("td",{className:"py-2 px-2 text-left font-mono text-xs",children:e.vin?`...${e.vin.slice(-8)}`:t.vinLast8||"N/A"}),u.jsx("td",{className:"py-2 px-2 text-center",children:u.jsx("span",{className:"px-1.5 py-0.5 rounded text-xs font-medium "+("N"===i?"bg-green-100 text-green-800":"C"===i?"bg-blue-100 text-blue-800":"bg-amber-100 text-amber-800"),children:i})}),u.jsx("td",{className:"py-2 px-2 text-left",children:t.lender||"N/A"}),u.jsxs("td",{className:"py-2 px-2 text-right bg-blue-50 font-medium",children:["$",(t.frontEndGross||Math.round(.7*e.amount)).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-teal-50",children:["$",d.toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-purple-50",children:["$",m.toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-green-50",children:["$",h.toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-amber-50",children:["$",p.toLocaleString()]}),u.jsx("td",{className:"py-2 px-2 text-center bg-pink-50 font-medium",children:g}),u.jsxs("td",{className:"py-2 px-2 text-right bg-purple-50",children:["$",f.toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right font-medium text-green-600",children:["$",e.profit.toLocaleString()]}),u.jsx("td",{className:"py-2 px-2 text-center",children:u.jsxs("select",{value:j,onChange:s=>((e,s)=>{try{const t=localStorage.getItem("financeDeals"),r=(t?JSON.parse(t):[]).map(a=>a.id===e?c(o({},a),{status:s}):a);localStorage.setItem("financeDeals",JSON.stringify(r)),a(r),console.log(`[FinanceDealsPage] Updated deal ${e} status to ${s}`)}catch(t){console.error("[FinanceDealsPage] Error updating deal status:",t)}})(e.id,s.target.value),className:`text-xs px-2 py-1 rounded border-0 focus:ring-1 focus:ring-blue-500 ${v}`,children:[u.jsx("option",{value:"Pending",children:"Pending"}),u.jsx("option",{value:"Funded",children:"Funded"}),u.jsx("option",{value:"Unwound",children:"Unwound"}),u.jsx("option",{value:"Dead Deal",children:"Dead Deal"})]})}),u.jsx("td",{className:"py-2 px-2 text-center",children:u.jsx("input",{type:"checkbox",onChange:s=>((e,s)=>{if(s&&confirm("Are you sure you want to delete this deal? This action cannot be undone."))try{const s=localStorage.getItem("financeDeals"),t=(s?JSON.parse(s):[]).filter(s=>s.id!==e);localStorage.setItem("financeDeals",JSON.stringify(t)),a(t),console.log(`[FinanceDealsPage] Deleted deal ${e}`)}catch(t){console.error("[FinanceDealsPage] Error deleting deal:",t)}})(e.id,s.target.checked),className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"})})]},e.id)}):u.jsx("tr",{children:u.jsx("td",{colSpan:18,className:"py-10 text-center text-gray-500",children:"No deals match your filter criteria. Try adjusting your filters."})})})]})})})}),u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("div",{className:"text-sm text-gray-500",children:["Showing ",x.length," of ",s.length," deals"]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx(Bt,{variant:"outline",size:"sm",children:"Previous"}),u.jsx(Bt,{variant:"outline",size:"sm",children:"Next"})]})]})]})},fr=[{id:1,customer:"John Smith",vehicle:"2024 Honda Accord",time:"9:00 AM",date:"2024-05-17",status:"Confirmed",type:"Final Document Signing"},{id:2,customer:"Sarah Wilson",vehicle:"2023 Toyota Camry",time:"10:30 AM",date:"2024-05-17",status:"Confirmed",type:"Contract Review"},{id:3,customer:"Michael Brown",vehicle:"2023 Nissan Rogue",time:"1:00 PM",date:"2024-05-17",status:"Pending",type:"Insurance Verification"},{id:4,customer:"Jessica Taylor",vehicle:"2024 Subaru Outback",time:"3:30 PM",date:"2024-05-17",status:"Confirmed",type:"Final Document Signing"},{id:5,customer:"David Anderson",vehicle:"2023 Mazda CX-5",time:"11:00 AM",date:"2024-05-18",status:"Confirmed",type:"Contract Review"},{id:6,customer:"Elizabeth Martin",vehicle:"2024 Jeep Grand Cherokee",time:"2:00 PM",date:"2024-05-18",status:"Pending",type:"Final Document Signing"},{id:7,customer:"Robert Miller",vehicle:"2024 Ford F-150",time:"9:30 AM",date:"2024-05-19",status:"Confirmed",type:"Insurance Verification"},{id:8,customer:"Jennifer Lee",vehicle:"2023 Chevy Equinox",time:"1:30 PM",date:"2024-05-19",status:"Confirmed",type:"Contract Review"}],jr=()=>{const[e,s]=he.useState(new Date),[a,t]=he.useState((new Date).toISOString().split("T")[0]),r=e.getFullYear(),l=e.getMonth(),n=((e,s)=>{const a=new Date(e,s,1).getDay(),t=new Date(e,s+1,0).getDate(),r=[];for(let l=0;l<a;l++)r.push(null);for(let l=1;l<=t;l++)r.push(l);return r})(r,l),i=(e,s,a)=>null===a?"":`${e}-${String(s+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`,o=fr.filter(e=>e.date===a).sort((e,s)=>new Date(`1970/01/01 ${e.time}`).getTime()-new Date(`1970/01/01 ${s.time}`).getTime()),c=fr.reduce((e,s)=>{const a=s.date;return e[a]||(e[a]=0),e[a]++,e},{});return u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("h2",{className:"text-2xl font-bold",children:"Finance Schedule"}),u.jsxs(Bt,{children:[u.jsx(us,{className:"mr-2 h-4 w-4"}),"New Appointment"]})]}),u.jsxs("div",{className:"grid gap-6 md:grid-cols-7 lg:grid-cols-12",children:[u.jsx("div",{className:"md:col-span-3 lg:col-span-4",children:u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx(Bt,{variant:"ghost",onClick:()=>{s(new Date(r,l-1,1))},children:u.jsx(Xe,{className:"h-4 w-4"})}),u.jsxs(Mt,{children:[["January","February","March","April","May","June","July","August","September","October","November","December"][l]," ",r]}),u.jsx(Bt,{variant:"ghost",onClick:()=>{s(new Date(r,l+1,1))},children:u.jsx(es,{className:"h-4 w-4"})})]})}),u.jsxs($t,{children:[u.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>u.jsx("div",{className:"text-xs font-medium text-gray-500",children:e},e))}),u.jsx("div",{className:"grid grid-cols-7 gap-1",children:n.map((e,s)=>{const n=e?i(r,l,e):"",o=n===(new Date).toISOString().split("T")[0],d=n===a,m=n&&c[n]||0;return u.jsx("div",{onClick:()=>e&&t(i(r,l,e)),className:`\n                        h-12 flex flex-col items-center justify-center rounded-md cursor-pointer text-sm\n                        ${o?"border border-blue-500":""}\n                        ${d?"bg-blue-100":e?"hover:bg-gray-100":""}\n                        ${e?"":"text-gray-300"}\n                      `,children:e&&u.jsxs(u.Fragment,{children:[u.jsx("span",{children:e}),m>0&&u.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-blue-500 text-white rounded-full mt-1",children:m})]})},s)})})]})]})}),u.jsx("div",{className:"md:col-span-4 lg:col-span-8",children:u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsx("div",{className:"flex justify-between items-center",children:u.jsxs(Mt,{children:["Appointments for"," ",new Date(a).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})})}),u.jsx($t,{children:0===o.length?u.jsxs("div",{className:"text-center py-8 text-gray-500",children:[u.jsx(Oe,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),u.jsx("p",{children:"No appointments scheduled for this day."}),u.jsxs(Bt,{className:"mt-4",variant:"outline",size:"sm",children:[u.jsx(us,{className:"mr-2 h-4 w-4"}),"Add Appointment"]})]}):u.jsx("div",{className:"space-y-4",children:o.map(e=>u.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:u.jsxs("div",{className:"flex items-start justify-between",children:[u.jsxs("div",{children:[u.jsx("h3",{className:"font-medium",children:e.customer}),u.jsx("p",{className:"text-sm text-gray-500",children:e.vehicle}),u.jsxs("div",{className:"flex items-center mt-2 text-sm text-gray-500",children:[u.jsx(ze,{className:"h-4 w-4 mr-1"}),e.time,u.jsx("span",{className:"mx-2",children:""}),u.jsx(pr,{variant:"Confirmed"===e.status?"default":"outline",children:e.status}),u.jsx("span",{className:"mx-2",children:""}),e.type]})]}),u.jsx("div",{className:"flex",children:u.jsx(Bt,{variant:"ghost",size:"sm",children:"Edit"})})]})},e.id))})})]})})]})]})},vr=()=>{var e;const{user:s,role:a,dealershipId:t}=It(),r=xe(),l=pe(),[n,i]=he.useState("this-month");he.useEffect(()=>(console.log("[FinanceDashboard] Rendering finance dashboard",{userId:null==s?void 0:s.id,role:a,dealershipId:t,timestamp:(new Date).toISOString(),path:r.pathname}),()=>{console.log("[FinanceDashboard] Unmounting finance dashboard")}),[s,a,t,r.pathname]);const o=["Present every product to every customer every time - consistency is key.","Build value first, then discuss investment. Never start with the price.","Use customer-friendly language instead of industry jargon when explaining products.","Focus on protection and peace of mind, not just financial benefits.","Keep your menu presentation simple and visual for maximum effectiveness.","Digital menus increase compliance and provide a more professional presentation.","Always congratulate the customer on their vehicle purchase before starting your presentation.","Listen to customer concerns about products and address them specifically.","Explain how each product benefits the customer's specific vehicle and usage patterns."];return u.jsxs("div",{className:"container py-4",children:[u.jsx("div",{className:"flex justify-between items-start mb-6",children:u.jsx("div",{className:"flex-grow",children:u.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-2",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-3xl font-bold",children:"Finance Manager Dashboard"}),u.jsxs("p",{className:"text-gray-600 mt-1",children:["Finance Manager: ",(null==(e=null==s?void 0:s.email)?void 0:e.split("@")[0])||"Not Assigned"]})]}),u.jsx("div",{className:"bg-blue-50 p-2 rounded-md mt-2 md:mt-0 border border-blue-100 max-w-2xl",children:u.jsxs("p",{className:"text-xs italic text-blue-800",children:[u.jsx(Je,{className:"h-3 w-3 inline-block mr-1"}),u.jsx("strong",{children:"F&I Best Practice:"})," ",o[(new Date).getDay()%o.length]]})})]})})}),u.jsxs("div",{className:"flex justify-between items-center mb-3",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx("h2",{className:"text-2xl font-bold mr-3",children:(e=>{const s=new Date,a=s.toLocaleString("default",{month:"long"}),t=s.getFullYear();switch(e){case"this-month":default:return`${a} ${t}`;case"last-month":return`${0===s.getMonth()?"December":new Date(s.getFullYear(),s.getMonth()-1,1).toLocaleString("default",{month:"long"})} ${0===s.getMonth()?s.getFullYear()-1:s.getFullYear()}`;case"last-quarter":const e=Math.floor(s.getMonth()/3);return`Q${0===e?4:e} ${0===e?t-1:t}`;case"ytd":return`Year to Date ${t}`;case"last-year":return""+(t-1)}})(n)}),u.jsxs("select",{value:n,onChange:e=>i(e.target.value),className:"p-2 border rounded-md shadow-sm",children:[u.jsx("option",{value:"this-month",children:"This Month"}),u.jsx("option",{value:"last-month",children:"Last Month"}),u.jsx("option",{value:"last-quarter",children:"Last Quarter"}),u.jsx("option",{value:"ytd",children:"Year to Date"}),u.jsx("option",{value:"last-year",children:"Last Year"})]})]}),u.jsx(Bt,{size:"lg",className:"bg-orange-600 hover:bg-orange-700",onClick:e=>{e.preventDefault(),console.log("[FinanceDashboard] Log New Deal button clicked, navigating to /finance-deal-log"),l("/finance-deal-log")},children:u.jsxs("span",{className:"flex items-center",children:[u.jsx(xs,{className:"mr-2 h-5 w-5"}),"Log New Deal"]})})]}),u.jsxs(ve,{children:[u.jsx(be,{path:"/",element:u.jsx(ur,{})}),u.jsx(be,{path:"/deals",element:u.jsx(gr,{})}),u.jsx(be,{path:"/schedule",element:u.jsx(jr,{})}),u.jsx(be,{path:"*",element:u.jsx(ge,{to:"/dashboard/finance",replace:!0})})]})]})},br=I,Nr=U,yr=k,wr=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(C,o({ref:s,className:et("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t)},r))});wr.displayName=C.displayName;const Sr=he.forwardRef((e,s)=>{var a=e,{className:t,children:r}=a,l=d(a,["className","children"]);return u.jsxs(yr,{children:[u.jsx(wr,{}),u.jsxs(T,c(o({ref:s,className:et("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t)},l),{children:[r,u.jsxs(F,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[u.jsx(Te,{className:"h-4 w-4"}),u.jsx("span",{className:"sr-only",children:"Close"})]})]}))]})});Sr.displayName=T.displayName;const _r=e=>{var s=e,{className:a}=s,t=d(s,["className"]);return u.jsx("div",o({className:et("flex flex-col space-y-1.5 text-center sm:text-left",a)},t))};_r.displayName="DialogHeader";const Dr=e=>{var s=e,{className:a}=s,t=d(s,["className"]);return u.jsx("div",o({className:et("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a)},t))};Dr.displayName="DialogFooter";const Pr=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(A,o({ref:s,className:et("text-lg font-semibold leading-none tracking-tight",t)},r))});Pr.displayName=A.displayName;const Cr=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(E,o({ref:s,className:et("text-sm text-muted-foreground",t)},r))});function kr(e,[s,a]){return Math.min(a,Math.max(s,e))}function Tr(e){const s=he.useRef({value:e,previous:e});return he.useMemo(()=>(s.current.value!==e&&(s.current.previous=s.current.value,s.current.value=e),s.current.previous),[e])}Cr.displayName=E.displayName;var Fr=[" ","Enter","ArrowUp","ArrowDown"],Ar=[" ","Enter"],Er="Select",[Ir,Ur,Gr]=g(Er),[Mr,Rr]=p(Er,[Gr,G]),$r=G(),[Lr,Or]=Mr(Er),[Br,Vr]=Mr(Er),zr=e=>{const{__scopeSelect:s,children:a,open:t,defaultOpen:r,onOpenChange:l,value:n,defaultValue:i,onValueChange:d,dir:m,name:h,autoComplete:x,disabled:p,required:g,form:f}=e,j=$r(s),[b,N]=he.useState(null),[y,w]=he.useState(null),[S,_]=he.useState(!1),D=q(m),[P,C]=v({prop:t,defaultProp:null!=r&&r,onChange:l,caller:Er}),[k,T]=v({prop:n,defaultProp:i,onChange:d,caller:Er}),F=he.useRef(null),A=!b||f||!!b.closest("form"),[E,I]=he.useState(new Set),U=Array.from(E).map(e=>e.props.value).join(";");return u.jsx(J,c(o({},j),{children:u.jsxs(Lr,{required:g,scope:s,trigger:b,onTriggerChange:N,valueNode:y,onValueNodeChange:w,valueNodeHasChildren:S,onValueNodeHasChildrenChange:_,contentId:R(),value:k,onValueChange:T,open:P,onOpenChange:C,dir:D,triggerPointerDownPosRef:F,disabled:p,children:[u.jsx(Ir.Provider,{scope:s,children:u.jsx(Br,{scope:e.__scopeSelect,onNativeOptionAdd:he.useCallback(e=>{I(s=>new Set(s).add(e))},[]),onNativeOptionRemove:he.useCallback(e=>{I(s=>{const a=new Set(s);return a.delete(e),a})},[]),children:a})}),A?u.jsxs(Tl,{"aria-hidden":!0,required:g,tabIndex:-1,name:h,autoComplete:x,value:k,onChange:e=>T(e.target.value),disabled:p,form:f,children:[void 0===k?u.jsx("option",{value:""}):null,Array.from(E)]},U):null]})}))};zr.displayName=Er;var Wr="SelectTrigger",qr=he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t,disabled:r=!1}=a,l=d(a,["__scopeSelect","disabled"]),n=$r(t),i=Or(Wr,t),m=i.disabled||r,h=f(s,i.onTriggerChange),p=Ur(t),g=he.useRef("touch"),[j,v,b]=Al(e=>{const s=p().filter(e=>!e.disabled),a=s.find(e=>e.value===i.value),t=El(s,e,a);void 0!==t&&i.onValueChange(t.value)}),y=e=>{m||(i.onOpenChange(!0),b()),e&&(i.triggerPointerDownPosRef.current={x:Math.round(e.pageX),y:Math.round(e.pageY)})};return u.jsx(M,c(o({asChild:!0},n),{children:u.jsx(x.button,c(o({type:"button",role:"combobox","aria-controls":i.contentId,"aria-expanded":i.open,"aria-required":i.required,"aria-autocomplete":"none",dir:i.dir,"data-state":i.open?"open":"closed",disabled:m,"data-disabled":m?"":void 0,"data-placeholder":Fl(i.value)?"":void 0},l),{ref:h,onClick:N(l.onClick,e=>{e.currentTarget.focus(),"mouse"!==g.current&&y(e)}),onPointerDown:N(l.onPointerDown,e=>{g.current=e.pointerType;const s=e.target;s.hasPointerCapture(e.pointerId)&&s.releasePointerCapture(e.pointerId),0===e.button&&!1===e.ctrlKey&&"mouse"===e.pointerType&&(y(e),e.preventDefault())}),onKeyDown:N(l.onKeyDown,e=>{const s=""!==j.current;e.ctrlKey||e.altKey||e.metaKey||1!==e.key.length||v(e.key),s&&" "===e.key||Fr.includes(e.key)&&(y(),e.preventDefault())})}))}))});qr.displayName=Wr;var Jr="SelectValue",Yr=he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t,className:r,style:l,children:n,placeholder:i=""}=a,m=d(a,["__scopeSelect","className","style","children","placeholder"]),h=Or(Jr,t),{onValueNodeHasChildrenChange:p}=h,g=void 0!==n,j=f(s,h.onValueNodeChange);return _(()=>{p(g)},[p,g]),u.jsx(x.span,c(o({},m),{ref:j,style:{pointerEvents:"none"},children:Fl(h.value)?u.jsx(u.Fragment,{children:i}):n}))});Yr.displayName=Jr;var Hr=he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t,children:r}=a,l=d(a,["__scopeSelect","children"]);return u.jsx(x.span,c(o({"aria-hidden":!0},l),{ref:s,children:r||""}))});Hr.displayName="SelectIcon";var Kr=e=>u.jsx(S,o({asChild:!0},e));Kr.displayName="SelectPortal";var Zr="SelectContent",Qr=he.forwardRef((e,s)=>{const a=Or(Zr,e.__scopeSelect),[t,r]=he.useState();if(_(()=>{r(new DocumentFragment)},[]),!a.open){const s=t;return s?ue.createPortal(u.jsx(el,{scope:e.__scopeSelect,children:u.jsx(Ir.Slot,{scope:e.__scopeSelect,children:u.jsx("div",{children:e.children})})}),s):null}return u.jsx(tl,c(o({},e),{ref:s}))});Qr.displayName=Zr;var Xr=10,[el,sl]=Mr(Zr),al=B("SelectContent.RemoveScroll"),tl=he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t,position:r="item-aligned",onCloseAutoFocus:l,onEscapeKeyDown:n,onPointerDownOutside:i,side:m,sideOffset:h,align:x,alignOffset:p,arrowPadding:g,collisionBoundary:j,collisionPadding:v,sticky:b,hideWhenDetached:y,avoidCollisions:w}=a,S=d(a,["__scopeSelect","position","onCloseAutoFocus","onEscapeKeyDown","onPointerDownOutside","side","sideOffset","align","alignOffset","arrowPadding","collisionBoundary","collisionPadding","sticky","hideWhenDetached","avoidCollisions"]),_=Or(Zr,t),[D,P]=he.useState(null),[C,k]=he.useState(null),T=f(s,e=>P(e)),[F,A]=he.useState(null),[E,I]=he.useState(null),U=Ur(t),[G,M]=he.useState(!1),R=he.useRef(!1);he.useEffect(()=>{if(D)return $(D)},[D]),L();const B=he.useCallback(e=>{const[s,...a]=U().map(e=>e.ref.current),[t]=a.slice(-1),r=document.activeElement;for(const l of e){if(l===r)return;if(null==l||l.scrollIntoView({block:"nearest"}),l===s&&C&&(C.scrollTop=0),l===t&&C&&(C.scrollTop=C.scrollHeight),null==l||l.focus(),document.activeElement!==r)return}},[U,C]),W=he.useCallback(()=>B([F,D]),[B,F,D]);he.useEffect(()=>{G&&W()},[G,W]);const{onOpenChange:q,triggerPointerDownPosRef:J}=_;he.useEffect(()=>{if(D){let e={x:0,y:0};const s=s=>{var a,t,r,l;e={x:Math.abs(Math.round(s.pageX)-(null!=(t=null==(a=J.current)?void 0:a.x)?t:0)),y:Math.abs(Math.round(s.pageY)-(null!=(l=null==(r=J.current)?void 0:r.y)?l:0))}},a=a=>{e.x<=10&&e.y<=10?a.preventDefault():D.contains(a.target)||q(!1),document.removeEventListener("pointermove",s),J.current=null};return null!==J.current&&(document.addEventListener("pointermove",s),document.addEventListener("pointerup",a,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",a,{capture:!0})}}},[D,q,J]),he.useEffect(()=>{const e=()=>q(!1);return window.addEventListener("blur",e),window.addEventListener("resize",e),()=>{window.removeEventListener("blur",e),window.removeEventListener("resize",e)}},[q]);const[Y,H]=Al(e=>{const s=U().filter(e=>!e.disabled),a=s.find(e=>e.ref.current===document.activeElement),t=El(s,e,a);t&&setTimeout(()=>t.ref.current.focus())}),K=he.useCallback((e,s,a)=>{const t=!R.current&&!a;(void 0!==_.value&&_.value===s||t)&&(A(e),t&&(R.current=!0))},[_.value]),Z=he.useCallback(()=>null==D?void 0:D.focus(),[D]),Q=he.useCallback((e,s,a)=>{const t=!R.current&&!a;(void 0!==_.value&&_.value===s||t)&&I(e)},[_.value]),X="popper"===r?ll:rl,ee=X===ll?{side:m,sideOffset:h,align:x,alignOffset:p,arrowPadding:g,collisionBoundary:j,collisionPadding:v,sticky:b,hideWhenDetached:y,avoidCollisions:w}:{};return u.jsx(el,{scope:t,content:D,viewport:C,onViewportChange:k,itemRefCallback:K,selectedItem:F,onItemLeave:Z,itemTextRefCallback:Q,focusSelectedItem:W,selectedItemText:E,position:r,isPositioned:G,searchRef:Y,children:u.jsx(O,{as:al,allowPinchZoom:!0,children:u.jsx(V,{asChild:!0,trapped:_.open,onMountAutoFocus:e=>{e.preventDefault()},onUnmountAutoFocus:N(l,e=>{var s;null==(s=_.trigger)||s.focus({preventScroll:!0}),e.preventDefault()}),children:u.jsx(z,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:n,onPointerDownOutside:i,onFocusOutside:e=>e.preventDefault(),onDismiss:()=>_.onOpenChange(!1),children:u.jsx(X,c(o(o({role:"listbox",id:_.contentId,"data-state":_.open?"open":"closed",dir:_.dir,onContextMenu:e=>e.preventDefault()},S),ee),{onPlaced:()=>M(!0),ref:T,style:o({display:"flex",flexDirection:"column",outline:"none"},S.style),onKeyDown:N(S.onKeyDown,e=>{const s=e.ctrlKey||e.altKey||e.metaKey;if("Tab"===e.key&&e.preventDefault(),s||1!==e.key.length||H(e.key),["ArrowUp","ArrowDown","Home","End"].includes(e.key)){let s=U().filter(e=>!e.disabled).map(e=>e.ref.current);if(["ArrowUp","End"].includes(e.key)&&(s=s.slice().reverse()),["ArrowUp","ArrowDown"].includes(e.key)){const a=e.target,t=s.indexOf(a);s=s.slice(t+1)}setTimeout(()=>B(s)),e.preventDefault()}})}))})})})})});tl.displayName="SelectContentImpl";var rl=he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t,onPlaced:r}=a,l=d(a,["__scopeSelect","onPlaced"]),n=Or(Zr,t),i=sl(Zr,t),[m,h]=he.useState(null),[p,g]=he.useState(null),j=f(s,e=>g(e)),v=Ur(t),b=he.useRef(!1),N=he.useRef(!0),{viewport:y,selectedItem:w,selectedItemText:S,focusSelectedItem:D}=i,P=he.useCallback(()=>{if(n.trigger&&n.valueNode&&m&&p&&y&&w&&S){const e=n.trigger.getBoundingClientRect(),s=p.getBoundingClientRect(),a=n.valueNode.getBoundingClientRect(),t=S.getBoundingClientRect();if("rtl"!==n.dir){const r=t.left-s.left,l=a.left-r,n=e.left-l,i=e.width+n,o=Math.max(i,s.width),c=window.innerWidth-Xr,d=kr(l,[Xr,Math.max(Xr,c-o)]);m.style.minWidth=i+"px",m.style.left=d+"px"}else{const r=s.right-t.right,l=window.innerWidth-a.right-r,n=window.innerWidth-e.right-l,i=e.width+n,o=Math.max(i,s.width),c=window.innerWidth-Xr,d=kr(l,[Xr,Math.max(Xr,c-o)]);m.style.minWidth=i+"px",m.style.right=d+"px"}const l=v(),i=window.innerHeight-2*Xr,o=y.scrollHeight,c=window.getComputedStyle(p),d=parseInt(c.borderTopWidth,10),h=parseInt(c.paddingTop,10),u=parseInt(c.borderBottomWidth,10),x=d+h+o+parseInt(c.paddingBottom,10)+u,g=Math.min(5*w.offsetHeight,x),f=window.getComputedStyle(y),j=parseInt(f.paddingTop,10),N=parseInt(f.paddingBottom,10),_=e.top+e.height/2-Xr,D=i-_,P=w.offsetHeight/2,C=d+h+(w.offsetTop+P),k=x-C;if(C<=_){const e=l.length>0&&w===l[l.length-1].ref.current;m.style.bottom="0px";const s=p.clientHeight-y.offsetTop-y.offsetHeight,a=C+Math.max(D,P+(e?N:0)+s+u);m.style.height=a+"px"}else{const e=l.length>0&&w===l[0].ref.current;m.style.top="0px";const s=Math.max(_,d+y.offsetTop+(e?j:0)+P)+k;m.style.height=s+"px",y.scrollTop=C-_+y.offsetTop}m.style.margin=`${Xr}px 0`,m.style.minHeight=g+"px",m.style.maxHeight=i+"px",null==r||r(),requestAnimationFrame(()=>b.current=!0)}},[v,n.trigger,n.valueNode,m,p,y,w,S,n.dir,r]);_(()=>P(),[P]);const[C,k]=he.useState();_(()=>{p&&k(window.getComputedStyle(p).zIndex)},[p]);const T=he.useCallback(e=>{e&&!0===N.current&&(P(),null==D||D(),N.current=!1)},[P,D]);return u.jsx(nl,{scope:t,contentWrapper:m,shouldExpandOnScrollRef:b,onScrollButtonChange:T,children:u.jsx("div",{ref:h,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:C},children:u.jsx(x.div,c(o({},l),{ref:j,style:o({boxSizing:"border-box",maxHeight:"100%"},l.style)}))})})});rl.displayName="SelectItemAlignedPosition";var ll=he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t,align:r="start",collisionPadding:l=Xr}=a,n=d(a,["__scopeSelect","align","collisionPadding"]),i=$r(t);return u.jsx(W,c(o(o({},i),n),{ref:s,align:r,collisionPadding:l,style:o(o({boxSizing:"border-box"},n.style),{"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"})}))});ll.displayName="SelectPopperPosition";var[nl,il]=Mr(Zr,{}),ol="SelectViewport",cl=he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t,nonce:r}=a,l=d(a,["__scopeSelect","nonce"]),n=sl(ol,t),i=il(ol,t),m=f(s,n.onViewportChange),h=he.useRef(0);return u.jsxs(u.Fragment,{children:[u.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),u.jsx(Ir.Slot,{scope:t,children:u.jsx(x.div,c(o({"data-radix-select-viewport":"",role:"presentation"},l),{ref:m,style:o({position:"relative",flex:1,overflow:"hidden auto"},l.style),onScroll:N(l.onScroll,e=>{const s=e.currentTarget,{contentWrapper:a,shouldExpandOnScrollRef:t}=i;if((null==t?void 0:t.current)&&a){const e=Math.abs(h.current-s.scrollTop);if(e>0){const t=window.innerHeight-2*Xr,r=parseFloat(a.style.minHeight),l=parseFloat(a.style.height),n=Math.max(r,l);if(n<t){const r=n+e,l=Math.min(t,r),i=r-l;a.style.height=l+"px","0px"===a.style.bottom&&(s.scrollTop=i>0?i:0,a.style.justifyContent="flex-end")}}}h.current=s.scrollTop})}))})]})});cl.displayName=ol;var dl="SelectGroup",[ml,hl]=Mr(dl);he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t}=a,r=d(a,["__scopeSelect"]),l=R();return u.jsx(ml,{scope:t,id:l,children:u.jsx(x.div,c(o({role:"group","aria-labelledby":l},r),{ref:s}))})}).displayName=dl;var ul="SelectLabel",xl=he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t}=a,r=d(a,["__scopeSelect"]),l=hl(ul,t);return u.jsx(x.div,c(o({id:l.id},r),{ref:s}))});xl.displayName=ul;var pl="SelectItem",[gl,fl]=Mr(pl),jl=he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t,value:r,disabled:l=!1,textValue:n}=a,i=d(a,["__scopeSelect","value","disabled","textValue"]),m=Or(pl,t),h=sl(pl,t),p=m.value===r,[g,j]=he.useState(null!=n?n:""),[v,b]=he.useState(!1),y=f(s,e=>{var s;return null==(s=h.itemRefCallback)?void 0:s.call(h,e,r,l)}),w=R(),S=he.useRef("touch"),_=()=>{l||(m.onValueChange(r),m.onOpenChange(!1))};if(""===r)throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return u.jsx(gl,{scope:t,value:r,disabled:l,textId:w,isSelected:p,onItemTextChange:he.useCallback(e=>{j(s=>{var a;return s||(null!=(a=null==e?void 0:e.textContent)?a:"").trim()})},[]),children:u.jsx(Ir.ItemSlot,{scope:t,value:r,disabled:l,textValue:g,children:u.jsx(x.div,c(o({role:"option","aria-labelledby":w,"data-highlighted":v?"":void 0,"aria-selected":p&&v,"data-state":p?"checked":"unchecked","aria-disabled":l||void 0,"data-disabled":l?"":void 0,tabIndex:l?void 0:-1},i),{ref:y,onFocus:N(i.onFocus,()=>b(!0)),onBlur:N(i.onBlur,()=>b(!1)),onClick:N(i.onClick,()=>{"mouse"!==S.current&&_()}),onPointerUp:N(i.onPointerUp,()=>{"mouse"===S.current&&_()}),onPointerDown:N(i.onPointerDown,e=>{S.current=e.pointerType}),onPointerMove:N(i.onPointerMove,e=>{var s;S.current=e.pointerType,l?null==(s=h.onItemLeave)||s.call(h):"mouse"===S.current&&e.currentTarget.focus({preventScroll:!0})}),onPointerLeave:N(i.onPointerLeave,e=>{var s;e.currentTarget===document.activeElement&&(null==(s=h.onItemLeave)||s.call(h))}),onKeyDown:N(i.onKeyDown,e=>{var s;""!==(null==(s=h.searchRef)?void 0:s.current)&&" "===e.key||(Ar.includes(e.key)&&_()," "===e.key&&e.preventDefault())})}))})})});jl.displayName=pl;var vl="SelectItemText",bl=he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t,className:r,style:l}=a,n=d(a,["__scopeSelect","className","style"]),i=Or(vl,t),m=sl(vl,t),h=fl(vl,t),p=Vr(vl,t),[g,j]=he.useState(null),v=f(s,e=>j(e),h.onItemTextChange,e=>{var s;return null==(s=m.itemTextRefCallback)?void 0:s.call(m,e,h.value,h.disabled)}),b=null==g?void 0:g.textContent,N=he.useMemo(()=>u.jsx("option",{value:h.value,disabled:h.disabled,children:b},h.value),[h.disabled,h.value,b]),{onNativeOptionAdd:y,onNativeOptionRemove:w}=p;return _(()=>(y(N),()=>w(N)),[y,w,N]),u.jsxs(u.Fragment,{children:[u.jsx(x.span,c(o({id:h.textId},n),{ref:v})),h.isSelected&&i.valueNode&&!i.valueNodeHasChildren?ue.createPortal(n.children,i.valueNode):null]})});bl.displayName=vl;var Nl="SelectItemIndicator",yl=he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t}=a,r=d(a,["__scopeSelect"]);return fl(Nl,t).isSelected?u.jsx(x.span,c(o({"aria-hidden":!0},r),{ref:s})):null});yl.displayName=Nl;var wl="SelectScrollUpButton",Sl=he.forwardRef((e,s)=>{const a=sl(wl,e.__scopeSelect),t=il(wl,e.__scopeSelect),[r,l]=he.useState(!1),n=f(s,t.onScrollButtonChange);return _(()=>{if(a.viewport&&a.isPositioned){let e=function(){const e=s.scrollTop>0;l(e)};const s=a.viewport;return e(),s.addEventListener("scroll",e),()=>s.removeEventListener("scroll",e)}},[a.viewport,a.isPositioned]),r?u.jsx(Pl,c(o({},e),{ref:n,onAutoScroll:()=>{const{viewport:e,selectedItem:s}=a;e&&s&&(e.scrollTop=e.scrollTop-s.offsetHeight)}})):null});Sl.displayName=wl;var _l="SelectScrollDownButton",Dl=he.forwardRef((e,s)=>{const a=sl(_l,e.__scopeSelect),t=il(_l,e.__scopeSelect),[r,l]=he.useState(!1),n=f(s,t.onScrollButtonChange);return _(()=>{if(a.viewport&&a.isPositioned){let e=function(){const e=s.scrollHeight-s.clientHeight,a=Math.ceil(s.scrollTop)<e;l(a)};const s=a.viewport;return e(),s.addEventListener("scroll",e),()=>s.removeEventListener("scroll",e)}},[a.viewport,a.isPositioned]),r?u.jsx(Pl,c(o({},e),{ref:n,onAutoScroll:()=>{const{viewport:e,selectedItem:s}=a;e&&s&&(e.scrollTop=e.scrollTop+s.offsetHeight)}})):null});Dl.displayName=_l;var Pl=he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t,onAutoScroll:r}=a,l=d(a,["__scopeSelect","onAutoScroll"]),n=sl("SelectScrollButton",t),i=he.useRef(null),m=Ur(t),h=he.useCallback(()=>{null!==i.current&&(window.clearInterval(i.current),i.current=null)},[]);return he.useEffect(()=>()=>h(),[h]),_(()=>{var e;const s=m().find(e=>e.ref.current===document.activeElement);null==(e=null==s?void 0:s.ref.current)||e.scrollIntoView({block:"nearest"})},[m]),u.jsx(x.div,c(o({"aria-hidden":!0},l),{ref:s,style:o({flexShrink:0},l.style),onPointerDown:N(l.onPointerDown,()=>{null===i.current&&(i.current=window.setInterval(r,50))}),onPointerMove:N(l.onPointerMove,()=>{var e;null==(e=n.onItemLeave)||e.call(n),null===i.current&&(i.current=window.setInterval(r,50))}),onPointerLeave:N(l.onPointerLeave,()=>{h()})}))}),Cl=he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t}=a,r=d(a,["__scopeSelect"]);return u.jsx(x.div,c(o({"aria-hidden":!0},r),{ref:s}))});Cl.displayName="SelectSeparator";var kl="SelectArrow";he.forwardRef((e,s)=>{const a=e,{__scopeSelect:t}=a,r=d(a,["__scopeSelect"]),l=$r(t),n=Or(kl,t),i=sl(kl,t);return n.open&&"popper"===i.position?u.jsx(Y,c(o(o({},l),r),{ref:s})):null}).displayName=kl;var Tl=he.forwardRef((e,s)=>{var a=e,{__scopeSelect:t,value:r}=a,l=d(a,["__scopeSelect","value"]);const n=he.useRef(null),i=f(s,n),m=Tr(r);return he.useEffect(()=>{const e=n.current;if(!e)return;const s=window.HTMLSelectElement.prototype,a=Object.getOwnPropertyDescriptor(s,"value").set;if(m!==r&&a){const s=new Event("change",{bubbles:!0});a.call(e,r),e.dispatchEvent(s)}},[m,r]),u.jsx(x.select,c(o({},l),{style:o(o({},ca),l.style),ref:i,defaultValue:r}))});function Fl(e){return""===e||void 0===e}function Al(e){const s=y(e),a=he.useRef(""),t=he.useRef(0),r=he.useCallback(e=>{const r=a.current+e;s(r),function e(s){a.current=s,window.clearTimeout(t.current),""!==s&&(t.current=window.setTimeout(()=>e(""),1e3))}(r)},[s]),l=he.useCallback(()=>{a.current="",window.clearTimeout(t.current)},[]);return he.useEffect(()=>()=>window.clearTimeout(t.current),[]),[a,r,l]}function El(e,s,a){const t=s.length>1&&Array.from(s).every(e=>e===s[0])?s[0]:s,r=a?e.indexOf(a):-1;let l=(n=e,i=Math.max(r,0),n.map((e,s)=>n[(i+s)%n.length]));var n,i;1===t.length&&(l=l.filter(e=>e!==a));const o=l.find(e=>e.textValue.toLowerCase().startsWith(t.toLowerCase()));return o!==a?o:void 0}Tl.displayName="SelectBubbleInput";var Il=qr,Ul=Hr,Gl=Kr,Ml=Qr,Rl=cl,$l=xl,Ll=jl,Ol=bl,Bl=yl,Vl=Sl,zl=Dl,Wl=Cl;const ql=zr,Jl=Yr,Yl=he.forwardRef((e,s)=>{var a=e,{className:t,children:r}=a,l=d(a,["className","children"]);return u.jsxs(Il,c(o({ref:s,className:et("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t)},l),{children:[r,u.jsx(Ul,{asChild:!0,children:u.jsx(Ze,{className:"h-4 w-4 opacity-50"})})]}))});Yl.displayName=Il.displayName;const Hl=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(Vl,c(o({ref:s,className:et("flex cursor-default items-center justify-center py-1",t)},r),{children:u.jsx(He,{className:"h-4 w-4"})}))});Hl.displayName=Vl.displayName;const Kl=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(zl,c(o({ref:s,className:et("flex cursor-default items-center justify-center py-1",t)},r),{children:u.jsx(Ze,{className:"h-4 w-4"})}))});Kl.displayName=zl.displayName;const Zl=he.forwardRef((e,s)=>{var a=e,{className:t,children:r,position:l="popper"}=a,n=d(a,["className","children","position"]);return u.jsx(Gl,{children:u.jsxs(Ml,c(o({ref:s,className:et("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:l},n),{children:[u.jsx(Hl,{}),u.jsx(Rl,{className:et("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),u.jsx(Kl,{})]}))})});Zl.displayName=Ml.displayName,he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx($l,o({ref:s,className:et("py-1.5 pl-8 pr-2 text-sm font-semibold",t)},r))}).displayName=$l.displayName;const Ql=he.forwardRef((e,s)=>{var a=e,{className:t,children:r}=a,l=d(a,["className","children"]);return u.jsxs(Ll,c(o({ref:s,className:et("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t)},l),{children:[u.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:u.jsx(Bl,{children:u.jsx(ps,{className:"h-4 w-4"})})}),u.jsx(Ol,{children:r})]}))});Ql.displayName=Ll.displayName,he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(Wl,o({ref:s,className:et("-mx-1 my-1 h-px bg-muted",t)},r))}).displayName=Wl.displayName;const Xl=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("div",{className:"relative w-full overflow-auto",children:u.jsx("table",o({ref:s,className:et("w-full caption-bottom text-sm",t)},r))})});Xl.displayName="Table";const en=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("thead",o({ref:s,className:et("[&_tr]:border-b",t)},r))});en.displayName="TableHeader";const sn=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("tbody",o({ref:s,className:et("[&_tr:last-child]:border-0",t)},r))});sn.displayName="TableBody",he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("tfoot",o({ref:s,className:et("border-t bg-muted/50 font-medium",t)},r))}).displayName="TableFooter";const an=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("tr",o({ref:s,className:et("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t)},r))});an.displayName="TableRow";const tn=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("th",o({ref:s,className:et("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t)},r))});tn.displayName="TableHead";const rn=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("td",o({ref:s,className:et("p-4 align-middle [&:has([role=checkbox])]:pr-0",t)},r))});rn.displayName="TableCell",he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("caption",o({ref:s,className:et("mt-4 text-sm text-muted-foreground",t)},r))}).displayName="TableCaption";const ln={totalGross:125600,frontEndGross:82400,financeGross:43200,totalUnits:86,newCars:52,usedCars:34,salesGoal:100,salesPerformance:86,avgPerDeal:1460,avgFrontGross:958,avgFinanceGross:502,lastMonthComparison:{totalGross:8.5,frontEndGross:6.2,financeGross:12.4,totalUnits:9.3,avgPerDeal:4.8}},nn=[{day:"Monday",date:"12",shifts:[{team:"Team A",hours:"9am-6pm",members:"SJ, MC, DR"},{team:"Team B",hours:"Off",members:""}]},{day:"Tuesday",date:"13",shifts:[{team:"Team A",hours:"9am-6pm",members:"SJ, MC, DR"},{team:"Team B",hours:"Off",members:""}]},{day:"Wednesday",date:"14",shifts:[{team:"Team A",hours:"10am-7pm",members:"SJ, MC, DR"},{team:"Team B",hours:"Off",members:""}]},{day:"Thursday",date:"15",shifts:[{team:"Team A",hours:"Off",members:""},{team:"Team B",hours:"9am-6pm",members:"AW, RJ, KS"}]},{day:"Friday",date:"16",shifts:[{team:"Team A",hours:"Off",members:""},{team:"Team B",hours:"11am-8pm",members:"AW, RJ, KS"}]},{day:"Saturday",date:"17",shifts:[{team:"Team A",hours:"9am-5pm",members:"SJ, MC, DR"},{team:"Team B",hours:"9am-5pm",members:"AW, RJ, KS"}]},{day:"Sunday",date:"18",shifts:[{team:"Team A",hours:"Off",members:""},{team:"Team B",hours:"10am-4pm",members:"AW, RJ"}]}],on=()=>{var e,s,a,t,r,l,n,i,d,m,h,x,p,g,f,j,v,b;const{user:N,role:y,dealershipId:w}=It(),[S,_]=he.useState(ln),[D,P]=he.useState(null),[C,k]=he.useState(!1),[T,F]=he.useState(!1),[A,E]=he.useState("this-month"),I=pe(),{dealData:U,loading:G,error:M}=nr(w,A);he.useEffect(()=>(console.log("[SalesManagerDashboard] Rendering sales manager dashboard",{userId:null==N?void 0:N.id,role:y,dealershipId:w,timestamp:(new Date).toISOString()}),()=>{console.log("[SalesManagerDashboard] Unmounting sales manager dashboard")}),[N,y,w]);const R=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),$=(()=>{const e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s=new Date,a=s.getDay();return Array.from({length:7},(t,r)=>{const l=(a+r)%7,n=new Date(s);n.setDate(s.getDate()+r);const i=n.getDate(),o=nn.findIndex(s=>s.day===e[l]),c=o>=0?nn[o].shifts:[{team:"Team A",hours:"Off",members:""},{team:"Team B",hours:"Off",members:""}];return{day:e[l],date:i.toString(),shifts:c,isToday:0===r}})})(),L=e=>{if(D){const s=parseFloat(e.target.value)||0;P(c(o({},D),{frontGross:s}))}},O=e=>{D&&P(c(o({},D),{status:e}))},B=e=>{e.preventDefault(),D&&(F(!0),setTimeout(()=>{F(!1),k(!1),P(null),console.log("Deal updated:",D)},1e3))};return u.jsxs("div",{className:"container py-6",children:[u.jsx("div",{className:"flex justify-between items-center mb-6",children:u.jsxs("div",{className:"flex-grow",children:[u.jsx("h1",{className:"text-3xl font-bold",children:"Sales Manager Dashboard"}),u.jsx("div",{className:"bg-blue-50 p-2 rounded-md mt-2 border border-blue-100",children:u.jsxs("p",{className:"text-xs italic text-blue-800",children:[u.jsx(Je,{className:"h-3 w-3 inline-block mr-1"}),u.jsx("strong",{children:"Management Tip:"})," ",["Great managers don't just set goals; they remove obstacles for their team members.","Feedback is a gift. Deliver it with respect, receive it with gratitude.","Celebrate small wins to build momentum toward big victories.","Know your numbers, but remember that your people drive those numbers.","The best way to predict the future is to create it through coaching and development.","The quality of your leadership determines the quality of your team.","Your team doesn't care how much you know until they know how much you care."][(new Date).getDay()]]})})]})}),u.jsx("div",{className:"mb-6",children:u.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[u.jsxs("div",{className:"flex flex-row items-center gap-4",children:[u.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:(e=>{const s=new Date,a=s.toLocaleString("default",{month:"long"}),t=s.getFullYear();switch(e){case"this-month":default:return`${a} ${t}`;case"last-month":return`${0===s.getMonth()?"December":new Date(s.getFullYear(),s.getMonth()-1,1).toLocaleString("default",{month:"long"})} ${0===s.getMonth()?s.getFullYear()-1:s.getFullYear()}`;case"last-quarter":const e=Math.floor(s.getMonth()/3);return`Q${0===e?4:e} ${0===e?t-1:t}`;case"ytd":return`Year to Date ${t}`;case"last-year":return""+(t-1)}})(A)}),u.jsxs("div",{className:"flex items-center",children:[u.jsx(Oe,{className:"h-5 w-5 text-gray-500 mr-1"}),u.jsxs("select",{value:A,onChange:e=>{E(e.target.value)},className:"p-2 border rounded-md shadow-sm",children:[u.jsx("option",{value:"this-month",children:"This Month"}),u.jsx("option",{value:"last-month",children:"Last Month"}),u.jsx("option",{value:"last-quarter",children:"Last Quarter"}),u.jsx("option",{value:"ytd",children:"Year to Date"}),u.jsx("option",{value:"last-year",children:"Last Year"})]})]}),u.jsx("p",{className:"text-gray-500",children:"Sales Performance Dashboard"})]}),u.jsx("div",{className:"flex items-center",children:u.jsx("div",{className:"text-lg font-medium text-gray-700",children:"Mike Johnson"})})]})}),M&&u.jsx("div",{className:"mb-6",children:u.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:u.jsxs("div",{className:"flex",children:[u.jsx(Ee,{className:"h-5 w-5 text-red-400 mr-2 mt-0.5"}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Deal Data Warning"}),u.jsx("p",{className:"text-sm text-red-700 mt-1",children:M}),u.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Showing fallback data. New deals will update automatically."})]})]})})}),G&&u.jsx("div",{className:"mb-6",children:u.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),u.jsx("p",{className:"text-sm text-blue-700",children:"Loading deal data..."})]})})}),u.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[u.jsxs(Ut,{className:"border-l-4 border-l-green-500",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(Ke,{className:"mr-2 h-4 w-4 text-green-500"}),"Gross Profit"]})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:R((null==(e=null==U?void 0:U.metrics)?void 0:e.totalGross)||S.totalGross)}),u.jsxs("div",{className:"mt-2 space-y-1",children:[u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-gray-500",children:"Front End Gross:"}),u.jsx("span",{className:"font-medium",children:R((null==(s=null==U?void 0:U.metrics)?void 0:s.totalFrontGross)||S.frontEndGross)})]}),u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-gray-500",children:"Finance Gross:"}),u.jsx("span",{className:"font-medium",children:R((null==(a=null==U?void 0:U.metrics)?void 0:a.totalBackGross)||S.financeGross)})]})]}),u.jsx("div",{className:"flex items-center pt-2 text-xs",children:u.jsxs("span",{className:"flex items-center "+(S.lastMonthComparison.totalGross>=0?"text-green-500":"text-red-500"),children:[S.lastMonthComparison.totalGross>=0?u.jsx(gs,{className:"h-3 w-3 mr-1"}):u.jsx(fs,{className:"h-3 w-3 mr-1"}),Math.abs(S.lastMonthComparison.totalGross),"% from last month"]})})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-blue-500",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(js,{className:"mr-2 h-4 w-4 text-blue-500"}),"Total Units"]})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:(null==(t=null==U?void 0:U.metrics)?void 0:t.totalDeals)||S.totalUnits}),u.jsxs("div",{className:"mt-2 space-y-1",children:[u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-gray-500",children:"New Cars:"}),u.jsx("span",{className:"font-medium",children:(null==(r=null==U?void 0:U.metrics)?void 0:r.newVehicleDeals)||S.newCars})]}),u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-gray-500",children:"Used Cars:"}),u.jsx("span",{className:"font-medium",children:(null==(l=null==U?void 0:U.metrics)?void 0:l.usedVehicleDeals)||S.usedCars})]})]}),u.jsx("div",{className:"flex items-center pt-2 text-xs",children:u.jsxs("span",{className:"flex items-center "+(S.lastMonthComparison.totalUnits>=0?"text-green-500":"text-red-500"),children:[S.lastMonthComparison.totalUnits>=0?u.jsx(gs,{className:"h-3 w-3 mr-1"}):u.jsx(fs,{className:"h-3 w-3 mr-1"}),Math.abs(S.lastMonthComparison.totalUnits),"% from last month"]})})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-purple-500",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(Ve,{className:"mr-2 h-4 w-4 text-purple-500"}),"Sales Performance"]})}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:[(null==(n=null==U?void 0:U.metrics)?void 0:n.salesPerformance)||S.salesPerformance,"%"]}),u.jsxs("div",{className:"mt-2",children:[u.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[u.jsxs("span",{className:"text-gray-500",children:["Goal: ",(null==(i=null==U?void 0:U.metrics)?void 0:i.salesGoal)||S.salesGoal," units"]}),u.jsxs("span",{className:"font-medium",children:[(null==(d=null==U?void 0:U.metrics)?void 0:d.totalDeals)||S.totalUnits,"/",(null==(m=null==U?void 0:U.metrics)?void 0:m.salesGoal)||S.salesGoal]})]}),u.jsx("div",{className:"h-2 w-full bg-gray-100 rounded-full",children:u.jsx("div",{className:"h-full rounded-full "+(((null==(h=null==U?void 0:U.metrics)?void 0:h.salesPerformance)||S.salesPerformance)>=100?"bg-green-500":((null==(x=null==U?void 0:U.metrics)?void 0:x.salesPerformance)||S.salesPerformance)>=80?"bg-yellow-500":"bg-red-500"),style:{width:`${Math.min((null==(p=null==U?void 0:U.metrics)?void 0:p.salesPerformance)||S.salesPerformance,100)}%`}})})]}),u.jsx("div",{className:"flex items-center pt-2 text-xs",children:u.jsx("span",{className:"text-gray-500",children:((null==(g=null==U?void 0:U.metrics)?void 0:g.salesGoal)||S.salesGoal)-((null==(f=null==U?void 0:U.metrics)?void 0:f.totalDeals)||S.totalUnits)>0?((null==(j=null==U?void 0:U.metrics)?void 0:j.salesGoal)||S.salesGoal)-((null==(v=null==U?void 0:U.metrics)?void 0:v.totalDeals)||S.totalUnits)+" more units to goal":"Goal achieved!"})})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-amber-500",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(rs,{className:"mr-2 h-4 w-4 text-amber-500"}),"Average Per Deal"]})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:R((null==(b=null==U?void 0:U.metrics)?void 0:b.avgPerDeal)||S.avgPerDeal)}),u.jsxs("div",{className:"mt-2 space-y-1",children:[u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-gray-500",children:"Avg Front Gross:"}),u.jsx("span",{className:"font-medium",children:R(S.avgFrontGross)})]}),u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-gray-500",children:"Avg F&I Gross:"}),u.jsx("span",{className:"font-medium",children:R(S.avgFinanceGross)})]})]}),u.jsx("div",{className:"flex items-center pt-2 text-xs",children:u.jsxs("span",{className:"flex items-center "+(S.lastMonthComparison.avgPerDeal>=0?"text-green-500":"text-red-500"),children:[S.lastMonthComparison.avgPerDeal>=0?u.jsx(gs,{className:"h-3 w-3 mr-1"}):u.jsx(fs,{className:"h-3 w-3 mr-1"}),Math.abs(S.lastMonthComparison.avgPerDeal),"% from last month"]})})]})]})]}),u.jsx("div",{className:"mb-6",children:u.jsxs(Ut,{className:"border hover:shadow-md transition-shadow",children:[u.jsx(Gt,{className:"py-2 px-4 border-b",children:u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(Qe,{className:"mr-2 h-4 w-4 text-indigo-500"}),"Team Schedule"]}),u.jsxs("div",{className:"flex items-center space-x-1",children:[u.jsx(Bt,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:u.jsx(Xe,{className:"h-4 w-4"})}),u.jsx("span",{className:"text-sm",children:"This Week"}),u.jsx(Bt,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:u.jsx(es,{className:"h-4 w-4"})})]})]})}),u.jsx($t,{className:"py-2 px-0 overflow-x-auto",children:u.jsx("div",{className:"min-w-full",children:u.jsx("div",{className:"grid grid-cols-7 text-center",children:$.map((e,s)=>u.jsxs("div",{className:"p-2 "+(e.isToday?"bg-blue-50 border-b-2 border-blue-500":""),children:[u.jsxs("div",{className:"font-medium text-xs text-gray-800",children:[e.day.substring(0,3)," ",u.jsx("span",{className:"text-gray-500",children:e.date})]}),u.jsx("div",{className:"mt-1 space-y-2",children:e.shifts.map((e,s)=>u.jsx("div",{className:"text-xs",children:"Off"!==e.hours?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"font-medium text-blue-600",children:e.team}),u.jsx("div",{className:"text-gray-700",children:e.hours}),e.members&&u.jsx("div",{className:"text-gray-500 text-[10px]",children:e.members})]}):u.jsxs("div",{className:"text-gray-400 italic",children:[e.team,": Off"]})},s))})]},s))})})})]})}),u.jsxs("div",{className:"grid gap-6 md:grid-cols-3 mb-6",children:[u.jsxs(Ut,{className:"md:col-span-2",children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"The Das Board"})}),u.jsxs($t,{children:[u.jsxs("div",{className:"flex items-center text-xs font-medium text-white border-b py-2 px-1 overflow-x-auto",children:[u.jsx("div",{className:"w-10 text-center bg-gray-600 py-2 rounded-l-md",children:"#"}),u.jsx("div",{className:"w-40 flex-shrink-0 bg-gray-600 py-2 px-2",children:"Salesperson"}),u.jsxs("div",{className:"w-28 text-center bg-purple-600 py-2 flex items-center justify-center cursor-pointer hover:bg-purple-700",children:["PVR ",u.jsx(hs,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-36 text-center bg-green-600 py-2 flex items-center justify-center cursor-pointer hover:bg-green-700",children:["Total Gross ",u.jsx(hs,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-blue-600 py-2 flex items-center justify-center cursor-pointer hover:bg-blue-700",children:["Avg/Mo ",u.jsx(hs,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-blue-500 py-2 flex items-center justify-center cursor-pointer hover:bg-blue-600",children:["Last Mo ",u.jsx(hs,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-blue-600 py-2 flex items-center justify-center cursor-pointer hover:bg-blue-700",children:["YTD ",u.jsx(hs,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-blue-500 py-2 flex items-center justify-center cursor-pointer hover:bg-blue-600",children:["Annual ",u.jsx(hs,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-24 text-center bg-green-600 py-2 flex items-center justify-center cursor-pointer hover:bg-green-700",children:["New ",u.jsx(hs,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-24 text-center bg-amber-600 py-2 flex items-center justify-center cursor-pointer hover:bg-amber-700",children:["Used ",u.jsx(hs,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-36 text-right bg-indigo-600 py-2 pr-3 flex items-center justify-end cursor-pointer hover:bg-indigo-700 font-semibold rounded-r-md",children:["Current Month ",u.jsx(hs,{className:"ml-1 h-3 w-3"})]})]}),u.jsx("div",{className:"overflow-x-auto",children:[{name:"Sarah Johnson",units:14,frontGross:18200,backGross:14300,totalGross:32500,avgMonth:12,lastMonth:15,ytd:82,annualPace:144,newUnits:9,usedUnits:5,pvr:2321},{name:"Michael Chen",units:12,frontGross:16400,backGross:12500,totalGross:28900,avgMonth:10,lastMonth:11,ytd:65,annualPace:120,newUnits:7,usedUnits:5,pvr:2408},{name:"David Rodriguez",units:11,frontGross:14800,backGross:11600,totalGross:26400,avgMonth:9,lastMonth:10,ytd:58,annualPace:108,newUnits:4,usedUnits:7,pvr:2400},{name:"Amanda Williams",units:9,frontGross:11900,backGross:9800,totalGross:21700,avgMonth:8,lastMonth:7,ytd:48,annualPace:96,newUnits:5,usedUnits:4,pvr:2411},{name:"Robert Johnson",units:8,frontGross:10500,backGross:8700,totalGross:19200,avgMonth:7,lastMonth:9,ytd:42,annualPace:84,newUnits:3,usedUnits:5,pvr:2400}].map((e,s)=>u.jsxs("div",{className:`flex items-center py-2 px-1 ${4!==s?"border-b":""} border-gray-100 text-sm hover:bg-gray-50`,children:[u.jsx("div",{className:"w-10 flex justify-center",children:u.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center\n                      "+(0===s?"bg-yellow-100 text-yellow-600":1===s?"bg-gray-100 text-gray-600":2===s?"bg-amber-100 text-amber-600":"bg-blue-50 text-blue-500"),children:u.jsx("span",{className:"text-xs font-bold",children:s+1})})}),u.jsx("div",{className:"w-40 flex-shrink-0 font-medium truncate px-2",children:e.name}),u.jsxs("div",{className:"w-28 text-center bg-purple-50",children:["$",e.pvr]}),u.jsxs("div",{className:"w-36 text-center bg-green-50",children:["$",e.totalGross.toLocaleString()]}),u.jsx("div",{className:"w-28 text-center bg-blue-50",children:e.avgMonth}),u.jsx("div",{className:"w-28 text-center",children:e.lastMonth}),u.jsx("div",{className:"w-28 text-center bg-blue-50",children:e.ytd}),u.jsx("div",{className:"w-28 text-center",children:e.annualPace}),u.jsx("div",{className:"w-24 text-center bg-green-50",children:e.newUnits}),u.jsx("div",{className:"w-24 text-center bg-amber-50",children:e.usedUnits}),u.jsx("div",{className:"w-36 text-right pr-3",children:u.jsx("span",{className:"text-lg font-bold text-indigo-700",children:e.units})})]},s))}),u.jsx("div",{className:"mt-2 pt-2 text-center",children:u.jsx(Bt,{variant:"ghost",size:"sm",className:"text-xs text-blue-600",children:"View All Salespeople"})})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Quick Actions"})}),u.jsxs($t,{className:"grid gap-4",children:[u.jsxs(Bt,{className:"w-full justify-start",onClick:()=>I("/dashboard/sales-manager/team"),children:[u.jsx(vs,{className:"mr-2 h-4 w-4"}),"Team Management"]}),u.jsxs(Bt,{variant:"outline",className:"w-full justify-start",onClick:()=>I("/dashboard/sales-manager/goals"),children:[u.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Set Team Goals"]}),u.jsxs(Bt,{variant:"outline",className:"w-full justify-start",onClick:()=>I("/dashboard/sales-manager/schedule"),children:[u.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Schedule"]}),u.jsxs(Bt,{variant:"outline",className:"w-full justify-start",onClick:()=>I("/dashboard/sales-manager/sales-report"),children:[u.jsx(bs,{className:"mr-2 h-4 w-4"}),"Sales Reports"]})]})]})]}),u.jsxs(Ut,{className:"mb-6 border hover:shadow-md transition-shadow",children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2 border-b",children:[u.jsxs(Mt,{className:"text-lg font-medium flex items-center",children:[u.jsx(as,{className:"mr-2 h-5 w-5 text-blue-500"}),"Deals Log"]}),u.jsx(Bt,{variant:"outline",size:"sm",className:"h-8 text-xs px-2",children:"View All Deals"})]}),u.jsx($t,{className:"pt-4 px-0",children:u.jsxs("div",{className:"flex",children:[u.jsxs("div",{className:"flex-grow overflow-x-auto",children:[u.jsxs("table",{className:"w-full text-sm",children:[u.jsx("thead",{children:u.jsxs("tr",{className:"text-xs",children:[u.jsx("th",{className:"font-medium text-white py-2 pl-3 text-center bg-gray-600 w-12",children:"#"}),u.jsx("th",{className:"font-medium text-white py-2 pl-4 pr-2 text-left bg-blue-600",children:"Deal #"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-left bg-gray-600",children:"Stock #"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-left bg-gray-600",children:"Customer"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-gray-600",children:"Date"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-indigo-600",children:"N/U/CPO"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-blue-600",children:"Salesperson"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-green-600",children:"Front Gross"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-purple-600",children:"Finance Gross"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-amber-600",children:"Total Gross"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-gray-600 w-20",children:"Status"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-blue-600 w-20",children:"CSI Follow Up"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-gray-600 rounded-tr-md",children:"Action"})]})}),u.jsx("tbody",{children:((null==U?void 0:U.deals)||[{id:"D12345",stockNumber:"S9876",customer:"Johnson",vehicleType:"N",date:"06/12/2023",salesperson:"Sarah Johnson",initials:"SJ",frontGross:1850,financeGross:1200,totalGross:3050,status:"Funded",csiFollowUp:!0},{id:"D12346",stockNumber:"S9452",customer:"Williams",vehicleType:"U",date:"06/10/2023",salesperson:"Michael Chen",initials:"MC",frontGross:1300,financeGross:950,totalGross:2250,status:"Pending",csiFollowUp:!1},{id:"D12347",stockNumber:"S8765",customer:"Martinez",vehicleType:"C",date:"06/09/2023",salesperson:"David Rodriguez",initials:"DR",frontGross:2100,financeGross:1400,totalGross:3500,status:"Funded",csiFollowUp:!0},{id:"D12348",stockNumber:"S7620",customer:"Taylor",vehicleType:"U",date:"06/07/2023",salesperson:"Amanda Williams",initials:"AW",frontGross:1750,financeGross:1050,totalGross:2800,status:"Funded",csiFollowUp:!0},{id:"D12349",stockNumber:"S8452",customer:"Garcia",vehicleType:"N",date:"06/05/2023",salesperson:"Robert Johnson",initials:"RJ",frontGross:1500,financeGross:1100,totalGross:2600,status:"Pending",csiFollowUp:!1},{id:"D12350",stockNumber:"S9123",customer:"Miller",vehicleType:"C",date:"06/04/2023",salesperson:"Sarah Johnson",initials:"SJ",frontGross:2250,financeGross:1320,totalGross:3570,status:"Funded",csiFollowUp:!0},{id:"D12351",stockNumber:"S7845",customer:"Davis",vehicleType:"U",date:"06/03/2023",salesperson:"Michael Chen",initials:"MC",frontGross:1420,financeGross:980,totalGross:2400,status:"Funded",csiFollowUp:!1},{id:"D12352",stockNumber:"S8932",customer:"Wilson",vehicleType:"N",date:"06/02/2023",salesperson:"David Rodriguez",initials:"DR",frontGross:1950,financeGross:1250,totalGross:3200,status:"Unwound",csiFollowUp:!1},{id:"D12353",stockNumber:"S7534",customer:"Thompson",vehicleType:"C",date:"06/01/2023",salesperson:"Amanda Williams",initials:"AW",frontGross:1650,financeGross:1020,totalGross:2670,status:"Funded",csiFollowUp:!0},{id:"D12354",stockNumber:"S8721",customer:"Anderson",vehicleType:"N",date:"05/31/2023",salesperson:"Robert Johnson",initials:"RJ",frontGross:2050,financeGross:1350,totalGross:3400,status:"Funded",csiFollowUp:!0}]).slice(0,10).map((e,s)=>{var a,t;const r="Funded"===(e.status||e.dealStatus)?"bg-green-100 text-green-800 border-green-200":"Unwound"===(e.status||e.dealStatus)?"bg-red-100 text-red-800 border-red-200":"bg-amber-100 text-amber-800 border-amber-200",l=10-s;return u.jsxs("tr",{className:`border-b ${s%2==1?"bg-gray-50":""} hover:bg-blue-50`,children:[u.jsx("td",{className:"py-2 px-2 text-center font-medium",children:l}),u.jsx("td",{className:"py-2 pl-4 pr-2 text-left font-medium text-blue-600",children:e.dealNumber||e.id}),u.jsx("td",{className:"py-2 px-2 text-left",children:e.stockNumber}),u.jsx("td",{className:"py-2 px-2 text-left font-medium",children:e.customer||e.lastName}),u.jsx("td",{className:"py-2 px-2 text-center text-gray-600",children:e.date||e.dealDate}),u.jsx("td",{className:"py-2 px-2 text-center",children:u.jsx("span",{className:"px-1.5 py-0.5 rounded text-xs font-medium "+("N"===e.vehicleType?"bg-green-100 text-green-800":"U"===e.vehicleType||"C"===e.vehicleType?"bg-amber-100 text-amber-800":"bg-blue-100 text-blue-800"),children:e.vehicleType||"U"})}),u.jsx("td",{className:"py-2 px-2 text-center font-medium",children:e.initials||(null==(t=null==(a=e.salesperson)?void 0:a.substring(0,2))?void 0:t.toUpperCase())||"SP"}),u.jsxs("td",{className:"py-2 px-2 text-right",children:["$",(e.frontGross||e.frontEndGross||0).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right",children:["$",(e.financeGross||e.backEndGross||e.profit||0).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right font-medium text-green-600",children:["$",(e.totalGross||(e.frontGross||e.frontEndGross||0)+(e.financeGross||e.backEndGross||e.profit||0)).toLocaleString()]}),u.jsx("td",{className:"py-2 px-2 text-center",children:u.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r}`,children:e.status||e.dealStatus||"Pending"})}),u.jsx("td",{className:"py-2 px-2 text-center",children:u.jsx("input",{type:"checkbox",checked:e.csiFollowUp||!1,className:"h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"})}),u.jsx("td",{className:"py-2 px-2 text-center",children:u.jsxs(br,{open:C&&(null==D?void 0:D.id)===(e.id||e.dealNumber),onOpenChange:e=>{e||k(!1)},children:[u.jsx(Nr,{asChild:!0,children:u.jsx(Bt,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{P({id:e.id||e.dealNumber,frontGross:e.frontGross||e.frontEndGross||0,status:e.status||e.dealStatus||"Pending"}),k(!0)},children:u.jsx(Ns,{className:"h-3.5 w-3.5"})})}),u.jsxs(Sr,{className:"sm:max-w-[425px]",children:[u.jsxs(_r,{children:[u.jsx(Pr,{children:"Edit Deal"}),u.jsxs(Cr,{children:["Update deal information for ",e.customer||e.lastName]})]}),u.jsxs("form",{onSubmit:B,children:[u.jsxs("div",{className:"grid gap-4 py-4",children:[u.jsxs("div",{className:"grid gap-2",children:[u.jsx(Jt,{htmlFor:"frontGross",children:"Front End Gross ($)"}),u.jsx(Vt,{id:"frontGross",type:"number",value:(null==D?void 0:D.frontGross)||0,onChange:L})]}),u.jsxs("div",{className:"grid gap-2",children:[u.jsx(Jt,{htmlFor:"status",children:"Deal Status"}),u.jsxs(ql,{value:(null==D?void 0:D.status)||"Pending",onValueChange:O,children:[u.jsx(Yl,{id:"status",children:u.jsx(Jl,{placeholder:"Select status"})}),u.jsxs(Zl,{children:[u.jsx(Ql,{value:"Pending",children:"Pending"}),u.jsx(Ql,{value:"Funded",children:"Funded"}),u.jsx(Ql,{value:"Unwound",children:"Unwound"})]})]}),"Unwound"===(null==D?void 0:D.status)&&u.jsx("p",{className:"text-xs text-red-500 mt-1",children:"Warning: Unwinding a deal may affect salesperson commissions."})]})]}),u.jsx(Dr,{children:u.jsx(Bt,{type:"submit",disabled:T,children:T?u.jsxs(u.Fragment,{children:[u.jsx(Ge,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving"]}):u.jsxs(u.Fragment,{children:[u.jsx(ys,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})})]})]})]})})]},e.id||e.dealNumber)})}),u.jsx("tfoot",{children:u.jsxs("tr",{className:"bg-gray-100 border-t border-t-gray-200 font-medium",children:[u.jsx("td",{colSpan:6,className:"py-2 pl-4 text-left",children:"TOTALS"}),u.jsxs("td",{className:"py-2 px-2 text-right",children:["$",[1850,1300,2100,1750,1500,2250,1420,1950,1650,2050].reduce((e,s)=>e+s,0).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right",children:["$",[1200,950,1400,1050,1100,1320,980,1250,1020,1350].reduce((e,s)=>e+s,0).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right text-green-600 font-medium",children:["$",[3050,2250,3500,2800,2600,3570,2400,3200,2670,3400].reduce((e,s)=>e+s,0).toLocaleString()]}),u.jsx("td",{})]})})]}),u.jsxs("div",{className:"flex justify-between items-center px-4 py-3 border-t",children:[u.jsx("div",{className:"text-sm text-gray-500",children:"Showing deals 1-10 of 45"}),u.jsxs("div",{className:"flex space-x-1",children:[u.jsx(Bt,{variant:"outline",size:"sm",children:"Previous"}),u.jsx(Bt,{variant:"outline",size:"sm",children:"Next"})]})]})]}),u.jsxs("div",{className:"w-12 border-l bg-gray-50 flex flex-col items-center justify-between py-4",children:[u.jsxs("div",{className:"flex flex-col space-y-2",children:[u.jsx(Bt,{variant:"outline",size:"sm",className:"w-8 h-8 p-0",children:u.jsx(He,{className:"h-4 w-4"})}),u.jsx(Bt,{variant:"outline",size:"sm",className:"w-8 h-8 p-0",children:u.jsx(He,{className:"h-4 w-4"})})]}),u.jsx("div",{className:"text-xs text-gray-500 text-center py-2",children:"10/45"}),u.jsxs("div",{className:"flex flex-col space-y-2",children:[u.jsx(Bt,{variant:"outline",size:"sm",className:"w-8 h-8 p-0",children:u.jsx(Ze,{className:"h-4 w-4"})}),u.jsx(Bt,{variant:"outline",size:"sm",className:"w-8 h-8 p-0",children:u.jsx(Ze,{className:"h-4 w-4"})})]})]})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Team Performance Metrics"})}),u.jsx($t,{children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Salesperson"}),u.jsx(tn,{children:"Team"}),u.jsx(tn,{className:"text-center",children:"Target Goal"}),u.jsx(tn,{className:"text-center",children:"Sold (MTD)"}),u.jsx(tn,{className:"text-right",children:"Avg Front"}),u.jsx(tn,{className:"text-right",children:"Avg Back End"}),u.jsx(tn,{className:"text-center",children:"CSI Follow Up"}),u.jsx(tn,{className:"text-right",children:"% of Goal"})]})}),u.jsx(sn,{children:[{name:"Sarah Johnson",initials:"SJ",team:"A",targetGoal:30,actualDeals:24,avgFront:1850,avgBackEnd:1200,csiFollowUp:92,percentGoal:80},{name:"Michael Chen",initials:"MC",team:"A",targetGoal:25,actualDeals:20,avgFront:1320,avgBackEnd:980,csiFollowUp:85,percentGoal:80},{name:"David Rodriguez",initials:"DR",team:"A",targetGoal:22,actualDeals:18,avgFront:1950,avgBackEnd:1250,csiFollowUp:75,percentGoal:82},{name:"Amanda Williams",initials:"AW",team:"B",targetGoal:20,actualDeals:16,avgFront:1650,avgBackEnd:1020,csiFollowUp:95,percentGoal:80},{name:"Robert Johnson",initials:"RJ",team:"B",targetGoal:18,actualDeals:15,avgFront:2050,avgBackEnd:1350,csiFollowUp:88,percentGoal:83}].map((e,s)=>u.jsxs(an,{children:[u.jsx(rn,{className:"font-medium",children:e.name}),u.jsx(rn,{className:"text-center",children:u.jsxs("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("A"===e.team?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:["Team ",e.team]})}),u.jsx(rn,{className:"text-center",children:e.targetGoal}),u.jsx(rn,{className:"text-center",children:e.actualDeals}),u.jsxs(rn,{className:"text-right",children:["$",e.avgFront.toLocaleString()]}),u.jsxs(rn,{className:"text-right",children:["$",e.avgBackEnd.toLocaleString()]}),u.jsx(rn,{className:"text-center",children:u.jsx("div",{className:"flex items-center justify-center",children:u.jsxs("span",{className:"text-xs font-medium px-2 py-1 rounded-full "+(e.csiFollowUp>=90?"bg-green-100 text-green-800":e.csiFollowUp>=80?"bg-blue-100 text-blue-800":"bg-amber-100 text-amber-800"),children:[e.csiFollowUp,"%"]})})}),u.jsx(rn,{className:"text-right",children:u.jsxs("div",{className:"flex items-center justify-end",children:[u.jsx("div",{className:"w-16 h-2 bg-gray-100 rounded-full mr-2 overflow-hidden",children:u.jsx("div",{className:"h-full rounded-full "+(e.percentGoal>=90?"bg-green-500":e.percentGoal>=70?"bg-blue-500":e.percentGoal>=50?"bg-amber-500":"bg-red-500"),style:{width:`${Math.min(e.percentGoal,100)}%`}})}),u.jsxs("span",{className:"text-xs font-medium",children:[e.percentGoal,"%"]})]})})]},s))})]})})]})]})},cn=()=>{const{user:e,role:s,dealershipId:a}=It(),[t,r]=he.useState("this-month"),[l,n]=he.useState({totalGross:125600,frontEndGross:82400,financeGross:43200,totalUnits:86,newCars:52,usedCars:34,salesGoal:100,salesPerformance:86,avgPerDeal:1460,avgFrontGross:958,avgFinanceGross:502,lastMonthComparison:{totalGross:8.5,frontEndGross:6.2,financeGross:12.4,totalUnits:9.3,avgPerDeal:4.8}});he.useEffect(()=>(console.log("[GMDashboard] Rendering general manager dashboard",{userId:null==e?void 0:e.id,role:s,dealershipId:a,timestamp:(new Date).toISOString()}),()=>{console.log("[GMDashboard] Unmounting general manager dashboard")}),[e,s,a]);const i=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);return u.jsxs("div",{className:"container py-6",children:[u.jsx("div",{className:"flex justify-between items-center mb-6",children:u.jsx("div",{className:"flex-grow",children:u.jsx("h1",{className:"text-3xl font-bold",children:"General Manager Dashboard"})})}),u.jsx("div",{className:"mb-6",children:u.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[u.jsxs("div",{className:"flex flex-row items-center gap-4",children:[u.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:(e=>{const s=new Date,a=s.toLocaleString("default",{month:"long"}),t=s.getFullYear();switch(e){case"this-month":default:return`${a} ${t}`;case"last-month":return`${0===s.getMonth()?"December":new Date(s.getFullYear(),s.getMonth()-1,1).toLocaleString("default",{month:"long"})} ${0===s.getMonth()?s.getFullYear()-1:s.getFullYear()}`;case"last-quarter":const e=Math.floor(s.getMonth()/3);return`Q${0===e?4:e} ${0===e?t-1:t}`;case"ytd":return`Year to Date ${t}`;case"last-year":return""+(t-1)}})(t)}),u.jsxs("div",{className:"flex items-center",children:[u.jsx(Oe,{className:"h-5 w-5 text-gray-500 mr-1"}),u.jsxs("select",{value:t,onChange:e=>r(e.target.value),className:"p-2 border rounded-md shadow-sm",children:[u.jsx("option",{value:"this-month",children:"This Month"}),u.jsx("option",{value:"last-month",children:"Last Month"}),u.jsx("option",{value:"last-quarter",children:"Last Quarter"}),u.jsx("option",{value:"ytd",children:"Year to Date"}),u.jsx("option",{value:"last-year",children:"Last Year"})]})]}),u.jsx("p",{className:"text-gray-500",children:"GM Performance Dashboard"})]}),u.jsx("div",{className:"flex items-center",children:u.jsx("div",{className:"text-lg font-medium text-gray-700",children:(null==e?void 0:e.email)||"General Manager"})})]})}),u.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[u.jsxs(Ut,{className:"border-l-4 border-l-green-500",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(Ke,{className:"mr-2 h-4 w-4 text-green-500"}),"Gross Profit"]})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:i(l.totalGross)}),u.jsxs("div",{className:"mt-2 space-y-1",children:[u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-gray-500",children:"Front End Gross:"}),u.jsx("span",{className:"font-medium",children:i(l.frontEndGross)})]}),u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-gray-500",children:"Finance Gross:"}),u.jsx("span",{className:"font-medium",children:i(l.financeGross)})]})]}),u.jsx("div",{className:"flex items-center pt-2 text-xs",children:u.jsxs("span",{className:"flex items-center "+(l.lastMonthComparison.totalGross>=0?"text-green-500":"text-red-500"),children:[l.lastMonthComparison.totalGross>=0?u.jsx(gs,{className:"h-3 w-3 mr-1"}):u.jsx(fs,{className:"h-3 w-3 mr-1"}),Math.abs(l.lastMonthComparison.totalGross),"% from last month"]})})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-blue-500",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(js,{className:"mr-2 h-4 w-4 text-blue-500"}),"Total Units"]})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:l.totalUnits}),u.jsxs("div",{className:"mt-2 space-y-1",children:[u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-gray-500",children:"New Cars:"}),u.jsx("span",{className:"font-medium",children:l.newCars})]}),u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-gray-500",children:"Used Cars:"}),u.jsx("span",{className:"font-medium",children:l.usedCars})]})]}),u.jsx("div",{className:"flex items-center pt-2 text-xs",children:u.jsxs("span",{className:"flex items-center "+(l.lastMonthComparison.totalUnits>=0?"text-green-500":"text-red-500"),children:[l.lastMonthComparison.totalUnits>=0?u.jsx(gs,{className:"h-3 w-3 mr-1"}):u.jsx(fs,{className:"h-3 w-3 mr-1"}),Math.abs(l.lastMonthComparison.totalUnits),"% from last month"]})})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-purple-500",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(Ve,{className:"mr-2 h-4 w-4 text-purple-500"}),"Sales Performance"]})}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:[l.salesPerformance,"%"]}),u.jsxs("div",{className:"mt-2",children:[u.jsxs("div",{className:"flex justify-between items-center text-sm mb-1",children:[u.jsxs("span",{className:"text-gray-500",children:["Goal: ",l.salesGoal," units"]}),u.jsxs("span",{className:"font-medium",children:[l.totalUnits,"/",l.salesGoal]})]}),u.jsx("div",{className:"h-2 w-full bg-gray-100 rounded-full",children:u.jsx("div",{className:"h-full rounded-full "+(l.salesPerformance>=100?"bg-green-500":l.salesPerformance>=80?"bg-yellow-500":"bg-red-500"),style:{width:`${Math.min(l.salesPerformance,100)}%`}})})]}),u.jsx("div",{className:"flex items-center pt-2 text-xs",children:u.jsx("span",{className:"text-gray-500",children:l.salesGoal-l.totalUnits>0?l.salesGoal-l.totalUnits+" more units to goal":"Goal achieved!"})})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-amber-500",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"text-sm font-medium flex items-center",children:[u.jsx(rs,{className:"mr-2 h-4 w-4 text-amber-500"}),"Average Per Deal"]})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:i(l.avgPerDeal)}),u.jsxs("div",{className:"mt-2 space-y-1",children:[u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-gray-500",children:"Avg Front Gross:"}),u.jsx("span",{className:"font-medium",children:i(l.avgFrontGross)})]}),u.jsxs("div",{className:"flex justify-between items-center text-sm",children:[u.jsx("span",{className:"text-gray-500",children:"Avg F&I Gross:"}),u.jsx("span",{className:"font-medium",children:i(l.avgFinanceGross)})]})]}),u.jsx("div",{className:"flex items-center pt-2 text-xs",children:u.jsxs("span",{className:"flex items-center "+(l.lastMonthComparison.avgPerDeal>=0?"text-green-500":"text-red-500"),children:[l.lastMonthComparison.avgPerDeal>=0?u.jsx(gs,{className:"h-3 w-3 mr-1"}):u.jsx(fs,{className:"h-3 w-3 mr-1"}),Math.abs(l.lastMonthComparison.avgPerDeal),"% from last month"]})})]})]})]}),u.jsxs("div",{className:"grid grid-cols-12 gap-6 mb-6",children:[u.jsxs(Ut,{className:"col-span-12 md:col-span-6",children:[u.jsx(Gt,{className:"bg-green-50 border-b border-green-100",children:u.jsxs(Mt,{className:"text-lg font-semibold text-green-700 flex items-center",children:[u.jsx(ss,{className:"mr-2 h-5 w-5 text-yellow-500"}),"Finance Das Board"]})}),u.jsx($t,{className:"p-0",children:u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("div",{className:"min-w-full",children:[u.jsxs("div",{className:"flex items-center text-xs font-medium text-white border-b py-2 px-1",children:[u.jsx("div",{className:"w-10 text-center bg-gray-600 py-2 rounded-l-md",children:"#"}),u.jsx("div",{className:"w-36 flex-shrink-0 bg-gray-600 py-2 px-2",children:"F&I Manager"}),u.jsxs("div",{className:"w-28 text-center bg-purple-600 py-2 flex items-center justify-center cursor-pointer hover:bg-purple-700",children:["PVR ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-teal-600 py-2 flex items-center justify-center cursor-pointer hover:bg-teal-700",children:["VSC % ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-purple-600 py-2 flex items-center justify-center cursor-pointer hover:bg-purple-700",children:["PPM % ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-24 text-center bg-pink-600 py-2 flex items-center justify-center cursor-pointer hover:bg-pink-700",children:["PPD ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-36 text-right bg-indigo-600 py-2 pr-3 flex items-center justify-end cursor-pointer hover:bg-indigo-700 font-semibold rounded-r-md",children:["Profit ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]})]}),u.jsx("div",{children:[{name:"Ashley Rodriguez",pvr:2650,vscPen:68,ppmPen:54,ppd:3.2,profit:143200},{name:"Michael Parker",pvr:2450,vscPen:65,ppmPen:48,ppd:2.9,profit:127500},{name:"Sophia Martinez",pvr:2320,vscPen:61,ppmPen:45,ppd:2.7,profit:115300},{name:"James Wilson",pvr:2200,vscPen:58,ppmPen:42,ppd:2.5,profit:96500},{name:"Emma Johnson",pvr:2100,vscPen:55,ppmPen:38,ppd:2.3,profit:84200}].map((e,s)=>u.jsxs("div",{className:`flex items-center py-2 px-1 ${4!==s?"border-b":""} border-gray-100 text-sm hover:bg-gray-50`,children:[u.jsx("div",{className:"w-10 flex justify-center",children:u.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center\n                          "+(0===s?"bg-yellow-100 text-yellow-600":1===s?"bg-gray-100 text-gray-600":2===s?"bg-amber-100 text-amber-600":"bg-blue-50 text-blue-500"),children:u.jsx("span",{className:"text-xs font-bold",children:s+1})})}),u.jsx("div",{className:"w-36 flex-shrink-0 font-medium px-2",children:e.name}),u.jsxs("div",{className:"w-28 text-center",children:["$",e.pvr]}),u.jsxs("div",{className:"w-28 text-center",children:[e.vscPen,"%"]}),u.jsxs("div",{className:"w-28 text-center",children:[e.ppmPen,"%"]}),u.jsx("div",{className:"w-24 text-center",children:e.ppd}),u.jsxs("div",{className:"w-36 text-right pr-3 font-semibold text-green-700",children:["$",e.profit.toLocaleString()]})]},s))})]})})})]}),u.jsxs(Ut,{className:"col-span-12 md:col-span-6",children:[u.jsx(Gt,{className:"bg-purple-50 border-b border-purple-100",children:u.jsxs(Mt,{className:"text-lg font-semibold text-purple-700 flex items-center",children:[u.jsx(vs,{className:"h-5 w-5 text-purple-600 mr-2"}),"Sales Manager Das Board"]})}),u.jsx($t,{className:"p-0",children:u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("div",{className:"min-w-full",children:[u.jsxs("div",{className:"flex items-center text-xs font-medium text-white border-b py-2 px-1",children:[u.jsx("div",{className:"w-10 text-center bg-gray-600 py-2 rounded-l-md",children:"#"}),u.jsx("div",{className:"w-40 flex-shrink-0 bg-gray-600 py-2 px-2",children:"Manager"}),u.jsx("div",{className:"w-28 text-center bg-blue-600 py-2",children:"Team Units"}),u.jsx("div",{className:"w-28 text-center bg-green-600 py-2",children:"Total Gross"}),u.jsx("div",{className:"w-28 text-center bg-purple-600 py-2",children:"Avg Front"}),u.jsx("div",{className:"w-28 text-center bg-indigo-600 py-2 rounded-r-md",children:"Avg Back"})]}),[{name:"John Smith",units:45,gross:84500,avgFront:1250,avgBack:950},{name:"Jessica Lee",units:41,gross:78900,avgFront:1180,avgBack:920}].map((e,s)=>u.jsxs("div",{className:`flex items-center py-2 px-1 ${1!==s?"border-b":""} border-gray-100 text-sm hover:bg-gray-50`,children:[u.jsx("div",{className:"w-10 flex justify-center",children:s+1}),u.jsx("div",{className:"w-40 flex-shrink-0 font-medium px-2",children:e.name}),u.jsx("div",{className:"w-28 text-center",children:e.units}),u.jsxs("div",{className:"w-28 text-center",children:["$",e.gross.toLocaleString()]}),u.jsxs("div",{className:"w-28 text-center",children:["$",e.avgFront]}),u.jsxs("div",{className:"w-28 text-center",children:["$",e.avgBack]})]},s))]})})})]}),u.jsxs(Ut,{className:"col-span-12",children:[u.jsx(Gt,{className:"bg-blue-50 border-b border-blue-100",children:u.jsxs(Mt,{className:"text-lg font-semibold text-blue-700 flex items-center",children:[u.jsx(ss,{className:"h-5 w-5 text-yellow-500 mr-2"}),"The Das Board"]})}),u.jsx($t,{className:"p-0",children:u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("div",{className:"min-w-full",children:[u.jsxs("div",{className:"flex items-center text-xs font-medium text-white border-b py-2 px-1",children:[u.jsx("div",{className:"w-10 text-center bg-gray-600 py-2 rounded-l-md",children:"#"}),u.jsx("div",{className:"w-40 flex-shrink-0 bg-gray-600 py-2 px-2",children:"Salesperson"}),u.jsxs("div",{className:"w-28 text-center bg-purple-600 py-2 flex items-center justify-center cursor-pointer hover:bg-purple-700",children:["PVR ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-36 text-center bg-green-600 py-2 flex items-center justify-center cursor-pointer hover:bg-green-700",children:["Total Gross ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-blue-600 py-2 flex items-center justify-center cursor-pointer hover:bg-blue-700",children:["Avg/Mo ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-blue-500 py-2 flex items-center justify-center cursor-pointer hover:bg-blue-600",children:["Last Mo ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-blue-600 py-2 flex items-center justify-center cursor-pointer hover:bg-blue-700",children:["YTD ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-28 text-center bg-blue-500 py-2 flex items-center justify-center cursor-pointer hover:bg-blue-600",children:["Annual ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-24 text-center bg-green-600 py-2 flex items-center justify-center cursor-pointer hover:bg-green-700",children:["New ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-24 text-center bg-amber-600 py-2 flex items-center justify-center cursor-pointer hover:bg-amber-700",children:["Used ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]}),u.jsxs("div",{className:"w-36 text-right bg-indigo-600 py-2 pr-3 flex items-center justify-end cursor-pointer hover:bg-indigo-700 font-semibold rounded-r-md",children:["Current Month ",u.jsx(Ze,{className:"ml-1 h-3 w-3"})]})]}),u.jsx("div",{children:[{name:"Michael Scott",units:14,frontGross:18200,backGross:14300,totalGross:32500,avgMonth:12,lastMonth:15,ytd:82,annualPace:144,newUnits:9,usedUnits:5,pvr:2321},{name:"Jim Halpert",units:12,frontGross:16400,backGross:12500,totalGross:28900,avgMonth:10,lastMonth:11,ytd:65,annualPace:120,newUnits:7,usedUnits:5,pvr:2408},{name:"Dwight Schrute",units:11,frontGross:14800,backGross:11600,totalGross:26400,avgMonth:9,lastMonth:10,ytd:58,annualPace:108,newUnits:4,usedUnits:7,pvr:2400},{name:"Pam Beesly",units:9,frontGross:11900,backGross:9800,totalGross:21700,avgMonth:8,lastMonth:7,ytd:48,annualPace:96,newUnits:5,usedUnits:4,pvr:2411},{name:"Stanley Hudson",units:8,frontGross:10500,backGross:8700,totalGross:19200,avgMonth:7,lastMonth:9,ytd:42,annualPace:84,newUnits:3,usedUnits:5,pvr:2400}].map((e,s)=>u.jsxs("div",{className:`flex items-center py-2 px-1 ${4!==s?"border-b":""} border-gray-100 text-sm hover:bg-gray-50`,children:[u.jsx("div",{className:"w-10 flex justify-center",children:u.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center\n                          "+(0===s?"bg-yellow-100 text-yellow-600":1===s?"bg-gray-100 text-gray-600":2===s?"bg-amber-100 text-amber-600":"bg-blue-50 text-blue-500"),children:u.jsx("span",{className:"text-xs font-bold",children:s+1})})}),u.jsx("div",{className:"w-40 flex-shrink-0 font-medium truncate px-2",children:e.name}),u.jsxs("div",{className:"w-28 text-center bg-purple-50",children:["$",e.pvr]}),u.jsxs("div",{className:"w-36 text-center bg-green-50",children:["$",e.totalGross.toLocaleString()]}),u.jsx("div",{className:"w-28 text-center bg-blue-50",children:e.avgMonth}),u.jsx("div",{className:"w-28 text-center",children:e.lastMonth}),u.jsx("div",{className:"w-28 text-center bg-blue-50",children:e.ytd}),u.jsx("div",{className:"w-28 text-center",children:e.annualPace}),u.jsx("div",{className:"w-24 text-center bg-green-50",children:e.newUnits}),u.jsx("div",{className:"w-24 text-center bg-amber-50",children:e.usedUnits}),u.jsx("div",{className:"w-36 text-right pr-3",children:u.jsx("span",{className:"text-lg font-bold text-indigo-700",children:e.units})})]},s))})]})})})]})]}),u.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-7 mb-6",children:[u.jsxs(Ut,{className:"col-span-4",children:[u.jsxs(Gt,{children:[u.jsx(Mt,{children:"Department Performance"}),u.jsx(Rt,{children:"Overall business metrics for the current month"})]}),u.jsx($t,{className:"pl-2",children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"w-[100px] text-sm",children:"Sales"}),u.jsx("div",{className:"flex-1",children:u.jsx("div",{className:"bg-blue-500 h-2 w-[85%] rounded-full"})}),u.jsx("div",{className:"w-[50px] text-right text-sm",children:"85%"})]}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"w-[100px] text-sm",children:"Finance"}),u.jsx("div",{className:"flex-1",children:u.jsx("div",{className:"bg-green-500 h-2 w-[92%] rounded-full"})}),u.jsx("div",{className:"w-[50px] text-right text-sm",children:"92%"})]}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"w-[100px] text-sm",children:"Service"}),u.jsx("div",{className:"flex-1",children:u.jsx("div",{className:"bg-amber-500 h-2 w-[78%] rounded-full"})}),u.jsx("div",{className:"w-[50px] text-right text-sm",children:"78%"})]}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"w-[100px] text-sm",children:"Parts"}),u.jsx("div",{className:"flex-1",children:u.jsx("div",{className:"bg-purple-500 h-2 w-[68%] rounded-full"})}),u.jsx("div",{className:"w-[50px] text-right text-sm",children:"68%"})]})]})})]}),u.jsxs(Ut,{className:"col-span-3",children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Quick Actions"})}),u.jsxs($t,{className:"grid gap-4",children:[u.jsxs(Bt,{className:"w-full justify-start",children:[u.jsx(as,{className:"mr-2 h-4 w-4"}),"Dealership Reports"]}),u.jsxs(Bt,{variant:"outline",className:"w-full justify-start",children:[u.jsx(vs,{className:"mr-2 h-4 w-4"}),"Staff Management"]}),u.jsxs(Bt,{variant:"outline",className:"w-full justify-start",children:[u.jsx(ws,{className:"mr-2 h-4 w-4"}),"Inventory Overview"]}),u.jsxs(Bt,{variant:"outline",className:"w-full justify-start",children:[u.jsx(Ss,{className:"mr-2 h-4 w-4"}),"Financial Analysis"]})]})]})]})]})},dn=Q,mn=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(H,o({ref:s,className:et("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t)},r))});mn.displayName=H.displayName;const hn=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(K,o({ref:s,className:et("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t)},r))});hn.displayName=K.displayName;const un=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(Z,o({ref:s,className:et("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t)},r))});un.displayName=Z.displayName;var xn="Checkbox",[pn,gn]=p(xn),[fn,jn]=pn(xn),vn=he.forwardRef((e,s)=>{const a=e,{__scopeCheckbox:t,name:r,checked:l,defaultChecked:n,required:i,disabled:m,value:h="on",onCheckedChange:p,form:g}=a,j=d(a,["__scopeCheckbox","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]),[b,y]=he.useState(null),w=f(s,e=>y(e)),S=he.useRef(!1),_=!b||g||!!b.closest("form"),[D,P]=v({prop:l,defaultProp:null!=n&&n,onChange:p,caller:xn}),C=he.useRef(D);return he.useEffect(()=>{const e=null==b?void 0:b.form;if(e){const s=()=>P(C.current);return e.addEventListener("reset",s),()=>e.removeEventListener("reset",s)}},[b,P]),u.jsxs(fn,{scope:t,state:D,disabled:m,children:[u.jsx(x.button,c(o({type:"button",role:"checkbox","aria-checked":wn(D)?"mixed":D,"aria-required":i,"data-state":Sn(D),"data-disabled":m?"":void 0,disabled:m,value:h},j),{ref:w,onKeyDown:N(e.onKeyDown,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:N(e.onClick,e=>{P(e=>!!wn(e)||!e),_&&(S.current=e.isPropagationStopped(),S.current||e.stopPropagation())})})),_&&u.jsx(yn,{control:b,bubbles:!S.current,name:r,value:h,checked:D,required:i,disabled:m,form:g,style:{transform:"translateX(-100%)"},defaultChecked:!wn(n)&&n})]})});vn.displayName=xn;var bn="CheckboxIndicator",Nn=he.forwardRef((e,s)=>{const a=e,{__scopeCheckbox:t,forceMount:r}=a,l=d(a,["__scopeCheckbox","forceMount"]),n=jn(bn,t);return u.jsx(b,{present:r||wn(n.state)||!0===n.state,children:u.jsx(x.span,c(o({"data-state":Sn(n.state),"data-disabled":n.disabled?"":void 0},l),{ref:s,style:o({pointerEvents:"none"},e.style)}))})});Nn.displayName=bn;var yn=he.forwardRef((e,s)=>{var a=e,{__scopeCheckbox:t,control:r,checked:l,bubbles:n=!0,defaultChecked:i}=a,m=d(a,["__scopeCheckbox","control","checked","bubbles","defaultChecked"]);const h=he.useRef(null),p=f(h,s),g=Tr(l),j=X(r);he.useEffect(()=>{const e=h.current;if(!e)return;const s=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(s,"checked").set;if(g!==l&&a){const s=new Event("click",{bubbles:n});e.indeterminate=wn(l),a.call(e,!wn(l)&&l),e.dispatchEvent(s)}},[g,l,n]);const v=he.useRef(!wn(l)&&l);return u.jsx(x.input,c(o({type:"checkbox","aria-hidden":!0,defaultChecked:null!=i?i:v.current},m),{tabIndex:-1,ref:p,style:c(o(o({},m.style),j),{position:"absolute",pointerEvents:"none",opacity:0,margin:0})}))});function wn(e){return"indeterminate"===e}function Sn(e){return wn(e)?"indeterminate":e?"checked":"unchecked"}yn.displayName="CheckboxBubbleInput";var _n=vn,Dn=Nn;const Pn=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(_n,c(o({ref:s,className:et("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t)},r),{children:u.jsx(Dn,{className:et("flex items-center justify-center text-current"),children:u.jsx(ps,{className:"h-4 w-4"})})}))});function Cn(e){const s=kn(e),a=he.forwardRef((e,a)=>{const t=e,{children:r}=t,l=d(t,["children"]),n=he.Children.toArray(r),i=n.find(Fn);if(i){const e=i.props.children,t=n.map(s=>s===i?he.Children.count(e)>1?he.Children.only(null):he.isValidElement(e)?e.props.children:null:s);return u.jsx(s,c(o({},l),{ref:a,children:he.isValidElement(e)?he.cloneElement(e,void 0,t):null}))}return u.jsx(s,c(o({},l),{ref:a,children:r}))});return a.displayName=`${e}.Slot`,a}function kn(e){const s=he.forwardRef((e,s)=>{const a=e,{children:t}=a,r=d(a,["children"]);if(he.isValidElement(t)){const e=function(e){var s,a;let t=null==(s=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:s.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=null==(a=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:a.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}(t),a=function(e,s){const a=o({},s);for(const t in s){const r=e[t],l=s[t];/^on[A-Z]/.test(t)?r&&l?a[t]=(...e)=>{const s=l(...e);return r(...e),s}:r&&(a[t]=r):"style"===t?a[t]=o(o({},r),l):"className"===t&&(a[t]=[r,l].filter(Boolean).join(" "))}return o(o({},e),a)}(r,t.props);return t.type!==he.Fragment&&(a.ref=s?ee(s,e):e),he.cloneElement(t,a)}return he.Children.count(t)>1?he.Children.only(null):null});return s.displayName=`${e}.SlotClone`,s}Pn.displayName=_n.displayName;var Tn=Symbol("radix.slottable");function Fn(e){return he.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===Tn}var An=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,s)=>{const a=Cn(`Primitive.${s}`),t=he.forwardRef((e,t)=>{const r=e,{asChild:l}=r,n=d(r,["asChild"]),i=l?a:s;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),u.jsx(i,c(o({},n),{ref:t}))});return t.displayName=`Primitive.${s}`,c(o({},e),{[s]:t})},{}),En="Switch",[In,Un]=p(En),[Gn,Mn]=In(En),Rn=he.forwardRef((e,s)=>{const a=e,{__scopeSwitch:t,name:r,checked:l,defaultChecked:n,required:i,disabled:m,value:h="on",onCheckedChange:x,form:p}=a,g=d(a,["__scopeSwitch","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]),[j,b]=he.useState(null),y=f(s,e=>b(e)),w=he.useRef(!1),S=!j||p||!!j.closest("form"),[_,D]=v({prop:l,defaultProp:null!=n&&n,onChange:x,caller:En});return u.jsxs(Gn,{scope:t,checked:_,disabled:m,children:[u.jsx(An.button,c(o({type:"button",role:"switch","aria-checked":_,"aria-required":i,"data-state":Bn(_),"data-disabled":m?"":void 0,disabled:m,value:h},g),{ref:y,onClick:N(e.onClick,e=>{D(e=>!e),S&&(w.current=e.isPropagationStopped(),w.current||e.stopPropagation())})})),S&&u.jsx(On,{control:j,bubbles:!w.current,name:r,value:h,checked:_,required:i,disabled:m,form:p,style:{transform:"translateX(-100%)"}})]})});Rn.displayName=En;var $n="SwitchThumb",Ln=he.forwardRef((e,s)=>{const a=e,{__scopeSwitch:t}=a,r=d(a,["__scopeSwitch"]),l=Mn($n,t);return u.jsx(An.span,c(o({"data-state":Bn(l.checked),"data-disabled":l.disabled?"":void 0},r),{ref:s}))});Ln.displayName=$n;var On=he.forwardRef((e,s)=>{var a=e,{__scopeSwitch:t,control:r,checked:l,bubbles:n=!0}=a,i=d(a,["__scopeSwitch","control","checked","bubbles"]);const m=he.useRef(null),h=f(m,s),x=Tr(l),p=X(r);return he.useEffect(()=>{const e=m.current;if(!e)return;const s=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(s,"checked").set;if(x!==l&&a){const s=new Event("click",{bubbles:n});a.call(e,l),e.dispatchEvent(s)}},[x,l,n]),u.jsx("input",c(o({type:"checkbox","aria-hidden":!0,defaultChecked:l},i),{tabIndex:-1,ref:h,style:c(o(o({},i.style),p),{position:"absolute",pointerEvents:"none",opacity:0,margin:0})}))});function Bn(e){return e?"checked":"unchecked"}On.displayName="SwitchBubbleInput";var Vn=Rn,zn=Ln;const Wn=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(Vn,c(o({className:et("peer inline-flex h-[24px] w-[44px] shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t)},r),{ref:s,children:u.jsx(zn,{className:et("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}))});Wn.displayName=Vn.displayName;const qn=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("textarea",o({className:et("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s},r))});qn.displayName="Textarea";const Jn={ROLES:[{id:"salesperson",name:"Salesperson",category:"sales"},{id:"finance_manager",name:"Finance Manager",category:"finance"},{id:"finance_director",name:"Finance Director",category:"finance"},{id:"sales_manager",name:"Sales Manager",category:"management"},{id:"general_manager",name:"General Manager",category:"management"}],PLAN_TYPES:[{id:"simple",name:"Simple Plan",description:"Basic commission structure"},{id:"advanced",name:"Advanced Plan",description:"Complex bonus structure with multiple tiers"}],PERCENTAGE_OPTIONS:[{value:8,label:"8%"},{value:10,label:"10%"},{value:12,label:"12%"},{value:13,label:"13%"},{value:13.5,label:"13.5%"},{value:14,label:"14%"},{value:14.5,label:"14.5%"},{value:15,label:"15%"},{value:20,label:"20%"},{value:25,label:"25%"},{value:30,label:"30%"},{value:35,label:"35%"},{value:40,label:"40%"},{value:45,label:"45%"},{value:50,label:"50%"}],DRAW_AMOUNTS:[{value:1e3,label:"$1,000"},{value:1500,label:"$1,500"},{value:2e3,label:"$2,000"},{value:2500,label:"$2,500"},{value:3e3,label:"$3,000"},{value:3500,label:"$3,500"},{value:4e3,label:"$4,000"},{value:5e3,label:"$5,000"}],DRAW_FREQUENCIES:[{value:"weekly",label:"Weekly"},{value:"bi-weekly",label:"Bi-Weekly"},{value:"monthly",label:"Monthly"}],PROVIDER_OPTIONS:[{id:"easycare",name:"EasyCare",commission:10.99},{id:"jm_family",name:"JM Family",commission:8.5},{id:"protective",name:"Protective",commission:12},{id:"cna",name:"CNA",commission:9.5}],UNIT_FLAT_AMOUNTS:[{value:14.5,label:"$14.50"},{value:19.5,label:"$19.50"},{value:25,label:"$25.00"},{value:50,label:"$50.00"},{value:75,label:"$75.00"},{value:100,label:"$100.00"},{value:125,label:"$125.00"},{value:150,label:"$150.00"}],PACK_AMOUNTS:[{value:450,label:"$450"},{value:500,label:"$500"},{value:750,label:"$750"},{value:1e3,label:"$1,000"},{value:5e3,label:"$5,000"},{value:1e4,label:"$10,000"}],PACK_THRESHOLDS:[{value:2e3,label:"$2,000"},{value:5e3,label:"$5,000"},{value:1e4,label:"$10,000"},{value:15e3,label:"$15,000"},{value:2e4,label:"$20,000"}],MINIMUM_GUARANTEES:[{value:3e3,label:"$3,000"},{value:4e3,label:"$4,000"},{value:5e3,label:"$5,000"},{value:6e3,label:"$6,000"},{value:7500,label:"$7,500"},{value:1e4,label:"$10,000"},{value:12500,label:"$12,500"},{value:15e3,label:"$15,000"}]};function Yn({dealershipId:e,isGroupAdmin:s=!1}){const{toast:a}=dt(),[t,r]=he.useState([]),[l,n]=he.useState([]),[i,d]=he.useState([]),[m,x]=he.useState("overview"),[p,g]=he.useState(null),[f,j]=he.useState(!1),[v,b]=he.useState(!1),[N,y]=he.useState({name:"",description:"",role:"finance_manager",plan_type:"simple",is_active:!0,structure:{}}),[w,S]=he.useState(null);he.useEffect(()=>{_(),D(),P()},[e]);const _=()=>h(null,null,function*(){try{r([{id:"fm_advanced_1",name:"John Valentine Finance Plan",description:"Advanced F&I plan with CIT bonuses and penetration tiers",role:"finance_manager",plan_type:"advanced",dealership_id:e,created_by:"admin",created_at:"2024-01-01",updated_at:"2024-01-01",is_active:!0,base_commission:{enabled:!0,base_percentage:25,tiers:[],applies_to:"total_fi_income"},draw_structure:{enabled:!0,amount:4e3,frequency:"monthly",deducted_from_commissions:!0},cit_bonuses:{enabled:!0,cit_30_bonus:{enabled:!0,tiers:[{min_deals:2,bonus_percentage:.5},{min_deals:1,max_deals:1,bonus_percentage:.25},{min_deals:0,max_deals:0,bonus_percentage:0}]},cit_10_bonus:{enabled:!0,tiers:[{min_deals:3,bonus_percentage:.5},{min_deals:1,max_deals:2,bonus_percentage:.25},{min_deals:0,max_deals:0,bonus_percentage:0}]}},penetration_bonuses:[{enabled:!0,name:"Service Contract Penetration",tiers:[{min_percentage:80,bonus_percentage:3.5},{min_percentage:70,max_percentage:79.99,bonus_percentage:3},{min_percentage:60,max_percentage:69.99,bonus_percentage:2.5},{min_percentage:50,max_percentage:59.99,bonus_percentage:2},{min_percentage:40,max_percentage:49.99,bonus_percentage:1.5},{min_percentage:30,max_percentage:39.99,bonus_percentage:1},{min_percentage:0,max_percentage:29.99,bonus_percentage:0}]}],provider_bonuses:[{enabled:!0,provider_name:"EasyCare",commission_percentage:10.99,payment_frequency:"annually",description:"Year-end EasyCare commission"}],vehicle_allowance:{enabled:!0,allowance_amount:300,demo_privileges_available:!0,description:"Monthly vehicle allowance or demo privileges"},pto_structure:{enabled:!0,annual_days:12,prorated:!0,cash_value_per_day:150},chargeback_protection:{enabled:!0,protection_period_days:90}},{id:"fm_simple_1",name:"Lloyd Hatter Finance Plan",description:"Simple PVR-based commission structure",role:"finance_manager",plan_type:"simple",dealership_id:e,created_by:"admin",created_at:"2024-01-01",updated_at:"2024-01-01",is_active:!0,commission_structure:{base_fi_percentage:12,pvr_tiers:[{min_value:999,max_value:999,percentage:12,label:"$999 or below"},{min_value:1e3,max_value:1099,percentage:13,label:"$1,000 to $1,099"},{min_value:1100,max_value:1199,percentage:13.5,label:"$1,100 to $1,199"},{min_value:1200,max_value:1299,percentage:14,label:"$1,200 to $1,299"},{min_value:1300,percentage:14.5,label:"$1,300 or more"}]},monthly_draw:2500,provider_bonuses:[{enabled:!0,provider_name:"EasyCare",commission_percentage:10.99,payment_frequency:"annually",description:"Year-end EasyCare commission"}],vehicle_allowance:{enabled:!0,allowance_amount:300,demo_privileges_available:!0,description:"Monthly vehicle allowance or demo privileges"},pto_structure:{enabled:!0,annual_days:12,prorated:!0}}])}catch(s){console.error("Error fetching pay plans:",s),a({title:"Error",description:"Failed to fetch pay plans",variant:"destructive"})}}),D=()=>h(null,null,function*(){try{n([{id:"u1",first_name:"John",last_name:"Valentine",email:"john.valentine@dealership.com",role:"finance_manager",current_pay_plan:"fm_advanced_1"},{id:"u2",first_name:"Lloyd",last_name:"Hatter",email:"lloyd.hatter@dealership.com",role:"finance_manager",current_pay_plan:"fm_simple_1"}])}catch(e){console.error("Error fetching users:",e)}}),P=()=>h(null,null,function*(){try{d([{id:"a1",user_id:"u1",pay_plan_id:"fm_advanced_1",assigned_by:"admin",assigned_at:"2024-01-01",effective_date:"2024-01-01",is_active:!0},{id:"a2",user_id:"u2",pay_plan_id:"fm_simple_1",assigned_by:"admin",assigned_at:"2024-01-01",effective_date:"2024-01-01",is_active:!0}])}catch(e){console.error("Error fetching assignments:",e)}}),C=()=>{y({name:"",description:"",role:"finance_manager",plan_type:"simple",is_active:!0,structure:{}})};return u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsxs("h2",{className:"text-2xl font-bold tracking-tight flex items-center",children:[u.jsx(Ke,{className:"w-6 h-6 mr-2"}),"Enhanced Pay Plan Management"]}),u.jsx("p",{className:"text-muted-foreground",children:"Create complex compensation plans with multiple tiers and bonuses"})]}),u.jsxs(Bt,{onClick:()=>j(!0),children:[u.jsx(us,{className:"w-4 h-4 mr-2"}),"Create Pay Plan"]})]}),u.jsx(Ut,{className:"border-orange-200 bg-orange-50",children:u.jsxs($t,{className:"pt-6",children:[u.jsxs("div",{className:"flex items-center space-x-2 text-orange-800",children:[u.jsx(_s,{className:"w-5 h-5"}),u.jsx("span",{className:"font-semibold",children:"Security Notice:"})]}),u.jsx("p",{className:"text-orange-700 mt-2 text-sm",children:"Pay plans can only be assigned to users with matching roles. The system prevents accidental assignment of incorrect compensation structures."})]})}),u.jsxs(dn,{value:m,onValueChange:x,children:[u.jsxs(mn,{className:"grid w-full grid-cols-4",children:[u.jsx(hn,{value:"overview",children:"Overview"}),u.jsx(hn,{value:"plans",children:"Pay Plans"}),u.jsx(hn,{value:"assignments",children:"Assignments"}),u.jsx(hn,{value:"calculator",children:"Calculator"})]}),u.jsx(un,{value:"overview",className:"space-y-6",children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Total Pay Plans"}),u.jsx(Ke,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:t.length}),u.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.filter(e=>e.is_active).length," active"]})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Advanced Plans"}),u.jsx(Ds,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:t.filter(e=>"advanced"===e.plan_type).length}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Complex bonus structures"})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Simple Plans"}),u.jsx(rs,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:t.filter(e=>"simple"===e.plan_type).length}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Basic commission structures"})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Assigned Users"}),u.jsx(vs,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:i.filter(e=>e.is_active).length}),u.jsxs("p",{className:"text-xs text-muted-foreground",children:["Out of ",l.length," total users"]})]})]})]})}),u.jsx(un,{value:"plans",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsx(Mt,{children:"All Pay Plans"}),u.jsx(Rt,{children:"Manage compensation structures for different roles"})]}),u.jsx($t,{children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Name"}),u.jsx(tn,{children:"Role"}),u.jsx(tn,{children:"Type"}),u.jsx(tn,{children:"Status"}),u.jsx(tn,{children:"Assigned Users"}),u.jsx(tn,{children:"Actions"})]})}),u.jsx(sn,{children:t.map(e=>{var s;const a=i.filter(s=>s.pay_plan_id===e.id&&s.is_active).length;return u.jsxs(an,{children:[u.jsx(rn,{children:u.jsxs("div",{children:[u.jsx("div",{className:"font-medium",children:e.name}),u.jsx("div",{className:"text-sm text-muted-foreground",children:e.description})]})}),u.jsx(rn,{children:u.jsx(pr,{variant:"outline",children:(null==(s=Jn.ROLES.find(s=>s.id===e.role))?void 0:s.name)||e.role})}),u.jsx(rn,{children:u.jsx(pr,{variant:"advanced"===e.plan_type?"default":"secondary",children:"advanced"===e.plan_type?"Advanced":"Simple"})}),u.jsx(rn,{children:u.jsx(pr,{variant:e.is_active?"default":"secondary",children:e.is_active?"Active":"Inactive"})}),u.jsxs(rn,{children:[a," users"]}),u.jsx(rn,{children:u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Bt,{variant:"outline",size:"sm",children:u.jsx(Ns,{className:"w-4 h-4"})}),u.jsx(Bt,{variant:"outline",size:"sm",children:u.jsx(Ps,{className:"w-4 h-4"})})]})})]},e.id)})})]})})]})}),u.jsx(un,{value:"assignments",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsx(Mt,{children:"Pay Plan Assignments"}),u.jsx(Rt,{children:"Assign pay plans to users (roles must match)"})]}),u.jsx($t,{children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"User"}),u.jsx(tn,{children:"Role"}),u.jsx(tn,{children:"Current Pay Plan"}),u.jsx(tn,{children:"Plan Type"}),u.jsx(tn,{children:"Actions"})]})}),u.jsx(sn,{children:l.map(e=>{const s=i.find(s=>s.user_id===e.id&&s.is_active),r=s?t.find(e=>e.id===s.pay_plan_id):null,m=(x=e.role,t.filter(e=>e.role===x&&e.is_active));var x;return u.jsxs(an,{children:[u.jsx(rn,{children:u.jsxs("div",{children:[u.jsxs("div",{className:"font-medium",children:[e.first_name," ",e.last_name]}),u.jsx("div",{className:"text-sm text-muted-foreground",children:e.email})]})}),u.jsx(rn,{children:u.jsx(pr,{variant:"outline",children:e.role})}),u.jsx(rn,{children:r?u.jsx(pr,{variant:"default",children:r.name}):u.jsx(pr,{variant:"destructive",children:"No Plan Assigned"})}),u.jsx(rn,{children:r&&u.jsx(pr,{variant:"advanced"===r.plan_type?"default":"secondary",children:"advanced"===r.plan_type?"Advanced":"Simple"})}),u.jsx(rn,{children:u.jsxs(ql,{onValueChange:s=>{return r=e.id,m=s,h(null,null,function*(){try{const e=l.find(e=>e.id===r),s=t.find(e=>e.id===m);if(!e||!s)return void a({title:"Error",description:"User or pay plan not found",variant:"destructive"});if(e.role!==s.role)return void a({title:"Role Mismatch Error",description:`Cannot assign ${s.role} pay plan to ${e.role}. Roles must match for security.`,variant:"destructive"});const h={id:`assignment_${Date.now()}`,user_id:r,pay_plan_id:m,assigned_by:"current_user",assigned_at:(new Date).toISOString(),effective_date:(new Date).toISOString(),is_active:!0};d([...i,h]),n(l.map(e=>e.id===r?c(o({},e),{current_pay_plan:m}):e)),a({title:"Success",description:`Pay plan assigned to ${e.first_name} ${e.last_name}`})}catch(e){console.error("Error assigning pay plan:",e),a({title:"Error",description:"Failed to assign pay plan",variant:"destructive"})}});var r,m},children:[u.jsx(Yl,{className:"w-48",children:u.jsx(Jl,{placeholder:"Assign Plan"})}),u.jsx(Zl,{children:m.map(e=>u.jsxs(Ql,{value:e.id,children:[e.name," (",e.plan_type,")"]},e.id))})]})})]},e.id)})})]})})]})}),u.jsx(un,{value:"calculator",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsx(Mt,{children:"Pay Calculator"}),u.jsx(Rt,{children:"Real-time pay calculations based on assigned pay plans"})]}),u.jsx($t,{children:u.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[u.jsx(rs,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),u.jsx("p",{children:"Pay calculator will integrate with deal data"}),u.jsx("p",{className:"text-sm",children:"Enter deal information to calculate real-time estimated pay"})]})})]})})]}),f&&u.jsx("div",{className:"fixed inset-0 z-50 bg-black/80 backdrop-blur",children:u.jsx("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx(Mt,{children:"Create New Pay Plan"}),u.jsx(Rt,{children:"Configure comprehensive compensation structure"})]}),u.jsx(Bt,{variant:"ghost",size:"sm",onClick:()=>j(!1),children:u.jsx(Te,{className:"w-4 h-4"})})]})}),u.jsxs($t,{className:"space-y-6",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"name",children:"Plan Name"}),u.jsx(Vt,{id:"name",value:N.name,onChange:e=>y(c(o({},N),{name:e.target.value})),placeholder:"e.g., Senior Finance Manager Plan"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"role",children:"Role"}),u.jsxs(ql,{value:N.role,onValueChange:e=>y(c(o({},N),{role:e})),children:[u.jsx(Yl,{children:u.jsx(Jl,{})}),u.jsx(Zl,{children:Jn.ROLES.map(e=>u.jsx(Ql,{value:e.id,children:e.name},e.id))})]})]})]}),u.jsx("div",{className:"grid grid-cols-1 gap-4",children:u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"plan_type",children:"Plan Type"}),u.jsxs(ql,{value:N.plan_type,onValueChange:e=>y(c(o({},N),{plan_type:e})),children:[u.jsx(Yl,{children:u.jsx(Jl,{})}),u.jsx(Zl,{children:Jn.PLAN_TYPES.map(e=>u.jsx(Ql,{value:e.id,children:u.jsxs("div",{children:[u.jsx("div",{className:"font-medium",children:e.name}),u.jsx("div",{className:"text-sm text-muted-foreground",children:e.description})]})},e.id))})]})]})}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"description",children:"Description"}),u.jsx(qn,{id:"description",value:N.description,onChange:e=>y(c(o({},N),{description:e.target.value})),placeholder:"Brief description of this pay plan",rows:3})]}),"finance_manager"===N.role||"finance_director"===N.role?u.jsx(Hn,{formData:N,setFormData:y}):"salesperson"===N.role?u.jsx(Kn,{formData:N,setFormData:y}):u.jsx("div",{className:"space-y-4 border-t pt-4",children:u.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[u.jsx(Ds,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),u.jsxs("p",{children:["Configuration form for ",N.role," role is coming soon."]})]})}),u.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[u.jsx(Bt,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),u.jsx(Bt,{onClick:()=>h(null,null,function*(){try{b(!0);const s=(e=>{var s;const a=[];return(null==(s=e.name)?void 0:s.trim())||a.push("Pay plan name is required"),e.role||a.push("Role selection is required"),e.plan_type||a.push("Plan type selection is required"),a})(N);if(s.length>0)return void a({title:"Validation Error",description:s.join(", "),variant:"destructive"});const l=o(c(o({},N),{id:`plan_${Date.now()}`,dealership_id:e,created_by:"current_user",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}),N.structure);r([...t,l]),C(),j(!1),a({title:"Success",description:"Pay plan created successfully"})}catch(s){console.error("Error creating pay plan:",s),a({title:"Error",description:"Failed to create pay plan",variant:"destructive"})}finally{b(!1)}}),disabled:v,children:v?"Creating...":"Create Pay Plan"})]})]})]})})})]})}function Hn({formData:e,setFormData:s}){const[a,t]=he.useState(["basic"]),r=e=>{t(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},l=e=>a.includes(e);return"simple"===e.plan_type?u.jsxs("div",{className:"space-y-4 border-t pt-4",children:[u.jsx("h4",{className:"font-medium",children:"Simple Finance Manager Plan"}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Base F&I Commission %"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select base percentage"})}),u.jsx(Zl,{children:Jn.PERCENTAGE_OPTIONS.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Monthly Draw"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select draw amount"})}),u.jsx(Zl,{children:Jn.DRAW_AMOUNTS.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-3",children:u.jsx(Mt,{className:"text-sm",children:"PVR Commission Tiers"})}),u.jsx($t,{children:u.jsxs("div",{className:"space-y-3",children:[u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(us,{className:"w-4 h-4 mr-2"}),"Add PVR Tier"]}),u.jsx("div",{className:"text-sm text-muted-foreground",children:"Configure commission percentages based on PVR thresholds"})]})})]})]}):u.jsxs("div",{className:"space-y-4 border-t pt-4",children:[u.jsx("h4",{className:"font-medium",children:"Advanced Finance Manager Plan Configuration"}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-3 cursor-pointer",onClick:()=>r("basic"),children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(Mt,{className:"text-sm",children:"Base Commission Structure"}),l("basic")?u.jsx(He,{className:"w-4 h-4"}):u.jsx(Ze,{className:"w-4 h-4"})]})}),l("basic")&&u.jsx($t,{children:u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Base F&I Commission %"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select base percentage"})}),u.jsx(Zl,{children:Jn.PERCENTAGE_OPTIONS.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Applies To"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Commission applies to..."})}),u.jsxs(Zl,{children:[u.jsx(Ql,{value:"total_fi_income",children:"Total F&I Income"}),u.jsx(Ql,{value:"front_end",children:"Front End Only"}),u.jsx(Ql,{value:"back_end",children:"Back End Only"})]})]})]})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-3 cursor-pointer",onClick:()=>r("draw"),children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(Mt,{className:"text-sm",children:"Draw Structure"}),l("draw")?u.jsx(He,{className:"w-4 h-4"}):u.jsx(Ze,{className:"w-4 h-4"})]})}),l("draw")&&u.jsx($t,{children:u.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Draw Amount"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select amount"})}),u.jsx(Zl,{children:Jn.DRAW_AMOUNTS.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Frequency"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select frequency"})}),u.jsx(Zl,{children:Jn.DRAW_FREQUENCIES.map(e=>u.jsx(Ql,{value:e.value,children:e.label},e.value))})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Deducted from Commissions"}),u.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[u.jsx(Wn,{defaultChecked:!0}),u.jsx("span",{className:"text-sm",children:"Yes"})]})]})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-3 cursor-pointer",onClick:()=>r("cit"),children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(Mt,{className:"text-sm",children:"CIT Deal Bonuses"}),l("cit")?u.jsx(He,{className:"w-4 h-4"}):u.jsx(Ze,{className:"w-4 h-4"})]})}),l("cit")&&u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Wn,{}),u.jsx(Jt,{children:"Enable CIT Deal Bonuses"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-3",children:[u.jsx("h5",{className:"font-medium text-sm",children:"30+ CIT Bonus"}),u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(us,{className:"w-4 h-4 mr-2"}),"Add 30+ CIT Tier"]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx("h5",{className:"font-medium text-sm",children:"10+ CIT Bonus"}),u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(us,{className:"w-4 h-4 mr-2"}),"Add 10+ CIT Tier"]})]})]})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-3 cursor-pointer",onClick:()=>r("penetration"),children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(Mt,{className:"text-sm",children:"Penetration Bonuses"}),l("penetration")?u.jsx(He,{className:"w-4 h-4"}):u.jsx(Ze,{className:"w-4 h-4"})]})}),l("penetration")&&u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(us,{className:"w-4 h-4 mr-2"}),"Add Penetration Bonus"]}),u.jsx("div",{className:"text-sm text-muted-foreground",children:"Configure bonuses based on product penetration rates (Service Contracts, GAP, Warranties, etc.)"})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-3 cursor-pointer",onClick:()=>r("providers"),children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(Mt,{className:"text-sm",children:"Provider Bonuses"}),l("providers")?u.jsx(He,{className:"w-4 h-4"}):u.jsx(Ze,{className:"w-4 h-4"})]})}),l("providers")&&u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(us,{className:"w-4 h-4 mr-2"}),"Add Provider Bonus"]}),u.jsx("div",{className:"grid grid-cols-1 gap-3",children:Jn.PROVIDER_OPTIONS.map(e=>u.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[u.jsxs("div",{children:[u.jsx("span",{className:"font-medium",children:e.name}),u.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["(",e.commission,"% default)"]})]}),u.jsx(Wn,{})]},e.id))})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-3 cursor-pointer",onClick:()=>r("benefits"),children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(Mt,{className:"text-sm",children:"Benefits & Allowances"}),l("benefits")?u.jsx(He,{className:"w-4 h-4"}):u.jsx(Ze,{className:"w-4 h-4"})]})}),l("benefits")&&u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Vehicle Allowance"}),u.jsx(Vt,{placeholder:"$300"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Annual PTO Days"}),u.jsx(Vt,{placeholder:"12"})]})]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Wn,{}),u.jsx(Jt,{children:"Demo Vehicle Privileges Available"})]})]})})]})]})}function Kn({formData:e,setFormData:s}){const[a,t]=he.useState(["basic"]),r=e=>{t(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},l=e=>a.includes(e);return"simple"===e.plan_type?u.jsxs("div",{className:"space-y-4 border-t pt-4",children:[u.jsx("h4",{className:"font-medium",children:"Simple Salesperson Plan"}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Front-End Commission %"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select front-end percentage"})}),u.jsx(Zl,{children:Jn.PERCENTAGE_OPTIONS.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Back-End Commission %"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select back-end percentage"})}),u.jsx(Zl,{children:Jn.PERCENTAGE_OPTIONS.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Minimum Monthly Pay"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select minimum guarantee"})}),u.jsx(Zl,{children:Jn.MINIMUM_GUARANTEES.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]})]})]}):u.jsxs("div",{className:"space-y-4 border-t pt-4",children:[u.jsx("h4",{className:"font-medium",children:"Advanced Salesperson Plan Configuration"}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-3 cursor-pointer",onClick:()=>r("frontend"),children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(Mt,{className:"text-sm",children:"Front-End Commission Structure"}),l("frontend")?u.jsx(He,{className:"w-4 h-4"}):u.jsx(Ze,{className:"w-4 h-4"})]})}),l("frontend")&&u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Gross Profit Percentage"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select percentage"})}),u.jsx(Zl,{children:Jn.PERCENTAGE_OPTIONS.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]})]}),u.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[u.jsx(Pn,{id:"take-higher"}),u.jsx(Jt,{htmlFor:"take-higher",className:"text-sm",children:"Take higher of percentage or unit flat"})]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx(Jt,{className:"text-sm font-medium",children:"Unit Flat Rate Tiers"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs font-medium text-muted-foreground",children:[u.jsx("span",{children:"Min Units"}),u.jsx("span",{children:"Max Units"}),u.jsx("span",{children:"Flat Amount"}),u.jsx("span",{children:"Retroactive"})]}),u.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[u.jsx(Vt,{placeholder:"0"}),u.jsx(Vt,{placeholder:"14"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Amount"})}),u.jsx(Zl,{children:Jn.UNIT_FLAT_AMOUNTS.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]}),u.jsx("div",{className:"flex items-center justify-center",children:u.jsx(Pn,{})})]})]}),u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(us,{className:"w-4 h-4 mr-2"}),"Add Tier"]})]})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-3 cursor-pointer",onClick:()=>r("backend"),children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(Mt,{className:"text-sm",children:"Back-End Commission Structure"}),l("backend")?u.jsx(He,{className:"w-4 h-4"}):u.jsx(Ze,{className:"w-4 h-4"})]})}),l("backend")&&u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Base Back-End Percentage"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select base percentage"})}),u.jsx(Zl,{children:Jn.PERCENTAGE_OPTIONS.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx(Jt,{className:"text-sm font-medium",children:"Volume-Based Percentage Tiers"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"grid grid-cols-4 gap-2 text-xs font-medium text-muted-foreground",children:[u.jsx("span",{children:"Min Units"}),u.jsx("span",{children:"Max Units"}),u.jsx("span",{children:"Percentage"}),u.jsx("span",{children:"Retroactive"})]}),u.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[u.jsx(Vt,{placeholder:"0"}),u.jsx(Vt,{placeholder:"14"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"%"})}),u.jsx(Zl,{children:Jn.PERCENTAGE_OPTIONS.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]}),u.jsx("div",{className:"flex items-center justify-center",children:u.jsx(Pn,{})})]})]}),u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(us,{className:"w-4 h-4 mr-2"}),"Add Tier"]})]})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-3 cursor-pointer",onClick:()=>r("pack"),children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(Mt,{className:"text-sm",children:"Used Vehicle Pack Deductions"}),l("pack")?u.jsx(He,{className:"w-4 h-4"}):u.jsx(Ze,{className:"w-4 h-4"})]})}),l("pack")&&u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Pn,{id:"enable-pack"}),u.jsx(Jt,{htmlFor:"enable-pack",children:"Enable used vehicle pack deductions"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"High Value Pack ($10,000)"}),u.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Threshold"})}),u.jsx(Zl,{children:Jn.PACK_THRESHOLDS.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Pack Amount"})}),u.jsx(Zl,{children:Jn.PACK_AMOUNTS.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Low Value Pack ($2,000-$10,000)"}),u.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Min Threshold"})}),u.jsx(Zl,{children:Jn.PACK_THRESHOLDS.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Pack Amount"})}),u.jsx(Zl,{children:Jn.PACK_AMOUNTS.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]})]})]})]})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-3 cursor-pointer",onClick:()=>r("csi"),children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(Mt,{className:"text-sm",children:"CSI Bonus Structure"}),l("csi")?u.jsx(He,{className:"w-4 h-4"}):u.jsx(Ze,{className:"w-4 h-4"})]})}),l("csi")&&u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Pn,{id:"enable-csi"}),u.jsx(Jt,{htmlFor:"enable-csi",children:"Enable CSI benchmark bonus"})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Bonus Percentage"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select bonus %"})}),u.jsx(Zl,{children:Jn.PERCENTAGE_OPTIONS.filter(e=>e.value<=10).map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Description"}),u.jsx(Vt,{placeholder:"e.g., Additional 5% on back-end if CSI above benchmark"})]})]})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-3 cursor-pointer",onClick:()=>r("guarantee"),children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(Mt,{className:"text-sm",children:"Minimum Unit Guarantee"}),l("guarantee")?u.jsx(He,{className:"w-4 h-4"}):u.jsx(Ze,{className:"w-4 h-4"})]})}),l("guarantee")&&u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Pn,{id:"enable-guarantee"}),u.jsx(Jt,{htmlFor:"enable-guarantee",children:"Enable minimum unit guarantees"})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx(Jt,{className:"text-sm font-medium",children:"Guarantee Tiers"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs font-medium text-muted-foreground",children:[u.jsx("span",{children:"Min Units"}),u.jsx("span",{children:"Max Units"}),u.jsx("span",{children:"Guarantee Amount"})]}),u.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[u.jsx(Vt,{placeholder:"15"}),u.jsx(Vt,{placeholder:"19"}),u.jsxs(ql,{children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Amount"})}),u.jsx(Zl,{children:Jn.MINIMUM_GUARANTEES.map(e=>u.jsx(Ql,{value:e.value.toString(),children:e.label},e.value))})]})]})]}),u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(us,{className:"w-4 h-4 mr-2"}),"Add Guarantee Tier"]})]})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-3 cursor-pointer",onClick:()=>r("benefits"),children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(Mt,{className:"text-sm",children:"Benefits & Allowances"}),l("benefits")?u.jsx(He,{className:"w-4 h-4"}):u.jsx(Ze,{className:"w-4 h-4"})]})}),l("benefits")&&u.jsx($t,{children:u.jsx("div",{className:"space-y-4",children:u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Vehicle Allowance"}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Pn,{id:"vehicle-allowance"}),u.jsx(Jt,{htmlFor:"vehicle-allowance",className:"text-sm",children:"Enable"})]}),u.jsx(Vt,{placeholder:"Monthly allowance amount"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"PTO Structure"}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Pn,{id:"pto"}),u.jsx(Jt,{htmlFor:"pto",className:"text-sm",children:"Enable"})]}),u.jsx(Vt,{placeholder:"Annual PTO days"})]})]})})})]})]})}function Zn({payPlans:e}){const[s,a]=he.useState({selectedPayPlanId:"",unitsSold:0,frontEndGrossProfit:0,backEndGrossProfit:0,vehicleType:"new",vehicleValue:0,csiAboveBenchmark:!1}),[t,r]=he.useState(null),l=e.find(e=>e.id===s.selectedPayPlanId),n=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e);return u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(rs,{className:"w-5 h-5 mr-2"}),"Pay Calculator"]}),u.jsx(Rt,{children:"Calculate commission based on selected pay plan and deal details"})]}),u.jsxs($t,{className:"space-y-6",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"payPlan",children:"Select Pay Plan"}),u.jsxs(ql,{value:s.selectedPayPlanId,onValueChange:e=>a(c(o({},s),{selectedPayPlanId:e})),children:[u.jsx(Yl,{id:"payPlan",children:u.jsx(Jl,{placeholder:"Choose a pay plan"})}),u.jsx(Zl,{children:e.filter(e=>"salesperson"===e.role&&e.is_active).map(e=>u.jsx(Ql,{value:e.id,children:u.jsxs("div",{className:"flex flex-col",children:[u.jsx("span",{children:e.name}),u.jsx("span",{className:"text-xs text-muted-foreground",children:e.description})]})},e.id))})]})]}),l&&u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"units",children:"Units Sold"}),u.jsx(Vt,{id:"units",type:"number",min:"0",value:s.unitsSold,onChange:e=>a(c(o({},s),{unitsSold:parseInt(e.target.value)||0})),placeholder:"0"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"frontEnd",children:"Front-End Gross Profit"}),u.jsx(Vt,{id:"frontEnd",type:"number",min:"0",step:"0.01",value:s.frontEndGrossProfit,onChange:e=>a(c(o({},s),{frontEndGrossProfit:parseFloat(e.target.value)||0})),placeholder:"0.00"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"backEnd",children:"Back-End Gross Profit"}),u.jsx(Vt,{id:"backEnd",type:"number",min:"0",step:"0.01",value:s.backEndGrossProfit,onChange:e=>a(c(o({},s),{backEndGrossProfit:parseFloat(e.target.value)||0})),placeholder:"0.00"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"vehicleType",children:"Vehicle Type"}),u.jsxs(ql,{value:s.vehicleType,onValueChange:e=>a(c(o({},s),{vehicleType:e})),children:[u.jsx(Yl,{id:"vehicleType",children:u.jsx(Jl,{})}),u.jsxs(Zl,{children:[u.jsx(Ql,{value:"new",children:"New Vehicle"}),u.jsx(Ql,{value:"used",children:"Used Vehicle"})]})]})]}),"used"===s.vehicleType&&u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"vehicleValue",children:"Vehicle Value"}),u.jsx(Vt,{id:"vehicleValue",type:"number",min:"0",step:"0.01",value:s.vehicleValue,onChange:e=>a(c(o({},s),{vehicleValue:parseFloat(e.target.value)||0})),placeholder:"0.00"})]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Pn,{id:"csi",checked:s.csiAboveBenchmark,onCheckedChange:e=>a(c(o({},s),{csiAboveBenchmark:!!e}))}),u.jsx(Jt,{htmlFor:"csi",children:"CSI Above Benchmark"})]})]}),u.jsxs(Bt,{onClick:()=>{if(l&&"salesperson"===l.role)if("simple"===l.plan_type){const e=l,a=s.frontEndGrossProfit*(e.front_end_gross_percentage/100),t=s.backEndGrossProfit*(e.back_end_gross_percentage/100),n=a+t,i=Math.max(n,e.minimum_monthly_pay||0);r({frontEndCommission:a,backEndCommission:t,csiBonus:0,totalCommission:n,minimumGuarantee:e.minimum_monthly_pay||0,finalPayout:i,packDeduction:0,unitFlatAmount:0,percentageAmount:a,usedHigherAmount:!1})}else{const e=l;let a=0;"used"===s.vehicleType&&e.used_vehicle_pack.enabled&&(s.vehicleValue>=e.used_vehicle_pack.high_value_pack.threshold?a=e.used_vehicle_pack.high_value_pack.pack_amount:s.vehicleValue>=e.used_vehicle_pack.low_value_pack.min_threshold&&s.vehicleValue<e.used_vehicle_pack.low_value_pack.max_threshold&&(a=e.used_vehicle_pack.low_value_pack.pack_amount));const t=(s.frontEndGrossProfit-a)*(e.front_end_commission.gross_percentage/100);let n=0;if(e.front_end_commission.unit_flat_structure.enabled){const a=e.front_end_commission.unit_flat_structure.tiers.reverse().find(e=>s.unitsSold>=e.min_units);a&&(n=a.retroactive?a.flat_amount*s.unitsSold:a.flat_amount)}const i=n>t,o=e.front_end_commission.take_higher?Math.max(t,n):t;let c=e.back_end_commission.base_percentage;if(e.back_end_commission.enabled){const a=e.back_end_commission.tiers.reverse().find(e=>s.unitsSold>=e.min_units);a&&(c=a.percentage)}let d=s.backEndGrossProfit*(c/100),m=0;s.csiAboveBenchmark&&e.csi_bonus.enabled&&e.csi_bonus.benchmark_bonus.enabled&&(m=s.backEndGrossProfit*(e.csi_bonus.benchmark_bonus.bonus_percentage/100),d+=m);const h=o+d;let u=0;if(e.minimum_guarantee.enabled){const a=e.minimum_guarantee.tiers.reverse().find(e=>s.unitsSold>=e.min_units);a&&(u=a.guarantee_amount)}const x=Math.max(h,u);r({frontEndCommission:o,backEndCommission:d-m,csiBonus:m,totalCommission:h,minimumGuarantee:u,finalPayout:x,packDeduction:a,unitFlatAmount:n,percentageAmount:t,usedHigherAmount:i})}},className:"w-full",children:[u.jsx(rs,{className:"w-4 h-4 mr-2"}),"Calculate Commission"]}),t&&u.jsxs("div",{className:"space-y-4 p-4 bg-muted rounded-lg",children:[u.jsxs("h3",{className:"font-semibold flex items-center",children:[u.jsx(qe,{className:"w-4 h-4 mr-2"}),"Calculation Results"]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:["advanced"===l.plan_type&&u.jsx(u.Fragment,{children:u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"Pack Deduction:"}),u.jsxs("span",{className:"text-red-600",children:["-",n(t.packDeduction)]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"Percentage Amount:"}),u.jsx("span",{children:n(t.percentageAmount)})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"Unit Flat Amount:"}),u.jsx("span",{children:n(t.unitFlatAmount)})]}),u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{children:"Used Higher Amount:"}),u.jsx(pr,{variant:t.usedHigherAmount?"default":"secondary",children:t.usedHigherAmount?"Unit Flat":"Percentage"})]})]})}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"Front-End Commission:"}),u.jsx("span",{className:"font-medium",children:n(t.frontEndCommission)})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"Back-End Commission:"}),u.jsx("span",{className:"font-medium",children:n(t.backEndCommission)})]}),t.csiBonus>0&&u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"CSI Bonus:"}),u.jsxs("span",{className:"font-medium text-green-600",children:["+",n(t.csiBonus)]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"Total Commission:"}),u.jsx("span",{className:"font-medium",children:n(t.totalCommission)})]}),t.minimumGuarantee>0&&u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"Minimum Guarantee:"}),u.jsx("span",{className:"font-medium",children:n(t.minimumGuarantee)})]})]})]}),u.jsx("div",{className:"pt-4 border-t",children:u.jsxs("div",{className:"flex justify-between items-center text-lg font-bold",children:[u.jsx("span",{children:"Final Payout:"}),u.jsxs("span",{className:"flex items-center text-green-600",children:[u.jsx(Ke,{className:"w-5 h-5 mr-1"}),n(t.finalPayout)]})]})})]})]})]})]})}const Qn=[{id:"salesperson",name:"Salesperson",category:"sales"},{id:"finance_manager",name:"Finance Manager",category:"finance"},{id:"finance_director",name:"Finance Director",category:"finance"},{id:"sales_manager",name:"Sales Manager",category:"management"},{id:"general_manager",name:"General Manager",category:"management"},{id:"gsm",name:"GSM",category:"management"},{id:"dealership_admin",name:"Dealership Admin",category:"admin"}],Xn=[{id:"employed",name:"Employed",color:"bg-green-100 text-green-800"},{id:"suspended",name:"Suspended",color:"bg-yellow-100 text-yellow-800"},{id:"terminated",name:"Terminated",color:"bg-red-100 text-red-800"}];function ei(){const{user:e}=It(),{toast:s}=dt(),a=pe(),t=localStorage.getItem("directauth_user"),r=t?JSON.parse(t):null,l=e||r,n=(null==l?void 0:l.dealership_id)||(null==l?void 0:l.dealershipId)||null;console.log("[AdminDashboard] Component rendering",{supabaseUser:null==e?void 0:e.email,directUser:null==r?void 0:r.email,currentUser:null==l?void 0:l.email,dealershipId:n});const[i,d]=he.useState([]),[m,x]=he.useState([]),[p,g]=he.useState({salesperson:0,finance_manager:0,sales_manager:0,general_manager:0,gsm:0,total:0}),[f,j]=he.useState("salesperson"),[v,b]=he.useState(null),[N,y]=he.useState(!1),[w,S]=he.useState({firstName:"",lastName:"",email:"",roleId:"salesperson",startDate:"",tempPassword:"",payPlanId:""}),_=()=>{const e=Math.random().toString(36).slice(-8)+Math.random().toString(36).toUpperCase().slice(-4);S(c(o({},w),{tempPassword:e}))};he.useEffect(()=>{console.log("[AdminDashboard] useEffect running - currentUser:",null==l?void 0:l.email),l?D():console.log("[AdminDashboard] No current user, showing dashboard anyway"),w.tempPassword||_()},[l]),he.useEffect(()=>{const e=i.reduce((e,s)=>{const a=s.role||s.role_id;return a in e&&e[a]++,e.total++,e},{salesperson:0,finance_manager:0,sales_manager:0,general_manager:0,gsm:0,total:0});g(e)},[i]);const D=()=>h(null,null,function*(){try{const{data:e,error:a}=yield ta.from("profiles").select("id, email, role, created_at, start_date, first_name, last_name, employment_status").order("created_at",{ascending:!1});if(a)return console.error("Error fetching users:",a),void s({title:"Error",description:"Failed to fetch users",variant:"destructive"});const t=(null==e?void 0:e.map(e=>({id:e.id,first_name:e.first_name||e.email.split("@")[0].split(".")[0]||"User",last_name:e.last_name||e.email.split("@")[0].split(".")[1]||"",email:e.email,role:e.role||"viewer",role_id:e.role||"viewer",employment_status:e.employment_status,created_at:e.created_at,start_date:e.start_date})))||[];d(t),console.log("Fetched users:",t),yield P()}catch(e){console.error("Error fetching users:",e),s({title:"Error",description:"Failed to fetch users",variant:"destructive"})}}),P=()=>h(null,null,function*(){try{const e=[{id:"1",name:"John Valentine Advanced Plan",description:"Advanced F&I plan with complex bonus structures",role:"finance_manager",dealership_id:n||"demo",created_by:"admin",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),is_active:!0,plan_type:"advanced",base_commission:{enabled:!0,base_percentage:25,tiers:[],applies_to:"total_fi_income"},draw_structure:{enabled:!0,amount:2500,frequency:"monthly",deducted_from_commissions:!0},penetration_bonuses:[],provider_bonuses:[],vehicle_allowance:{enabled:!0,allowance_amount:300,demo_privileges_available:!0,description:"$300 vehicle allowance or demo privileges"},pto_structure:{enabled:!0,annual_days:12,prorated:!0},chargeback_protection:{enabled:!0,protection_period_days:90}},{id:"2",name:"Lloyd Hatter Simple Plan",description:"Simple PVR-based F&I plan",role:"finance_manager",dealership_id:n||"demo",created_by:"admin",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),is_active:!0,plan_type:"simple",commission_structure:{base_fi_percentage:12,pvr_tiers:[{min_value:0,max_value:999,percentage:12,label:"$999 or below"},{min_value:1e3,max_value:1199,percentage:13,label:"$1,000 - $1,199"},{min_value:1200,max_value:1299,percentage:14,label:"$1,200 - $1,299"},{min_value:1300,percentage:14.5,label:"$1,300+"}]},monthly_draw:2500,provider_bonuses:[],vehicle_allowance:{enabled:!0,allowance_amount:300,demo_privileges_available:!0,description:"$300 vehicle allowance or demo privileges"},pto_structure:{enabled:!0,annual_days:12,prorated:!0}},{id:"3",name:"Basic Salesperson Plan",description:"Standard salesperson compensation",role:"salesperson",dealership_id:n||"demo",created_by:"admin",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),is_active:!0,plan_type:"simple",front_end_gross_percentage:25,back_end_gross_percentage:10,minimum_monthly_pay:3e3},{id:"4",name:"Advanced Salesperson Plan",description:"Complex salesperson plan with unit flats, pack deductions, and minimum guarantees",role:"salesperson",dealership_id:n||"demo",created_by:"admin",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),is_active:!0,plan_type:"advanced",front_end_commission:{gross_percentage:15,unit_flat_structure:{enabled:!0,tiers:[{min_units:0,max_units:14,flat_amount:14.5,label:"0-14 units: $14.50",retroactive:!0},{min_units:15,max_units:19,flat_amount:19.5,label:"15-19 units: $19.50",retroactive:!0},{min_units:20,flat_amount:25,label:"20+ units: $25.00",retroactive:!0}]},take_higher:!0},back_end_commission:{enabled:!0,base_percentage:10,tiers:[{min_units:0,max_units:14,percentage:10,label:"0-14 units: 10%",retroactive:!0},{min_units:15,max_units:19,percentage:12.5,label:"15-19 units: 12.5%",retroactive:!0},{min_units:20,percentage:15,label:"20+ units: 15%",retroactive:!0}]},used_vehicle_pack:{enabled:!0,high_value_pack:{threshold:1e4,pack_amount:1e4},low_value_pack:{min_threshold:2e3,max_threshold:1e4,pack_amount:450}},csi_bonus:{enabled:!0,benchmark_bonus:{enabled:!0,bonus_percentage:5,description:"Additional 5% on back-end if CSI above benchmark"}},minimum_guarantee:{enabled:!0,tiers:[{min_units:15,max_units:19,guarantee_amount:5e3,label:"15-19 units: $5,000"},{min_units:20,max_units:24,guarantee_amount:7500,label:"20-24 units: $7,500"},{min_units:25,guarantee_amount:1e4,label:"25+ units: $10,000"}]},conditions:{no_prepaid_commission:!0,complete_paperwork_required:!0,trade_payoff_discrepancy_flat:!0,weekly_verification_required:!0},vehicle_allowance:{enabled:!1,allowance_amount:0,demo_privileges_available:!1,description:"No vehicle allowance"},pto_structure:{enabled:!0,annual_days:10,prorated:!0}}];x(e)}catch(e){console.error("Error fetching pay plans:",e),s({title:"Error",description:"Failed to fetch pay plans",variant:"destructive"})}}),C=(e,a)=>h(null,null,function*(){try{const{error:t}=yield ta.from("profiles").update({employment_status:a}).eq("id",e);if(t)throw t;s({title:"Success",description:`Employment status updated to ${a}`}),yield D()}catch(t){console.error("Error updating employment status:",t),s({title:"Error",description:"Failed to update employment status",variant:"destructive"})}}),k=e=>{b(v===e?null:e)},T=e=>i.filter(s=>(s.role||s.role_id)===e).sort((e,s)=>{const a={employed:0,suspended:1,terminated:2},t=e.employment_status||"employed",r=s.employment_status||"employed";return a[t]-a[r]}),F=(e="employed")=>{const s=Xn.find(s=>s.id===e)||Xn[0];return u.jsx(pr,{className:s.color,children:s.name})};return u.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dealership Admin"}),u.jsx("p",{className:"text-muted-foreground",children:"Manage your dealership staff and operations"})]}),u.jsx("div",{className:"flex items-center space-x-2",children:u.jsxs(pr,{variant:"outline",className:"px-3 py-1",children:[u.jsx(ws,{className:"w-4 h-4 mr-1"}),"Admin Dashboard"]})})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Total Salespeople"}),u.jsx(vs,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:p.salesperson}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Active sales staff members"})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Finance Managers"}),u.jsx(rs,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:p.finance_manager}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"F&I department staff"})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Sales Managers"}),u.jsx(Ve,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:p.sales_manager}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Sales management team"})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"GM/GSM"}),u.jsx(Cs,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:p.general_manager+p.gsm}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Executive management"})]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(vs,{className:"w-5 h-5 mr-2"}),"Staff Management"]})}),u.jsx($t,{children:u.jsxs(dn,{value:f,onValueChange:j,className:"w-full",children:[u.jsxs(mn,{className:"grid w-full grid-cols-5",children:[u.jsx(hn,{value:"salesperson",children:"Sales People"}),u.jsx(hn,{value:"finance_manager",children:"Finance Managers"}),u.jsx(hn,{value:"sales_manager",children:"Sales Managers"}),u.jsx(hn,{value:"scheduler",children:"Scheduler"}),u.jsx(hn,{value:"payplans",children:"Pay Plans"})]}),u.jsxs(un,{value:"salesperson",className:"space-y-4",children:[u.jsx("div",{className:"flex items-center justify-between",children:u.jsxs("h3",{className:"text-lg font-semibold",children:["Sales Team (",p.salesperson,")"]})}),u.jsx("div",{className:"border rounded-lg",children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Name"}),u.jsx(tn,{children:"Email"}),u.jsx(tn,{children:"Start Date"}),u.jsx(tn,{children:"Status"}),u.jsx(tn,{className:"w-[100px]",children:"Actions"})]})}),u.jsx(sn,{children:T("salesperson").map(e=>u.jsxs(an,{children:[u.jsxs(rn,{className:"font-medium",children:[e.first_name," ",e.last_name]}),u.jsx(rn,{children:e.email}),u.jsx(rn,{children:e.start_date?new Date(e.start_date).toLocaleDateString():"Not set"}),u.jsx(rn,{children:F(e.employment_status)}),u.jsx(rn,{children:u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsxs(ql,{value:e.employment_status||"employed",onValueChange:s=>C(e.id,s),children:[u.jsx(Yl,{className:"w-32",children:u.jsx(Jl,{})}),u.jsx(Zl,{children:Xn.map(e=>u.jsx(Ql,{value:e.id,children:e.name},e.id))})]}),u.jsx(Bt,{variant:"outline",size:"sm",onClick:()=>k(e.id),children:u.jsx(Ns,{className:"h-4 w-4"})})]})})]},e.id))})]})})]}),u.jsxs(un,{value:"finance_manager",className:"space-y-4",children:[u.jsx("div",{className:"flex items-center justify-between",children:u.jsxs("h3",{className:"text-lg font-semibold",children:["Finance Team (",p.finance_manager,")"]})}),u.jsx("div",{className:"border rounded-lg",children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Name"}),u.jsx(tn,{children:"Email"}),u.jsx(tn,{children:"Start Date"}),u.jsx(tn,{children:"Status"}),u.jsx(tn,{className:"w-[100px]",children:"Actions"})]})}),u.jsx(sn,{children:T("finance_manager").map(e=>u.jsxs(an,{children:[u.jsxs(rn,{className:"font-medium",children:[e.first_name," ",e.last_name]}),u.jsx(rn,{children:e.email}),u.jsx(rn,{children:e.start_date?new Date(e.start_date).toLocaleDateString():"Not set"}),u.jsx(rn,{children:F(e.employment_status)}),u.jsx(rn,{children:u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsxs(ql,{value:e.employment_status||"employed",onValueChange:s=>C(e.id,s),children:[u.jsx(Yl,{className:"w-32",children:u.jsx(Jl,{})}),u.jsx(Zl,{children:Xn.map(e=>u.jsx(Ql,{value:e.id,children:e.name},e.id))})]}),u.jsx(Bt,{variant:"outline",size:"sm",onClick:()=>k(e.id),children:u.jsx(Ns,{className:"h-4 w-4"})})]})})]},e.id))})]})})]}),u.jsxs(un,{value:"sales_manager",className:"space-y-4",children:[u.jsx("div",{className:"flex items-center justify-between",children:u.jsxs("h3",{className:"text-lg font-semibold",children:["Management Team (",p.sales_manager,")"]})}),u.jsx("div",{className:"border rounded-lg",children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Name"}),u.jsx(tn,{children:"Email"}),u.jsx(tn,{children:"Start Date"}),u.jsx(tn,{children:"Status"}),u.jsx(tn,{className:"w-[100px]",children:"Actions"})]})}),u.jsx(sn,{children:T("sales_manager").map(e=>u.jsxs(an,{children:[u.jsxs(rn,{className:"font-medium",children:[e.first_name," ",e.last_name]}),u.jsx(rn,{children:e.email}),u.jsx(rn,{children:e.start_date?new Date(e.start_date).toLocaleDateString():"Not set"}),u.jsx(rn,{children:F(e.employment_status)}),u.jsx(rn,{children:u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsxs(ql,{value:e.employment_status||"employed",onValueChange:s=>C(e.id,s),children:[u.jsx(Yl,{className:"w-32",children:u.jsx(Jl,{})}),u.jsx(Zl,{children:Xn.map(e=>u.jsx(Ql,{value:e.id,children:e.name},e.id))})]}),u.jsx(Bt,{variant:"outline",size:"sm",onClick:()=>k(e.id),children:u.jsx(Ns,{className:"h-4 w-4"})})]})})]},e.id))})]})})]}),u.jsxs(un,{value:"scheduler",className:"space-y-4",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[u.jsx(ze,{className:"w-5 h-5 mr-2"}),"Dealership Schedule & Hours"]}),u.jsxs(Bt,{onClick:()=>{a("/dashboard/sales-manager/schedule")},variant:"outline",className:"flex items-center",children:[u.jsx(Ns,{className:"w-4 h-4 mr-2"}),"Advanced Scheduler"]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(ws,{className:"w-5 h-5 mr-2"}),"Dealership Operating Hours"]}),u.jsx(Rt,{children:"Set the standard operating hours for your dealership. These hours will be used as the base for staff scheduling."})]}),u.jsxs($t,{children:[u.jsx("div",{className:"grid gap-4",children:[{day:"Monday",key:"monday"},{day:"Tuesday",key:"tuesday"},{day:"Wednesday",key:"wednesday"},{day:"Thursday",key:"thursday"},{day:"Friday",key:"friday"},{day:"Saturday",key:"saturday"},{day:"Sunday",key:"sunday"}].map(({day:e,key:s})=>u.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx("div",{className:"w-20 font-medium",children:e}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Vt,{type:"time",defaultValue:"09:00",className:"w-24",placeholder:"Open"}),u.jsx("span",{className:"text-muted-foreground",children:"to"}),u.jsx(Vt,{type:"time",defaultValue:"20:00",className:"w-24",placeholder:"Close"})]})]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Pn,{id:`closed-${s}`}),u.jsx(Jt,{htmlFor:`closed-${s}`,className:"text-sm text-muted-foreground",children:"Closed"})]})]},s))}),u.jsx("div",{className:"flex justify-end mt-4",children:u.jsxs(Bt,{children:[u.jsx(ys,{className:"w-4 h-4 mr-2"}),"Save Hours"]})})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(vs,{className:"w-5 h-5 mr-2"}),"This Week's Schedule"]}),u.jsx(Rt,{children:'Overview of staff schedules for the current week. Click "Advanced Scheduler" above for full editing capabilities.'})]}),u.jsxs($t,{children:[u.jsxs("div",{className:"grid grid-cols-7 gap-2 text-center",children:[["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(e=>u.jsx("div",{className:"font-semibold p-2 bg-muted rounded",children:e},e)),Array.from({length:7},(e,s)=>u.jsx("div",{className:"p-2 border rounded min-h-[100px]",children:u.jsxs("div",{className:"text-xs space-y-1",children:[u.jsx("div",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:"Team A: 9am-6pm"}),u.jsx("div",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs",children:"Team B: 11am-8pm"})]})},s))]}),u.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[u.jsxs("div",{className:"flex items-center text-blue-800",children:[u.jsx(ks,{className:"w-4 h-4 mr-2"}),u.jsx("span",{className:"text-sm font-medium",children:"Schedule Management"})]}),u.jsx("p",{className:"text-sm text-blue-700 mt-1",children:'Sales Managers can edit team schedules from their dashboard. Use the "Advanced Scheduler" button above for detailed schedule management.'})]})]})]})]}),u.jsx(un,{value:"payplans",className:"space-y-4",children:u.jsxs("div",{className:"grid gap-6",children:[u.jsx(Yn,{dealershipId:n||"demo",isGroupAdmin:!1}),u.jsx(Zn,{payPlans:m})]})})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(us,{className:"w-5 h-5 mr-2"}),"Add New Staff Member"]})}),u.jsx($t,{children:u.jsxs("form",{onSubmit:e=>h(null,null,function*(){var a;e.preventDefault(),y(!0);try{const e=w.tempPassword||Math.random().toString(36).slice(-8)+Math.random().toString(36).toUpperCase().slice(-4),{data:t,error:r}=yield ta.auth.signUp({email:w.email,password:e,options:{data:{role:w.roleId||"viewer",dealership_id:n}}});if(r)throw r;const{error:l}=yield ta.from("profiles").upsert({id:null==(a=null==t?void 0:t.user)?void 0:a.id,email:w.email,role:w.roleId||"viewer",dealership_id:n,first_name:w.firstName,last_name:w.lastName,start_date:w.startDate});if(l)throw console.error("Error updating profile:",l),l;s({title:"Success",description:`User created successfully. Temporary password: ${e}`}),S({firstName:"",lastName:"",email:"",roleId:"salesperson",startDate:"",tempPassword:"",payPlanId:""}),_(),yield D()}catch(t){console.error("Error creating user:",t),s({title:"Error",description:t instanceof Error?t.message:"Failed to create user",variant:"destructive"})}finally{y(!1)}}),className:"space-y-4",children:[u.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"firstName",children:"First Name"}),u.jsx(Vt,{id:"firstName",value:w.firstName,onChange:e=>S(c(o({},w),{firstName:e.target.value})),placeholder:"John",required:!0})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"lastName",children:"Last Name"}),u.jsx(Vt,{id:"lastName",value:w.lastName,onChange:e=>S(c(o({},w),{lastName:e.target.value})),placeholder:"Doe",required:!0})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"email",children:"Email Address"}),u.jsx(Vt,{id:"email",type:"email",value:w.email,onChange:e=>S(c(o({},w),{email:e.target.value})),placeholder:"john.doe@dealership.com",required:!0})]}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"role",children:"Role"}),u.jsxs(ql,{value:w.roleId,onValueChange:e=>S(c(o({},w),{roleId:e})),children:[u.jsx(Yl,{id:"role",children:u.jsx(Jl,{placeholder:"Select a role"})}),u.jsx(Zl,{children:Qn.map(e=>u.jsx(Ql,{value:e.id,children:e.name},e.id))})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"startDate",children:"Start Date"}),u.jsx(Vt,{id:"startDate",type:"date",value:w.startDate,onChange:e=>S(c(o({},w),{startDate:e.target.value})),required:!0})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"tempPassword",children:"Temporary Password"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx(Vt,{id:"tempPassword",type:"text",value:w.tempPassword,onChange:e=>S(c(o({},w),{tempPassword:e.target.value})),placeholder:"Auto-generated password",required:!0}),u.jsx(Bt,{type:"button",variant:"outline",onClick:_,className:"shrink-0",children:"Generate"})]}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"User will be required to change their password on first login."})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"payPlan",children:"Pay Plan"}),u.jsxs(ql,{value:w.payPlanId,onValueChange:e=>S(c(o({},w),{payPlanId:e})),children:[u.jsx(Yl,{id:"payPlan",children:u.jsx(Jl,{placeholder:"Select a pay plan"})}),u.jsxs(Zl,{children:[m.filter(e=>e.role===w.roleId&&e.is_active).map(e=>u.jsx(Ql,{value:e.id,children:u.jsxs("div",{className:"flex flex-col",children:[u.jsx("span",{children:e.name}),u.jsx("span",{className:"text-xs text-muted-foreground",children:e.description})]})},e.id)),0===m.filter(e=>e.role===w.roleId&&e.is_active).length&&u.jsx(Ql,{value:"no-plans",disabled:!0,children:"No active pay plans for this role"})]})]}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Pay plan determines the compensation structure for this employee. You can create new pay plans in the Pay Plans tab above."})]}),u.jsxs(Bt,{type:"submit",disabled:N,className:"w-full",children:[N?u.jsx(Ge,{className:"mr-2 h-4 w-4 animate-spin"}):u.jsx(us,{className:"mr-2 h-4 w-4"}),"Add Staff Member"]})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(Ss,{className:"w-5 h-5 mr-2"}),"Team Overview"]})}),u.jsx($t,{children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"space-y-3",children:[u.jsx("h4",{className:"font-semibold text-sm text-muted-foreground uppercase tracking-wide",children:"Sales Team"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{children:"Salespeople"}),u.jsx(pr,{variant:"outline",children:p.salesperson})]}),u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{children:"Sales Managers"}),u.jsx(pr,{variant:"outline",children:p.sales_manager})]})]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx("h4",{className:"font-semibold text-sm text-muted-foreground uppercase tracking-wide",children:"Finance Team"}),u.jsx("div",{className:"space-y-2",children:u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{children:"Finance Managers"}),u.jsx(pr,{variant:"outline",children:p.finance_manager})]})})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx("h4",{className:"font-semibold text-sm text-muted-foreground uppercase tracking-wide",children:"Executive Team"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{children:"General Managers"}),u.jsx(pr,{variant:"outline",children:p.general_manager})]}),u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{children:"GSM"}),u.jsx(pr,{variant:"outline",children:p.gsm})]})]})]})]})})]})]})}function si(){const{user:e}=It();return console.log("[AdminDashboardPage] Rendering with user:",null==e?void 0:e.email),u.jsx(Zt,{title:"Admin Dashboard",children:u.jsx(ei,{})})}const ai=["Ally Bank","American Credit Acceptance","Americredit","Bank of America","Capital One","Chase","Chrysler Capital","Crescent Bank","Exeter","First Help Financial","Ford Motor Credit","Global Lending Services","Huntington National Bank","Hyundai Financial","Navy Federal","Other","PNC Bank","Prestige Financial Services","Regional Acceptance","Santander","Stellantis","TD Auto","Tesla","Toyota Credit","Truist","US Bank","USAA","Wells Fargo","Westlake Financial Services"],ti=["Finance","Lease","Cash"],ri=["Pending","Funded","Unwound","Dead Deal"],li=[{value:"N",label:"New"},{value:"U",label:"Used"},{value:"C",label:"CPO"}],ni=[{id:1,initials:"JD",firstName:"John",lastName:"Doe"},{id:2,initials:"TS",firstName:"Thomas",lastName:"Smith"},{id:3,initials:"MR",firstName:"Maria",lastName:"Rodriguez"},{id:4,initials:"AK",firstName:"Anna",lastName:"Kim"},{id:5,initials:"BH",firstName:"Brandon",lastName:"Harris"}],ii=({dashboardType:e="finance"})=>{const s=pe(),[a,t]=he.useState({dealNumber:"",stockNumber:"",vinLast8:"",vehicleType:"N",lastName:"",dealType:"",frontEndGross:"",vscProfit:"",ppmProfit:"",gapProfit:"",tireAndWheelProfit:"",appearanceProfit:"",otherProfit:"",reserveFlat:"",backEndGross:"",totalGross:"",lender:"",salespersonId:"",salesManagerId:"",isSplitDeal:!1,secondSalespersonId:"",dealStatus:"Pending",outsideFunding:!1,dealDate:(new Date).toISOString().split("T")[0]}),r=e=>{const{name:s,value:a,type:r}=e.target;t("checkbox"!==r?"stockNumber"!==s&&"vinLast8"!==s?"dealType"===s&&"Cash"===a?e=>c(o({},e),{[s]:a,lender:""}):e=>c(o({},e),{[s]:a}):e=>c(o({},e),{[s]:a.toUpperCase()}):a=>c(o({},a),{[s]:e.target.checked}))};return he.useEffect(()=>{const e=()=>((parseFloat(a.vscProfit)||0)+(parseFloat(a.ppmProfit)||0)+(parseFloat(a.gapProfit)||0)+(parseFloat(a.tireAndWheelProfit)||0)+(parseFloat(a.appearanceProfit)||0)+(parseFloat(a.otherProfit)||0)+(parseFloat(a.reserveFlat)||0)).toFixed(2);t(s=>c(o({},s),{backEndGross:e(),totalGross:((parseFloat(a.frontEndGross)||0)+(parseFloat(e())||0)).toFixed(2)}))},[a.vscProfit,a.ppmProfit,a.gapProfit,a.tireAndWheelProfit,a.appearanceProfit,a.otherProfit,a.reserveFlat,a.frontEndGross]),u.jsxs("div",{className:"container mx-auto py-6",children:[u.jsx("div",{className:"flex justify-between items-center mb-6",children:u.jsxs("div",{className:"flex items-center",children:[u.jsxs("button",{type:"button",onClick:()=>{s("single-finance"===e?"/dashboard/single-finance":"/dashboard/finance")},className:"mr-4 flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[u.jsx(cs,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),u.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Log New Deal"})]})}),u.jsxs("form",{onSubmit:t=>{t.preventDefault(),console.log("Form submitted:",a);const r=`D${Math.floor(1e3+9e3*Math.random())}`,l=a.dealDate||(new Date).toISOString().split("T")[0],n=ni.find(e=>e.id.toString()===a.salespersonId),i=n?n.initials:"";let o="";if(a.isSplitDeal&&a.secondSalespersonId){const e=ni.find(e=>e.id.toString()===a.secondSalespersonId);o=e?e.initials:""}const c=a.isSplitDeal&&o?`${i}/${o} (Split)`:i,d=parseFloat(a.backEndGross)||0;parseFloat(a.frontEndGross);const m=parseFloat(a.totalGross)||0,h=[];parseFloat(a.vscProfit)>0&&h.push("Extended Warranty"),parseFloat(a.gapProfit)>0&&h.push("GAP Insurance"),parseFloat(a.appearanceProfit)>0&&h.push("Paint and Fabric Protection"),parseFloat(a.tireAndWheelProfit)>0&&h.push("Tire & Wheel"),parseFloat(a.ppmProfit)>0&&h.push("PPM"),parseFloat(a.otherProfit)>0&&h.push("Other");const u={id:r,dealNumber:a.dealNumber||r,stockNumber:a.stockNumber,vinLast8:a.vinLast8,vehicleType:a.vehicleType,lastName:a.lastName,dealType:a.dealType,frontEndGross:parseFloat(a.frontEndGross)||0,vscProfit:parseFloat(a.vscProfit)||0,ppmProfit:parseFloat(a.ppmProfit)||0,gapProfit:parseFloat(a.gapProfit)||0,tireAndWheelProfit:parseFloat(a.tireAndWheelProfit)||0,appearanceProfit:parseFloat(a.appearanceProfit)||0,otherProfit:parseFloat(a.otherProfit)||0,reserveFlat:parseFloat(a.reserveFlat)||0,backEndGross:parseFloat(a.backEndGross)||0,totalGross:parseFloat(a.totalGross)||0,lender:a.lender,salespersonId:a.salespersonId,salesManagerId:a.salesManagerId,isSplitDeal:a.isSplitDeal,secondSalespersonId:a.isSplitDeal?a.secondSalespersonId:null,dealStatus:a.dealStatus,outsideFunding:a.outsideFunding,dealDate:l,salesperson:c,products:h,created_at:(new Date).toISOString(),customer:a.lastName,vehicle:`${"N"===a.vehicleType?"New":"U"===a.vehicleType?"Used":"CPO"} - Stock #${a.stockNumber}`,vin:a.vinLast8,saleDate:l,amount:m,status:a.dealStatus,profit:d},x="single-finance"===e?"singleFinanceDeals":"financeDeals";try{const a=localStorage.getItem(x),t=[u,...a?JSON.parse(a):[]];localStorage.setItem(x,JSON.stringify(t)),alert(`Deal ${r} successfully logged!`),s("single-finance"===e?"/dashboard/single-finance":"/dashboard/finance")}catch(p){console.error("Error saving deal to localStorage:",p),alert("Failed to save deal. Please try again.")}},children:[u.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[u.jsxs("div",{className:"bg-blue-50 border-b border-blue-100 px-6 py-4 rounded-t-lg flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx(js,{className:"h-5 w-5 text-blue-500 mr-2"}),u.jsx("h2",{className:"text-lg font-semibold text-blue-700",children:"Deal Information"})]}),u.jsx("button",{type:"submit",className:"bg-green-600 hover:bg-green-700 border border-transparent rounded-md shadow-sm py-2 px-6 text-base font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",children:"Log Deal"})]}),u.jsxs("div",{className:"p-6",children:[u.jsxs("div",{className:"grid grid-cols-12 gap-4 mb-6",children:[u.jsxs("div",{className:"col-span-2",children:[u.jsxs("label",{htmlFor:"dealNumber",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(Ts,{className:"h-4 w-4 mr-2 text-gray-500"}),"Deal #"]}),u.jsx("input",{type:"text",id:"dealNumber",name:"dealNumber",value:a.dealNumber,onChange:r,maxLength:8,className:"w-full h-10 px-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base"})]}),u.jsxs("div",{className:"col-span-2",children:[u.jsxs("label",{htmlFor:"dealDate",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(Oe,{className:"h-4 w-4 mr-2 text-gray-500"}),"Deal Date"]}),u.jsx("input",{type:"date",id:"dealDate",name:"dealDate",value:a.dealDate||(new Date).toISOString().split("T")[0],onChange:r,className:"w-full h-10 px-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base"})]}),u.jsxs("div",{className:"col-span-2",children:[u.jsxs("label",{htmlFor:"stockNumber",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(Ts,{className:"h-4 w-4 mr-2 text-gray-500"}),"Stock #"]}),u.jsx("input",{type:"text",id:"stockNumber",name:"stockNumber",value:a.stockNumber,onChange:r,required:!0,maxLength:8,className:"w-full h-10 px-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base"})]}),u.jsxs("div",{className:"col-span-2",children:[u.jsxs("label",{htmlFor:"vinLast8",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(js,{className:"h-4 w-4 mr-2 text-gray-500"}),"Last 8 of VIN"]}),u.jsx("input",{type:"text",id:"vinLast8",name:"vinLast8",value:a.vinLast8,onChange:r,required:!0,maxLength:8,className:"w-full h-10 px-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base"})]}),u.jsxs("div",{className:"col-span-2",children:[u.jsxs("label",{htmlFor:"vehicleType",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(js,{className:"h-4 w-4 mr-2 text-gray-500"}),"Vehicle Type"]}),u.jsx("select",{id:"vehicleType",name:"vehicleType",value:a.vehicleType,onChange:r,required:!0,className:"w-full h-10 px-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base",children:li.map(e=>u.jsx("option",{value:e.value,children:e.label},e.value))})]}),u.jsxs("div",{className:"col-span-2",children:[u.jsxs("label",{htmlFor:"dealType",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(Fs,{className:"h-4 w-4 mr-2 text-gray-500"}),"Deal Type"]}),u.jsxs("select",{id:"dealType",name:"dealType",value:a.dealType,onChange:r,required:!0,className:"w-full h-10 px-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base",children:[u.jsx("option",{value:"",children:"Select"}),ti.map(e=>u.jsx("option",{value:e,children:e},e))]})]})]}),u.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[u.jsxs("div",{className:"col-span-3",children:[u.jsxs("label",{htmlFor:"lastName",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(Re,{className:"h-4 w-4 mr-2 text-gray-500"}),"Last Name"]}),u.jsx("input",{type:"text",id:"lastName",name:"lastName",value:a.lastName,onChange:r,required:!0,className:"w-full h-10 px-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base"})]}),u.jsxs("div",{className:"col-span-2",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsxs("label",{htmlFor:"salespersonId",className:"flex items-center text-base font-bold text-gray-700",children:[u.jsx(Re,{className:"h-4 w-4 mr-2 text-gray-500"}),"Salesperson"]}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",id:"isSplitDeal",name:"isSplitDeal",checked:a.isSplitDeal,onChange:r,className:"h-3 w-3 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),u.jsx("label",{htmlFor:"isSplitDeal",className:"ml-1 text-xs text-gray-500",children:"Split Deal"})]})]}),a.isSplitDeal?u.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.jsxs("select",{id:"salespersonId",name:"salespersonId",value:a.salespersonId,onChange:r,required:!0,className:"w-full h-10 px-2 text-sm rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[u.jsx("option",{value:"",children:"Select Primary"}),ni.map(e=>u.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]}),u.jsxs("select",{id:"secondSalespersonId",name:"secondSalespersonId",value:a.secondSalespersonId,onChange:r,required:a.isSplitDeal,className:"w-full h-10 px-2 text-sm rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[u.jsx("option",{value:"",children:"Select Secondary"}),ni.filter(e=>e.id.toString()!==a.salespersonId).map(e=>u.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}):u.jsx(u.Fragment,{children:u.jsxs("select",{id:"salespersonId",name:"salespersonId",value:a.salespersonId,onChange:r,required:!0,className:"w-full h-10 px-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base",children:[u.jsx("option",{value:"",children:"Select"}),ni.map(e=>u.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})}),(a.salespersonId||a.isSplitDeal&&a.secondSalespersonId)&&u.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Will display as: ",(()=>{if(!a.salespersonId)return"";const e=ni.find(e=>e.id.toString()===a.salespersonId),s=e?e.initials:"";if(a.isSplitDeal&&a.secondSalespersonId){const e=ni.find(e=>e.id.toString()===a.secondSalespersonId),t=e?e.initials:"";return t?`${s}/${t} (Split)`:s}return s})()]})]}),u.jsxs("div",{className:"col-span-3",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsxs("label",{htmlFor:"lender",className:"flex items-center text-base font-bold text-gray-700",children:[u.jsx(ls,{className:"h-4 w-4 mr-2 text-gray-500"}),"Lender"]}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",id:"outsideFunding",name:"outsideFunding",checked:a.outsideFunding,onChange:r,className:"h-3 w-3 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),u.jsx("label",{htmlFor:"outsideFunding",className:"ml-1 text-xs text-gray-500",children:"Outside Funding"})]})]}),u.jsxs("select",{id:"lender",name:"lender",value:a.lender,onChange:r,required:"Finance"===a.dealType||"Lease"===a.dealType,disabled:"Cash"===a.dealType,className:"w-full h-10 px-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base "+("Cash"===a.dealType?"bg-gray-100":""),children:[u.jsx("option",{value:"",children:"Select Lender"}),ai.map(e=>u.jsx("option",{value:e,children:e},e))]})]}),u.jsxs("div",{className:"col-span-2",children:[u.jsxs("label",{htmlFor:"dealStatus",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(Ee,{className:"h-4 w-4 mr-2 text-gray-500"}),"Deal Status"]}),u.jsx("select",{id:"dealStatus",name:"dealStatus",value:a.dealStatus,onChange:r,required:!0,className:"w-full h-10 px-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base",children:ri.map(e=>u.jsx("option",{value:e,children:e},e))})]}),u.jsxs("div",{className:"col-span-2",children:[u.jsxs("label",{htmlFor:"salesManagerId",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(vs,{className:"h-4 w-4 mr-2 text-gray-500"}),"Sales Manager"]}),u.jsxs("select",{id:"salesManagerId",name:"salesManagerId",onChange:r,className:"w-full h-10 px-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base",children:[u.jsx("option",{value:"",children:"Select"}),ni.map(e=>u.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]})]})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsx("div",{children:u.jsxs("div",{className:"bg-white rounded-lg shadow h-full",children:[u.jsxs("div",{className:"bg-purple-50 border-b border-purple-100 px-6 py-4 rounded-t-lg flex items-center",children:[u.jsx(As,{className:"h-5 w-5 text-purple-500 mr-2"}),u.jsx("h2",{className:"text-lg font-semibold text-purple-700",children:"Product Profits"})]}),u.jsxs("div",{className:"p-6 grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsxs("label",{htmlFor:"vscProfit",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(_s,{className:"h-4 w-4 mr-2 text-red-500"}),"VSC Profit"]}),u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:u.jsx("span",{className:"text-gray-500 text-lg",children:"$"})}),u.jsx("input",{type:"text",id:"vscProfit",name:"vscProfit",value:a.vscProfit,onChange:r,placeholder:"0.00",className:"w-full h-10 pl-8 pr-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base"})]})]}),u.jsxs("div",{children:[u.jsxs("label",{htmlFor:"ppmProfit",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(Oe,{className:"h-4 w-4 mr-2 text-amber-500"}),"PPM Profit"]}),u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:u.jsx("span",{className:"text-gray-500 text-lg",children:"$"})}),u.jsx("input",{type:"text",id:"ppmProfit",name:"ppmProfit",value:a.ppmProfit,onChange:r,placeholder:"0.00",className:"w-full h-10 pl-8 pr-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base"})]})]}),u.jsxs("div",{children:[u.jsxs("label",{htmlFor:"gapProfit",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(Es,{className:"h-4 w-4 mr-2 text-cyan-500"}),"GAP Profit"]}),u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:u.jsx("span",{className:"text-gray-500 text-lg",children:"$"})}),u.jsx("input",{type:"text",id:"gapProfit",name:"gapProfit",value:a.gapProfit,onChange:r,placeholder:"0.00",className:"w-full h-10 pl-8 pr-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base"})]})]}),u.jsxs("div",{children:[u.jsxs("label",{htmlFor:"tireAndWheelProfit",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(Is,{className:"h-4 w-4 mr-2 text-yellow-500"}),"T&W/Bundle Profit"]}),u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:u.jsx("span",{className:"text-gray-500 text-lg",children:"$"})}),u.jsx("input",{type:"text",id:"tireAndWheelProfit",name:"tireAndWheelProfit",value:a.tireAndWheelProfit,onChange:r,placeholder:"0.00",className:"w-full h-10 pl-8 pr-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base"})]})]}),u.jsxs("div",{children:[u.jsxs("label",{htmlFor:"appearanceProfit",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(As,{className:"h-4 w-4 mr-2 text-emerald-500"}),"Paint and Fabric Profit"]}),u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:u.jsx("span",{className:"text-gray-500 text-lg",children:"$"})}),u.jsx("input",{type:"text",id:"appearanceProfit",name:"appearanceProfit",value:a.appearanceProfit,onChange:r,placeholder:"0.00",className:"w-full h-10 pl-8 pr-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base"})]})]}),u.jsxs("div",{children:[u.jsxs("label",{htmlFor:"otherProfit",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(As,{className:"h-4 w-4 mr-2 text-gray-500"}),"Other Profit"]}),u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:u.jsx("span",{className:"text-gray-500 text-lg",children:"$"})}),u.jsx("input",{type:"text",id:"otherProfit",name:"otherProfit",value:a.otherProfit,onChange:r,placeholder:"0.00",className:"w-full h-10 pl-8 pr-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base"})]})]})]})]})}),u.jsx("div",{children:u.jsxs("div",{className:"bg-white rounded-lg shadow h-full",children:[u.jsxs("div",{className:"bg-green-50 border-b border-green-100 px-6 py-4 rounded-t-lg flex items-center",children:[u.jsx(Ke,{className:"h-5 w-5 text-green-500 mr-2"}),u.jsx("h2",{className:"text-lg font-semibold text-green-700",children:"Deal Profit"})]}),u.jsxs("div",{className:"p-6 space-y-4",children:[u.jsxs("div",{children:[u.jsxs("label",{htmlFor:"frontEndGross",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(qe,{className:"h-4 w-4 mr-2 text-blue-500"}),"Front End Profit"]}),u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:u.jsx("span",{className:"text-gray-500 text-lg",children:"$"})}),u.jsx("input",{type:"text",id:"frontEndGross",name:"frontEndGross",value:a.frontEndGross,onChange:r,placeholder:"0.00",className:"w-full h-10 pl-8 pr-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base"})]})]}),u.jsxs("div",{children:[u.jsxs("label",{htmlFor:"reserveFlat",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(is,{className:"h-4 w-4 mr-2 text-orange-500"}),"Reserve/Flat Amount"]}),u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:u.jsx("span",{className:"text-gray-500 text-lg",children:"$"})}),u.jsx("input",{type:"text",id:"reserveFlat",name:"reserveFlat",value:a.reserveFlat,onChange:r,placeholder:"0.00",className:"w-full h-10 pl-8 pr-4 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-base"})]})]}),u.jsxs("div",{className:"pt-6 border-t border-gray-200",children:[u.jsxs("label",{htmlFor:"backEndGross",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(Us,{className:"h-4 w-4 mr-2 text-indigo-500"}),"Back End Gross (Auto-calculated)"]}),u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:u.jsx("span",{className:"text-gray-500 text-lg",children:"$"})}),u.jsx("input",{type:"text",id:"backEndGross",name:"backEndGross",value:a.backEndGross,readOnly:!0,className:"w-full h-10 pl-8 pr-4 rounded-md border border-gray-200 bg-gray-50 shadow-sm text-base font-semibold"})]})]}),u.jsxs("div",{children:[u.jsxs("label",{htmlFor:"totalGross",className:"flex items-center text-base font-bold text-gray-700 mb-2",children:[u.jsx(Ke,{className:"h-4 w-4 mr-2 text-green-500"}),"Total Gross (Auto-calculated)"]}),u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:u.jsx("span",{className:"text-gray-500 text-lg",children:"$"})}),u.jsx("input",{type:"text",id:"totalGross",name:"totalGross",value:a.totalGross,readOnly:!0,className:"w-full h-10 pl-8 pr-4 rounded-md border border-gray-200 bg-gray-50 shadow-sm text-base font-semibold"})]})]})]})]})})]})]})]})},oi=()=>{var e;const{user:s,role:a,dealershipId:t}=It(),{toast:r}=dt();xe(),pe();const[l,n]=he.useState("overview"),[i,o]=he.useState("all"),[c,d]=he.useState(!0),[m,h]=he.useState("this-month"),[x,p]=he.useState({total_dealerships:5,active_dealerships:5,total_gross_profit:245e4,total_units:1247,district_front_pvr:2850,district_back_pvr:1420,goal_achievement:87.5,top_performer:"Downtown Toyota",mtd_growth:15.2}),[g,f]=he.useState([{id:"deal1",name:"Downtown Toyota",location:"Downtown District",general_manager:"Michael Johnson",phone:"(555) 123-4567",email:"mjohnson@downtowntoyota.com",status:"active",monthly_goal:250,ytd_units:2847,mtd_units:247,front_gross:485e3,back_gross:245e3,total_gross:73e4,new_units:147,used_units:85,cpo_units:15,front_pvr:2950,back_pvr:1485,performance_rating:"excellent"},{id:"deal2",name:"Westside Honda",location:"West District",general_manager:"Sarah Williams",phone:"(555) 234-5678",email:"swilliams@westsidehonda.com",status:"active",monthly_goal:200,ytd_units:2156,mtd_units:189,front_gross:378e3,back_gross:189e3,total_gross:567e3,new_units:112,used_units:65,cpo_units:12,front_pvr:2750,back_pvr:1350,performance_rating:"good"},{id:"deal3",name:"Northside Ford",location:"North District",general_manager:"David Chen",phone:"(555) 345-6789",email:"dchen@northsideford.com",status:"active",monthly_goal:180,ytd_units:1987,mtd_units:165,front_gross:342e3,back_gross:171e3,total_gross:513e3,new_units:98,used_units:55,cpo_units:12,front_pvr:2650,back_pvr:1285,performance_rating:"good"},{id:"deal4",name:"Southside Chevrolet",location:"South District",general_manager:"Lisa Rodriguez",phone:"(555) 456-7890",email:"lrodriguez@southsidechevy.com",status:"active",monthly_goal:220,ytd_units:2398,mtd_units:198,front_gross:425e3,back_gross:212e3,total_gross:637e3,new_units:118,used_units:68,cpo_units:12,front_pvr:2800,back_pvr:1395,performance_rating:"excellent"},{id:"deal5",name:"Eastside Nissan",location:"East District",general_manager:"Robert Taylor",phone:"(555) 567-8901",email:"rtaylor@eastsidenissan.com",status:"active",monthly_goal:160,ytd_units:1756,mtd_units:148,front_gross:298e3,back_gross:149e3,total_gross:447e3,new_units:88,used_units:48,cpo_units:12,front_pvr:2550,back_pvr:1245,performance_rating:"needs_improvement"}]),[j,v]=he.useState([{id:"tm1",name:"John Smith",role:"salesperson",dealership:"Downtown Toyota",deals_processed:28,revenue:84e3,performance_rating:"excellent",schedule:"9am - 6pm",goals:{monthly_deals:30,current_deals:28,monthly_revenue:9e4,current_revenue:84e3}},{id:"tm2",name:"Jane Valentine",role:"finance_manager",dealership:"Downtown Toyota",deals_processed:32,revenue:45e3,performance_rating:"excellent",schedule:"9am - 6pm",goals:{monthly_deals:35,current_deals:32,monthly_revenue:5e4,current_revenue:45e3}}]),b=e=>{const s=new Date,a=s.toLocaleString("default",{month:"long"}),t=s.getFullYear();switch(e){case"this-month":default:return`${a} ${t}`;case"last-month":return`${0===s.getMonth()?"December":new Date(s.getFullYear(),s.getMonth()-1,1).toLocaleString("default",{month:"long"})} ${0===s.getMonth()?s.getFullYear()-1:s.getFullYear()}`;case"last-quarter":const e=Math.floor(s.getMonth()/3);return`Q${0===e?4:e} ${0===e?t-1:t}`;case"ytd":return`Year to Date ${t}`;case"last-year":return""+(t-1)}},N=e=>{switch(e){case"excellent":return u.jsx(pr,{className:"bg-green-100 text-green-800",children:"Excellent"});case"good":return u.jsx(pr,{className:"bg-blue-100 text-blue-800",children:"Good"});case"needs_improvement":return u.jsx(pr,{className:"bg-yellow-100 text-yellow-800",children:"Needs Improvement"});default:return u.jsx(pr,{variant:"secondary",children:"Unknown"})}},y=(e,s)=>{const a=Math.min(e/s*100,100);return u.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:u.jsx("div",{className:"h-2 rounded-full "+(a>=90?"bg-green-500":a>=70?"bg-yellow-500":"bg-red-500"),style:{width:`${a}%`}})})};return u.jsxs("div",{className:"container py-4",children:[u.jsx("div",{className:"flex justify-between items-start mb-6",children:u.jsx("div",{className:"flex-grow",children:u.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-2",children:[u.jsxs("div",{children:[u.jsxs("h1",{className:"text-3xl font-bold flex items-center",children:[u.jsx(Me,{className:"w-8 h-8 mr-3 text-blue-600"}),"Area Vice President Dashboard"]}),u.jsxs("p",{className:"text-gray-600 mt-1",children:["AVP: ",(null==(e=null==s?void 0:s.email)?void 0:e.split("@")[0])||"Not Assigned"," | District Overview"]})]}),u.jsx("div",{className:"bg-blue-50 p-2 rounded-md mt-2 md:mt-0 border border-blue-100 max-w-2xl",children:u.jsxs("p",{className:"text-xs italic text-blue-800",children:[u.jsx(Je,{className:"h-3 w-3 inline-block mr-1"}),u.jsx("strong",{children:"Leadership Tip:"})," Focus on developing your General Managers - their success drives district performance."]})})]})})}),u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx("h2",{className:"text-2xl font-bold mr-3",children:b(m)}),u.jsxs("select",{value:m,onChange:e=>h(e.target.value),className:"p-2 border rounded-md shadow-sm",children:[u.jsx("option",{value:"this-month",children:"This Month"}),u.jsx("option",{value:"last-month",children:"Last Month"}),u.jsx("option",{value:"last-quarter",children:"Last Quarter"}),u.jsx("option",{value:"ytd",children:"Year to Date"}),u.jsx("option",{value:"last-year",children:"Last Year"})]})]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(Gs,{className:"mr-2 h-4 w-4"}),"Set Goals"]}),u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Schedules"]}),u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(Ss,{className:"mr-2 h-4 w-4"}),"Reports"]})]})]}),u.jsxs(dn,{value:l,onValueChange:n,className:"space-y-6",children:[u.jsxs(mn,{className:"grid w-full grid-cols-7",children:[u.jsx(hn,{value:"overview",children:"District View"}),u.jsx(hn,{value:"dealerships",children:"Dealerships"}),u.jsx(hn,{value:"leaderboard",children:"DAS Board"}),u.jsx(hn,{value:"schedules",children:"Schedules"}),u.jsx(hn,{value:"deals",children:"Deal Log"}),u.jsx(hn,{value:"metrics",children:"Team Metrics"}),u.jsx(hn,{value:"actions",children:"Quick Actions"})]}),u.jsxs(un,{value:"overview",className:"space-y-6",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Total Gross Profit"}),u.jsx(Ke,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:["$",x.total_gross_profit.toLocaleString()]}),u.jsxs("p",{className:"text-xs text-muted-foreground",children:[u.jsxs("span",{className:"text-green-600 flex items-center",children:[u.jsx(qe,{className:"w-3 h-3 mr-1"}),"+",x.mtd_growth,"%"]}),"from last month"]})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Total Units"}),u.jsx(ns,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:x.total_units}),u.jsxs("p",{className:"text-xs text-muted-foreground",children:["Across ",x.active_dealerships," dealerships"]})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"District Front PVR"}),u.jsx(rs,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:["$",x.district_front_pvr]}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Average across district"})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"District Back PVR"}),u.jsx(ls,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:["$",x.district_back_pvr]}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"F&I average"})]})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(Ve,{className:"w-5 h-5 mr-2"}),"District Goal Achievement"]})}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-3xl font-bold mb-2",children:[x.goal_achievement,"%"]}),y(x.goal_achievement,100),u.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:x.goal_achievement>=90?"Exceeding expectations":x.goal_achievement>=70?"On track":"Needs attention"})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(ss,{className:"w-5 h-5 mr-2 text-yellow-500"}),"Top Performing Store"]})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold mb-2",children:x.top_performer}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Leading in overall performance this month"}),u.jsx(Bt,{variant:"outline",size:"sm",className:"mt-2",children:"View Details"})]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(ws,{className:"w-5 h-5 mr-2"}),"Dealership Performance Overview"]})}),u.jsx($t,{children:u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.map(e=>u.jsxs("div",{className:"p-4 border rounded-lg",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx("h4",{className:"font-semibold",children:e.name}),N(e.performance_rating)]}),u.jsxs("div",{className:"space-y-1 text-sm",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"GM:"}),u.jsx("span",{className:"font-medium",children:e.general_manager})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"MTD Units:"}),u.jsx("span",{className:"font-medium",children:e.mtd_units})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"Goal:"}),u.jsx("span",{className:"font-medium",children:e.monthly_goal})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"Total Gross:"}),u.jsxs("span",{className:"font-medium",children:["$",e.total_gross.toLocaleString()]})]}),u.jsxs("div",{className:"mt-2",children:[u.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Goal Progress"}),y(e.mtd_units,e.monthly_goal)]})]})]},e.id))})})]})]}),u.jsxs(un,{value:"dealerships",className:"space-y-6",children:[u.jsxs("div",{className:"flex items-center justify-between mb-4",children:[u.jsx("h3",{className:"text-lg font-semibold",children:"Individual Dealership Performance"}),u.jsxs(ql,{value:i,onValueChange:o,children:[u.jsx(Yl,{className:"w-64",children:u.jsx(Jl,{placeholder:"Select dealership"})}),u.jsxs(Zl,{children:[u.jsx(Ql,{value:"all",children:"All Dealerships"}),g.map(e=>u.jsx(Ql,{value:e.id,children:e.name},e.id))]})]})]}),u.jsx(Ut,{children:u.jsx($t,{className:"p-6",children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Dealership"}),u.jsx(tn,{children:"General Manager"}),u.jsx(tn,{children:"Location"}),u.jsx(tn,{className:"text-right",children:"MTD Units"}),u.jsx(tn,{className:"text-right",children:"Goal"}),u.jsx(tn,{className:"text-right",children:"Front Gross"}),u.jsx(tn,{className:"text-right",children:"Back Gross"}),u.jsx(tn,{className:"text-right",children:"Front PVR"}),u.jsx(tn,{className:"text-right",children:"Back PVR"}),u.jsx(tn,{className:"text-right",children:"Performance"}),u.jsx(tn,{className:"text-right",children:"Actions"})]})}),u.jsx(sn,{children:g.filter(e=>"all"===i||e.id===i).map(e=>u.jsxs(an,{children:[u.jsx(rn,{className:"font-medium",children:e.name}),u.jsx(rn,{children:e.general_manager}),u.jsx(rn,{children:e.location}),u.jsx(rn,{className:"text-right font-medium",children:e.mtd_units}),u.jsx(rn,{className:"text-right",children:e.monthly_goal}),u.jsxs(rn,{className:"text-right font-medium",children:["$",e.front_gross.toLocaleString()]}),u.jsxs(rn,{className:"text-right font-medium",children:["$",e.back_gross.toLocaleString()]}),u.jsxs(rn,{className:"text-right",children:["$",e.front_pvr]}),u.jsxs(rn,{className:"text-right",children:["$",e.back_pvr]}),u.jsx(rn,{className:"text-right",children:N(e.performance_rating)}),u.jsx(rn,{className:"text-right",children:u.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[u.jsx(Bt,{variant:"outline",size:"sm",children:u.jsx(Ae,{className:"w-4 h-4"})}),u.jsx(Bt,{variant:"outline",size:"sm",children:u.jsx(Ns,{className:"w-4 h-4"})})]})})]},e.id))})]})})})]}),u.jsxs(un,{value:"leaderboard",className:"space-y-6",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("h3",{className:"text-lg font-semibold",children:"District Performance Board"}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("span",{className:"text-sm",children:"Sales"}),u.jsx(Bt,{variant:"outline",size:"sm",onClick:()=>d(!c),className:"p-2",children:c?u.jsx(Ms,{className:"w-4 h-4"}):u.jsx(Rs,{className:"w-4 h-4"})}),u.jsx("span",{className:"text-sm",children:"F&I"})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(ss,{className:"w-5 h-5 mr-2 text-yellow-500"}),c?"Sales Team":"F&I Team"," Leaderboard"]}),u.jsxs(Rt,{children:["Top performers across all dealerships for ",b(m)]})]}),u.jsx($t,{children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{className:"w-12",children:"Rank"}),u.jsx(tn,{children:"Name"}),u.jsx(tn,{children:"Dealership"}),u.jsx(tn,{className:"text-right",children:"Deals"}),u.jsx(tn,{className:"text-right",children:"Revenue"}),u.jsx(tn,{className:"text-right",children:"Goal Progress"}),u.jsx(tn,{className:"text-right",children:"Performance"})]})}),u.jsx(sn,{children:j.filter(e=>c?"salesperson"===e.role:"finance_manager"===e.role).sort((e,s)=>s.revenue-e.revenue).map((e,s)=>u.jsxs(an,{children:[u.jsx(rn,{children:u.jsxs("div",{className:"flex items-center",children:[0===s&&u.jsx(ss,{className:"w-4 h-4 text-yellow-500 mr-1"}),1===s&&u.jsx(ss,{className:"w-4 h-4 text-gray-400 mr-1"}),2===s&&u.jsx(ss,{className:"w-4 h-4 text-amber-600 mr-1"}),u.jsxs("span",{className:"font-medium",children:["#",s+1]})]})}),u.jsx(rn,{className:"font-medium",children:e.name}),u.jsx(rn,{children:e.dealership}),u.jsx(rn,{className:"text-right",children:e.deals_processed}),u.jsxs(rn,{className:"text-right",children:["$",e.revenue.toLocaleString()]}),u.jsx(rn,{className:"text-right",children:u.jsx("div",{className:"w-20",children:y(e.goals.current_deals,e.goals.monthly_deals)})}),u.jsx(rn,{className:"text-right",children:N(e.performance_rating)})]},e.id))})]})})]})]}),u.jsx(un,{value:"schedules",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(Oe,{className:"w-5 h-5 mr-2"}),"District Team Schedules"]}),u.jsx(Rt,{children:"View and manage schedules across all dealerships"})]}),u.jsx($t,{children:u.jsx("div",{className:"space-y-6",children:g.map(e=>u.jsxs("div",{className:"border rounded-lg p-4",children:[u.jsxs("div",{className:"flex items-center justify-between mb-4",children:[u.jsx("h4",{className:"font-semibold",children:e.name}),u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(Ns,{className:"w-4 h-4 mr-2"}),"Manage Schedules"]})]}),u.jsxs("div",{className:"text-sm text-muted-foreground",children:["GM: ",e.general_manager," | ",e.location]})]},e.id))})})]})}),u.jsx(un,{value:"deals",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(as,{className:"w-5 h-5 mr-2"}),"District Deal Log"]}),u.jsx(Rt,{children:"View and edit deals across all dealerships (Front Gross editable)"})]}),u.jsx($t,{children:u.jsx(ii,{dashboardType:"avp"})})]})}),u.jsx(un,{value:"metrics",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(Ss,{className:"w-5 h-5 mr-2"}),"Team Sales Metrics"]}),u.jsx(Rt,{children:"Comprehensive performance metrics across the district"})]}),u.jsx($t,{children:u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:g.map(e=>u.jsxs("div",{className:"p-4 border rounded-lg",children:[u.jsx("h4",{className:"font-semibold mb-3",children:e.name}),u.jsxs("div",{className:"space-y-2 text-sm",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"New Units:"}),u.jsx("span",{className:"font-medium",children:e.new_units})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"Used Units:"}),u.jsx("span",{className:"font-medium",children:e.used_units})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"CPO Units:"}),u.jsx("span",{className:"font-medium",children:e.cpo_units})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"YTD Total:"}),u.jsx("span",{className:"font-medium",children:e.ytd_units})]})]})]},e.id))})})]})}),u.jsx(un,{value:"actions",className:"space-y-6",children:u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center",children:[u.jsx($s,{className:"w-5 h-5 mr-2"}),"Team Management"]})}),u.jsxs($t,{className:"space-y-2",children:[u.jsxs(Bt,{className:"w-full",variant:"outline",children:[u.jsx(vs,{className:"w-4 h-4 mr-2"}),"Manage Teams"]}),u.jsxs(Bt,{className:"w-full",variant:"outline",children:[u.jsx(Ls,{className:"w-4 h-4 mr-2"}),"Performance Reviews"]}),u.jsxs(Bt,{className:"w-full",variant:"outline",children:[u.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Schedule Management"]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(Gs,{className:"w-5 h-5 mr-2"}),"Goal Setting"]})}),u.jsxs($t,{className:"space-y-2",children:[u.jsxs(Bt,{className:"w-full",variant:"outline",children:[u.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Set Team Goals"]}),u.jsxs(Bt,{className:"w-full",variant:"outline",children:[u.jsx(Es,{className:"w-4 h-4 mr-2"}),"Individual Goals"]}),u.jsxs(Bt,{className:"w-full",variant:"outline",children:[u.jsx(qe,{className:"w-4 h-4 mr-2"}),"Track Progress"]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(Os,{className:"w-5 h-5 mr-2"}),"Reports & Analytics"]})}),u.jsxs($t,{className:"space-y-2",children:[u.jsxs(Bt,{className:"w-full",variant:"outline",children:[u.jsx(Ss,{className:"w-4 h-4 mr-2"}),"Sales Reports"]}),u.jsxs(Bt,{className:"w-full",variant:"outline",children:[u.jsx(bs,{className:"w-4 h-4 mr-2"}),"Performance Analytics"]}),u.jsxs(Bt,{className:"w-full",variant:"outline",children:[u.jsx(Us,{className:"w-4 h-4 mr-2"}),"District Summary"]})]})]})]})})]})]})},ci=[{id:"salesperson",name:"Salesperson",category:"sales"},{id:"finance_manager",name:"Finance Manager",category:"finance"},{id:"finance_director",name:"Finance Director",category:"finance"},{id:"sales_manager",name:"Sales Manager",category:"management"},{id:"general_manager",name:"General Manager",category:"management"},{id:"gsm",name:"GSM",category:"management"},{id:"dealership_admin",name:"Dealership Admin",category:"admin"}],di=[{id:"employed",name:"Employed",color:"bg-green-100 text-green-800"},{id:"suspended",name:"Suspended",color:"bg-yellow-100 text-yellow-800"},{id:"terminated",name:"Terminated",color:"bg-red-100 text-red-800"}];function mi(){const{user:e}=It(),{toast:s}=dt();pe();const a=localStorage.getItem("directauth_user"),t=a?JSON.parse(a):null,r=e||t,[l,n]=he.useState([]),[i,d]=he.useState({total_dealerships:0,total_users:0,monthly_vehicles_sold:0,total_revenue:0}),[m,x]=he.useState(!1),[p,g]=he.useState(null),[f,j]=he.useState([]),[v,b]=he.useState({salesperson:0,finance_manager:0,sales_manager:0,general_manager:0,gsm:0,total:0}),[N,y]=he.useState({firstName:"",lastName:"",email:"",roleId:"salesperson",startDate:"",tempPassword:"",dealershipId:""}),[w,S]=he.useState(!1),[_,D]=he.useState("staff");he.useEffect(()=>{console.log("[GroupAdminDashboard] Component mounting - currentUser:",null==r?void 0:r.email),r&&C()},[r]),he.useEffect(()=>{if(p&&f.length>0){const e=f.reduce((e,s)=>{const a=s.role||s.role_id;return a in e&&e[a]++,e.total++,e},{salesperson:0,finance_manager:0,sales_manager:0,general_manager:0,gsm:0,total:0});b(e)}},[f,p]);const P=()=>{const e=Math.random().toString(36).slice(-8)+Math.random().toString(36).toUpperCase().slice(-4);y(c(o({},N),{tempPassword:e}))},C=()=>h(null,null,function*(){try{x(!0);const e=[{id:"1",name:"Downtown Toyota",location:"Chicago, IL",phone:"(312) 555-0123",email:"info@downtowntoyota.com",created_at:"2024-01-15",salespeople_count:12,finance_count:3,managers_count:4,total_staff:19,monthly_sales:145,monthly_revenue:435e4,is_configured:!0},{id:"2",name:"Suburban Honda",location:"Naperville, IL",phone:"(630) 555-0456",email:"contact@suburbanhonda.com",created_at:"2024-02-01",salespeople_count:8,finance_count:2,managers_count:3,total_staff:13,monthly_sales:98,monthly_revenue:294e4,is_configured:!1},{id:"3",name:"Metro Ford",location:"Aurora, IL",phone:"(630) 555-0789",email:"hello@metroford.com",created_at:"2024-01-20",salespeople_count:15,finance_count:4,managers_count:5,total_staff:24,monthly_sales:187,monthly_revenue:561e4,is_configured:!0}];n(e);const s={total_dealerships:e.length,total_users:e.reduce((e,s)=>e+s.total_staff,0),monthly_vehicles_sold:e.reduce((e,s)=>e+s.monthly_sales,0),total_revenue:e.reduce((e,s)=>e+s.monthly_revenue,0)};d(s),console.log("[GroupAdminDashboard] Data loaded successfully")}catch(e){console.error("Error fetching dashboard data:",e),s({title:"Error",description:"Failed to fetch dashboard data",variant:"destructive"})}finally{x(!1)}}),k=e=>h(null,null,function*(){try{j([{id:"u1",first_name:"John",last_name:"Smith",email:"john.smith@dealership.com",role:"salesperson",role_id:"salesperson",employment_status:"employed",created_at:"2024-01-10",start_date:"2024-01-15",dealership_id:e},{id:"u2",first_name:"Sarah",last_name:"Johnson",email:"sarah.johnson@dealership.com",role:"finance_manager",role_id:"finance_manager",employment_status:"employed",created_at:"2024-01-12",start_date:"2024-01-20",dealership_id:e}])}catch(a){console.error("Error fetching dealership users:",a),s({title:"Error",description:"Failed to fetch dealership staff",variant:"destructive"})}}),T=e=>h(null,null,function*(){e.preventDefault(),S(!0);try{const e={id:`u${Date.now()}`,first_name:N.firstName,last_name:N.lastName,email:N.email,role:N.roleId,role_id:N.roleId,employment_status:"employed",created_at:(new Date).toISOString(),start_date:N.startDate,dealership_id:N.dealershipId};j([...f,e]),y({firstName:"",lastName:"",email:"",roleId:"salesperson",startDate:"",tempPassword:"",dealershipId:(null==p?void 0:p.id)||""}),P(),s({title:"Success",description:`${N.firstName} ${N.lastName} has been added to ${null==p?void 0:p.name}`})}catch(a){console.error("Error adding user:",a),s({title:"Error",description:"Failed to add staff member",variant:"destructive"})}finally{S(!1)}}),F=(e="employed")=>{const s=di.find(s=>s.id===e)||di[0];return u.jsx(pr,{className:s.color,children:s.name})},A=()=>{g(null),j([]),D("staff")},E=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);return p?u.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center space-x-4",children:[u.jsxs(Bt,{variant:"outline",onClick:A,children:[u.jsx(cs,{className:"w-4 h-4 mr-2"}),"Back to Dealerships"]}),u.jsxs("div",{children:[u.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:["Configure ",p.name]}),u.jsxs("p",{className:"text-muted-foreground flex items-center",children:[u.jsx(Bs,{className:"w-4 h-4 mr-1"}),p.location]})]})]}),u.jsx("div",{className:"flex items-center space-x-2",children:u.jsxs(pr,{variant:"outline",className:"px-3 py-1",children:[u.jsx(Ds,{className:"w-4 h-4 mr-1"}),"Configuration"]})})]}),u.jsxs(dn,{value:_,onValueChange:D,className:"w-full",children:[u.jsxs(mn,{className:"grid w-full grid-cols-4",children:[u.jsx(hn,{value:"staff",children:"Staff Management"}),u.jsx(hn,{value:"hours",children:"Operating Hours"}),u.jsx(hn,{value:"payplans",children:"Pay Plans"}),u.jsx(hn,{value:"settings",children:"Settings"})]}),u.jsxs(un,{value:"staff",className:"space-y-6",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Sales People"}),u.jsx(Vs,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsx($t,{children:u.jsx("div",{className:"text-2xl font-bold",children:v.salesperson})})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Finance Managers"}),u.jsx(rs,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsx($t,{children:u.jsx("div",{className:"text-2xl font-bold",children:v.finance_manager})})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Sales Managers"}),u.jsx(Ve,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsx($t,{children:u.jsx("div",{className:"text-2xl font-bold",children:v.sales_manager})})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Total Staff"}),u.jsx(vs,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsx($t,{children:u.jsx("div",{className:"text-2xl font-bold",children:v.total})})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Staff Members"})}),u.jsx($t,{children:u.jsx("div",{className:"border rounded-lg",children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Name"}),u.jsx(tn,{children:"Email"}),u.jsx(tn,{children:"Role"}),u.jsx(tn,{children:"Start Date"}),u.jsx(tn,{children:"Status"}),u.jsx(tn,{children:"Actions"})]})}),u.jsx(sn,{children:f.map(e=>{var a;return u.jsxs(an,{children:[u.jsxs(rn,{className:"font-medium",children:[e.first_name," ",e.last_name]}),u.jsx(rn,{children:e.email}),u.jsx(rn,{children:u.jsx(pr,{variant:"outline",children:(null==(a=ci.find(s=>s.id===e.role))?void 0:a.name)||e.role})}),u.jsx(rn,{children:e.start_date?new Date(e.start_date).toLocaleDateString():"Not set"}),u.jsx(rn,{children:F(e.employment_status)}),u.jsx(rn,{children:u.jsxs(ql,{value:e.employment_status||"employed",onValueChange:a=>{return t=e.id,r=a,h(null,null,function*(){try{j(f.map(e=>e.id===t?c(o({},e),{employment_status:r}):e)),s({title:"Success",description:`Employment status updated to ${r}`})}catch(e){console.error("Error updating employment status:",e),s({title:"Error",description:"Failed to update employment status",variant:"destructive"})}});var t,r},children:[u.jsx(Yl,{className:"w-32",children:u.jsx(Jl,{})}),u.jsx(Zl,{children:di.map(e=>u.jsx(Ql,{value:e.id,children:e.name},e.id))})]})})]},e.id)})})]})})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(us,{className:"w-5 h-5 mr-2"}),"Add New Staff Member"]})}),u.jsx($t,{children:u.jsxs("form",{onSubmit:T,className:"space-y-4",children:[u.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"firstName",children:"First Name"}),u.jsx(Vt,{id:"firstName",value:N.firstName,onChange:e=>y(c(o({},N),{firstName:e.target.value})),placeholder:"John",required:!0})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"lastName",children:"Last Name"}),u.jsx(Vt,{id:"lastName",value:N.lastName,onChange:e=>y(c(o({},N),{lastName:e.target.value})),placeholder:"Doe",required:!0})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"email",children:"Email Address"}),u.jsx(Vt,{id:"email",type:"email",value:N.email,onChange:e=>y(c(o({},N),{email:e.target.value})),placeholder:"john.doe@dealership.com",required:!0})]}),u.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"role",children:"Role"}),u.jsxs(ql,{value:N.roleId,onValueChange:e=>y(c(o({},N),{roleId:e})),children:[u.jsx(Yl,{id:"role",children:u.jsx(Jl,{placeholder:"Select a role"})}),u.jsx(Zl,{children:ci.map(e=>u.jsx(Ql,{value:e.id,children:e.name},e.id))})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"startDate",children:"Start Date"}),u.jsx(Vt,{id:"startDate",type:"date",value:N.startDate,onChange:e=>y(c(o({},N),{startDate:e.target.value})),required:!0})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"tempPassword",children:"Temporary Password"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx(Vt,{id:"tempPassword",type:"text",value:N.tempPassword,onChange:e=>y(c(o({},N),{tempPassword:e.target.value})),placeholder:"Auto-generated password",required:!0}),u.jsx(Bt,{type:"button",variant:"outline",onClick:P,className:"shrink-0",children:"Generate"})]}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"User will be required to change their password on first login."})]}),u.jsxs(Bt,{type:"submit",disabled:w,className:"w-full",children:[w?u.jsx(Ge,{className:"mr-2 h-4 w-4 animate-spin"}):u.jsx(us,{className:"mr-2 h-4 w-4"}),"Add Staff Member"]})]})})]})]}),u.jsx(un,{value:"hours",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(ze,{className:"w-5 h-5 mr-2"}),"Dealership Operating Hours"]}),u.jsx(Rt,{children:"Set the standard operating hours for this dealership. These hours will be used as the base for staff scheduling."})]}),u.jsxs($t,{children:[u.jsx("div",{className:"grid gap-4",children:[{day:"Monday",key:"monday"},{day:"Tuesday",key:"tuesday"},{day:"Wednesday",key:"wednesday"},{day:"Thursday",key:"thursday"},{day:"Friday",key:"friday"},{day:"Saturday",key:"saturday"},{day:"Sunday",key:"sunday"}].map(({day:e,key:s})=>u.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[u.jsxs("div",{className:"flex items-center space-x-3",children:[u.jsx("div",{className:"w-20 font-medium",children:e}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Vt,{type:"time",defaultValue:"09:00",className:"w-24",placeholder:"Open"}),u.jsx("span",{className:"text-muted-foreground",children:"to"}),u.jsx(Vt,{type:"time",defaultValue:"20:00",className:"w-24",placeholder:"Close"})]})]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Pn,{id:`closed-${s}`}),u.jsx(Jt,{htmlFor:`closed-${s}`,className:"text-sm text-muted-foreground",children:"Closed"})]})]},s))}),u.jsx("div",{className:"flex justify-end mt-4",children:u.jsxs(Bt,{children:[u.jsx(ys,{className:"w-4 h-4 mr-2"}),"Save Hours"]})})]})]})}),u.jsx(un,{value:"payplans",className:"space-y-6",children:u.jsx(Yn,{dealershipId:p.id,isGroupAdmin:!0})}),u.jsx(un,{value:"settings",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Dealership Information"})}),u.jsxs($t,{className:"space-y-4",children:[u.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"dealership-name",children:"Dealership Name"}),u.jsx(Vt,{id:"dealership-name",defaultValue:p.name,placeholder:"Dealership Name"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"dealership-location",children:"Location"}),u.jsx(Vt,{id:"dealership-location",defaultValue:p.location,placeholder:"City, State"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"dealership-phone",children:"Phone Number"}),u.jsx(Vt,{id:"dealership-phone",defaultValue:p.phone,placeholder:"(555) 123-4567"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"dealership-email",children:"Email"}),u.jsx(Vt,{id:"dealership-email",defaultValue:p.email,placeholder:"info@dealership.com"})]})]}),u.jsxs(Bt,{children:[u.jsx(ys,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]})]})})]})]}):u.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Group Admin Dashboard"}),u.jsx("p",{className:"text-muted-foreground",children:"Manage and configure your dealership group"})]}),u.jsx("div",{className:"flex items-center space-x-2",children:u.jsxs(pr,{variant:"outline",className:"px-3 py-1",children:[u.jsx(Me,{className:"w-4 h-4 mr-1"}),"Group Admin"]})})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Number of Dealerships"}),u.jsx(Me,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:i.total_dealerships}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Active dealership locations"})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Total Users"}),u.jsx(vs,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:i.total_users}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Staff across all dealerships"})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Total Vehicles Sold MTD"}),u.jsx(js,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:i.monthly_vehicles_sold}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Month to date sales"})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"TBD Metric"}),u.jsx(qe,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:E(i.total_revenue)}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"To be determined"})]})]})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsx("h2",{className:"text-2xl font-semibold",children:"Dealership Configuration"}),u.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:l.map(e=>u.jsxs(Ut,{className:"hover:shadow-lg transition-shadow",children:[u.jsx(Gt,{children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsxs(Mt,{className:"text-lg flex items-center",children:[e.name,!e.is_configured&&u.jsx(pr,{variant:"destructive",className:"ml-2 text-xs",children:"Needs Setup"})]}),u.jsxs(Rt,{className:"flex items-center",children:[u.jsx(Bs,{className:"w-4 h-4 mr-1"}),e.location]})]}),u.jsx(Ds,{className:"w-5 h-5 text-muted-foreground"})]})}),u.jsxs($t,{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsxs("h4",{className:"text-sm font-medium mb-3 flex items-center",children:[u.jsx(vs,{className:"w-4 h-4 mr-1"}),"Staff Breakdown"]}),u.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Vs,{className:"w-4 h-4 text-blue-500"}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-muted-foreground",children:"Sales People"}),u.jsx("p",{className:"font-semibold",children:e.salespeople_count})]})]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(rs,{className:"w-4 h-4 text-green-500"}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-muted-foreground",children:"Finance People"}),u.jsx("p",{className:"font-semibold",children:e.finance_count})]})]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Ve,{className:"w-4 h-4 text-purple-500"}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-muted-foreground",children:"Sales Managers"}),u.jsx("p",{className:"font-semibold",children:e.managers_count})]})]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Cs,{className:"w-4 h-4 text-yellow-500"}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Staff"}),u.jsx("p",{className:"font-semibold",children:e.total_staff})]})]})]})]}),u.jsxs("div",{className:"pt-3 border-t",children:[u.jsxs("h4",{className:"text-sm font-medium mb-3 flex items-center",children:[u.jsx(Ss,{className:"w-4 h-4 mr-1"}),"Monthly Performance"]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"text-sm text-muted-foreground",children:"Vehicles Sold:"}),u.jsx(pr,{variant:"secondary",children:e.monthly_sales})]}),u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"text-sm text-muted-foreground",children:"Revenue:"}),u.jsx(pr,{variant:"secondary",children:E(e.monthly_revenue)})]})]})]}),u.jsxs("div",{className:"pt-3 border-t space-y-2",children:[e.is_configured?u.jsxs("div",{className:"flex items-center text-green-600 text-sm",children:[u.jsx(Ds,{className:"w-4 h-4 mr-1"}),"Configuration Complete"]}):u.jsxs("div",{className:"flex items-center text-orange-600 text-sm",children:[u.jsx(Ds,{className:"w-4 h-4 mr-1"}),"Requires Configuration"]}),u.jsxs(Bt,{variant:"outline",size:"sm",className:"w-full",onClick:()=>(e=>h(null,null,function*(){g(e),y(c(o({},N),{dealershipId:e.id})),N.tempPassword||P(),yield k(e.id)}))(e),children:[u.jsx(Ds,{className:"w-4 h-4 mr-2"}),"Configure Dealership"]})]})]})]},e.id))})]})]})}const hi=Xa("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",warning:"border-yellow-500/30 bg-yellow-500/10 text-yellow-700 dark:border-yellow-600 [&>svg]:text-yellow-600",success:"border-green-500/30 bg-green-500/10 text-green-700 dark:border-green-600 [&>svg]:text-green-600"}},defaultVariants:{variant:"default"}}),ui=he.forwardRef((e,s)=>{var a=e,{className:t,variant:r}=a,l=d(a,["className","variant"]);return u.jsx("div",o({ref:s,role:"alert",className:et(hi({variant:r}),t)},l))});ui.displayName="Alert",he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("h5",o({ref:s,className:et("mb-1 font-medium leading-none tracking-tight",t)},r))}).displayName="AlertTitle";const xi=he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx("div",o({ref:s,className:et("text-sm [&_p]:leading-relaxed",t)},r))});xi.displayName="AlertDescription";const pi=[{name:"Master Admin",email:"testadmin@example.com",password:"password123",redirectPath:"/master-admin",metadata:{role:"admin",is_admin:!0}},{name:"Group Admin",email:"group1.admin@exampletest.com",password:"password123",redirectPath:"/group-admin",metadata:{role:"dealer_group_admin",is_group_admin:!0}},{name:"Dealership Admin",email:"dealer1.admin@exampletest.com",password:"password123",redirectPath:"/dashboard/admin",metadata:{role:"dealership_admin",dealership_id:1}},{name:"Sales Manager",email:"sales.manager@exampletest.com",password:"password123",redirectPath:"/dashboard/sales-manager",metadata:{role:"sales_manager",dealership_id:1}},{name:"Salesperson",email:"sales@exampletest.com",password:"password123",redirectPath:"/dashboard/sales",metadata:{role:"salesperson",dealership_id:1}}],gi=()=>{const[e,s]=he.useState(""),[a,t]=he.useState(""),[r,l]=he.useState(!1),[n,i]=he.useState(""),[o,c]=he.useState(""),[d,m]=he.useState(null),[x,p]=he.useState(0);he.useEffect(()=>{g()},[]);const g=()=>h(null,null,function*(){try{m(null);const{data:e,error:s}=yield ta.auth.getSession();s?(console.error("Auth check error:",s),m({error:s.message})):(console.log("Auth check result:",e),m(e))}catch(e){console.error("Exception checking auth:",e),m({error:"Exception checking auth status"})}}),f=(s=!1)=>h(null,null,function*(){try{l(!0),i(""),c("");const r=s?pi[x].email:e,n=s?pi[x].password:a,o=s?pi[x].metadata:null,d=s?pi[x].redirectPath:null;console.log(`Attempting login for ${r}`),yield ta.auth.signOut();const{data:m,error:h}=yield ta.auth.signInWithPassword({email:r,password:n});if(h)return console.error("Login error:",h),void i(h.message);if(console.log("Login success:",m),o&&m.user)try{console.log("Setting user metadata:",o),yield ta.auth.updateUser({data:o}),c("User metadata updated successfully")}catch(t){console.error("Error setting user metadata:",t)}if(c("Login successful! Redirecting..."),ia(r))return"testadmin@example.com"===r?void setTimeout(()=>window.location.href="/master-admin",1e3):r.includes("group")&&r.includes("@exampletest.com")?(sessionStorage.setItem("is_group_admin","true"),void setTimeout(()=>window.location.href="/group-admin",1e3)):void setTimeout(()=>window.location.href=d||"/dashboard",1e3);setTimeout(()=>window.location.href="/dashboard",1e3)}catch(r){console.error("Login exception:",r),i("Unexpected error during login")}finally{l(!1)}});return u.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen p-4 bg-gray-50",children:[u.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Auth Debug Page"}),u.jsx("p",{className:"text-gray-500 mb-8",children:"Use this page to bypass the normal authentication flow for testing"}),u.jsx("div",{className:"w-full max-w-2xl mb-8",children:u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center justify-between",children:[u.jsx("span",{children:"Current Auth Status"}),u.jsxs(Bt,{variant:"ghost",size:"sm",onClick:g,disabled:r,children:[u.jsx(zs,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})}),u.jsxs($t,{children:[d?u.jsx("div",{className:"bg-gray-100 p-3 rounded text-xs overflow-auto max-h-48",children:u.jsx("pre",{children:JSON.stringify(d,null,2)})}):u.jsx("p",{children:"Checking auth status..."}),(null==d?void 0:d.session)&&u.jsxs(ui,{className:"mt-4 bg-blue-50",children:[u.jsx(ks,{className:"h-4 w-4"}),u.jsxs(xi,{children:["You are currently logged in as ",u.jsx("strong",{children:d.session.user.email})]})]}),!(null==d?void 0:d.session)&&u.jsxs(ui,{className:"mt-4 bg-amber-50",children:[u.jsx(Ue,{className:"h-4 w-4"}),u.jsx(xi,{children:"You are currently not logged in"})]})]}),u.jsx(Lt,{className:"flex justify-end gap-2",children:u.jsx(Bt,{variant:"outline",onClick:()=>h(null,null,function*(){try{l(!0),i(""),c(""),yield ta.auth.signOut(),localStorage.removeItem("sb-undefined-auth-token"),sessionStorage.removeItem("is_group_admin"),c("Signed out successfully"),setTimeout(()=>window.location.reload(),1e3)}catch(e){console.error("Sign out error:",e),i("Error signing out")}finally{l(!1)}}),disabled:r,children:"Force Sign Out"})})]})}),u.jsx("div",{className:"w-full max-w-2xl",children:u.jsxs(dn,{defaultValue:"presets",children:[u.jsxs(mn,{className:"grid grid-cols-2",children:[u.jsx(hn,{value:"presets",children:"Test Account Presets"}),u.jsx(hn,{value:"custom",children:"Custom Login"})]}),u.jsx(un,{value:"presets",children:u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Login with Test Account"})}),u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Test Account"}),u.jsx("select",{className:"w-full p-2 border border-gray-300 rounded-md",value:x,onChange:e=>p(Number(e.target.value)),children:pi.map((e,s)=>u.jsxs("option",{value:s,children:[e.name," (",e.email,")"]},s))})]}),u.jsxs("div",{className:"bg-blue-50 p-3 rounded-md text-sm",children:[u.jsxs("p",{children:[u.jsx("strong",{children:"Email:"})," ",pi[x].email]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Password:"})," ",pi[x].password]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Role:"})," ",pi[x].metadata.role]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Redirects to:"})," ",pi[x].redirectPath]})]}),n&&u.jsx("div",{className:"bg-red-50 text-red-600 p-3 rounded-md text-sm",children:n}),o&&u.jsx("div",{className:"bg-green-50 text-green-600 p-3 rounded-md text-sm",children:o})]})}),u.jsx(Lt,{children:u.jsx(Bt,{onClick:()=>f(!0),disabled:r,className:"w-full",children:r?"Logging in...":"Login with Selected Account"})})]})}),u.jsx(un,{value:"custom",children:u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Custom Login"})}),u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email"}),u.jsx(Vt,{type:"email",value:e,onChange:e=>s(e.target.value),placeholder:"email@example.com"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium mb-1",children:"Password"}),u.jsx(Vt,{type:"password",value:a,onChange:e=>t(e.target.value),placeholder:"password"})]}),n&&u.jsx("div",{className:"bg-red-50 text-red-600 p-3 rounded-md text-sm",children:n}),o&&u.jsx("div",{className:"bg-green-50 text-green-600 p-3 rounded-md text-sm",children:o})]})}),u.jsx(Lt,{children:u.jsx(Bt,{onClick:()=>f(!1),disabled:r,className:"w-full",children:r?"Logging in...":"Login Directly"})})]})})]})})]})},fi=({show:e=!0})=>{const[s,a]=he.useState(e),[t,r]=he.useState(null),[l,n]=he.useState(""),[i,o]=he.useState([]),{user:c,role:d,loading:m,hasSession:x,authCheckComplete:p,dealershipId:g,userRole:f,isGroupAdmin:j,error:v}=It();return he.useEffect(()=>{try{o(e=>[...e,`AuthDebugger initialized at ${(new Date).toISOString()}`]);const s={};for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);if(a)try{const e=localStorage.getItem(a);s[a]=e}catch(e){console.error(`Error reading localStorage key ${a}:`,e)}}n(JSON.stringify(s,null,2));const a=localStorage.getItem("sb-undefined-auth-token");if(a)try{r(JSON.parse(a)),o(e=>[...e,"Found session data in localStorage"])}catch(e){console.error("Error parsing session data:",e),o(s=>[...s,`Error parsing session data: ${e.message}`])}else o(e=>[...e,"No session found in localStorage"])}catch(e){console.error("Error accessing localStorage:",e),o(s=>[...s,`Error accessing localStorage: ${e.message}`])}},[]),he.useEffect(()=>{o(e=>[...e,`Auth state update at ${(new Date).toISOString()} - loading: ${m}, hasSession: ${x}, authCheckComplete: ${p}`])},[m,x,p]),s?u.jsx("div",{className:"fixed inset-0 bg-black/80 text-white p-4 z-50 overflow-auto",children:u.jsxs("div",{className:"max-w-3xl mx-auto bg-gray-900 p-4 rounded-lg",children:[u.jsxs("div",{className:"flex justify-between mb-4",children:[u.jsx("h2",{className:"text-xl font-bold",children:"Authentication Debugger"}),u.jsx("button",{className:"bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded",onClick:()=>a(!1),children:"Close"})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[u.jsxs("div",{className:"bg-gray-800 p-3 rounded",children:[u.jsx("h3",{className:"font-bold mb-2",children:"Authentication State"}),u.jsxs("div",{className:"space-y-1 text-sm",children:[u.jsxs("p",{children:[u.jsx("span",{className:"text-gray-400",children:"Loading:"})," ",m?"":""]}),u.jsxs("p",{children:[u.jsx("span",{className:"text-gray-400",children:"Auth Check Complete:"})," ",p?"":""]}),u.jsxs("p",{children:[u.jsx("span",{className:"text-gray-400",children:"Has Session:"})," ",x?"":""]}),u.jsxs("p",{children:[u.jsx("span",{className:"text-gray-400",children:"User:"})," ",c?c.email:"Not logged in"]}),u.jsxs("p",{children:[u.jsx("span",{className:"text-gray-400",children:"Role:"})," ",d||"Unknown"]}),u.jsxs("p",{children:[u.jsx("span",{className:"text-gray-400",children:"User Role:"})," ",f||"Unknown"]}),u.jsxs("p",{children:[u.jsx("span",{className:"text-gray-400",children:"Is Group Admin:"})," ",j?"":""]}),u.jsxs("p",{children:[u.jsx("span",{className:"text-gray-400",children:"Dealership ID:"})," ",g||"None"]}),u.jsxs("p",{children:[u.jsx("span",{className:"text-gray-400",children:"Error:"}),v?u.jsx("span",{className:"text-red-400",children:v.message}):"None"]})]})]}),u.jsxs("div",{className:"bg-gray-800 p-3 rounded",children:[u.jsx("h3",{className:"font-bold mb-2",children:"Session Storage"}),u.jsx("p",{className:"mb-2 text-sm",children:t?`Session expires: ${new Date(1e3*t.expires_at).toLocaleTimeString()}`:"No session in localStorage"}),u.jsx("button",{className:"bg-blue-700 hover:bg-blue-600 px-3 py-1 rounded text-sm",onClick:()=>h(null,null,function*(){o(e=>[...e,`Forcing auth recheck at ${(new Date).toISOString()}`]);try{const{data:e,error:s}=yield ta.auth.getSession();if(s)return void o(e=>[...e,`Error getting session: ${s.message}`]);if(null==e?void 0:e.session){o(e=>[...e,"Session exists but not properly recognized by app, fixing..."]);const s=JSON.stringify({access_token:e.session.access_token,refresh_token:e.session.refresh_token,expires_at:Math.floor(Date.now()/1e3)+3600});localStorage.setItem("sb-undefined-auth-token",s),o(e=>[...e,"Session manually updated in localStorage"]),window.location.reload()}else o(e=>[...e,"No active session found"])}catch(e){o(s=>[...s,`Error in auth recheck: ${e.message}`])}}),children:"Force Auth Recheck"})]})]}),u.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[u.jsxs("div",{className:"bg-gray-800 p-3 rounded",children:[u.jsx("h3",{className:"font-bold mb-2",children:"Auth Event Log"}),u.jsx("div",{className:"h-32 overflow-y-auto text-xs font-mono bg-black/50 p-2 rounded",children:i.map((e,s)=>u.jsx("div",{className:"mb-1",children:e},s))})]}),u.jsxs("div",{className:"bg-gray-800 p-3 rounded",children:[u.jsx("h3",{className:"font-bold mb-2",children:"Raw Local Storage"}),u.jsx("pre",{className:"h-32 overflow-auto text-xs bg-black/50 p-2 rounded",children:l})]})]})]})}):u.jsx("div",{className:"fixed bottom-4 right-4 p-2 bg-yellow-100 rounded shadow cursor-pointer",onClick:()=>a(!0),children:"Show Auth Debug"})},ji=({children:e})=>{const[s,a]=he.useState(!0),[t,r]=he.useState(!1),[l,n]=he.useState(!1),i=xe(),o=pe();return wt()?u.jsx(u.Fragment,{children:e}):(he.useEffect(()=>{"undefined"!=typeof window&&(window.clearTestUserProcessingFlags=()=>{const e=Object.keys(localStorage).filter(e=>e.startsWith("test_user_processed_"));e.forEach(e=>localStorage.removeItem(e)),console.log("[TestUserMiddleware] Cleared processing flags:",e)})},[]),he.useEffect(()=>{l?a(!1):h(null,null,function*(){try{if(console.log("[TestUserMiddleware] Checking for test user..."),wt&&wt())return console.log("[TestUserMiddleware] Direct auth active, bypassing"),a(!1),void n(!0);const{data:s,error:t}=yield ta.auth.getSession();if(t)return console.error("[TestUserMiddleware] Session error:",t),a(!1),void n(!0);if(!s.session)return console.log("[TestUserMiddleware] No active session"),a(!1),void n(!0);const l=s.session.user,c=(null==l?void 0:l.email)||"";if(!ia(c))return console.log("[TestUserMiddleware] Not a test user:",c),a(!1),void n(!0);console.log("[TestUserMiddleware] Test user detected:",c),"testfinance@example.com"!==c&&"finance1@exampletest.com"!==c||console.warn("[TestUserMiddleware] FINANCE USER DETECTED:",{email:c,currentPath:i.pathname,shouldRedirectTo:"/dashboard/single-finance"}),r(!0);const d=`test_user_processed_${c}`;if("undefined"!=typeof window&&localStorage.getItem(d))return console.log("[TestUserMiddleware] User already processed, skipping metadata update"),a(!1),void n(!0);if("testadmin@example.com"===c){console.log("[TestUserMiddleware] Master admin user detected");try{yield ta.auth.updateUser({data:{role:"admin",is_admin:!0}}),console.log("[TestUserMiddleware] Updated metadata for master admin"),"undefined"!=typeof window&&localStorage.setItem(d,"true")}catch(e){console.error("[TestUserMiddleware] Error updating metadata:",e)}"/master-admin"!==i.pathname&&(console.log("[TestUserMiddleware] Redirecting master admin to /master-admin"),o("/master-admin",{replace:!0}))}else if(c.includes("finance")||"testfinance@example.com"===c||"finance1@exampletest.com"===c){console.log("[TestUserMiddleware] Finance manager user detected");try{yield ta.auth.updateUser({data:{role:"single_finance_manager",dealership_id:1}}),console.log("[TestUserMiddleware] Updated metadata for finance manager"),"undefined"!=typeof window&&localStorage.setItem(d,"true")}catch(e){console.error("[TestUserMiddleware] Error updating metadata:",e)}"/dashboard/single-finance"!==i.pathname&&(console.log("[TestUserMiddleware] Redirecting finance manager to /dashboard/single-finance"),o("/dashboard/single-finance",{replace:!0}))}else if(c.includes("group")&&c.includes("@exampletest.com")){console.log("[TestUserMiddleware] Group admin user detected");try{yield ta.auth.updateUser({data:{role:"dealer_group_admin",is_group_admin:!0}}),console.log("[TestUserMiddleware] Updated metadata for group admin"),"undefined"!=typeof window&&window.sessionStorage&&window.sessionStorage.setItem("is_group_admin","true"),"undefined"!=typeof window&&localStorage.setItem(d,"true")}catch(e){console.error("[TestUserMiddleware] Error updating metadata:",e)}"/group-admin"!==i.pathname&&(console.log("[TestUserMiddleware] Redirecting group admin to /group-admin"),o("/group-admin",{replace:!0}))}else if(c.includes("admin")&&c.includes("@exampletest.com")){console.log("[TestUserMiddleware] Dealership admin user detected");try{yield ta.auth.updateUser({data:{role:"dealership_admin",dealership_id:1}}),console.log("[TestUserMiddleware] Updated metadata for dealership admin"),"undefined"!=typeof window&&localStorage.setItem(d,"true")}catch(e){console.error("[TestUserMiddleware] Error updating metadata:",e)}"/dashboard/admin"!==i.pathname&&(console.log("[TestUserMiddleware] Redirecting dealership admin to /dashboard/admin"),o("/dashboard/admin",{replace:!0}))}n(!0),a(!1)}catch(s){console.error("[TestUserMiddleware] Unexpected error:",s),n(!0),a(!1)}})},[l]),s&&t?u.jsx("div",{className:"flex items-center justify-center h-screen",children:u.jsxs("div",{className:"text-center",children:[u.jsx(Ge,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),u.jsx("p",{className:"text-sm text-gray-500",children:"Configuring test user access..."})]})}):u.jsx(u.Fragment,{children:e}))},vi=()=>{const[e,s]=he.useState(0),[a,t]=he.useState(""),[r,l]=he.useState("idle"),[n,i]=he.useState(!1),o=pe();return he.useEffect(()=>{if(wt()){const e=yt();if(e){t(`Already logged in as ${e.email}. Redirecting...`),l("success");const s=setTimeout(()=>{o(Dt(e))},1500);return()=>clearTimeout(s)}}},[o]),u.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50 p-4",children:u.jsxs("div",{className:"w-full max-w-md",children:[u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsx(Mt,{className:"text-2xl text-center",children:"Direct Login"}),u.jsx("p",{className:"text-center text-gray-500 text-sm",children:"Simplified login without Supabase authentication"})]}),u.jsxs($t,{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Test Account"}),u.jsx("select",{className:"w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",value:e,onChange:e=>s(Number(e.target.value)),disabled:n,children:ft.map((e,s)=>u.jsxs("option",{value:s,children:[e.name||e.email," (",e.role,")"]},s))})]}),u.jsxs("div",{className:"bg-gray-100 p-3 rounded text-sm",children:[u.jsxs("div",{children:[u.jsx("strong",{children:"Email:"})," ",ft[e].email]}),u.jsxs("div",{children:[u.jsx("strong",{children:"Role:"})," ",ft[e].role]}),u.jsxs("div",{children:[u.jsx("strong",{children:"Redirects to:"})," ",Dt(ft[e])]})]}),a&&u.jsx("div",{className:"p-3 rounded text-sm "+("success"===r?"bg-green-100 text-green-800":"error"===r?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:a})]}),u.jsxs(Lt,{className:"flex justify-between",children:[u.jsx(Bt,{onClick:()=>{i(!0),t(""),l("idle");const s=_t(ft[e].email);if(s.success){t(s.message+" - Redirecting..."),l("success");const e=yt();e&&setTimeout(()=>{o(Dt(e))},1500)}else t(s.message),l("error");i(!1)},disabled:n,className:"w-full mr-2",children:n?"Logging in...":"Login as Selected User"}),wt()&&u.jsx(Bt,{onClick:()=>{St(),t("Logged out successfully"),l("success"),window.location.reload()},variant:"outline",className:"w-1/3",children:"Log Out"})]})]}),u.jsx("div",{className:"mt-4 text-center",children:u.jsx("a",{href:"/",className:"text-sm text-blue-600 hover:text-blue-800 hover:underline",children:"Return to regular login"})})]})})},bi=({children:e})=>{const[s,a]=he.useState(!0),t=pe(),r=xe();return he.useEffect(()=>{var e;if("true"===localStorage.getItem("logout_in_progress"))return console.log("[DirectAuthProvider] Logout in progress, skipping redirect"),void a(!1);const s=localStorage.getItem("force_redirect_after_login"),l=localStorage.getItem("force_redirect_timestamp"),n=l&&Date.now()-parseInt(l)<1e4;if(s&&n)return console.log("[DirectAuthProvider] Force redirect detected, navigating to:",s),localStorage.removeItem("force_redirect_after_login"),localStorage.removeItem("force_redirect_timestamp"),t(s,{replace:!0}),void a(!1);if(["/direct-login","/force-login","/logout","/reset","/","/auth","/dashboard-selector","/deal-log","/finance-deal-log","/single-finance-deal-log","/finance-manager/log-deal"].includes(r.pathname))return console.log(`[DirectAuthProvider] Skipping redirect for excluded path: ${r.pathname}`),void a(!1);const i=new URLSearchParams(r.search);if(i.has("noredirect")||i.has("forcelogin")||i.has("reset"))return console.log("[DirectAuthProvider] Skipping redirect due to special parameter"),void a(!1);if(wt()){const s=yt();if(s){if(console.log("[DirectAuthProvider] Direct auth user detected:",s.email),null!==localStorage.getItem("directauth_timestamp")&&(console.log("[DirectAuthProvider] Dashboard selector session detected - allowing specific dashboard access"),r.pathname.startsWith("/dashboard/")||"/master-admin"===r.pathname||"/group-admin"===r.pathname||"/avp-full-dashboard"===r.pathname||"/deal-log"===r.pathname))return console.log("[DirectAuthProvider] Allowing access to path:",r.pathname),void a(!1);if("/"===r.pathname||"/auth"===r.pathname)console.log("[DirectAuthProvider] Redirecting to dashboard:",Dt(s)),t(Dt(s),{replace:!0});else{const l=Dt(s),n="finance_manager"===(null==(e=s.role)?void 0:e.toLowerCase()),i="/deal-log"===r.pathname;if(n&&i)return console.log("[DirectAuthProvider] Allowing finance manager to access deal-log path"),void a(!1);const o="area_vice_president"===s.role,c="/avp-full-dashboard"===r.pathname;if(o&&c)return console.log("[DirectAuthProvider] Allowing AVP user to access:",r.pathname),void a(!1);r.pathname===l||r.pathname.startsWith(l+"/")||(console.log("[DirectAuthProvider] Current path doesn't match user role, redirecting:",{current:r.pathname,correct:l}),t(l,{replace:!0}))}}}a(!1)},[t,r.pathname,r.search]),s?u.jsx("div",{className:"flex justify-center items-center h-screen",children:u.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})}):u.jsx(u.Fragment,{children:e})},Ni=()=>{const[e,s]=he.useState(0),[a,t]=he.useState(""),[r,l]=he.useState("idle"),[n,i]=he.useState(!1);he.useEffect(()=>{new URLSearchParams(window.location.search).has("reset")&&o()},[]);const o=()=>{try{localStorage.clear(),sessionStorage.clear(),document.cookie.split(";").forEach(e=>{const[s]=e.trim().split("=");document.cookie=`${s}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`}),t("All authentication data has been completely cleared. You can now use any login option."),l("success")}catch(e){console.error("Reset error:",e),t("Error while resetting: "+String(e)),l("error")}};return u.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50 p-4",children:u.jsxs("div",{className:"w-full max-w-md",children:[u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsxs("div",{className:"flex justify-between items-center mb-2",children:[u.jsx(Mt,{className:"text-2xl text-center",children:"Force Login"}),u.jsx(Bt,{variant:"destructive",size:"sm",onClick:o,children:"Reset All Auth"})]}),u.jsx("p",{className:"text-center text-gray-500 text-sm",children:"Force authentication by directly manipulating local storage"})]}),u.jsxs($t,{className:"space-y-4",children:[u.jsxs(ui,{variant:"destructive",children:[u.jsx(Ue,{className:"h-4 w-4"}),u.jsx(xi,{children:"This is an emergency bypass. Use only when all other login methods fail."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Test Account"}),u.jsx("select",{className:"w-full p-2 border border-gray-300 rounded-md",value:e,onChange:e=>s(Number(e.target.value)),disabled:n,children:ft.map((e,s)=>u.jsxs("option",{value:s,children:[e.name||e.email," (",e.role,")"]},s))})]}),u.jsxs("div",{className:"bg-gray-100 p-3 rounded text-sm",children:[u.jsxs("div",{children:[u.jsx("strong",{children:"Email:"})," ",ft[e].email]}),u.jsxs("div",{children:[u.jsx("strong",{children:"Role:"})," ",ft[e].role]}),u.jsxs("div",{children:[u.jsx("strong",{children:"Redirects to:"})," ",Dt(ft[e])]})]}),a&&u.jsxs("div",{className:"p-3 rounded text-sm "+("success"===r?"bg-green-100 text-green-800":"error"===r?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:[a,"success"===r&&u.jsx("div",{className:"mt-2",children:u.jsx("a",{href:Dt(ft[e]),className:"inline-block bg-green-600 text-white px-3 py-1 rounded mt-1 hover:bg-green-700",children:"Go to Dashboard"})})]})]}),u.jsxs(Lt,{className:"flex justify-between gap-2",children:[u.jsx(Bt,{onClick:()=>{try{i(!0),t(""),l("idle");const s=ft[e];_t(s.email);const a="sb-dasboard-auth-token",r={access_token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNhbXBsZSIsInJvbGUiOiJhdXRoZW50aWNhdGVkIiwiaWF0IjoxNjE2NDI4ODAwLCJleHAiOjE2MTY0NzIwMDB9.EXAMPLE",refresh_token:"refresh-token-example",expires_at:Date.now()+36e5,expires_in:3600,user:{id:s.id,email:s.email,role:s.role,user_metadata:{name:s.name,role:s.role,is_admin:!!s.isAdmin,is_group_admin:!!s.isGroupAdmin,dealership_id:s.dealershipId}}};localStorage.setItem(a,JSON.stringify(r)),t(`Forced login successful for ${s.email}. You can now go to:`),l("success")}catch(s){console.error("Force login error:",s),t("Error forcing login: "+String(s)),l("error")}finally{i(!1)}},disabled:n,className:"w-full",variant:"destructive",children:n?"Forcing login...":"Force Login"}),u.jsx(Bt,{onClick:()=>{try{localStorage.clear(),sessionStorage.clear(),t("All auth data cleared. You are now logged out."),l("success"),setTimeout(()=>window.location.reload(),1500)}catch(e){console.error("Logout error:",e),t("Error logging out: "+String(e)),l("error")}},variant:"outline",className:"w-1/3",children:"Clear All"})]})]}),u.jsxs("div",{className:"mt-4 text-center space-y-2",children:[u.jsx("a",{href:"/direct-login",className:"text-sm text-blue-600 hover:text-blue-800 hover:underline block",children:"Try Regular Direct Login"}),u.jsx("a",{href:"/",className:"text-sm text-blue-600 hover:text-blue-800 hover:underline block",children:"Return to Regular Login"})]})]})})},yi=()=>{const[e,s]=he.useState("Signing you out..."),[a,t]=he.useState(null),[r,l]=he.useState(!1),[n,i]=he.useState([]),o=pe(),c=e=>{const s=`${(new Date).toISOString()} - ${e}`;console.log(`[LogoutPage] ${e}`),i(e=>[...e,s])};return he.useEffect(()=>{const e=()=>h(null,null,function*(){var e;try{const{data:s,error:a}=yield ta.auth.getSession(),t=!!(null==s?void 0:s.session);return console.log("[LogoutPage] Session check:",{hasSession:t,error:(null==a?void 0:a.message)||null,timestamp:(new Date).toISOString(),sessionExpiry:(null==(e=null==s?void 0:s.session)?void 0:e.expires_at)?new Date(1e3*s.session.expires_at).toISOString():null}),t}catch(s){return console.error("[LogoutPage] Error checking session:",s),!1}}),a=()=>{try{c("Clearing all storage"),localStorage.removeItem("force_redirect_after_login"),localStorage.removeItem("force_redirect_timestamp"),localStorage.removeItem("logout_in_progress");const e=Object.keys(localStorage);console.log("[LogoutPage] LocalStorage keys before clearing:",e),localStorage.clear(),sessionStorage.clear();const s=document.cookie.split(";");return console.log("[LogoutPage] Cookies before clearing:",s),s.forEach(e=>{const[s]=e.trim().split("=");document.cookie=`${s}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`}),c("All storage cleared successfully"),!0}catch(e){return console.error("[LogoutPage] Error clearing storage:",e),c(`Error clearing storage: ${e instanceof Error?e.message:String(e)}`),!1}};h(null,null,function*(){try{c("Starting logout process");const t=yield e();if(c("Initial session check: "+(t?"Active session found":"No active session")),!t)return c("No active session found, just clearing storage"),a(),s("No active session. Clearing data and redirecting..."),l(!0),void setTimeout(()=>{window.location.href="/auth?forcelogin=true"},1e3);localStorage.setItem("logout_in_progress","true"),c("Set logout_in_progress flag");try{s("Signing out from Supabase..."),c("Attempting signOut via apiService");const e=Date.now();yield function(){return h(this,null,function*(){const{error:e}=yield ta.auth.signOut();if(e)throw console.error("Sign out error:",e),e})}();const a=Date.now()-e;c(`apiService.signOut completed in ${a}ms`)}catch(r){c(`Error with apiService.signOut: ${r instanceof Error?r.message:String(r)}`);try{c("Falling back to direct supabase.auth.signOut");const e=Date.now(),{error:s}=yield ta.auth.signOut(),a=Date.now()-e;c(s?`Direct Supabase signOut error: ${s.message}`:`Direct Supabase signOut successful in ${a}ms`)}catch(n){c(`Exception during direct Supabase signOut: ${n instanceof Error?n.message:String(n)}`)}}const i=yield e();c("Session check after signOut: "+(i?"Session still exists!":"Session successfully removed")),s("Clearing direct auth session...");try{St(),c("Direct auth logout successful")}catch(r){c(`Error during direct auth logout: ${r instanceof Error?r.message:String(r)}`)}s("Clearing browser storage...");const o=a();c("All storage cleared: "+(o?"success":"failed"));const d=yield e();c("Final session check: "+(d?"Session still exists! (unexpected)":"No session (expected)")),s("Logout successful! Redirecting..."),l(!0),setTimeout(()=>{c("Redirecting to auth page"),window.location.href="/auth?forcelogin=true"},1e3)}catch(i){console.error("[LogoutPage] Error during logout process:",i),c(`Logout process error: ${i instanceof Error?i.message:String(i)}`),t(`Logout failed: ${i instanceof Error?i.message:"Unknown error"}`),s("Error occurred during logout"),setTimeout(()=>{c("Redirecting after error"),window.location.href="/auth?forcelogin=true"},2e3)}});const n=setTimeout(()=>{r||(c("Logout timeout reached, forcing redirect"),s("Logout taking too long, redirecting..."),window.location.href="/auth?forcelogin=true")},5e3);return()=>clearTimeout(n)},[o]),u.jsx("div",{className:"flex min-h-screen flex-col items-center justify-center bg-gradient-to-b from-indigo-50 to-white p-4",children:u.jsx("div",{className:"w-full max-w-md space-y-8 rounded-xl bg-white p-8 shadow-xl",children:u.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[r||a?a?u.jsx("div",{className:"text-red-500",children:""}):u.jsx("div",{className:"text-green-500",children:""}):u.jsx(Ge,{className:"h-12 w-12 animate-spin text-indigo-600"}),u.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a?"Logout Failed":r?"Logged Out":"Logging Out"}),u.jsx("p",{className:"text-center text-gray-600",children:e}),a&&u.jsx("p",{className:"text-sm text-red-500",children:a}),u.jsx("p",{className:"text-sm text-gray-500",children:r?"Redirecting to login page...":a?"Trying to redirect to login page...":"You will be redirected to the login page automatically."}),!1]})})})},wi=()=>{const{user:e,hasSession:s}=It(),a=pe(),[t,r]=he.useState(5),[l,n]=he.useState(null);return he.useEffect(()=>{const s=e?(null==(a=e.user_metadata)?void 0:a.is_group_admin)||(null==(t=e.email)?void 0:t.toLowerCase().includes("group"))&&(null==(l=e.email)?void 0:l.toLowerCase().includes("@exampletest.com"))?(console.log("[TestLoginRedirect] User is a group admin, redirecting to /group-admin"),"/group-admin"):"testadmin@example.com"===e.email||"testadmin@exampletest.com"===e.email?(console.log("[TestLoginRedirect] User is master admin, redirecting to /master-admin"),"/master-admin"):"/dashboard":"/auth";var a,t,l;n(s);const i=setInterval(()=>{r(e=>e<=1?(clearInterval(i),console.log(`[TestLoginRedirect] Redirecting to ${s}`),window.location.href=s,0):e-1)},1e3);return()=>clearInterval(i)},[e,a,s]),u.jsx("div",{className:"flex min-h-screen flex-col items-center justify-center bg-gradient-to-b from-indigo-50 to-white p-4",children:u.jsx("div",{className:"w-full max-w-md space-y-8 rounded-xl bg-white p-8 shadow-xl",children:u.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[u.jsx(Ge,{className:"h-12 w-12 animate-spin text-indigo-600"}),u.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Redirecting..."}),u.jsx("p",{className:"text-center text-gray-600",children:e?u.jsxs(u.Fragment,{children:["Welcome, ",e.email,"!"]}):u.jsx(u.Fragment,{children:"No user detected, redirecting to login."})}),l&&u.jsxs("p",{className:"text-center text-gray-600",children:["You will be redirected to ",u.jsx("span",{className:"font-bold",children:l})," in"," ",t," seconds..."]}),u.jsx("div",{className:"mt-4",children:u.jsx("button",{onClick:()=>{l&&(window.location.href=l)},className:"rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700",children:"Go Now"})})]})})})},Si=()=>{const[e,s]=he.useState("idle"),[a,t]=he.useState("Click the button to log in as group admin"),[r,l]=he.useState(3);he.useEffect(()=>{"true"===new URLSearchParams(window.location.search).get("auto")&&n()},[]),he.useEffect(()=>{if("success"!==e)return;const s=setInterval(()=>{l(e=>e<=1?(clearInterval(s),window.location.href="/group-admin",0):e-1)},1e3);return()=>clearInterval(s)},[e]);const n=()=>h(null,null,function*(){s("loading"),t("Logging in...");try{if(yield ta.auth.signOut(),localStorage.clear(),"logout"in window)try{window.logout()}catch(e){console.error("Error calling direct logout:",e)}localStorage.setItem("bypass_redirect","/group-admin"),yield new Promise(e=>setTimeout(e,500));const{data:a,error:r}=yield ta.auth.signInWithPassword({email:"group1.admin@exampletest.com",password:"password123"});if(r)throw r;console.log("[GroupAdminBypass] Login successful:",a),yield ta.auth.updateUser({data:{is_group_admin:!0,role:"dealer_group_admin"}}),yield ta.from("profiles").update({is_group_admin:!0,role:"dealer_group_admin"}).eq("id",a.user.id),s("success"),t("Login successful! Redirecting to group admin dashboard..."),setTimeout(()=>{window.location.href="/group-admin"},3e3)}catch(a){console.error("[GroupAdminBypass] Login error:",a),s("error"),t(`Login failed: ${a instanceof Error?a.message:"Unknown error"}`)}});return u.jsx("div",{className:"flex min-h-screen flex-col items-center justify-center bg-gradient-to-b from-indigo-50 to-white p-4",children:u.jsx("div",{className:"w-full max-w-md space-y-8 rounded-xl bg-white p-8 shadow-xl",children:u.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[u.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Group Admin Login Bypass"}),u.jsx("p",{className:"text-center text-gray-600",children:a}),"loading"===e&&u.jsx(Ge,{className:"h-12 w-12 animate-spin text-indigo-600"}),"success"===e&&u.jsxs("p",{className:"text-green-600 font-semibold",children:["Redirecting in ",r," seconds..."]}),"error"===e&&u.jsx("p",{className:"text-red-600",children:"An error occurred. Please try again."}),"idle"===e&&u.jsx("button",{onClick:n,className:"rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700",children:"Login as Group Admin"}),"error"===e&&u.jsx("button",{onClick:n,className:"rounded bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700",children:"Try Again"}),u.jsx("a",{href:"/",className:"text-sm text-indigo-600 hover:underline",children:"Back to regular login"})]})})})},_i=()=>{const[e,s]=he.useState(!1),[a,t]=he.useState("Select a dashboard to access"),[r,l]=he.useState(null),[n,i]=he.useState(!0),o=e=>h(null,null,function*(){if(n)(e=>{try{console.log(`[DashboardSelector] Using direct bypass for ${e.name}`),console.log("[DashboardSelector] Clearing all auth data"),localStorage.removeItem("direct_auth_user"),localStorage.removeItem("directauth_user"),localStorage.removeItem("directauth_timestamp"),localStorage.removeItem("supabase.auth.token"),localStorage.removeItem("supabase.auth.expires_at"),localStorage.removeItem("supabase.auth.expires_in"),console.log("[DashboardSelector] Setting new auth data for",e.email);const s={id:`${e.role}-id-${Date.now()}`,email:e.email,role:e.role,isAdmin:"admin"===e.role,isGroupAdmin:"dealer_group_admin"===e.role,name:e.name,dealershipId:"dealership_admin"===e.role||"single_finance_manager"===e.role?1:void 0};localStorage.setItem("directauth_user",JSON.stringify(s)),localStorage.setItem("directauth_timestamp",Date.now().toString()),console.log(`[DashboardSelector] Redirecting to ${e.path}`),window.location.href=e.path}catch(a){console.error("[DashboardSelector] Bypass error:",a),l(`Bypass failed: ${a instanceof Error?a.message:"Unknown error"}`),s(!1)}})(e);else{s(!0),l(null),t(`Accessing ${e.name} dashboard...`);try{console.log("[DashboardSelector] Clearing existing session..."),yield ta.auth.signOut(),localStorage.clear(),window.sessionStorage.clear(),console.log(`[DashboardSelector] Signing in as ${e.email}...`);const{data:s,error:a}=yield ta.auth.signInWithPassword({email:e.email,password:"test123"});if(a)throw console.error("[DashboardSelector] Sign in error:",a),a;if(!s||!s.user)throw console.error("[DashboardSelector] No user data returned from sign in"),new Error("Authentication failed - no user data returned");if(console.log(`[DashboardSelector] Logged in as ${e.email}`),"single_finance_manager"===e.role||"finance_manager"===e.role)return console.log("[DashboardSelector] Using direct navigation for Finance Manager:",e.role),void(window.location.href=e.path);console.log(`[DashboardSelector] Updating user metadata with role: ${e.role}`);const t=yield ta.auth.updateUser({data:{role:e.role,is_group_admin:"dealer_group_admin"===e.role}});t.error&&console.error("[DashboardSelector] User metadata update error:",t.error),console.log(`[DashboardSelector] Updating profile record for user: ${s.user.id}`);const r=yield ta.from("profiles").update({role:e.role,is_group_admin:"dealer_group_admin"===e.role}).eq("id",s.user.id);r.error&&console.error("[DashboardSelector] Profile update error:",r.error),console.log(`[DashboardSelector] Redirecting to: ${e.path}`),window.location.href=e.path}catch(a){console.error("[DashboardSelector] Error:",a),l(`Login failed: ${a instanceof Error?a.message:"Unknown error"}`),s(!1)}}});return u.jsx("div",{className:"flex min-h-screen flex-col items-center justify-center bg-gradient-to-b from-indigo-50 to-white p-4",children:u.jsx("div",{className:"w-full max-w-md space-y-8 rounded-xl bg-white p-8 shadow-xl",children:u.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[u.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard Direct Access"}),u.jsx("p",{className:"text-sm text-red-500 font-bold",children:"FOR DEVELOPMENT USE ONLY"}),u.jsxs("div",{className:"flex items-center mb-2 w-full justify-between",children:[u.jsx("span",{className:"text-sm text-gray-700",children:"Authentication Method:"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{onClick:()=>i(!0),className:"px-3 py-1 text-xs rounded "+(n?"bg-blue-600 text-white":"bg-gray-200 text-gray-700"),children:"Quick Bypass"}),u.jsx("button",{onClick:()=>i(!1),className:"px-3 py-1 text-xs rounded "+(n?"bg-gray-200 text-gray-700":"bg-blue-600 text-white"),children:"Full Auth"})]})]}),r&&u.jsx("div",{className:"p-4 rounded-md bg-red-50 text-red-800 w-full",children:u.jsx("p",{children:r})}),u.jsx("p",{className:"text-center text-gray-600",children:a}),u.jsx("div",{className:"grid grid-cols-1 gap-3 w-full",children:[{name:"Master Admin",path:"/master-admin",email:"testadmin@example.com",role:"admin"},{name:"Group Admin",path:"/group-admin",email:"group1.admin@exampletest.com",role:"dealer_group_admin"},{name:"Dealership Admin",path:"/dashboard/admin",email:"dealer1.admin@exampletest.com",role:"dealership_admin"},{name:"Finance Manager",path:"/dashboard/finance",email:"finance@exampletest.com",role:"finance_manager"},{name:"Finance Director",path:"/dashboard/finance-director",email:"finance.director@exampletest.com",role:"finance_director"},{name:"Single Finance Manager",path:"/dashboard/single-finance",email:"testfinance@example.com",role:"single_finance_manager"},{name:"Sales Manager",path:"/dashboard/sales-manager",email:"sales.manager@exampletest.com",role:"sales_manager"},{name:"General Manager",path:"/dashboard/gm",email:"gm@exampletest.com",role:"general_manager"},{name:"Salesperson",path:"/dashboard/sales",email:"sales@exampletest.com",role:"salesperson"},{name:"Area Vice President",path:"/avp-full-dashboard",email:"avp@exampletest.com",role:"area_vice_president"}].map(s=>u.jsx("button",{onClick:()=>o(s),disabled:e,className:`p-3 rounded-md text-white w-full\n                  ${e?"bg-gray-400":"bg-blue-600 hover:bg-blue-700"}\n                  ${"Master Admin"===s.name?"bg-purple-700 hover:bg-purple-800":""}\n                  ${"Group Admin"===s.name?"bg-green-600 hover:bg-green-700":""}\n                  ${s.name.includes("Finance Manager")?"bg-indigo-600 hover:bg-indigo-700":""}\n                `,children:s.name},s.path))}),e&&u.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-700"}),u.jsx("div",{className:"mt-6 border-t border-gray-200 pt-4 w-full",children:u.jsx("a",{href:"/",className:"text-sm text-blue-600 hover:underline",children:"Back to regular login"})})]})})})},Di=[{id:1,name:"Sarah Johnson",email:"sarah.johnson@dealership.com",phone:"(555) 123-4567",role:"Sales Associate",team:"Team A",status:"active",performance:"top",joinDate:"2021-03-12",deals:24,lastActivity:"2 hours ago"},{id:2,name:"Michael Chen",email:"michael.chen@dealership.com",phone:"(555) 234-5678",role:"Sales Associate",team:"Team A",status:"active",performance:"high",joinDate:"2021-06-15",deals:20,lastActivity:"4 hours ago"},{id:3,name:"David Rodriguez",email:"david.rodriguez@dealership.com",phone:"(555) 345-6789",role:"Sales Associate",team:"Team A",status:"active",performance:"high",joinDate:"2022-01-07",deals:18,lastActivity:"35 minutes ago"},{id:4,name:"Amanda Williams",email:"amanda.williams@dealership.com",phone:"(555) 456-7890",role:"Sales Associate",team:"Team B",status:"active",performance:"medium",joinDate:"2022-03-28",deals:16,lastActivity:"1 day ago"},{id:5,name:"Robert Johnson",email:"robert.johnson@dealership.com",phone:"(555) 567-8901",role:"Sales Associate",team:"Team B",status:"active",performance:"medium",joinDate:"2022-05-10",deals:15,lastActivity:"3 hours ago"},{id:6,name:"Lisa Thompson",email:"lisa.thompson@dealership.com",phone:"(555) 678-9012",role:"Sales Associate",team:"Team B",status:"inactive",performance:"low",joinDate:"2022-08-22",deals:8,lastActivity:"2 weeks ago"}],Pi=[{team:"Team A",members:3,dealsTotal:62,avgDealsPerMember:20.7,grossTotal:87800,avgGross:1415.5,closingRatio:32},{team:"Team B",members:3,dealsTotal:39,avgDealsPerMember:13,grossTotal:52600,avgGross:1348.7,closingRatio:28}],Ci=()=>{const[e,s]=he.useState(""),[a,t]=he.useState("all"),[r,l]=he.useState("members"),[n,i]=he.useState(null),[o,c]=he.useState(""),[d,m]=he.useState(!1),[h,x]=he.useState(""),[p,g]=he.useState("#4f46e5"),f=Di.filter(s=>{const t=s.name.toLowerCase().includes(e.toLowerCase())||s.email.toLowerCase().includes(e.toLowerCase()),r="all"===a||s.team===a;return t&&r});return u.jsxs("div",{className:"container py-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx(Bt,{variant:"ghost",size:"sm",asChild:!0,className:"mr-2",children:u.jsxs(fe,{to:"/dashboard",children:[u.jsx(Xe,{className:"h-4 w-4 mr-1"}),"Back to Dashboard"]})}),u.jsx("h1",{className:"text-3xl font-bold",children:"Team Management"})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs(Bt,{variant:"outline",onClick:()=>m(!0),children:[u.jsx(vs,{className:"mr-2 h-4 w-4"}),"Add Team"]}),u.jsxs(Bt,{children:[u.jsx($s,{className:"mr-2 h-4 w-4"}),"Add Team Member"]})]})]}),u.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsx(Mt,{className:"text-sm font-medium",children:"Total Team Members"})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:Di.length}),u.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[Di.filter(e=>"active"===e.status).length," active members"]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsx(Mt,{className:"text-sm font-medium",children:"Total Deals (MTD)"})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:Pi.reduce((e,s)=>e+s.dealsTotal,0)}),u.jsx("p",{className:"text-xs text-green-600 mt-1",children:"+8% from last month"})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsx(Mt,{className:"text-sm font-medium",children:"Avg Deals Per Person"})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:(Pi.reduce((e,s)=>e+s.dealsTotal,0)/Di.filter(e=>"active"===e.status).length).toFixed(1)}),u.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Target: 15 deals"})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsx(Mt,{className:"text-sm font-medium",children:"Avg Closing Ratio"})}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:[(Pi.reduce((e,s)=>e+s.closingRatio*s.members,0)/Di.filter(e=>"active"===e.status).length).toFixed(1),"%"]}),u.jsx("p",{className:"text-xs text-green-600 mt-1",children:"+2.5% from last month"})]})]})]}),u.jsxs(dn,{value:r,onValueChange:l,className:"mb-6",children:[u.jsxs(mn,{children:[u.jsxs(hn,{value:"members",children:[u.jsx(vs,{className:"h-4 w-4 mr-2"}),"Team Members"]}),u.jsxs(hn,{value:"performance",children:[u.jsx(Es,{className:"h-4 w-4 mr-2"}),"Performance"]}),u.jsxs(hn,{value:"training",children:[u.jsx(Ws,{className:"h-4 w-4 mr-2"}),"Training & Development"]})]}),u.jsx(un,{value:"members",className:"mt-6",children:u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-4",children:u.jsxs("div",{className:"flex justify-between flex-wrap gap-4",children:[u.jsx(Mt,{children:"Team Members"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs("div",{className:"relative",children:[u.jsx(ds,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500"}),u.jsx(Vt,{type:"search",placeholder:"Search members...",className:"w-64 pl-8",value:e,onChange:e=>s(e.target.value)})]}),u.jsxs(ql,{value:a,onValueChange:t,children:[u.jsx(Yl,{className:"w-36",children:u.jsx(Jl,{placeholder:"Select Team"})}),u.jsxs(Zl,{children:[u.jsx(Ql,{value:"all",children:"All Teams"}),u.jsx(Ql,{value:"Team A",children:"Team A"}),u.jsx(Ql,{value:"Team B",children:"Team B"})]})]})]})]})}),u.jsx($t,{children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Name"}),u.jsx(tn,{children:"Role"}),u.jsx(tn,{children:"Team"}),u.jsx(tn,{children:"Deals (MTD)"}),u.jsx(tn,{children:"Status"}),u.jsx(tn,{children:"Last Activity"}),u.jsx(tn,{className:"text-right",children:"Actions"})]})}),u.jsx(sn,{children:f.map(e=>u.jsxs(an,{children:[u.jsx(rn,{className:"font-medium",children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center",children:u.jsx(Re,{className:"h-4 w-4 text-gray-600"})}),u.jsxs("div",{children:[u.jsx("div",{children:e.name}),u.jsx("div",{className:"text-xs text-gray-500",children:e.email})]})]})}),u.jsx(rn,{children:e.role}),u.jsx(rn,{children:e.team}),u.jsx(rn,{children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("span",{className:"font-medium "+("top"===e.performance?"text-green-600":"high"===e.performance?"text-blue-600":"medium"===e.performance?"text-amber-600":"text-gray-600"),children:e.deals}),"top"===e.performance&&u.jsx(Ws,{className:"ml-1 h-4 w-4 text-green-600"})]})}),u.jsx(rn,{children:u.jsxs("div",{className:"flex items-center",children:[u.jsx(Pn,{checked:"active"===e.status,onCheckedChange:s=>{const a=s?"active":"inactive";console.log(`Set ${e.name} to ${a}`),"inactive"===a&&alert(`A notification has been sent to the Admin to delete ${e.name}.`)},id:`active-status-${e.id}`}),u.jsx("label",{htmlFor:`active-status-${e.id}`,className:"ml-2 text-sm",children:u.jsx("span",{className:"px-2 py-1 rounded-full text-xs "+("active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:"active"===e.status?"Active":"Inactive"})})]})}),u.jsx(rn,{children:u.jsxs("div",{className:"flex items-center text-gray-500 text-sm",children:[u.jsx(ze,{className:"mr-1 h-3 w-3"}),e.lastActivity]})}),u.jsx(rn,{className:"text-right",children:u.jsx("div",{className:"flex justify-end gap-2",children:u.jsx(Bt,{variant:"ghost",size:"sm",onClick:()=>(e=>{i(e),c(e.team)})(e),children:u.jsx(Ns,{className:"h-4 w-4"})})})})]},e.id))})]})})]})}),u.jsx(un,{value:"performance",className:"mt-6",children:u.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Team Performance"})}),u.jsxs($t,{children:[u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Team"}),u.jsx(tn,{className:"text-right",children:"Total Units"}),u.jsx(tn,{className:"text-right",children:"New Units"}),u.jsx(tn,{className:"text-right",children:"Used Units"}),u.jsx(tn,{className:"text-right",children:"Total Gross"}),u.jsx(tn,{className:"text-right",children:"PVR"})]})}),u.jsx(sn,{children:[{team:"Team A",members:3,totalUnits:62,newUnits:36,usedUnits:26,totalGross:124500,pvr:2008,lastMonth:58,ytd:394,avgMonthly:65.7,annualPace:788,closingRatio:32},{team:"Team B",members:2,totalUnits:38,newUnits:22,usedUnits:16,totalGross:76e3,pvr:2e3,lastMonth:30,ytd:224,avgMonthly:37.3,annualPace:448,closingRatio:28}].map(e=>u.jsxs(an,{children:[u.jsx(rn,{className:"font-medium",children:e.team}),u.jsx(rn,{className:"text-right",children:e.totalUnits}),u.jsx(rn,{className:"text-right",children:e.newUnits}),u.jsx(rn,{className:"text-right",children:e.usedUnits}),u.jsxs(rn,{className:"text-right",children:["$",e.totalGross.toLocaleString()]}),u.jsxs(rn,{className:"text-right",children:["$",e.pvr]})]},e.team))})]}),u.jsxs("div",{className:"mt-6",children:[u.jsx("h3",{className:"text-sm font-medium mb-4",children:"Extended Metrics"}),u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Team"}),u.jsx(tn,{className:"text-right",children:"Last Month"}),u.jsx(tn,{className:"text-right",children:"YTD"}),u.jsx(tn,{className:"text-right",children:"Avg/Month"}),u.jsx(tn,{className:"text-right",children:"Annual Pace"})]})}),u.jsx(sn,{children:[{team:"Team A",members:3,totalUnits:62,newUnits:36,usedUnits:26,totalGross:124500,pvr:2008,lastMonth:58,ytd:394,avgMonthly:65.7,annualPace:788,closingRatio:32},{team:"Team B",members:2,totalUnits:38,newUnits:22,usedUnits:16,totalGross:76e3,pvr:2e3,lastMonth:30,ytd:224,avgMonthly:37.3,annualPace:448,closingRatio:28}].map(e=>u.jsxs(an,{children:[u.jsx(rn,{className:"font-medium",children:e.team}),u.jsx(rn,{className:"text-right",children:e.lastMonth}),u.jsx(rn,{className:"text-right",children:e.ytd}),u.jsx(rn,{className:"text-right",children:e.avgMonthly.toFixed(1)}),u.jsx(rn,{className:"text-right",children:e.annualPace})]},e.team))})]})]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Performance Indicators"})}),u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-1",children:[u.jsx("span",{className:"text-sm font-medium",children:"Closing Ratio"}),u.jsxs("span",{className:"text-sm font-medium text-green-600",children:[u.jsx(qs,{className:"inline-block h-4 w-4 mr-1"}),"Good"]})]}),u.jsx("div",{className:"h-2.5 w-full bg-gray-200 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:"85%"}})}),u.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[u.jsx("span",{children:"Current: 30%"}),u.jsx("span",{children:"Target: 25%"})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-1",children:[u.jsx("span",{className:"text-sm font-medium",children:"Deals Per Person"}),u.jsxs("span",{className:"text-sm font-medium text-amber-600",children:[u.jsx(Ee,{className:"inline-block h-4 w-4 mr-1"}),"Average"]})]}),u.jsx("div",{className:"h-2.5 w-full bg-gray-200 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-amber-500 rounded-full",style:{width:"68%"}})}),u.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[u.jsx("span",{children:"Current: 12.2"}),u.jsx("span",{children:"Target: 15"})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-1",children:[u.jsx("span",{className:"text-sm font-medium",children:"Customer Satisfaction"}),u.jsxs("span",{className:"text-sm font-medium text-green-600",children:[u.jsx(qs,{className:"inline-block h-4 w-4 mr-1"}),"Excellent"]})]}),u.jsx("div",{className:"h-2.5 w-full bg-gray-200 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:"92%"}})}),u.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[u.jsx("span",{children:"Current: 4.7/5"}),u.jsx("span",{children:"Target: 4.5/5"})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-1",children:[u.jsx("span",{className:"text-sm font-medium",children:"Follow-up Completion"}),u.jsxs("span",{className:"text-sm font-medium text-amber-600",children:[u.jsx(Ee,{className:"inline-block h-4 w-4 mr-1"}),"Needs Improvement"]})]}),u.jsx("div",{className:"h-2.5 w-full bg-gray-200 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-amber-500 rounded-full",style:{width:"65%"}})}),u.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[u.jsx("span",{children:"Current: 65%"}),u.jsx("span",{children:"Target: 90%"})]})]})]})})]})]})}),u.jsx(un,{value:"training",className:"mt-6",children:u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Training & Development"})}),u.jsx($t,{children:u.jsxs("div",{className:"text-center py-12",children:[u.jsx(zs,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),u.jsx("h3",{className:"text-lg font-medium mb-2",children:"Training Module Coming Soon"}),u.jsx("p",{className:"text-gray-500 max-w-md mx-auto",children:"The training and development module is currently under development. Check back soon for updates on training courses, certifications, and skill development tracking."})]})})]})})]}),u.jsx(br,{open:d,onOpenChange:m,children:u.jsxs(Sr,{children:[u.jsxs(_r,{children:[u.jsx(Pr,{children:"Add New Team"}),u.jsx(Cr,{children:"Create a new team to organize your salespeople."})]}),u.jsxs("div",{className:"space-y-4 py-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"team-name",children:"Team Name"}),u.jsx(Vt,{id:"team-name",placeholder:"Enter team name",value:h,onChange:e=>x(e.target.value)})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"team-color",children:"Team Color"}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx("input",{type:"color",id:"team-color",value:p,onChange:e=>g(e.target.value),className:"p-0 h-9 w-9 border rounded cursor-pointer"}),u.jsx("div",{className:"text-sm",children:p})]})]})]}),u.jsxs(Dr,{children:[u.jsx(Bt,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),u.jsx(Bt,{onClick:()=>{h.trim()?(console.log(`Created new team: ${h} with color ${p}`),x(""),g("#4f46e5"),m(!1)):alert("Please enter a team name")},children:"Create Team"})]})]})}),n&&u.jsx(br,{open:!!n,onOpenChange:()=>i(null),children:u.jsxs(Sr,{children:[u.jsxs(_r,{children:[u.jsx(Pr,{children:"Edit Team Assignment"}),u.jsxs(Cr,{children:["Change the team assignment for ",n.name,". Sales Managers can only modify team assignments."]})]}),u.jsxs("div",{className:"py-4",children:[u.jsx(Jt,{htmlFor:"team-select",children:"Team Assignment"}),u.jsxs(ql,{value:o,onValueChange:c,children:[u.jsx(Yl,{id:"team-select",children:u.jsx(Jl,{placeholder:"Select Team"})}),u.jsxs(Zl,{children:[u.jsx(Ql,{value:"Team A",children:"Team A"}),u.jsx(Ql,{value:"Team B",children:"Team B"})]})]})]}),u.jsxs(Dr,{children:[u.jsx(Bt,{variant:"outline",onClick:()=>i(null),children:"Cancel"}),u.jsx(Bt,{onClick:()=>{console.log(`Changed ${n.name}'s team to ${o}`),i(null)},children:"Save Changes"})]})]})})]})},ki=[{id:1,name:"Sarah Johnson",team:"Team A",currentUnits:24,goalUnits:30,lastMonth:28,avgMonthly:26,grossTarget:45e3,currentGross:38500,frontGrossGoal:1200,backEndGoal:900},{id:2,name:"Michael Chen",team:"Team A",currentUnits:20,goalUnits:25,lastMonth:22,avgMonthly:21,grossTarget:38e3,currentGross:32100,frontGrossGoal:1100,backEndGoal:850},{id:3,name:"David Rodriguez",team:"Team A",currentUnits:18,goalUnits:22,lastMonth:16,avgMonthly:18,grossTarget:32e3,currentGross:28700,frontGrossGoal:950,backEndGoal:800},{id:4,name:"Amanda Williams",team:"Team B",currentUnits:16,goalUnits:20,lastMonth:14,avgMonthly:15,grossTarget:3e4,currentGross:21800,frontGrossGoal:900,backEndGoal:750},{id:5,name:"Robert Johnson",team:"Team B",currentUnits:15,goalUnits:18,lastMonth:16,avgMonthly:14,grossTarget:28e3,currentGross:19500,frontGrossGoal:850,backEndGoal:700}],Ti=[{id:1,name:"Team A",members:3,currentUnits:62,goalUnits:75,lastMonth:66,grossTarget:115e3,currentGross:99300,closingRatioTarget:35,currentClosingRatio:32,frontEndTarget:1200,backEndTarget:800},{id:2,name:"Team B",members:2,currentUnits:31,goalUnits:40,lastMonth:30,grossTarget:6e4,currentGross:41300,closingRatioTarget:30,currentClosingRatio:28,frontEndTarget:1100,backEndTarget:700}],Fi={newVehicles:65,usedVehicles:50,totalUnits:115,totalGross:175e3,avgGrossPerUnit:1500,closingRatio:32},Ai=()=>{const[e,s]=he.useState("individual"),[a,t]=he.useState(!1),r=(()=>{const e=ki.reduce((e,s)=>e+s.currentUnits,0),s=ki.reduce((e,s)=>e+s.goalUnits,0);return{currentUnits:e,goalUnits:s,percentage:Math.round(e/s*100)}})();return u.jsxs("div",{className:"container py-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx(Bt,{variant:"ghost",size:"sm",asChild:!0,className:"mr-2",children:u.jsxs(fe,{to:"/dashboard",children:[u.jsx(Xe,{className:"h-4 w-4 mr-1"}),"Back to Dashboard"]})}),u.jsx("h1",{className:"text-3xl font-bold",children:"Set Team Goals"})]}),u.jsx(Bt,{onClick:()=>t(!a),children:a?u.jsxs(u.Fragment,{children:[u.jsx(ys,{className:"mr-2 h-4 w-4"}),"Save Goals"]}):u.jsxs(u.Fragment,{children:[u.jsx(Ns,{className:"mr-2 h-4 w-4"}),"Edit Goals"]})})]}),u.jsxs(Ut,{className:"mb-6",children:[u.jsx(Gt,{className:"pb-2",children:u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(Ve,{className:"mr-2 h-5 w-5 text-blue-600"}),"Monthly Dealership Targets"]})}),u.jsx($t,{children:u.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6",children:[u.jsxs("div",{children:[u.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"New Vehicles"}),u.jsxs("div",{className:"text-xl font-bold flex items-center",children:[u.jsx(js,{className:"mr-2 h-4 w-4 text-green-600"}),Fi.newVehicles]})]}),u.jsxs("div",{children:[u.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Used Vehicles"}),u.jsxs("div",{className:"text-xl font-bold flex items-center",children:[u.jsx(js,{className:"mr-2 h-4 w-4 text-amber-600"}),Fi.usedVehicles]})]}),u.jsxs("div",{children:[u.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Total Units"}),u.jsxs("div",{className:"text-xl font-bold flex items-center",children:[u.jsx(vs,{className:"mr-2 h-4 w-4 text-blue-600"}),Fi.totalUnits]})]}),u.jsxs("div",{children:[u.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Total Gross"}),u.jsxs("div",{className:"text-xl font-bold flex items-center",children:[u.jsx(Ke,{className:"mr-2 h-4 w-4 text-purple-600"}),"$",Fi.totalGross.toLocaleString()]})]}),u.jsxs("div",{children:[u.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Avg. Gross/Unit"}),u.jsxs("div",{className:"text-xl font-bold flex items-center",children:[u.jsx(qe,{className:"mr-2 h-4 w-4 text-indigo-600"}),"$",Fi.avgGrossPerUnit.toLocaleString()]})]}),u.jsxs("div",{children:[u.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Closing Ratio"}),u.jsxs("div",{className:"text-xl font-bold flex items-center",children:[u.jsx(Js,{className:"mr-2 h-4 w-4 text-blue-600"}),Fi.closingRatio,"%"]})]})]})})]}),u.jsxs(Ut,{className:"mb-6",children:[u.jsx(Gt,{className:"pb-2",children:u.jsx(Mt,{children:"Overall Goal Progress"})}),u.jsx($t,{children:u.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between",children:[u.jsxs("div",{className:"flex items-center mb-4 md:mb-0",children:[u.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center mr-4",children:u.jsx(Ve,{className:"h-8 w-8 text-blue-600"})}),u.jsxs("div",{children:[u.jsx("div",{className:"text-sm text-gray-500",children:"Total Units Sold"}),u.jsxs("div",{className:"text-2xl font-bold",children:[r.currentUnits," / ",r.goalUnits]}),u.jsxs("div",{className:"text-sm text-gray-500",children:[r.percentage,"% of monthly goal"]})]})]}),u.jsxs("div",{className:"w-full md:w-3/5",children:[u.jsx("div",{className:"h-4 w-full bg-gray-100 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full rounded-full "+(r.percentage>=90?"bg-green-500":r.percentage>=70?"bg-blue-500":r.percentage>=50?"bg-amber-500":"bg-red-500"),style:{width:`${Math.min(r.percentage,100)}%`}})}),u.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[u.jsx("span",{children:"0"}),u.jsx("span",{children:"25%"}),u.jsx("span",{children:"50%"}),u.jsx("span",{children:"75%"}),u.jsx("span",{children:"100%"})]})]})]})})]}),u.jsxs(dn,{value:e,onValueChange:s,className:"mb-6",children:[u.jsxs(mn,{children:[u.jsxs(hn,{value:"individual",children:[u.jsx(Ys,{className:"h-4 w-4 mr-2"}),"Individual Goals"]}),u.jsxs(hn,{value:"team",children:[u.jsx(vs,{className:"h-4 w-4 mr-2"}),"Team Goals"]}),u.jsxs(hn,{value:"history",children:[u.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Historical Data"]})]}),u.jsx(un,{value:"individual",className:"mt-6",children:u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Individual Salesperson Goals"})}),u.jsx($t,{children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Name"}),u.jsx(tn,{children:"Team"}),u.jsx(tn,{className:"text-right",children:"Current"}),u.jsx(tn,{className:"text-right",children:"Goal"}),u.jsx(tn,{className:"text-right",children:"Last Month"}),u.jsx(tn,{className:"text-right",children:"Progress"}),u.jsx(tn,{className:"text-right",children:"Gross"}),u.jsx(tn,{className:"text-right",children:"Avg Front Gross"}),u.jsx(tn,{className:"text-right",children:"Avg Back End Gross"})]})}),u.jsx(sn,{children:ki.map(e=>{const s=Math.round(e.currentUnits/e.goalUnits*100),t=e.currentUnits-e.lastMonth;return u.jsxs(an,{children:[u.jsx(rn,{className:"font-medium",children:e.name}),u.jsx(rn,{children:e.team}),u.jsx(rn,{className:"text-right",children:e.currentUnits}),u.jsx(rn,{className:"text-right",children:a?u.jsx(Vt,{type:"number",defaultValue:e.goalUnits,className:"w-16 h-8 text-right inline-block"}):e.goalUnits}),u.jsx(rn,{className:"text-right",children:u.jsxs("div",{className:"flex items-center justify-end",children:[e.lastMonth," ",t>0?u.jsx(gs,{className:"ml-1 h-3 w-3 text-green-600"}):t<0?u.jsx(fs,{className:"ml-1 h-3 w-3 text-red-600"}):null]})}),u.jsx(rn,{className:"text-right",children:u.jsxs("div",{className:"flex items-center justify-end",children:[u.jsx("div",{className:"w-20 h-2 bg-gray-100 rounded-full mr-2 overflow-hidden",children:u.jsx("div",{className:"h-full rounded-full "+(s>=90?"bg-green-500":s>=70?"bg-blue-500":s>=50?"bg-amber-500":"bg-red-500"),style:{width:`${Math.min(s,100)}%`}})}),u.jsxs("span",{className:"text-xs",children:[s,"%"]})]})}),u.jsxs(rn,{className:"text-right",children:["$",e.currentGross.toLocaleString()," / $",e.grossTarget.toLocaleString()]}),u.jsx(rn,{className:"text-right",children:a?u.jsxs("div",{className:"flex items-center justify-end gap-2",children:[u.jsx(Vt,{type:"number",defaultValue:e.frontGrossGoal,min:"0",max:"9999",step:"1",className:"w-20 h-8 text-right inline-block"}),u.jsx("span",{children:"$"})]}):"$"+e.frontGrossGoal.toLocaleString(void 0,{maximumFractionDigits:0})}),u.jsx(rn,{className:"text-right",children:a?u.jsxs("div",{className:"flex items-center justify-end gap-2",children:[u.jsx(Vt,{type:"number",defaultValue:e.backEndGoal,min:"0",max:"9999",step:"1",className:"w-20 h-8 text-right inline-block"}),u.jsx("span",{children:"$"})]}):"$"+e.backEndGoal.toLocaleString(void 0,{maximumFractionDigits:0})})]},e.id)})})]})})]})}),u.jsx(un,{value:"team",className:"mt-6",children:u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Team Goals"})}),u.jsxs($t,{children:[u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Team"}),u.jsx(tn,{className:"text-right",children:"Members"}),u.jsx(tn,{className:"text-right",children:"Current / Goal"}),u.jsx(tn,{className:"text-right",children:"Last Month"}),u.jsx(tn,{className:"text-right",children:"Progress"}),u.jsx(tn,{className:"text-right",children:"Gross"}),u.jsx(tn,{className:"text-right",children:"Closing Ratio"})]})}),u.jsx(sn,{children:Ti.map(e=>{const s=Math.round(e.currentUnits/e.goalUnits*100),t=e.currentUnits-e.lastMonth;return u.jsxs(an,{children:[u.jsx(rn,{className:"font-medium",children:e.name}),u.jsx(rn,{className:"text-right",children:e.members}),u.jsxs(rn,{className:"text-right",children:[e.currentUnits," /"," ",a?u.jsx(Vt,{type:"number",defaultValue:e.goalUnits,className:"w-16 h-8 text-right inline-block"}):e.goalUnits]}),u.jsx(rn,{className:"text-right",children:u.jsxs("div",{className:"flex items-center justify-end",children:[e.lastMonth," ",t>0?u.jsx(gs,{className:"ml-1 h-3 w-3 text-green-600"}):t<0?u.jsx(fs,{className:"ml-1 h-3 w-3 text-red-600"}):null]})}),u.jsx(rn,{className:"text-right",children:u.jsxs("div",{className:"flex items-center justify-end",children:[u.jsx("div",{className:"w-20 h-2 bg-gray-100 rounded-full mr-2 overflow-hidden",children:u.jsx("div",{className:"h-full rounded-full "+(s>=90?"bg-green-500":s>=70?"bg-blue-500":s>=50?"bg-amber-500":"bg-red-500"),style:{width:`${Math.min(s,100)}%`}})}),u.jsxs("span",{className:"text-xs",children:[s,"%"]})]})}),u.jsxs(rn,{className:"text-right",children:["$",e.currentGross.toLocaleString()," / $",e.grossTarget.toLocaleString()]}),u.jsxs(rn,{className:"text-right",children:[e.currentClosingRatio,"% /"," ",a?u.jsx(Vt,{type:"number",defaultValue:e.closingRatioTarget,className:"w-12 h-8 text-right inline-block"}):`${e.closingRatioTarget}%`]})]},e.id)})})]}),u.jsxs("div",{className:"mt-8 grid md:grid-cols-2 gap-6",children:[u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsx(Mt,{className:"text-sm",children:"Front End / Back End Targets"})}),u.jsx($t,{children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Team"}),u.jsx(tn,{className:"text-right",children:"Front End Target"}),u.jsx(tn,{className:"text-right",children:"Back End Target"})]})}),u.jsx(sn,{children:Ti.map(e=>u.jsxs(an,{children:[u.jsx(rn,{children:e.name}),u.jsxs(rn,{className:"text-right",children:["$",a?u.jsx(Vt,{type:"number",defaultValue:e.frontEndTarget,className:"w-20 h-8 text-right inline-block"}):e.frontEndTarget.toLocaleString()]}),u.jsxs(rn,{className:"text-right",children:["$",a?u.jsx(Vt,{type:"number",defaultValue:e.backEndTarget,className:"w-20 h-8 text-right inline-block"}):e.backEndTarget.toLocaleString()]})]},`fe-${e.id}`))})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsx(Mt,{className:"text-sm",children:"Performance Bonus Structure"})}),u.jsx($t,{children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Achievement Level"}),u.jsx(tn,{className:"text-right",children:"Team Bonus"}),u.jsx(tn,{className:"text-right",children:"Individual Bonus"})]})}),u.jsxs(sn,{children:[u.jsxs(an,{children:[u.jsx(rn,{children:"100% of Goal"}),u.jsx(rn,{className:"text-right",children:"$1,000"}),u.jsx(rn,{className:"text-right",children:"$500"})]}),u.jsxs(an,{children:[u.jsx(rn,{children:"110% of Goal"}),u.jsx(rn,{className:"text-right",children:"$2,000"}),u.jsx(rn,{className:"text-right",children:"$1,000"})]}),u.jsxs(an,{children:[u.jsx(rn,{children:"120% of Goal"}),u.jsx(rn,{className:"text-right",children:"$3,500"}),u.jsx(rn,{className:"text-right",children:"$1,500"})]})]})]})})]})]})]})]})}),u.jsx(un,{value:"history",className:"mt-6",children:u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Historical Performance"})}),u.jsx($t,{children:u.jsxs("div",{className:"text-center py-12",children:[u.jsx(Oe,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),u.jsx("h3",{className:"text-lg font-medium mb-2",children:"Historical Data Module Coming Soon"}),u.jsx("p",{className:"text-gray-500 max-w-md mx-auto",children:"The historical performance and goals tracking module is currently under development. Check back soon for detailed reports on past performance and goal achievement."})]})})]})})]})]})},Ei=[{id:1,name:"Sarah Johnson",team:"Team A",color:"#4f46e5"},{id:2,name:"Michael Chen",team:"Team A",color:"#4f46e5"},{id:3,name:"David Rodriguez",team:"Team A",color:"#4f46e5"},{id:4,name:"Amanda Williams",team:"Team B",color:"#0891b2"},{id:5,name:"Robert Johnson",team:"Team B",color:"#0891b2"}],Ii=[{id:1,name:"Opening (9am-6pm)",color:"#22c55e"},{id:2,name:"Mid (10am-7pm)",color:"#3b82f6"},{id:3,name:"Closing (12pm-9pm)",color:"#8b5cf6"},{id:4,name:"Weekend (9am-5pm)",color:"#f59e0b"},{id:5,name:"Off",color:"#e5e7eb"}],Ui=[{date:"2023-06-12",day:"Monday",shifts:[{memberId:1,shiftTypeId:1},{memberId:2,shiftTypeId:1},{memberId:3,shiftTypeId:1},{memberId:4,shiftTypeId:5},{memberId:5,shiftTypeId:5}]},{date:"2023-06-13",day:"Tuesday",shifts:[{memberId:1,shiftTypeId:1},{memberId:2,shiftTypeId:1},{memberId:3,shiftTypeId:1},{memberId:4,shiftTypeId:5},{memberId:5,shiftTypeId:5}]},{date:"2023-06-14",day:"Wednesday",shifts:[{memberId:1,shiftTypeId:2},{memberId:2,shiftTypeId:2},{memberId:3,shiftTypeId:2},{memberId:4,shiftTypeId:5},{memberId:5,shiftTypeId:5}]},{date:"2023-06-15",day:"Thursday",shifts:[{memberId:1,shiftTypeId:5},{memberId:2,shiftTypeId:5},{memberId:3,shiftTypeId:5},{memberId:4,shiftTypeId:1},{memberId:5,shiftTypeId:1}]},{date:"2023-06-16",day:"Friday",shifts:[{memberId:1,shiftTypeId:5},{memberId:2,shiftTypeId:5},{memberId:3,shiftTypeId:5},{memberId:4,shiftTypeId:3},{memberId:5,shiftTypeId:3}]},{date:"2023-06-17",day:"Saturday",shifts:[{memberId:1,shiftTypeId:4},{memberId:2,shiftTypeId:4},{memberId:3,shiftTypeId:4},{memberId:4,shiftTypeId:4},{memberId:5,shiftTypeId:4}]},{date:"2023-06-18",day:"Sunday",shifts:[{memberId:1,shiftTypeId:5},{memberId:2,shiftTypeId:5},{memberId:3,shiftTypeId:5},{memberId:4,shiftTypeId:4},{memberId:5,shiftTypeId:5}]}],Gi=(e=new Date)=>{const s=[],a=new Date(e);a.setDate(a.getDate()-a.getDay());for(let t=0;t<7;t++)s.push(new Date(a)),a.setDate(a.getDate()+1);return s},Mi=e=>e.toISOString().split("T")[0],Ri=()=>{const[e,s]=he.useState(new Date),[a,t]=he.useState("week"),[r,l]=he.useState(Gi()),[n,i]=he.useState(null),[o,c]=he.useState(null),[d,m]=he.useState(null),h=e=>{const s=new Date(r[0]);s.setDate(s.getDate()+("next"===e?7:-7)),l(Gi(s))},x=e=>Ii.find(s=>s.id===e),p=new Intl.DateTimeFormat("en-US",{month:"long",year:"numeric"}).format(r[0]);return u.jsxs("div",{className:"container py-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx(Bt,{variant:"ghost",size:"sm",asChild:!0,className:"mr-2",children:u.jsxs(fe,{to:"/dashboard",children:[u.jsx(Xe,{className:"h-4 w-4 mr-1"}),"Back to Dashboard"]})}),u.jsx("h1",{className:"text-3xl font-bold",children:"Sales Schedule Configurator"})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(Ps,{className:"mr-2 h-4 w-4"}),"Copy Last Week"]}),u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(as,{className:"mr-2 h-4 w-4"}),"Export Schedule"]}),u.jsxs(Bt,{children:[u.jsx(ys,{className:"mr-2 h-4 w-4"}),"Save Changes"]})]})]}),u.jsxs(Ut,{className:"mb-6",children:[u.jsx(Gt,{className:"pb-3",children:u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx(Oe,{className:"h-5 w-5 text-gray-500 mr-2"}),u.jsx(Mt,{children:p})]}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsxs(Bt,{variant:"outline",size:"sm",onClick:()=>h("prev"),children:[u.jsx(Xe,{className:"h-4 w-4"}),"Previous Week"]}),u.jsx(Bt,{variant:"outline",size:"sm",onClick:()=>l(Gi(new Date)),children:"Today"}),u.jsxs(Bt,{variant:"outline",size:"sm",onClick:()=>h("next"),children:["Next Week",u.jsx(es,{className:"ml-2 h-4 w-4"})]})]})]})}),u.jsx($t,{className:"pb-4",children:u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("div",{className:"min-w-full",children:[u.jsxs("div",{className:"grid grid-cols-8 border-b",children:[u.jsx("div",{className:"font-medium text-sm p-3 border-r bg-gray-50",children:"Team Member"}),r.map((e,s)=>{const a=(new Date).toDateString()===e.toDateString();return u.jsxs("div",{className:"p-3 text-center border-r last:border-r-0 "+(a?"bg-blue-50":"bg-gray-50"),children:[u.jsx("div",{className:"font-medium text-sm",children:e.toLocaleDateString("en-US",{weekday:"short"})}),u.jsx("div",{className:"text-xs "+(a?"font-bold text-blue-700":"text-gray-500"),children:e.toLocaleDateString("en-US",{month:"short",day:"numeric"})})]},s)})]}),Ei.map(e=>u.jsxs("div",{className:"grid grid-cols-8 border-b last:border-b-0",children:[u.jsxs("div",{className:"p-3 flex items-center border-r bg-gray-50",children:[u.jsx("div",{className:"w-2 h-2 rounded-full mr-2",style:{backgroundColor:e.color}}),u.jsx("div",{className:"text-sm font-medium",children:e.name})]}),r.map((s,a)=>{const t=Mi(s),r=((e,s)=>{const a=Ui.find(e=>e.date===s);if(!a)return null;const t=a.shifts.find(s=>s.memberId===e);return t?x(t.shiftTypeId):null})(e.id,t);return u.jsx("div",{className:"p-2 border-r last:border-r-0 text-center cursor-pointer hover:bg-gray-50",onClick:()=>((e,s)=>{const a=Ui.find(e=>e.date===s);if(!a)return;const t=a.shifts.find(s=>s.memberId===e);i({memberId:e,date:s}),c(Ei.find(s=>s.id===e)),m(t?x(t.shiftTypeId):null)})(e.id,t),children:r?u.jsx("div",{className:"text-xs p-1 rounded",style:{backgroundColor:r.color+"20",borderLeft:`3px solid ${r.color}`},children:r.name}):u.jsx("div",{className:"text-xs text-gray-400 italic p-1",children:"Unassigned"})},`${e.id}-${a}`)})]},e.id))]})})})]}),u.jsxs("div",{className:"grid gap-6 md:grid-cols-2 mb-6",children:[u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Team Coverage"})}),u.jsx($t,{children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Day"}),u.jsx(tn,{children:"Date"}),u.jsx(tn,{className:"text-right",children:"Opening"}),u.jsx(tn,{className:"text-right",children:"Mid"}),u.jsx(tn,{className:"text-right",children:"Closing"}),u.jsx(tn,{className:"text-right",children:"Off"})]})}),u.jsx(sn,{children:r.map((e,s)=>{const a=Mi(e),t=Ui.find(e=>e.date===a),r={opening:0,mid:0,closing:0,weekend:0,off:0};return t&&t.shifts.forEach(e=>{1===e.shiftTypeId?r.opening++:2===e.shiftTypeId?r.mid++:3===e.shiftTypeId?r.closing++:4===e.shiftTypeId?r.weekend++:5===e.shiftTypeId&&r.off++}),u.jsxs(an,{children:[u.jsx(rn,{className:"font-medium",children:e.toLocaleDateString("en-US",{weekday:"short"})}),u.jsx(rn,{children:e.toLocaleDateString("en-US",{month:"short",day:"numeric"})}),u.jsx(rn,{className:"text-right",children:r.opening>0?r.opening:"-"}),u.jsx(rn,{className:"text-right",children:r.mid>0?r.mid:"-"}),u.jsx(rn,{className:"text-right",children:r.closing>0||r.weekend>0?r.closing+r.weekend:"-"}),u.jsx(rn,{className:"text-right",children:r.off>0?r.off:"-"})]},s)})})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Shift Types"})}),u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[Ii.map(e=>u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"w-4 h-4 rounded-full mr-2",style:{backgroundColor:e.color}}),u.jsx("div",{className:"flex-grow",children:u.jsx("div",{className:"font-medium text-sm",children:e.name})}),u.jsx(Bt,{variant:"ghost",size:"sm",children:u.jsx(Ns,{className:"h-4 w-4"})})]},e.id)),u.jsxs(Bt,{variant:"outline",className:"w-full mt-2",size:"sm",children:[u.jsx(us,{className:"h-4 w-4 mr-2"}),"Add Shift Type"]})]})})]})]}),n&&u.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md p-6",children:[u.jsx("h3",{className:"text-lg font-medium mb-4",children:"Edit Shift"}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"member",children:"Team Member"}),u.jsx("div",{className:"text-sm font-medium mt-1",children:null==o?void 0:o.name})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"date",children:"Date"}),u.jsx("div",{className:"text-sm font-medium mt-1",children:new Date(n.date).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"shift-type",children:"Shift Type"}),u.jsxs(ql,{value:(null==d?void 0:d.id.toString())||"",onValueChange:e=>{const s=Ii.find(s=>s.id===parseInt(e));m(s)},children:[u.jsx(Yl,{id:"shift-type",children:u.jsx(Jl,{placeholder:"Select a shift type"})}),u.jsx(Zl,{children:Ii.map(e=>u.jsx(Ql,{value:e.id.toString(),children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:e.color}}),e.name]})},e.id))})]})]}),u.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[u.jsx(Bt,{variant:"outline",onClick:()=>{i(null),c(null),m(null)},children:"Cancel"}),u.jsx(Bt,{onClick:()=>{console.log("Saving shift:",{memberId:o.id,date:n.date,shiftTypeId:d.id}),i(null),c(null),m(null)},children:"Save"})]})]})]})})]})};function $i(e){const s=Li(e),a=he.forwardRef((e,a)=>{const t=e,{children:r}=t,l=d(t,["children"]),n=he.Children.toArray(r),i=n.find(Bi);if(i){const e=i.props.children,t=n.map(s=>s===i?he.Children.count(e)>1?he.Children.only(null):he.isValidElement(e)?e.props.children:null:s);return u.jsx(s,c(o({},l),{ref:a,children:he.isValidElement(e)?he.cloneElement(e,void 0,t):null}))}return u.jsx(s,c(o({},l),{ref:a,children:r}))});return a.displayName=`${e}.Slot`,a}function Li(e){const s=he.forwardRef((e,s)=>{const a=e,{children:t}=a,r=d(a,["children"]),l=he.isValidElement(t)?function(e){var s,a;let t=null==(s=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:s.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=null==(a=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:a.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}(t):void 0,n=f(l,s);if(he.isValidElement(t)){const e=function(e,s){const a=o({},s);for(const t in s){const r=e[t],l=s[t];/^on[A-Z]/.test(t)?r&&l?a[t]=(...e)=>{const s=l(...e);return r(...e),s}:r&&(a[t]=r):"style"===t?a[t]=o(o({},r),l):"className"===t&&(a[t]=[r,l].filter(Boolean).join(" "))}return o(o({},e),a)}(r,t.props);return t.type!==he.Fragment&&(e.ref=n),he.cloneElement(t,e)}return he.Children.count(t)>1?he.Children.only(null):null});return s.displayName=`${e}.SlotClone`,s}var Oi=Symbol("radix.slottable");function Bi(e){return he.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===Oi}var Vi=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,s)=>{const a=$i(`Primitive.${s}`),t=he.forwardRef((e,t)=>{const r=e,{asChild:l}=r,n=d(r,["asChild"]),i=l?a:s;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),u.jsx(i,c(o({},n),{ref:t}))});return t.displayName=`Primitive.${s}`,c(o({},e),{[s]:t})},{}),zi="Collapsible",[Wi,qi]=p(zi),[Ji,Yi]=Wi(zi),Hi=he.forwardRef((e,s)=>{const a=e,{__scopeCollapsible:t,open:r,defaultOpen:l,disabled:n,onOpenChange:i}=a,m=d(a,["__scopeCollapsible","open","defaultOpen","disabled","onOpenChange"]),[h,x]=v({prop:r,defaultProp:null!=l&&l,onChange:i,caller:zi});return u.jsx(Ji,{scope:t,disabled:n,contentId:R(),open:h,onOpenToggle:he.useCallback(()=>x(e=>!e),[x]),children:u.jsx(Vi.div,c(o({"data-state":so(h),"data-disabled":n?"":void 0},m),{ref:s}))})});Hi.displayName=zi;var Ki="CollapsibleTrigger",Zi=he.forwardRef((e,s)=>{const a=e,{__scopeCollapsible:t}=a,r=d(a,["__scopeCollapsible"]),l=Yi(Ki,t);return u.jsx(Vi.button,c(o({type:"button","aria-controls":l.contentId,"aria-expanded":l.open||!1,"data-state":so(l.open),"data-disabled":l.disabled?"":void 0,disabled:l.disabled},r),{ref:s,onClick:N(e.onClick,l.onOpenToggle)}))});Zi.displayName=Ki;var Qi="CollapsibleContent",Xi=he.forwardRef((e,s)=>{const a=e,{forceMount:t}=a,r=d(a,["forceMount"]),l=Yi(Qi,e.__scopeCollapsible);return u.jsx(b,{present:t||l.open,children:({present:e})=>u.jsx(eo,c(o({},r),{ref:s,present:e}))})});Xi.displayName=Qi;var eo=he.forwardRef((e,s)=>{const a=e,{__scopeCollapsible:t,present:r,children:l}=a,n=d(a,["__scopeCollapsible","present","children"]),i=Yi(Qi,t),[m,h]=he.useState(r),x=he.useRef(null),p=f(s,x),g=he.useRef(0),j=g.current,v=he.useRef(0),b=v.current,N=i.open||m,y=he.useRef(N),w=he.useRef(void 0);return he.useEffect(()=>{const e=requestAnimationFrame(()=>y.current=!1);return()=>cancelAnimationFrame(e)},[]),_(()=>{const e=x.current;if(e){w.current=w.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";const s=e.getBoundingClientRect();g.current=s.height,v.current=s.width,y.current||(e.style.transitionDuration=w.current.transitionDuration,e.style.animationName=w.current.animationName),h(r)}},[i.open,r]),u.jsx(Vi.div,c(o({"data-state":so(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!N},n),{ref:p,style:o({"--radix-collapsible-content-height":j?`${j}px`:void 0,"--radix-collapsible-content-width":b?`${b}px`:void 0},e.style),children:N&&l}))});function so(e){return e?"open":"closed"}const ao=Hi,to=Zi,ro=Xi,lo=[{month:"Jan",newVehicles:42,usedVehicles:38,totalSales:80,avgGross:1820},{month:"Feb",newVehicles:38,usedVehicles:35,totalSales:73,avgGross:1750},{month:"Mar",newVehicles:45,usedVehicles:40,totalSales:85,avgGross:1780},{month:"Apr",newVehicles:48,usedVehicles:42,totalSales:90,avgGross:1850},{month:"May",newVehicles:52,usedVehicles:48,totalSales:100,avgGross:1930},{month:"Jun",newVehicles:58,usedVehicles:52,totalSales:110,avgGross:2100}],no=[{team:"Team A",members:3,totalSales:62,salesPerMember:20.7,grossProfit:124500,avgGross:2008,closingRatio:32},{team:"Team B",members:2,totalSales:38,salesPerMember:19,grossProfit:74100,avgGross:1950,closingRatio:28}],io=[{id:1,name:"Sarah Johnson",team:"Team A",newVehicles:24,usedVehicles:10,totalSales:34,grossProfit:68500,avgGross:2015,closingRatio:35},{id:2,name:"Michael Chen",team:"Team A",newVehicles:18,usedVehicles:8,totalSales:26,grossProfit:52e3,avgGross:2e3,closingRatio:30},{id:3,name:"David Rodriguez",team:"Team A",newVehicles:14,usedVehicles:8,totalSales:22,grossProfit:44e3,avgGross:2e3,closingRatio:28},{id:4,name:"Amanda Williams",team:"Team B",newVehicles:12,usedVehicles:8,totalSales:20,grossProfit:38e3,avgGross:1900,closingRatio:27},{id:5,name:"Robert Johnson",team:"Team B",newVehicles:10,usedVehicles:8,totalSales:18,grossProfit:36100,avgGross:2006,closingRatio:29}],oo={total:120,inTransit:15,sold:58,available:47,reserved:10,daysOnLot:32},co={total:85,inTransit:8,sold:52,available:25,reserved:5,daysOnLot:24},mo=[{type:"Sedan",count:42,percentage:38},{type:"SUV",count:35,percentage:32},{type:"Truck",count:18,percentage:16},{type:"Crossover",count:10,percentage:9},{type:"Luxury",count:5,percentage:5}],ho=92,uo=18,xo=4.2,po=1460,go=880,fo=68,jo=72,vo=[{id:1,name:"Central Motors - Main Location",type:"single",lastUpdate:"06/18/2025",metrics:{totalSold:23,totalBooked:21,tracking:42,currentFront:10145,currentBack:62438,total:69006,avgFront:483,avgBack:2973,pvr:3456,fiChargebacks:1129,wholesaleProfitLoss:-2448,trackingGross:154086,forecastGross:159e3,overUnderGross:-9914,trackingUnits:42,forecastUnits:55,overUnderUnits:-13}},{id:2,name:"Premier Auto Group",type:"group",lastUpdate:"06/18/2025",metrics:{totalSold:87,totalBooked:79,tracking:158,currentFront:42580,currentBack:198750,total:241330,avgFront:489,avgBack:2284,pvr:2773,fiChargebacks:3890,wholesaleProfitLoss:-8920,trackingGross:445320,forecastGross:475e3,overUnderGross:-29680,trackingUnits:158,forecastUnits:185,overUnderUnits:-27}},{id:3,name:"AutoMax Dealerships",type:"group",lastUpdate:"06/18/2025",metrics:{totalSold:134,totalBooked:127,tracking:248,currentFront:68920,currentBack:312480,total:381400,avgFront:515,avgBack:2333,pvr:2848,fiChargebacks:5670,wholesaleProfitLoss:-12350,trackingGross:698540,forecastGross:72e4,overUnderGross:-21460,trackingUnits:248,forecastUnits:275,overUnderUnits:-27}}],bo=[{id:1,name:"Central Motors - New Cars",isManagerStore:!0,storeType:"new",lastUpdated:"2025-05-08 14:30",totalSold:45,totalPending:14,totalBooked:38,tracking:52,currentFrontGross:68500,currentBackGross:38500,totalGross:107e3,avgFront:1522,avgBack:856,pvr:2378,trackingGross:119e3,forecastGross:11e4,overUnderGross:9e3,trackingUnits:56,forecastUnits:52,actualUnits:52,overUnderUnits:0,locations:[{id:101,name:"Downtown Branch - New Cars",lastUpdated:"2025-05-08 14:15",totalSold:24,totalPending:7,totalBooked:19,tracking:26,currentFrontGross:36750,currentBackGross:20800,totalGross:57550,avgFront:1531,avgBack:867,pvr:2398,trackingGross:62500,forecastGross:58e3,overUnderGross:4500,trackingUnits:28,forecastUnits:26,actualUnits:26,overUnderUnits:0},{id:102,name:"Westside Branch - New Cars",lastUpdated:"2025-05-08 14:30",totalSold:21,totalPending:7,totalBooked:19,tracking:26,currentFrontGross:31750,currentBackGross:17700,totalGross:49450,avgFront:1512,avgBack:843,pvr:2355,trackingGross:56500,forecastGross:52e3,overUnderGross:4500,trackingUnits:28,forecastUnits:26,actualUnits:26,overUnderUnits:0}]},{id:2,name:"Central Motors - Used Cars",isManagerStore:!0,storeType:"used",lastUpdated:"2025-05-08 14:45",totalSold:33,totalPending:10,totalBooked:27,tracking:37,currentFrontGross:44e3,currentBackGross:27300,totalGross:71300,avgFront:1333,avgBack:827,pvr:2160,trackingGross:79e3,forecastGross:75e3,overUnderGross:4e3,trackingUnits:39,forecastUnits:38,actualUnits:37,overUnderUnits:-1,locations:[{id:201,name:"Downtown Branch - Used Cars",lastUpdated:"2025-05-08 14:15",totalSold:17,totalPending:5,totalBooked:13,tracking:19,currentFrontGross:23e3,currentBackGross:14e3,totalGross:37e3,avgFront:1353,avgBack:824,pvr:2177,trackingGross:41500,forecastGross:37e3,overUnderGross:4500,trackingUnits:20,forecastUnits:19,actualUnits:19,overUnderUnits:0},{id:202,name:"Westside Branch - Used Cars",lastUpdated:"2025-05-08 14:30",totalSold:16,totalPending:5,totalBooked:14,tracking:18,currentFrontGross:21e3,currentBackGross:13300,totalGross:34300,avgFront:1313,avgBack:831,pvr:2144,trackingGross:37500,forecastGross:38e3,overUnderGross:-500,trackingUnits:19,forecastUnits:19,actualUnits:18,overUnderUnits:-1}]},{id:3,name:"North Region Dealerships",isManagerStore:!1,storeType:"other",lastUpdated:"2025-05-08 13:45",totalSold:64,totalPending:19,totalBooked:55,tracking:72,currentFrontGross:95200,currentBackGross:52600,totalGross:147800,avgFront:1487,avgBack:822,pvr:2309,trackingGross:165e3,forecastGross:16e4,overUnderGross:5e3,trackingUnits:78,forecastUnits:75,actualUnits:72,overUnderUnits:-3,locations:[{id:301,name:"North City Branch",lastUpdated:"2025-05-08 13:45",totalSold:36,totalPending:10,totalBooked:30,tracking:40,currentFrontGross:54e3,currentBackGross:29600,totalGross:83600,avgFront:1500,avgBack:822,pvr:2322,trackingGross:93e3,forecastGross:9e4,overUnderGross:3e3,trackingUnits:42,forecastUnits:40,actualUnits:40,overUnderUnits:0},{id:302,name:"Eastside Branch",lastUpdated:"2025-05-08 13:30",totalSold:28,totalPending:9,totalBooked:25,tracking:32,currentFrontGross:41200,currentBackGross:23e3,totalGross:64200,avgFront:1471,avgBack:821,pvr:2292,trackingGross:72e3,forecastGross:7e4,overUnderGross:2e3,trackingUnits:36,forecastUnits:35,actualUnits:32,overUnderUnits:-3}]},{id:4,name:"Premier Auto - New Division",isManagerStore:!1,storeType:"new",lastUpdated:"2025-05-08 13:20",totalSold:38,totalPending:12,totalBooked:32,tracking:44,currentFrontGross:58200,currentBackGross:32100,totalGross:90300,avgFront:1532,avgBack:845,pvr:2377,trackingGross:101500,forecastGross:95e3,overUnderGross:6500,trackingUnits:48,forecastUnits:44,actualUnits:44,overUnderUnits:0,locations:[]},{id:5,name:"AutoMax New Cars",isManagerStore:!1,storeType:"new",lastUpdated:"2025-05-08 12:45",totalSold:29,totalPending:9,totalBooked:25,tracking:34,currentFrontGross:44800,currentBackGross:24600,totalGross:69400,avgFront:1545,avgBack:848,pvr:2393,trackingGross:78e3,forecastGross:72e3,overUnderGross:6e3,trackingUnits:37,forecastUnits:34,actualUnits:34,overUnderUnits:0,locations:[]},{id:6,name:"Premier Auto - Used Division",isManagerStore:!1,storeType:"used",lastUpdated:"2025-05-08 13:15",totalSold:41,totalPending:13,totalBooked:35,tracking:46,currentFrontGross:52300,currentBackGross:33100,totalGross:85400,avgFront:1276,avgBack:807,pvr:2083,trackingGross:96e3,forecastGross:9e4,overUnderGross:6e3,trackingUnits:50,forecastUnits:46,actualUnits:46,overUnderUnits:0,locations:[]},{id:7,name:"AutoMax Used Cars",isManagerStore:!1,storeType:"used",lastUpdated:"2025-05-08 12:30",totalSold:35,totalPending:11,totalBooked:30,tracking:39,currentFrontGross:43500,currentBackGross:28800,totalGross:72300,avgFront:1243,avgBack:823,pvr:2066,trackingGross:81e3,forecastGross:78e3,overUnderGross:3e3,trackingUnits:42,forecastUnits:39,actualUnits:39,overUnderUnits:0,locations:[]}],No=({data:e})=>{const[s,a]=he.useState("cards"),t=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),r=e=>e.toLocaleString(),l=()=>u.jsxs("div",{className:"space-y-3",children:[e.find(e=>1===e.id)&&u.jsx(yo,{dealerGroup:e.find(e=>1===e.id)},1),e.find(e=>2===e.id)&&u.jsx(yo,{dealerGroup:e.find(e=>2===e.id)},2),e.filter(e=>1!==e.id&&2!==e.id).map(e=>u.jsx(yo,{dealerGroup:e},e.id))]}),n=()=>{const s=e.filter(e=>"new"===e.storeType),a=e.filter(e=>"used"===e.storeType),l=e.filter(e=>"new"!==e.storeType&&"used"!==e.storeType),n=[{key:"lastUpdated",label:"Last Updated",format:"date"},{key:"totalSold",label:"Total Sold",format:"number"},{key:"totalBooked",label:"Total Booked/Funded",format:"number"},{key:"tracking",label:"Tracking",format:"number",highlight:!0},{key:"currentFrontGross",label:"Current Front Gross",format:"currency"},{key:"currentBackGross",label:"Current Back Gross",format:"currency"},{key:"totalGross",label:"Current Total Gross",format:"currency",color:"green"},{key:"avgFront",label:"Avg Front Gross",format:"currency"},{key:"avgBack",label:"Avg Back Gross",format:"currency"},{key:"pvr",label:"Total PVR",format:"currency",color:"blue"},{key:"trackingGross",label:"Tracking Gross",format:"currency",highlight:!0},{key:"forecastGross",label:"Forecast Gross",format:"currency"},{key:"overUnderGross",label:"Over/Under Gross",format:"currency",conditional:!0},{key:"trackingUnits",label:"Tracking Units",format:"number",highlight:!0},{key:"forecastUnits",label:"Forecast Units",format:"number"},{key:"overUnderUnits",label:"Over/Under Units",format:"number",conditional:!0}],i=(e,s,a=!1,t=!1)=>{let r="text-center font-medium";return t?r+=" text-amber-600 bg-yellow-50":a?r+=e<0?" text-red-600":" text-green-600":"green"===s?r+=" text-green-600":"blue"===s&&(r+=" text-blue-600"),r},o=(e,s,a)=>0===e.length?null:u.jsxs("div",{className:"mb-6",children:[u.jsx("h4",{className:`text-lg font-semibold mb-3 px-3 py-2 ${a} rounded-t-lg border-b`,children:s}),u.jsx("div",{className:"overflow-x-auto",children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{className:"bg-gray-50",children:[u.jsx(tn,{className:"w-40 font-semibold sticky left-0 bg-gray-50 z-10",children:"Metric"}),e.map(e=>u.jsx(tn,{className:"text-center font-semibold min-w-32",children:u.jsxs("div",{className:"flex flex-col items-center gap-1",children:[u.jsx("span",{className:"text-sm",children:e.name}),e.isManagerStore&&u.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-800 rounded-full",children:"Your Store"})]})},e.id)),u.jsx(tn,{className:"text-center font-semibold bg-gray-100 min-w-32",children:"Total"})]})}),u.jsx(sn,{children:n.map(s=>u.jsxs(an,{className:"hover:bg-gray-50",children:[u.jsx(rn,{className:"font-medium sticky left-0 bg-white z-10 border-r",children:s.label}),e.map(e=>{return u.jsx(rn,{className:i(e[s.key],s.color,s.conditional,s.highlight),children:(a=e[s.key],l=s.format,s.conditional,"currency"===l?t(a):"number"===l?r(a):a)},e.id);var a,l}),u.jsx(rn,{className:"text-center font-semibold bg-gray-50",children:"lastUpdated"===s.key?"Various":"currency"!==s.format||["avgFront","avgBack","pvr"].includes(s.key)?"number"===s.format?r(e.reduce((e,a)=>e+a[s.key],0)):["avgFront","avgBack","pvr"].includes(s.key)?t(e.reduce((e,a)=>e+a[s.key],0)/e.length):"--":t(e.reduce((e,a)=>e+a[s.key],0))})]},s.key))})]})})]});return u.jsxs("div",{className:"space-y-6",children:[o(s," New Cars Performance","bg-blue-50 text-blue-800"),o(a," Used Cars Performance","bg-green-50 text-green-800"),l.length>0&&o(l," Mixed Dealerships","bg-gray-50 text-gray-800"),u.jsxs("div",{className:"mt-6 p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-lg border",children:[u.jsx("h4",{className:"font-semibold text-gray-700 mb-3",children:" Overall Performance Summary"}),u.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[u.jsxs("div",{className:"bg-white p-3 rounded shadow-sm",children:[u.jsx("span",{className:"text-gray-600 block",children:"Total Units Sold"}),u.jsx("span",{className:"font-bold text-lg text-blue-600",children:r(e.reduce((e,s)=>e+s.totalSold,0))})]}),u.jsxs("div",{className:"bg-white p-3 rounded shadow-sm",children:[u.jsx("span",{className:"text-gray-600 block",children:"Total Gross"}),u.jsx("span",{className:"font-bold text-lg text-green-600",children:t(e.reduce((e,s)=>e+s.totalGross,0))})]}),u.jsxs("div",{className:"bg-white p-3 rounded shadow-sm",children:[u.jsx("span",{className:"text-gray-600 block",children:"Avg PVR"}),u.jsx("span",{className:"font-bold text-lg text-blue-600",children:t(e.reduce((e,s)=>e+s.pvr,0)/e.length)})]}),u.jsxs("div",{className:"bg-white p-3 rounded shadow-sm",children:[u.jsx("span",{className:"text-gray-600 block",children:"Total Over/Under"}),u.jsx("span",{className:"font-bold text-lg "+(e.reduce((e,s)=>e+s.overUnderGross,0)<0?"text-red-600":"text-green-600"),children:t(e.reduce((e,s)=>e+s.overUnderGross,0))})]})]})]})]})};return u.jsxs(Ut,{className:"mb-5",children:[u.jsx(Gt,{className:"pb-2 pt-4",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(Mt,{className:"text-xl",children:"Sales Performance"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs(Bt,{variant:"cards"===s?"default":"outline",size:"sm",onClick:()=>a("cards"),className:"flex items-center gap-2",children:[u.jsx(Js,{className:"h-4 w-4"}),"Cards View"]}),u.jsxs(Bt,{variant:"comparison"===s?"default":"outline",size:"sm",onClick:()=>a("comparison"),className:"flex items-center gap-2",children:[u.jsx(as,{className:"h-4 w-4"}),"Comparison Table"]})]})]})}),u.jsx($t,{className:"p-3",children:"cards"===s?u.jsx(l,{}):u.jsx(n,{})})]})},yo=({dealerGroup:e})=>{const[s,a]=he.useState(e.isManagerStore),t=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),r=(()=>{switch(e.storeType){case"new":return{headerBg:"bg-blue-50",border:"border-blue-200",badge:"bg-blue-100 text-blue-800",highlight:"bg-blue-50"};case"used":return{headerBg:"bg-green-50",border:"border-green-200",badge:"bg-green-100 text-green-800",highlight:"bg-green-50"};default:return{headerBg:"bg-gray-50",border:"border-gray-200",badge:"bg-gray-100 text-gray-800",highlight:"bg-gray-50"}}})();return u.jsx(ao,{open:s,onOpenChange:a,children:u.jsxs("div",{className:`border rounded-lg overflow-hidden shadow-sm ${r.border} ${e.isManagerStore?"":"text-sm"}`,children:[u.jsx("div",{className:`${r.headerBg} border-b`,children:u.jsx(to,{asChild:!0,children:u.jsxs("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-gray-100 transition-colors",children:[u.jsxs("div",{className:"flex items-center",children:[s?u.jsx(Ze,{className:"h-4 w-4 mr-2 text-gray-500"}):u.jsx(es,{className:"h-4 w-4 mr-2 text-gray-500"}),u.jsx("h3",{className:"font-semibold",children:e.name}),e.isManagerStore&&u.jsx("span",{className:`ml-2 px-2 py-0.5 text-xs ${r.badge} rounded-full`,children:"Your Store"})]}),u.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[u.jsx(ze,{className:"h-3 w-3 mr-1"}),e.lastUpdated]})]})})}),s&&u.jsxs("div",{className:"px-3 py-3",children:[u.jsxs("div",{className:"grid grid-cols-5 gap-2 mb-3",children:[u.jsx(So,{label:"Sold",value:e.totalSold,icon:u.jsx(js,{className:"h-3 w-3"}),color:"new"===e.storeType?"blue":"used"===e.storeType?"green":"gray"}),u.jsx(So,{label:"Booked",value:Math.floor(.6*e.totalBooked),icon:u.jsx(Ks,{className:"h-3 w-3"}),color:"new"===e.storeType?"blue":"used"===e.storeType?"green":"gray"}),u.jsx(So,{label:"Pending",value:e.totalPending,icon:u.jsx(ze,{className:"h-3 w-3"}),color:"new"===e.storeType?"blue":"used"===e.storeType?"green":"gray"}),u.jsx(So,{label:"Tracking",value:e.tracking,icon:u.jsx(qe,{className:"h-3 w-3"}),color:"new"===e.storeType?"blue":"used"===e.storeType?"green":"gray"}),u.jsx(So,{label:"Funded",value:Math.floor(.4*e.totalBooked),icon:u.jsx(Ke,{className:"h-3 w-3"}),color:"new"===e.storeType?"blue":"used"===e.storeType?"green":"gray"})]}),u.jsxs("div",{className:`${r.highlight} p-2 rounded-lg mb-3`,children:[u.jsx("h4",{className:"font-medium text-xs text-gray-500 mb-2",children:"REVENUE"}),u.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-xs text-gray-500",children:"Front Gross"}),u.jsx("p",{className:"text-base font-bold",children:t(e.currentFrontGross)}),u.jsxs("p",{className:"text-xs text-gray-500",children:["Avg: ",t(e.avgFront)]})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-xs text-gray-500",children:"Back Gross"}),u.jsx("p",{className:"text-base font-bold",children:t(e.currentBackGross)}),u.jsxs("p",{className:"text-xs text-gray-500",children:["Avg: ",t(e.avgBack)]})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-xs text-gray-500",children:"Total Gross"}),u.jsx("p",{className:"text-base font-bold",children:t(e.totalGross)}),u.jsxs("p",{className:"text-xs text-gray-500",children:["PVR: ",t(e.pvr)]})]})]})]}),u.jsxs("div",{className:`${r.highlight} p-2 rounded-lg`,children:[u.jsx("h4",{className:"font-medium text-xs text-gray-500 mb-2",children:"FORECAST VS ACTUAL"}),u.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[u.jsxs("div",{children:[u.jsx("h5",{className:"font-medium text-xs mb-1",children:"Gross Revenue"}),u.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Tracking:"}),u.jsx("span",{className:"font-medium ml-1",children:t(e.trackingGross)})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Forecast:"}),u.jsx("span",{className:"font-medium ml-1",children:t(e.forecastGross)})]}),u.jsxs("div",{className:e.overUnderGross>=0?"text-green-600":"text-red-600",children:[u.jsx("span",{className:"mr-1",children:"+/-:"}),u.jsxs("span",{className:"font-medium",children:[e.overUnderGross>=0?"+":"",t(e.overUnderGross)]})]})]}),u.jsx("div",{className:"h-1.5 bg-gray-200 rounded-full overflow-hidden",children:u.jsx("div",{className:`h-full ${e.overUnderGross>=0?"bg-green-500":"bg-red-500"} rounded-full`,style:{width:`${Math.min(100,Math.abs(e.trackingGross/e.forecastGross*100))}%`}})})]}),u.jsxs("div",{children:[u.jsx("h5",{className:"font-medium text-xs mb-1",children:"Units"}),u.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Tracking:"}),u.jsx("span",{className:"font-medium ml-1",children:e.trackingUnits})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Forecast:"}),u.jsx("span",{className:"font-medium ml-1",children:e.forecastUnits})]}),u.jsxs("div",{className:e.overUnderUnits>=0?"text-green-600":"text-red-600",children:[u.jsx("span",{className:"mr-1",children:"+/-:"}),u.jsxs("span",{className:"font-medium",children:[e.overUnderUnits>=0?"+":"",e.overUnderUnits]})]})]}),u.jsx("div",{className:"h-1.5 bg-gray-200 rounded-full overflow-hidden",children:u.jsx("div",{className:`h-full ${e.overUnderUnits>=0?"bg-green-500":"bg-red-500"} rounded-full`,style:{width:`${Math.min(100,Math.abs(e.trackingUnits/e.forecastUnits*100))}%`}})})]})]})]})]}),u.jsx(ro,{children:u.jsxs("div",{className:"border-t",children:[u.jsx("div",{className:`px-3 py-2 ${r.headerBg} border-b`,children:u.jsxs("h4",{className:"font-medium text-xs",children:["Dealership Locations (",e.locations.length,")"]})}),e.locations.map((s,a)=>u.jsxs("div",{className:"px-3 py-2 "+(a<e.locations.length-1?"border-b":""),children:[u.jsxs("div",{className:"flex justify-between mb-2",children:[u.jsx("h5",{className:"font-medium text-sm",children:s.name}),u.jsxs("div",{className:"text-xs text-gray-500",children:[u.jsx(ze,{className:"h-3 w-3 inline mr-1"}),s.lastUpdated]})]}),u.jsxs("div",{className:"grid grid-cols-5 gap-2 mb-2 text-xs",children:[u.jsxs("div",{className:"p-1",children:[u.jsx("p",{className:"text-gray-500 uppercase font-medium",children:"Sold"}),u.jsx("p",{className:"font-bold",children:s.totalSold})]}),u.jsxs("div",{className:"p-1",children:[u.jsx("p",{className:"text-gray-500 uppercase font-medium",children:"Booked"}),u.jsx("p",{className:"font-bold",children:Math.floor(.6*s.totalBooked)})]}),u.jsxs("div",{className:"p-1",children:[u.jsx("p",{className:"text-gray-500 uppercase font-medium",children:"Pending"}),u.jsx("p",{className:"font-bold",children:s.totalPending})]}),u.jsxs("div",{className:"p-1",children:[u.jsx("p",{className:"text-gray-500 uppercase font-medium",children:"Tracking"}),u.jsx("p",{className:"font-bold",children:s.tracking})]}),u.jsxs("div",{className:"p-1",children:[u.jsx("p",{className:"text-gray-500 uppercase font-medium",children:"Funded"}),u.jsx("p",{className:"font-bold",children:Math.floor(.4*s.totalBooked)})]})]}),u.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs mb-2",children:[u.jsxs("div",{className:`${r.highlight} p-1 rounded flex justify-between`,children:[u.jsx("span",{className:"text-gray-500",children:"Front:"}),u.jsx("span",{className:"font-medium",children:t(s.currentFrontGross)})]}),u.jsxs("div",{className:`${r.highlight} p-1 rounded flex justify-between`,children:[u.jsx("span",{className:"text-gray-500",children:"Back:"}),u.jsx("span",{className:"font-medium",children:t(s.currentBackGross)})]}),u.jsxs("div",{className:`${r.highlight} p-1 rounded flex justify-between`,children:[u.jsx("span",{className:"text-gray-500",children:"Total:"}),u.jsx("span",{className:"font-medium",children:t(s.totalGross)})]})]}),u.jsxs("div",{className:"flex gap-2 text-xs",children:[u.jsxs("div",{className:`flex-1 ${r.highlight} p-1 rounded flex justify-between`,children:[u.jsx("span",{className:"text-gray-500",children:"PVR:"}),u.jsx("span",{className:"font-medium",children:t(s.pvr)})]}),u.jsxs("div",{className:`flex-1 ${r.highlight} p-1 rounded flex justify-between`,children:[u.jsx("span",{className:"text-gray-500",children:"Gross +/-:"}),u.jsxs("span",{className:s.overUnderGross>=0?"text-green-600 font-medium":"text-red-600 font-medium",children:[s.overUnderGross>=0?"+":"",t(s.overUnderGross)]})]}),u.jsxs("div",{className:`flex-1 ${r.highlight} p-1 rounded flex justify-between`,children:[u.jsx("span",{className:"text-gray-500",children:"Units +/-:"}),u.jsxs("span",{className:s.overUnderUnits>=0?"text-green-600 font-medium":"text-red-600 font-medium",children:[s.overUnderUnits>=0?"+":"",s.overUnderUnits]})]})]})]},s.id))]})})]})})},wo=()=>{const[e,s]=he.useState("single"),[a,t]=he.useState(vo[0]),r=e=>e<0?`-$${Math.abs(e).toLocaleString()}`:`$${e.toLocaleString()}`,l=e=>e.toLocaleString(),n=vo.filter(s=>s.type===e),i=({label:e,value:s,isHighlighted:a=!1,isCurrency:t=!1,isNegative:n=!1})=>u.jsxs("div",{className:`grid grid-cols-2 py-3 px-4 border-b border-gray-100 ${a?"bg-yellow-50":"bg-white"} hover:bg-gray-50 transition-colors`,children:[u.jsx("div",{className:"text-sm font-medium text-gray-700",children:e}),u.jsx("div",{className:"text-sm font-semibold text-right "+(n?"text-red-600":"text-gray-900"),children:t?r(s):l(s)})]});return u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Detailed Sales Report"}),u.jsx("p",{className:"text-sm text-gray-600",children:"Comprehensive sales metrics for performance tracking"})]}),u.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[u.jsxs(ql,{value:e,onValueChange:s,children:[u.jsxs(Yl,{className:"w-44",children:[u.jsx(ms,{className:"mr-2 h-4 w-4"}),u.jsx(Jl,{})]}),u.jsxs(Zl,{children:[u.jsx(Ql,{value:"single",children:"Single Stores"}),u.jsx(Ql,{value:"group",children:"Dealer Groups"})]})]}),u.jsxs(ql,{value:a.id.toString(),onValueChange:e=>t(n.find(s=>s.id.toString()===e)),children:[u.jsx(Yl,{className:"w-64",children:u.jsx(Jl,{})}),u.jsx(Zl,{children:n.map(e=>u.jsx(Ql,{value:e.id.toString(),children:e.name},e.id))})]})]})]}),u.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[u.jsxs(Ut,{className:"lg:col-span-1",children:[u.jsxs(Gt,{className:"pb-3",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx(Mt,{className:"text-lg",children:a.name}),u.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[u.jsx(ze,{className:"h-4 w-4"}),"Last Update: ",a.lastUpdate]})]}),u.jsx("div",{className:"flex items-center gap-2",children:u.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full "+("single"===a.type?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:"single"===a.type?"Single Store":"Dealer Group"})})]}),u.jsx($t,{className:"p-0",children:u.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[u.jsx(i,{label:"Total Sold",value:a.metrics.totalSold}),u.jsx(i,{label:"Total Booked",value:a.metrics.totalBooked}),u.jsx(i,{label:"Tracking",value:a.metrics.tracking,isHighlighted:!0}),u.jsx(i,{label:"Current Front",value:a.metrics.currentFront,isCurrency:!0}),u.jsx(i,{label:"Current Back",value:a.metrics.currentBack,isCurrency:!0}),u.jsx(i,{label:"Total",value:a.metrics.total,isCurrency:!0}),u.jsx(i,{label:"Avg Front",value:a.metrics.avgFront,isCurrency:!0}),u.jsx(i,{label:"Avg Back",value:a.metrics.avgBack,isCurrency:!0}),u.jsx(i,{label:"PVR",value:a.metrics.pvr,isCurrency:!0})]})})]}),u.jsxs(Ut,{className:"lg:col-span-1",children:[u.jsxs(Gt,{className:"pb-3",children:[u.jsx(Mt,{className:"text-lg",children:"Performance Analysis"}),u.jsx("p",{className:"text-sm text-gray-600",children:"Key performance indicators and forecasts"})]}),u.jsx($t,{className:"p-0",children:u.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[u.jsx(i,{label:"F&I Charge Backs",value:a.metrics.fiChargebacks,isCurrency:!0}),u.jsx(i,{label:"Wholesale Profit / Loss (+/-)",value:a.metrics.wholesaleProfitLoss,isCurrency:!0,isHighlighted:!0,isNegative:a.metrics.wholesaleProfitLoss<0}),u.jsx(i,{label:"Tracking Gross",value:a.metrics.trackingGross,isCurrency:!0,isHighlighted:!0}),u.jsx(i,{label:"Forecast Gross",value:a.metrics.forecastGross,isCurrency:!0,isHighlighted:!0}),u.jsx(i,{label:"Over/Under Gross",value:a.metrics.overUnderGross,isCurrency:!0,isHighlighted:!0,isNegative:a.metrics.overUnderGross<0}),u.jsx(i,{label:"Tracking Units",value:a.metrics.trackingUnits,isHighlighted:!0}),u.jsx(i,{label:"Forecast Units",value:a.metrics.forecastUnits,isHighlighted:!0}),u.jsx(i,{label:"Over/Under Units",value:a.metrics.overUnderUnits,isHighlighted:!0,isNegative:a.metrics.overUnderUnits<0})]})})]})]}),u.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[u.jsx(Ut,{className:"border-l-4 border-l-blue-500",children:u.jsx($t,{className:"p-4",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-gray-600",children:"Total Sales"}),u.jsx("p",{className:"text-2xl font-bold",children:a.metrics.totalSold})]}),u.jsx(js,{className:"h-8 w-8 text-blue-500"})]})})}),u.jsx(Ut,{className:"border-l-4 border-l-green-500",children:u.jsx($t,{className:"p-4",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-gray-600",children:"Total Gross"}),u.jsx("p",{className:"text-2xl font-bold",children:r(a.metrics.total)})]}),u.jsx(Ke,{className:"h-8 w-8 text-green-500"})]})})}),u.jsx(Ut,{className:"border-l-4 border-l-amber-500",children:u.jsx($t,{className:"p-4",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-gray-600",children:"PVR"}),u.jsx("p",{className:"text-2xl font-bold",children:r(a.metrics.pvr)})]}),u.jsx(qe,{className:"h-8 w-8 text-amber-500"})]})})}),u.jsx(Ut,{className:"border-l-4 "+(a.metrics.overUnderGross<0?"border-l-red-500":"border-l-green-500"),children:u.jsx($t,{className:"p-4",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-sm text-gray-600",children:"Over/Under"}),u.jsx("p",{className:"text-2xl font-bold "+(a.metrics.overUnderGross<0?"text-red-600":"text-green-600"),children:r(a.metrics.overUnderGross)})]}),a.metrics.overUnderGross<0?u.jsx(We,{className:"h-8 w-8 text-red-500"}):u.jsx(qe,{className:"h-8 w-8 text-green-500"})]})})})]}),"group"===e&&u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsx(Mt,{children:"Dealer Group Comparison"}),u.jsx("p",{className:"text-sm text-gray-600",children:"Compare performance across dealer groups"})]}),u.jsx($t,{children:u.jsx("div",{className:"overflow-x-auto",children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Dealer Group"}),u.jsx(tn,{className:"text-right",children:"Total Sold"}),u.jsx(tn,{className:"text-right",children:"Total Gross"}),u.jsx(tn,{className:"text-right",children:"PVR"}),u.jsx(tn,{className:"text-right",children:"Over/Under Gross"}),u.jsx(tn,{className:"text-right",children:"Over/Under Units"})]})}),u.jsx(sn,{children:vo.filter(e=>"group"===e.type).map(e=>u.jsxs(an,{className:"hover:bg-gray-50",children:[u.jsx(rn,{className:"font-medium",children:e.name}),u.jsx(rn,{className:"text-right",children:e.metrics.totalSold}),u.jsx(rn,{className:"text-right",children:r(e.metrics.total)}),u.jsx(rn,{className:"text-right",children:r(e.metrics.pvr)}),u.jsx(rn,{className:"text-right font-medium "+(e.metrics.overUnderGross<0?"text-red-600":"text-green-600"),children:r(e.metrics.overUnderGross)}),u.jsx(rn,{className:"text-right font-medium "+(e.metrics.overUnderUnits<0?"text-red-600":"text-green-600"),children:e.metrics.overUnderUnits})]},e.id))})]})})})]})]})},So=({label:e,value:s,icon:a,color:t="blue"})=>u.jsxs("div",{className:"bg-white p-2 rounded-lg border shadow-sm",children:[u.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[u.jsx("div",{className:`p-1 rounded-md ${(()=>{switch(t){case"green":return"bg-green-50 text-green-600";case"blue":return"bg-blue-50 text-blue-600";default:return"bg-gray-50 text-gray-600"}})()}`,children:a}),u.jsx("p",{className:"text-xs font-medium text-gray-500",children:e})]}),u.jsx("p",{className:"text-lg font-bold",children:s})]}),_o=()=>{const[e,s]=he.useState("overview"),[a,t]=he.useState("month"),[r,l]=he.useState("all"),n=(()=>{const e=lo[lo.length-1],s=lo[lo.length-2],a=(e.newVehicles-s.newVehicles)/s.newVehicles*100,t=(e.usedVehicles-s.usedVehicles)/s.usedVehicles*100,r=(e.totalSales-s.totalSales)/s.totalSales*100,l=(e.avgGross-s.avgGross)/s.avgGross*100;return{newVehicles:{count:e.newVehicles,change:a},usedVehicles:{count:e.usedVehicles,change:t},totalSales:{count:e.totalSales,change:r},avgGross:{value:e.avgGross,change:l}}})();return u.jsxs("div",{className:"container py-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx(Bt,{variant:"ghost",size:"sm",asChild:!0,className:"mr-2",children:u.jsxs(fe,{to:"/dashboard/sales-manager",children:[u.jsx(Xe,{className:"h-4 w-4 mr-1"}),"Back to Dashboard"]})}),u.jsx("h1",{className:"text-3xl font-bold",children:"Sales Reports"})]}),u.jsxs("div",{className:"flex gap-2",children:[u.jsxs(ql,{value:a,onValueChange:t,children:[u.jsxs(Yl,{className:"w-36",children:[u.jsx(Oe,{className:"mr-2 h-4 w-4"}),u.jsx(Jl,{})]}),u.jsxs(Zl,{children:[u.jsx(Ql,{value:"week",children:"This Week"}),u.jsx(Ql,{value:"month",children:"This Month"}),u.jsx(Ql,{value:"quarter",children:"This Quarter"}),u.jsx(Ql,{value:"year",children:"This Year"})]})]}),u.jsxs(Bt,{variant:"outline",children:[u.jsx(Hs,{className:"mr-2 h-4 w-4"}),"Export"]}),u.jsxs(Bt,{variant:"outline",children:[u.jsx(zs,{className:"mr-2 h-4 w-4"}),"Refresh"]})]})]}),u.jsx(No,{data:bo}),u.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4 mb-6",children:[u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsx(Mt,{className:"text-sm font-medium",children:"New Vehicles Sold"})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:n.newVehicles.count}),u.jsxs("div",{className:"flex items-center text-xs mt-1",children:[n.newVehicles.change>0?u.jsxs(u.Fragment,{children:[u.jsx(gs,{className:"mr-1 h-3 w-3 text-green-600"}),u.jsxs("span",{className:"text-green-600",children:["+",n.newVehicles.change.toFixed(1),"%"]})]}):u.jsxs(u.Fragment,{children:[u.jsx(fs,{className:"mr-1 h-3 w-3 text-red-600"}),u.jsxs("span",{className:"text-red-600",children:[n.newVehicles.change.toFixed(1),"%"]})]}),u.jsx("span",{className:"text-gray-500 ml-1",children:"vs last month"})]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsx(Mt,{className:"text-sm font-medium",children:"Used Vehicles Sold"})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:n.usedVehicles.count}),u.jsxs("div",{className:"flex items-center text-xs mt-1",children:[n.usedVehicles.change>0?u.jsxs(u.Fragment,{children:[u.jsx(gs,{className:"mr-1 h-3 w-3 text-green-600"}),u.jsxs("span",{className:"text-green-600",children:["+",n.usedVehicles.change.toFixed(1),"%"]})]}):u.jsxs(u.Fragment,{children:[u.jsx(fs,{className:"mr-1 h-3 w-3 text-red-600"}),u.jsxs("span",{className:"text-red-600",children:[n.usedVehicles.change.toFixed(1),"%"]})]}),u.jsx("span",{className:"text-gray-500 ml-1",children:"vs last month"})]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsx(Mt,{className:"text-sm font-medium",children:"Total Sales"})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:n.totalSales.count}),u.jsxs("div",{className:"flex items-center text-xs mt-1",children:[n.totalSales.change>0?u.jsxs(u.Fragment,{children:[u.jsx(gs,{className:"mr-1 h-3 w-3 text-green-600"}),u.jsxs("span",{className:"text-green-600",children:["+",n.totalSales.change.toFixed(1),"%"]})]}):u.jsxs(u.Fragment,{children:[u.jsx(fs,{className:"mr-1 h-3 w-3 text-red-600"}),u.jsxs("span",{className:"text-red-600",children:[n.totalSales.change.toFixed(1),"%"]})]}),u.jsx("span",{className:"text-gray-500 ml-1",children:"vs last month"})]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsx(Mt,{className:"text-sm font-medium",children:"Avg. Gross Per Deal"})}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:["$",n.avgGross.value]}),u.jsxs("div",{className:"flex items-center text-xs mt-1",children:[n.avgGross.change>0?u.jsxs(u.Fragment,{children:[u.jsx(gs,{className:"mr-1 h-3 w-3 text-green-600"}),u.jsxs("span",{className:"text-green-600",children:["+",n.avgGross.change.toFixed(1),"%"]})]}):u.jsxs(u.Fragment,{children:[u.jsx(fs,{className:"mr-1 h-3 w-3 text-red-600"}),u.jsxs("span",{className:"text-red-600",children:[n.avgGross.change.toFixed(1),"%"]})]}),u.jsx("span",{className:"text-gray-500 ml-1",children:"vs last month"})]})]})]})]}),u.jsxs(dn,{value:e,onValueChange:s,className:"mb-6",children:[u.jsxs(mn,{children:[u.jsxs(hn,{value:"overview",children:[u.jsx(bs,{className:"h-4 w-4 mr-2"}),"Overview"]}),u.jsxs(hn,{value:"team",children:[u.jsx(vs,{className:"h-4 w-4 mr-2"}),"Team Performance"]}),u.jsxs(hn,{value:"individual",children:[u.jsx(vs,{className:"h-4 w-4 mr-2"}),"Individual Performance"]}),u.jsxs(hn,{value:"inventory",children:[u.jsx(js,{className:"h-4 w-4 mr-2"}),"Inventory"]}),u.jsxs(hn,{value:"finance",children:[u.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Finance"]}),u.jsxs(hn,{value:"detailed",children:[u.jsx(as,{className:"h-4 w-4 mr-2"}),"Detailed Report"]})]}),u.jsxs(un,{value:"overview",className:"mt-6",children:[u.jsxs("div",{className:"grid gap-6 md:grid-cols-2 mb-6",children:[u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Monthly Sales Trend"})}),u.jsx($t,{className:"h-80",children:u.jsx("div",{className:"flex justify-center items-center h-full text-center text-gray-500",children:"[Sales Trend Chart - Interactive line chart showing sales trends over the past 6 months]"})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Vehicle Type Distribution"})}),u.jsxs($t,{className:"h-80",children:[u.jsx("div",{className:"flex justify-center items-center h-full text-center text-gray-500",children:"[Vehicle Types Pie Chart - Distribution of vehicle types sold]"}),u.jsx("div",{className:"grid grid-cols-2 gap-4 mt-4",children:mo.map(e=>u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("div",{className:"text-sm",children:e.type}),u.jsxs("div",{className:"text-sm font-medium",children:[e.percentage,"%"]})]},e.type))})]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Monthly Sales Report"})}),u.jsx($t,{children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Month"}),u.jsx(tn,{className:"text-right",children:"New Vehicles"}),u.jsx(tn,{className:"text-right",children:"Used Vehicles"}),u.jsx(tn,{className:"text-right",children:"Total Sales"}),u.jsx(tn,{className:"text-right",children:"Avg. Gross"})]})}),u.jsx(sn,{children:lo.map(e=>u.jsxs(an,{children:[u.jsx(rn,{className:"font-medium",children:e.month}),u.jsx(rn,{className:"text-right",children:e.newVehicles}),u.jsx(rn,{className:"text-right",children:e.usedVehicles}),u.jsx(rn,{className:"text-right",children:e.totalSales}),u.jsxs(rn,{className:"text-right",children:["$",e.avgGross]})]},e.month))})]})})]})]}),u.jsxs(un,{value:"team",className:"mt-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-4",children:[u.jsx("h3",{className:"text-lg font-medium",children:"Team Performance Comparison"}),u.jsxs(ql,{value:r,onValueChange:l,children:[u.jsx(Yl,{className:"w-36",children:u.jsx(Jl,{placeholder:"All Teams"})}),u.jsxs(Zl,{children:[u.jsx(Ql,{value:"all",children:"All Teams"}),u.jsx(Ql,{value:"Team A",children:"Team A"}),u.jsx(Ql,{value:"Team B",children:"Team B"})]})]})]}),u.jsxs("div",{className:"grid gap-6 md:grid-cols-2 mb-6",children:[u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Sales Comparison"})}),u.jsx($t,{className:"h-80",children:u.jsx("div",{className:"flex justify-center items-center h-full text-center text-gray-500",children:"[Team Sales Comparison Chart - Bar chart comparing teams]"})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Performance Metrics"})}),u.jsx($t,{className:"h-80",children:u.jsx("div",{className:"flex justify-center items-center h-full text-center text-gray-500",children:"[Team Performance Radar Chart - Comparing multiple metrics]"})})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Team Performance Details"})}),u.jsx($t,{children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Team"}),u.jsx(tn,{className:"text-right",children:"Members"}),u.jsx(tn,{className:"text-right",children:"Total Sales"}),u.jsx(tn,{className:"text-right",children:"Sales/Member"}),u.jsx(tn,{className:"text-right",children:"Gross Profit"}),u.jsx(tn,{className:"text-right",children:"Avg. Gross"}),u.jsx(tn,{className:"text-right",children:"Closing %"})]})}),u.jsx(sn,{children:no.map(e=>u.jsxs(an,{children:[u.jsx(rn,{className:"font-medium",children:e.team}),u.jsx(rn,{className:"text-right",children:e.members}),u.jsx(rn,{className:"text-right",children:e.totalSales}),u.jsx(rn,{className:"text-right",children:e.salesPerMember.toFixed(1)}),u.jsxs(rn,{className:"text-right",children:["$",e.grossProfit.toLocaleString()]}),u.jsxs(rn,{className:"text-right",children:["$",e.avgGross]}),u.jsxs(rn,{className:"text-right",children:[e.closingRatio,"%"]})]},e.team))})]})})]})]}),u.jsx(un,{value:"individual",className:"mt-6",children:u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs("div",{className:"flex justify-between",children:[u.jsx(Mt,{children:"Individual Salesperson Performance"}),u.jsx("div",{className:"flex gap-2",children:u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(ms,{className:"mr-2 h-4 w-4"}),"Filter"]})})]})}),u.jsx($t,{children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Name"}),u.jsx(tn,{children:"Team"}),u.jsx(tn,{className:"text-right",children:"New"}),u.jsx(tn,{className:"text-right",children:"Used"}),u.jsx(tn,{className:"text-right",children:"Total"}),u.jsx(tn,{className:"text-right",children:"Gross Profit"}),u.jsx(tn,{className:"text-right",children:"Avg. Gross"}),u.jsx(tn,{className:"text-right",children:"Closing %"})]})}),u.jsx(sn,{children:io.map(e=>u.jsxs(an,{children:[u.jsx(rn,{className:"font-medium",children:e.name}),u.jsx(rn,{children:e.team}),u.jsx(rn,{className:"text-right",children:e.newVehicles}),u.jsx(rn,{className:"text-right",children:e.usedVehicles}),u.jsx(rn,{className:"text-right",children:e.totalSales}),u.jsxs(rn,{className:"text-right",children:["$",e.grossProfit.toLocaleString()]}),u.jsxs(rn,{className:"text-right",children:["$",e.avgGross]}),u.jsxs(rn,{className:"text-right",children:[e.closingRatio,"%"]})]},e.id))})]})})]})}),u.jsx(un,{value:"inventory",className:"mt-6",children:u.jsxs("div",{className:"grid gap-6 md:grid-cols-2 mb-6",children:[u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"New Vehicle Inventory"})}),u.jsxs($t,{children:[u.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[u.jsxs("div",{children:[u.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Total Inventory"}),u.jsx("div",{className:"text-2xl font-bold",children:oo.total})]}),u.jsxs("div",{children:[u.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Avg. Days on Lot"}),u.jsx("div",{className:"text-2xl font-bold",children:oo.daysOnLot})]})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between mb-1",children:[u.jsx("span",{className:"text-sm",children:"Available"}),u.jsxs("span",{className:"text-sm font-medium",children:[oo.available," (",Math.round(oo.available/oo.total*100),"%)"]})]}),u.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:oo.available/oo.total*100+"%"}})})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between mb-1",children:[u.jsx("span",{className:"text-sm",children:"Sold"}),u.jsxs("span",{className:"text-sm font-medium",children:[oo.sold," (",Math.round(oo.sold/oo.total*100),"%)"]})]}),u.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:oo.sold/oo.total*100+"%"}})})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between mb-1",children:[u.jsx("span",{className:"text-sm",children:"Reserved"}),u.jsxs("span",{className:"text-sm font-medium",children:[oo.reserved," (",Math.round(oo.reserved/oo.total*100),"%)"]})]}),u.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-amber-500 rounded-full",style:{width:oo.reserved/oo.total*100+"%"}})})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between mb-1",children:[u.jsx("span",{className:"text-sm",children:"In Transit"}),u.jsxs("span",{className:"text-sm font-medium",children:[oo.inTransit," (",Math.round(oo.inTransit/oo.total*100),"%)"]})]}),u.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-purple-500 rounded-full",style:{width:oo.inTransit/oo.total*100+"%"}})})]})]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Used Vehicle Inventory"})}),u.jsxs($t,{children:[u.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[u.jsxs("div",{children:[u.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Total Inventory"}),u.jsx("div",{className:"text-2xl font-bold",children:co.total})]}),u.jsxs("div",{children:[u.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Avg. Days on Lot"}),u.jsx("div",{className:"text-2xl font-bold",children:co.daysOnLot})]})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between mb-1",children:[u.jsx("span",{className:"text-sm",children:"Available"}),u.jsxs("span",{className:"text-sm font-medium",children:[co.available," (",Math.round(co.available/co.total*100),"%)"]})]}),u.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:co.available/co.total*100+"%"}})})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between mb-1",children:[u.jsx("span",{className:"text-sm",children:"Sold"}),u.jsxs("span",{className:"text-sm font-medium",children:[co.sold," (",Math.round(co.sold/co.total*100),"%)"]})]}),u.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:co.sold/co.total*100+"%"}})})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between mb-1",children:[u.jsx("span",{className:"text-sm",children:"Reserved"}),u.jsxs("span",{className:"text-sm font-medium",children:[co.reserved," (",Math.round(co.reserved/co.total*100),"%)"]})]}),u.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-amber-500 rounded-full",style:{width:co.reserved/co.total*100+"%"}})})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between mb-1",children:[u.jsx("span",{className:"text-sm",children:"In Transit"}),u.jsxs("span",{className:"text-sm font-medium",children:[co.inTransit," (",Math.round(co.inTransit/co.total*100),"%)"]})]}),u.jsx("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-purple-500 rounded-full",style:{width:co.inTransit/co.total*100+"%"}})})]})]})]})]})]})}),u.jsxs(un,{value:"finance",className:"mt-6",children:[u.jsxs("div",{className:"grid gap-6 md:grid-cols-3 mb-6",children:[u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsx(Mt,{className:"text-sm font-medium",children:"Total Finance Deals"})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:ho}),u.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[Math.round(ho/(ho+uo)*100),"% of total deals"]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsx(Mt,{className:"text-sm font-medium",children:"Cash Deals"})}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:uo}),u.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[Math.round(uo/(ho+uo)*100),"% of total deals"]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{className:"pb-2",children:u.jsx(Mt,{className:"text-sm font-medium",children:"Average Rate"})}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:[xo,"%"]}),u.jsx("p",{className:"text-xs text-green-600 mt-1",children:"0.3% lower than last month"})]})]})]}),u.jsxs("div",{className:"grid gap-6 md:grid-cols-2 mb-6",children:[u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Front End vs Back End"})}),u.jsxs($t,{className:"h-72",children:[u.jsx("div",{className:"flex justify-center items-center h-full text-center text-gray-500",children:"[Front End vs Back End Chart - Comparison of front-end vs back-end profit]"}),u.jsxs("div",{className:"grid grid-cols-2 gap-8 mt-4",children:[u.jsxs("div",{children:[u.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Front End Avg"}),u.jsxs("div",{className:"text-xl font-bold",children:["$",po]})]}),u.jsxs("div",{children:[u.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Back End Avg"}),u.jsxs("div",{className:"text-xl font-bold",children:["$",go]})]})]})]})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Product Penetration"})}),u.jsx($t,{className:"pt-6",children:u.jsxs("div",{className:"space-y-8",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between mb-2",children:[u.jsx("span",{className:"font-medium",children:"Warranty"}),u.jsxs("span",{className:"font-medium",children:[fo,"%"]})]}),u.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${fo}%`}})}),u.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[u.jsx("span",{children:"0%"}),u.jsx("span",{children:"50%"}),u.jsx("span",{children:"100%"})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between mb-2",children:[u.jsx("span",{className:"font-medium",children:"GAP Insurance"}),u.jsxs("span",{className:"font-medium",children:[jo,"%"]})]}),u.jsx("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:`${jo}%`}})}),u.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[u.jsx("span",{children:"0%"}),u.jsx("span",{children:"50%"}),u.jsx("span",{children:"100%"})]})]})]})})]})]})]}),u.jsx(un,{value:"detailed",className:"mt-6",children:u.jsx(wo,{})})]})]})},Do=me;he.forwardRef((e,s)=>{var a=e,{className:t,inset:r,children:l}=a,n=d(a,["className","inset","children"]);return u.jsxs(se,c(o({ref:s,className:et("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",t)},n),{children:[l,u.jsx(es,{className:"ml-auto"})]}))}).displayName=se.displayName,he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(ae,o({ref:s,className:et("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t)},r))}).displayName=ae.displayName,he.forwardRef((e,s)=>{var a=e,{className:t,sideOffset:r=4}=a,l=d(a,["className","sideOffset"]);return u.jsx(te,{children:u.jsx(re,o({ref:s,sideOffset:r,className:et("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t)},l))})}).displayName=re.displayName,he.forwardRef((e,s)=>{var a=e,{className:t,inset:r}=a,l=d(a,["className","inset"]);return u.jsx(le,o({ref:s,className:et("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",r&&"pl-8",t)},l))}).displayName=le.displayName,he.forwardRef((e,s)=>{var a=e,{className:t,children:r,checked:l}=a,n=d(a,["className","children","checked"]);return u.jsxs(ne,c(o({ref:s,className:et("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:l},n),{children:[u.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:u.jsx(ie,{children:u.jsx(ps,{className:"h-4 w-4"})})}),r]}))}).displayName=ne.displayName,he.forwardRef((e,s)=>{var a=e,{className:t,children:r}=a,l=d(a,["className","children"]);return u.jsxs(oe,c(o({ref:s,className:et("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t)},l),{children:[u.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:u.jsx(ie,{children:u.jsx(Zs,{className:"h-2 w-2 fill-current"})})}),r]}))}).displayName=oe.displayName,he.forwardRef((e,s)=>{var a=e,{className:t,inset:r}=a,l=d(a,["className","inset"]);return u.jsx(ce,o({ref:s,className:et("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",t)},l))}).displayName=ce.displayName,he.forwardRef((e,s)=>{var a=e,{className:t}=a,r=d(a,["className"]);return u.jsx(de,o({ref:s,className:et("-mx-1 my-1 h-px bg-muted",t)},r))}).displayName=de.displayName;const Po=[],Co=()=>{const[e,s]=he.useState([]),[a,t]=he.useState([]),[r,l]=he.useState("this-month"),[n,i]=he.useState({start:"",end:""}),[o,c]=he.useState(!1),[d,m]=he.useState([]),[h,x]=he.useState({mtdRevenue:0,dealsProcessed:0,productsPerDeal:0,pvr:0,dealTypes:{finance:0,cash:0,lease:0},productMix:{extendedWarranty:0,gapInsurance:0,paintProtection:0,tireWheel:0,ppm:0,other:0},avgProfits:{extendedWarranty:0,gapInsurance:0,paintProtection:0,tireWheel:0,ppm:0,other:0}}),[p,g]=he.useState(!0);he.useEffect(()=>{j();const e=e=>{"singleFinanceDeals"===e.key&&(console.log("[SingleFinanceHomePage] Storage change detected, reloading deals"),j())},s=()=>{console.log("[SingleFinanceHomePage] Window focus detected, refreshing deals"),j()};return window.addEventListener("storage",e),window.addEventListener("focus",s),()=>{window.removeEventListener("storage",e),window.removeEventListener("focus",s)}},[]);const f=()=>{console.log("[SingleFinanceHomePage] Manual refresh triggered"),j()};he.useEffect(()=>(window.refreshSingleFinanceDeals=f,()=>{delete window.refreshSingleFinanceDeals}),[]),he.useEffect(()=>{e.length>0&&v()},[r,n,e]);const j=he.useCallback(()=>{try{const e=localStorage.getItem("singleFinanceDeals");if(e){const a=JSON.parse(e);console.log("[SingleFinanceHomePage] Loaded deals from singleFinanceDeals storage:",a),s(a),t(a.filter(e=>"Pending"===e.status||"pending"===e.status))}else console.log("[SingleFinanceHomePage] No stored deals found, using mock data"),s(Po),t(Po.filter(e=>"Pending"===e.status))}catch(e){console.error("[SingleFinanceHomePage] Error loading deals from localStorage:",e),s(Po),t(Po.filter(e=>"Pending"===e.status))}},[]),v=he.useCallback(()=>{const{startDate:s,endDate:a}=N(r),t=e.filter(e=>{const t=new Date(e.saleDate);return t>=s&&t<=a});m(t),b(t)},[e,r,n]),b=he.useCallback(e=>{if(0===e.length)return void x({mtdRevenue:0,dealsProcessed:0,productsPerDeal:0,pvr:0,dealTypes:{finance:0,cash:0,lease:0},productMix:{extendedWarranty:0,gapInsurance:0,paintProtection:0,tireWheel:0,ppm:0,other:0},avgProfits:{extendedWarranty:0,gapInsurance:0,paintProtection:0,tireWheel:0,ppm:0,other:0}});const s=e.reduce((e,s)=>e+(s.back_end_gross||s.profit||0),0),a=e.length;let t=0,r=0,l=0,n=0,i=0,o=0,c=0,d=0,m=0,h=0,u=0,p=0;e.forEach(e=>{const s=e;s.vscProfit&&s.vscProfit>0?(t+=s.vscProfit,r++):e.vsc_profit&&e.vsc_profit>0&&(t+=e.vsc_profit,r++),s.gapProfit&&s.gapProfit>0?(l+=s.gapProfit,n++):e.gap_profit&&e.gap_profit>0&&(l+=e.gap_profit,n++),s.appearanceProfit&&s.appearanceProfit>0?(i+=s.appearanceProfit,o++):e.appearance_profit&&e.appearance_profit>0&&(i+=e.appearance_profit,o++),s.tireAndWheelProfit&&s.tireAndWheelProfit>0?(c+=s.tireAndWheelProfit,d++):e.tire_wheel_profit&&e.tire_wheel_profit>0&&(c+=e.tire_wheel_profit,d++),s.ppmProfit&&s.ppmProfit>0?(m+=s.ppmProfit,h++):e.ppm_profit&&e.ppm_profit>0&&(m+=e.ppm_profit,h++);const a=(s.extWarrantyProfit||e.ext_warranty_profit||0)+(s.keyReplacementProfit||e.key_replacement_profit||0)+(s.theftProfit||e.theft_profit||0)+(s.windshieldProfit||e.windshield_profit||0)+(s.lojackProfit||e.lojack_profit||0)+(s.otherProfit||e.other_profit||0);a>0&&(u+=a,p++)});let g=0,f=0,j=0;e.forEach(e=>{const s=(e.dealType||"").toLowerCase();"finance"===s||"financing"===s?g++:"cash"===s?f++:"lease"===s||"leasing"===s?j++:g++});const v=e=>a>0?Math.round(e/a*100):0,b=(e,s)=>s>0?Math.round(e/s):0;x({mtdRevenue:s,dealsProcessed:a,productsPerDeal:a>0?(r+n+o+d+h+p)/a:0,pvr:a>0?s/a:0,dealTypes:{finance:g,cash:f,lease:j},productMix:{extendedWarranty:v(r),gapInsurance:v(n),paintProtection:v(o),tireWheel:v(d),ppm:v(h),other:v(p)},avgProfits:{extendedWarranty:b(t,r),gapInsurance:b(l,n),paintProtection:b(i,o),tireWheel:b(c,d),ppm:b(m,h),other:b(u,p)}})},[]),N=he.useCallback(e=>{const s=new Date;let a=new Date,t=new Date;switch(e){case"this-month":a=new Date(s.getFullYear(),s.getMonth(),1),t=s;break;case"last-month":a=new Date(s.getFullYear(),s.getMonth()-1,1),t=new Date(s.getFullYear(),s.getMonth(),0);break;case"last-quarter":{const e=Math.floor(s.getMonth()/3);a=new Date(s.getFullYear(),3*e-3,1),t=new Date(s.getFullYear(),3*e,0);break}case"ytd":a=new Date(s.getFullYear(),0,1),t=s;break;case"last-year":a=new Date(s.getFullYear()-1,0,1),t=new Date(s.getFullYear()-1,11,31);break;case"custom":n.start&&n.end&&(a=new Date(n.start),t=new Date(n.end))}return{startDate:a,endDate:t}},[n]);return u.jsxs("div",{className:"container mx-auto px-4 py-8",children:[p&&u.jsxs("div",{className:"mb-6 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-100 rounded-lg shadow-sm relative",children:[u.jsx("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600",onClick:()=>g(!1),"aria-label":"Close promotional banner",children:u.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[u.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),u.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"mr-4 bg-blue-500 text-white p-2 rounded-full",children:u.jsx(ss,{size:20})}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-medium text-blue-800",children:"Special Promotion Active!"}),u.jsxs("p",{className:"text-blue-600",children:["Your Finance Manager subscription is currently"," ",u.jsx("span",{className:"line-through text-gray-500 mr-1",children:"$5/month"}),u.jsx("span",{className:"font-bold text-red-500",children:"FREE"}),u.jsx("span",{className:"text-gray-500 text-sm italic ml-1",children:"for a limited time"})]})]})]})]}),u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h1",{className:"text-2xl font-bold",children:"Finance Manager Dashboard"}),u.jsx("div",{className:"space-x-2",children:u.jsx(Do,{})})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[u.jsxs(Ut,{className:"border-l-4 border-l-green-500 hover:shadow-md transition-shadow",children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-base font-semibold text-slate-700",children:"F&I Gross"}),u.jsx(Ke,{className:"h-4 w-4 text-green-500"})]}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold text-slate-900",children:["$",h.mtdRevenue.toLocaleString()]}),u.jsx("p",{className:"text-xs text-muted-foreground",children:h.mtdRevenue>12e3?u.jsxs("span",{className:"text-green-500 flex items-center",children:[u.jsx(He,{className:"mr-1 h-4 w-4"}),"+12% from last month"]}):u.jsxs("span",{className:"text-red-600 flex items-center",children:[u.jsx(Ze,{className:"mr-1 h-4 w-4"}),"-8% from last month"]})})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-blue-500 hover:shadow-md transition-shadow",children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-base font-semibold text-slate-700",children:"Deals Processed"}),u.jsx(as,{className:"h-4 w-4 text-blue-500"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold text-slate-900",children:h.dealsProcessed}),u.jsx("p",{className:"text-xs text-muted-foreground",children:u.jsxs("span",{className:"text-green-500 flex items-center",children:[u.jsx(He,{className:"mr-1 h-4 w-4"}),"+3% from last month"]})})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-indigo-500 hover:shadow-md transition-shadow",children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-base font-semibold text-slate-700",children:"Deal Types"}),u.jsx(js,{className:"h-4 w-4 text-indigo-500"})]}),u.jsx($t,{children:u.jsxs("div",{className:"space-y-1",children:[u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"text-xs text-gray-600",children:"Finance:"}),u.jsx("span",{className:"text-sm font-bold text-indigo-600",children:h.dealTypes.finance})]}),u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"text-xs text-gray-600",children:"Cash:"}),u.jsx("span",{className:"text-sm font-bold text-green-600",children:h.dealTypes.cash})]}),u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"text-xs text-gray-600",children:"Lease:"}),u.jsx("span",{className:"text-sm font-bold text-blue-600",children:h.dealTypes.lease})]})]})})]}),u.jsxs(Ut,{className:"border-l-4 border-l-purple-500 hover:shadow-md transition-shadow",children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-base font-semibold text-slate-700",children:"Products Per Deal"}),u.jsx(ns,{className:"h-4 w-4 text-purple-500"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold text-slate-900",children:h.productsPerDeal.toFixed(1)}),u.jsx("p",{className:"text-xs text-muted-foreground",children:h.productsPerDeal>=2?u.jsxs("span",{className:"text-green-500 flex items-center",children:[u.jsx(He,{className:"mr-1 h-4 w-4"}),"+0.2 from last month"]}):u.jsxs("span",{className:"text-red-600 flex items-center",children:[u.jsx(Ze,{className:"mr-1 h-4 w-4"}),"-0.3 from last month"]})})]})]}),u.jsxs(Ut,{className:"border-l-4 border-l-amber-500 hover:shadow-md transition-shadow",children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-base font-semibold text-slate-700",children:"PVR (Per Vehicle Retailed)"}),u.jsx(ls,{className:"h-4 w-4 text-amber-500"})]}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold text-slate-900",children:["$",h.pvr.toLocaleString()]}),u.jsx("p",{className:"text-xs text-muted-foreground",children:h.pvr>1500?u.jsxs("span",{className:"text-green-500 flex items-center",children:[u.jsx(He,{className:"mr-1 h-4 w-4"}),"+$125 from last month"]}):u.jsxs("span",{className:"text-red-600 flex items-center",children:[u.jsx(Ze,{className:"mr-1 h-4 w-4"}),"-$89 from last month"]})})]})]})]}),u.jsxs(Ut,{className:"col-span-12 bg-white border-slate-200 shadow-sm mt-6",children:[u.jsx(Gt,{className:"py-2 px-4 border-b",children:u.jsxs(Mt,{className:"flex items-center text-xl font-semibold",children:[u.jsx(ns,{className:"mr-2 h-6 w-6 text-blue-500"}),"F&I Product Mix - Penetration % & Avg. Profit"]})}),u.jsxs($t,{className:"p-4",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100",children:[u.jsxs("div",{className:"font-medium flex items-center text-base",children:[u.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full mr-2"}),"Vehicle Service Contract (VSC)"]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("div",{className:"font-bold text-2xl text-blue-600",children:["$",h.avgProfits.extendedWarranty.toLocaleString()]}),u.jsxs("div",{className:"text-sm text-gray-600",children:[h.productMix.extendedWarranty,"% Penetration"]})]})]}),u.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100",children:[u.jsxs("div",{className:"font-medium flex items-center text-base",children:[u.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full mr-2"}),"GAP Insurance"]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("div",{className:"font-bold text-2xl text-green-600",children:["$",h.avgProfits.gapInsurance.toLocaleString()]}),u.jsxs("div",{className:"text-sm text-gray-600",children:[h.productMix.gapInsurance,"% Penetration"]})]})]}),u.jsxs("div",{className:"flex items-center justify-between py-2",children:[u.jsxs("div",{className:"font-medium flex items-center text-base",children:[u.jsx("div",{className:"w-3 h-3 bg-purple-600 rounded-full mr-2"}),"PrePaid Maintenance (PPM)"]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("div",{className:"font-bold text-2xl text-purple-600",children:["$",h.avgProfits.ppm.toLocaleString()]}),u.jsxs("div",{className:"text-sm text-gray-600",children:[h.productMix.ppm,"% Penetration"]})]})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100",children:[u.jsxs("div",{className:"font-medium flex items-center text-base",children:[u.jsx("div",{className:"w-3 h-3 bg-orange-600 rounded-full mr-2"}),"Paint Protection"]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("div",{className:"font-bold text-2xl text-orange-600",children:["$",h.avgProfits.paintProtection.toLocaleString()]}),u.jsxs("div",{className:"text-sm text-gray-600",children:[h.productMix.paintProtection,"% Penetration"]})]})]}),u.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100",children:[u.jsxs("div",{className:"font-medium flex items-center text-base",children:[u.jsx("div",{className:"w-3 h-3 bg-amber-600 rounded-full mr-2"}),"Tire and Wheel Bundle"]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("div",{className:"font-bold text-2xl text-amber-600",children:["$",h.avgProfits.tireWheel.toLocaleString()]}),u.jsxs("div",{className:"text-sm text-gray-600",children:[h.productMix.tireWheel,"% Penetration"]})]})]}),u.jsxs("div",{className:"flex items-center justify-between py-2",children:[u.jsxs("div",{className:"font-medium flex items-center text-base",children:[u.jsx("div",{className:"w-3 h-3 bg-gray-600 rounded-full mr-2"}),"Other Products"]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("div",{className:"font-bold text-2xl text-gray-600",children:["$",h.avgProfits.other.toLocaleString()]}),u.jsxs("div",{className:"text-sm text-gray-600",children:[h.productMix.other,"% Penetration"]})]})]})]})]}),u.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("div",{className:"font-medium text-sm",children:"Products Per Deal (PPD)"}),u.jsx("div",{className:"font-bold text-lg text-purple-600",children:h.productsPerDeal.toFixed(1)})]})})]})]}),u.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6"})]})},ko=()=>{const e=pe(),[s,a]=he.useState([]),[t,r]=he.useState(""),[l,n]=he.useState("All"),[i,o]=he.useState("saleDate"),[c,d]=he.useState("desc");he.useEffect(()=>{try{const e=localStorage.getItem("singleFinanceDeals");if(e){const s=JSON.parse(e).map(e=>{const s={id:e.id,customer:e.customer||e.lastName||"Unknown",vehicle:e.vehicle||`${"N"===e.vehicleType?"New":"U"===e.vehicleType?"Used":"CPO"} - Stock #${e.stockNumber}`,vin:e.vin||e.vinLast8||"",saleDate:e.saleDate||e.dealDate||e.created_at,salesperson:e.salesperson||"Self",amount:e.amount||e.totalGross||0,status:e.status||e.dealStatus||"Pending",products:e.products||[],profit:e.profit||e.backEndGross||0,created_at:e.created_at||(new Date).toISOString()};return Object.assign(s,e)});a(s)}}catch(e){console.error("Error loading deals from localStorage:",e)}},[]);const m=s.filter(e=>{const s=e.customer.toLowerCase().includes(t.toLowerCase())||e.vehicle.toLowerCase().includes(t.toLowerCase())||e.id.toLowerCase().includes(t.toLowerCase())||e.dealNumber&&e.dealNumber.toLowerCase().includes(t.toLowerCase())||e.vin&&e.vin.toLowerCase().includes(t.toLowerCase()),a="All"===l||e.status===l;return s&&a}).sort((e,s)=>{const a=e[i],t=s[i];return"string"==typeof a&&"string"==typeof t?"asc"===c?a.localeCompare(t):t.localeCompare(a):"number"==typeof a&&"number"==typeof t?"asc"===c?a-t:t-a:0}),h=e=>{i===e?d("asc"===c?"desc":"asc"):(o(e),d("asc"))},x=e=>{switch(e){case"Complete":case"Funded":return u.jsxs(pr,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[u.jsx(qs,{className:"w-3 h-3 mr-1"})," ",e]});case"Bank Approval":case"Contract Review":case"Insurance Verification":return u.jsxs(pr,{variant:"outline",className:"bg-amber-50 text-amber-700 border-amber-200",children:[u.jsx(ze,{className:"w-3 h-3 mr-1"})," ",e]});case"Pending Documents":case"Pending":return u.jsxs(pr,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[u.jsx(Ue,{className:"w-3 h-3 mr-1"})," ",e]});case"Unwound":case"Dead Deal":return u.jsxs(pr,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:[u.jsx(Ue,{className:"w-3 h-3 mr-1"})," ",e]});default:return u.jsx(pr,{variant:"outline",children:e})}},p=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);return u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{className:"flex items-center mb-6",children:[u.jsxs("button",{type:"button",onClick:()=>{e("/dashboard/single-finance")},className:"mr-4 flex items-center px-4 py-2 text-sm font-medium text-white bg-orange-600 border border-orange-600 rounded-md shadow-sm hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-500",children:[u.jsx(cs,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),u.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Single Finance Manager - Deals"})]}),u.jsx("div",{className:"mb-4 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:u.jsxs("p",{className:"text-orange-800 text-sm",children:[u.jsx("strong",{children:"Note:"})," These deals are specific to your Single Finance Manager Dashboard and are stored separately from the main finance deals."]})}),u.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4 mb-6",children:[u.jsxs("div",{className:"relative flex-1",children:[u.jsx(ds,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),u.jsx(Vt,{placeholder:"Search deals by customer, vehicle, deal #, or VIN",className:"pl-9 border-gray-300",value:t,onChange:e=>r(e.target.value)})]}),u.jsx("div",{className:"flex gap-2",children:u.jsxs("div",{className:"flex items-center gap-2 bg-white border border-gray-200 rounded-md px-2",children:[u.jsx(ms,{size:16,className:"text-gray-500"}),u.jsxs("select",{className:"border-0 rounded p-2 text-sm focus:ring-0 focus:outline-none",value:l,onChange:e=>n(e.target.value),children:[u.jsx("option",{value:"All",children:"All Statuses"}),u.jsx("option",{value:"Pending",children:"Pending"}),u.jsx("option",{value:"Funded",children:"Funded"}),u.jsx("option",{value:"Unwound",children:"Unwound"}),u.jsx("option",{value:"Dead Deal",children:"Dead Deal"})]})]})})]}),u.jsx(Ut,{className:"border hover:shadow-md transition-shadow",children:u.jsx($t,{className:"p-0",children:u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"w-full text-sm",children:[u.jsx("thead",{children:u.jsxs("tr",{className:"bg-orange-50 border-b",children:[u.jsx("th",{className:"py-3 px-4 text-left font-medium",children:u.jsxs("button",{className:"flex items-center",onClick:()=>h("dealNumber"),children:["Deal #","dealNumber"===i&&u.jsx(hs,{size:14,className:"ml-1 text-gray-500"})]})}),u.jsx("th",{className:"py-3 px-4 text-left font-medium",children:u.jsxs("button",{className:"flex items-center",onClick:()=>h("saleDate"),children:["Date","saleDate"===i&&u.jsx(hs,{size:14,className:"ml-1 text-gray-500"})]})}),u.jsx("th",{className:"py-3 px-4 text-left font-medium",children:u.jsxs("button",{className:"flex items-center",onClick:()=>h("customer"),children:["Customer","customer"===i&&u.jsx(hs,{size:14,className:"ml-1 text-gray-500"})]})}),u.jsx("th",{className:"py-3 px-4 text-left font-medium",children:"Vehicle"}),u.jsx("th",{className:"py-3 px-4 text-left font-medium",children:"Stock #"}),u.jsx("th",{className:"py-3 px-4 text-left font-medium",children:"VIN"}),u.jsx("th",{className:"py-3 px-4 text-right font-medium",children:u.jsxs("button",{className:"flex items-center ml-auto",onClick:()=>h("amount"),children:["Total Gross","amount"===i&&u.jsx(hs,{size:14,className:"ml-1 text-gray-500"})]})}),u.jsx("th",{className:"py-3 px-4 text-right font-medium",children:u.jsxs("button",{className:"flex items-center ml-auto",onClick:()=>h("profit"),children:["Back End","profit"===i&&u.jsx(hs,{size:14,className:"ml-1 text-gray-500"})]})}),u.jsx("th",{className:"py-3 px-4 text-left font-medium",children:"Lender"}),u.jsx("th",{className:"py-3 px-4 text-center font-medium",children:"Status"})]})}),u.jsx("tbody",{children:0===m.length?u.jsx("tr",{children:u.jsx("td",{colSpan:10,className:"py-8 text-center text-gray-500",children:0===s.length?"No deals logged yet. Use the 'Log New Deal' button to add deals.":"No deals match your search criteria."})}):m.map(e=>{const s=e;return u.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[u.jsx("td",{className:"py-3 px-4 font-medium text-blue-600",children:s.dealNumber||e.id}),u.jsx("td",{className:"py-3 px-4",children:(a=e.saleDate,new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))}),u.jsx("td",{className:"py-3 px-4",children:e.customer}),u.jsxs("td",{className:"py-3 px-4",children:[s.vehicleType&&u.jsx("span",{className:"inline-block w-6 h-6 text-xs font-bold text-white text-center rounded mr-2 "+("N"===s.vehicleType?"bg-green-600":"U"===s.vehicleType?"bg-blue-600":"bg-purple-600"),children:s.vehicleType}),e.vehicle]}),u.jsx("td",{className:"py-3 px-4 font-mono",children:s.stockNumber||"N/A"}),u.jsx("td",{className:"py-3 px-4 font-mono text-xs",children:e.vin?`...${e.vin.slice(-8)}`:"N/A"}),u.jsx("td",{className:"py-3 px-4 text-right font-medium",children:p(e.amount)}),u.jsx("td",{className:"py-3 px-4 text-right font-medium text-green-600",children:p(e.profit)}),u.jsx("td",{className:"py-3 px-4",children:s.lender||"N/A"}),u.jsx("td",{className:"py-3 px-4 text-center",children:x(e.status)})]},e.id);var a})})]})})})}),m.length>0&&u.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[u.jsxs("div",{children:["Showing ",m.length," of ",s.length," deals"]}),u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Ke,{size:16}),u.jsxs("span",{children:["Total Gross:"," ",p(m.reduce((e,s)=>e+s.amount,0))]})]}),u.jsx("div",{className:"flex items-center gap-2",children:u.jsxs("span",{children:["Back End Total:"," ",p(m.reduce((e,s)=>e+s.profit,0))]})})]})]})]})},To=()=>{var e;const{user:s,role:a,dealershipId:t}=It(),r=xe(),l=pe(),[n,i]=he.useState("this-month"),[d,m]=he.useState([]),[x,p]=he.useState(!1),[g,f]=he.useState(null),j=(null==(e=null==s?void 0:s.user_metadata)?void 0:e.schema_name)||"",v=()=>{p(!0),f(null);try{console.log("[SingleFinanceManagerDashboard] Loading deals from localStorage");const e=localStorage.getItem("singleFinanceDeals");if(console.log("[SingleFinanceManagerDashboard] Raw singleFinanceDeals:",e),!e)return console.log("[SingleFinanceManagerDashboard] No deals found in localStorage"),void m([]);const s=JSON.parse(e);console.log(`[SingleFinanceManagerDashboard] Found ${s.length} raw deals`),console.log("[SingleFinanceManagerDashboard] First deal sample:",s[0]);const a=s.map(e=>{const s={id:e.id,customer:e.customer||e.lastName,vehicle:e.vehicle||`${"N"===e.vehicleType?"New":"U"===e.vehicleType?"Used":"CPO"} - Stock #${e.stockNumber}`,vin:e.vin||e.vinLast8,saleDate:e.saleDate||e.dealDate,salesperson:e.salesperson||"Self",amount:e.amount||e.totalGross,status:e.status||e.dealStatus,products:e.products||[],profit:e.profit||e.backEndGross,created_at:e.created_at||(new Date).toISOString()};return Object.assign(s,e)});console.log("[SingleFinanceManagerDashboard] Formatted deals with extended properties:",a[0]),m(a)}catch(e){console.error("[SingleFinanceManagerDashboard] Error loading deals from localStorage:",e),f("Failed to load deals from local storage."),m([])}finally{p(!1)}};he.useEffect(()=>{j?b():(console.log("[SingleFinanceManagerDashboard] No schema available, loading from localStorage"),v())},[j,n]);const b=()=>h(null,null,function*(){if(j){p(!0),f(null);try{console.log(`[SingleFinanceManagerDashboard] Fetching deals from schema: ${j}`);const a={},t=new Date,r=t.getMonth(),l=t.getFullYear();if("this-month"===n){const e=new Date(l,r,1),s=new Date(l,r+1,0);a.sale_date={start:e.toISOString().split("T")[0],end:s.toISOString().split("T")[0]}}else if("last-month"===n){const e=new Date(l,r-1,1),s=new Date(l,r,0);a.sale_date={start:e.toISOString().split("T")[0],end:s.toISOString().split("T")[0]}}else if("last-quarter"===n){const e=3*Math.floor(r/3)-3,s=new Date(l,e,1),t=new Date(l,e+3,0);a.sale_date={start:s.toISOString().split("T")[0],end:t.toISOString().split("T")[0]}}else if("ytd"===n){const e=new Date(l,0,1);a.sale_date={start:e.toISOString().split("T")[0],end:t.toISOString().split("T")[0]}}else if("last-year"===n){const e=new Date(l-1,0,1),s=new Date(l-1,11,31);a.sale_date={start:e.toISOString().split("T")[0],end:s.toISOString().split("T")[0]}}const i=yield(e=j,s={limit:50,sortBy:"created_at",sortDirection:"desc",filter:a},h(null,null,function*(){try{console.log(`[apiService] Getting finance manager deals from schema: ${e}`);const a=yield na();if(!a)throw new Error("Not authenticated");const t=(null==s?void 0:s.limit)||50,r=(null==s?void 0:s.offset)||0,l=(null==s?void 0:s.sortBy)||"created_at",n=(null==s?void 0:s.sortDirection)||"desc";let i="";if(null==s?void 0:s.filter){const e=[];Object.entries(s.filter).forEach(([s,a])=>{null!=a&&("string"==typeof a?e.push(`${s} ILIKE '%${a}%'`):"number"==typeof a||"boolean"==typeof a?e.push(`${s} = ${a}`):a.start&&a.end&&e.push(`${s} BETWEEN '${a.start}' AND '${a.end}'`))}),e.length>0&&(i=`AND ${e.join(" AND ")}`)}const o=`\n      SELECT * FROM "${e}".deals \n      WHERE user_id = '${a.id}' ${i}\n      ORDER BY ${l} ${n}\n      LIMIT ${t} OFFSET ${r};\n    `,c=`\n      SELECT COUNT(*) FROM "${e}".deals \n      WHERE user_id = '${a.id}' ${i};\n    `,{data:d,error:m}=yield ta.rpc("run_sql",{sql_query:o});if(m)throw console.error(`[apiService] Error selecting deals from ${e}:`,m),m;const{data:h,error:u}=yield ta.rpc("run_sql",{sql_query:c});if(u)throw console.error(`[apiService] Error counting deals in ${e}:`,u),u;const x=h&&h.length>0?parseInt(h[0].count):0;return console.log(`[apiService] Retrieved ${d?d.length:0} deals from ${e} (total: ${x})`),{success:!0,deals:d||[],count:x,message:`Retrieved ${d?d.length:0} deals successfully`}}catch(g){return console.error("[apiService] Error in getFinanceManagerDeals:",g),{success:!1,deals:[],count:0,message:`Failed to get deals: ${g.message||g}`,error:g}}}));if(i.success){console.log(`[SingleFinanceManagerDashboard] Fetched ${i.deals.length} deals`);const e=i.deals.map(e=>({id:e.deal_number||String(e.id),customer:e.customer_name,vehicle:e.vehicle,vin:e.vin||"",saleDate:e.sale_date,salesperson:"Self",amount:e.amount,status:e.status,products:Array.isArray(e.products)?e.products:"string"==typeof e.products?JSON.parse(e.products):[],profit:e.profit,created_at:e.created_at}));m(e)}else console.error("[SingleFinanceManagerDashboard] Error fetching deals:",i.error),f("Failed to load deals. Please try again later.")}catch(a){console.error("[SingleFinanceManagerDashboard] Exception fetching deals:",a),f("An unexpected error occurred while loading deals.")}finally{p(!1)}var e,s}});he.useEffect(()=>(console.log("[SingleFinanceManagerDashboard] Rendering single finance manager dashboard",{userId:null==s?void 0:s.id,role:a,dealershipId:t,timestamp:(new Date).toISOString(),path:r.pathname}),()=>{console.log("[SingleFinanceManagerDashboard] Unmounting single finance manager dashboard")}),[s,a,t,r.pathname]);const N=e=>{e.preventDefault(),console.log("[SingleFinanceManagerDashboard] Log New Deal button clicked, navigating to /single-finance-deal-log"),l("/single-finance-deal-log")},y=e=>{const s=new Date,a=s.toLocaleString("default",{month:"long"}),t=s.getFullYear();switch(e){case"this-month":default:return`${a} ${t}`;case"last-month":return`${0===s.getMonth()?"December":new Date(s.getFullYear(),s.getMonth()-1,1).toLocaleString("default",{month:"long"})} ${0===s.getMonth()?s.getFullYear()-1:s.getFullYear()}`;case"last-quarter":const e=Math.floor(s.getMonth()/3);return`Q${0===e?4:e} ${0===e?t-1:t}`;case"ytd":return`Year to Date ${t}`;case"last-year":return""+(t-1)}},w=["Present every product to every customer every time - consistency is key.","Build value first, then discuss investment. Never start with the price.","Use customer-friendly language instead of industry jargon when explaining products.","Focus on protection and peace of mind, not just financial benefits.","Keep your menu presentation simple and visual for maximum effectiveness.","Digital menus increase compliance and provide a more professional presentation.","Always congratulate the customer on their vehicle purchase before starting your presentation.","Listen to customer concerns about products and address them specifically.","Explain how each product benefits the customer's specific vehicle and usage patterns."],S=()=>{var e;return u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"flex justify-between items-start mb-6",children:u.jsx("div",{className:"flex-grow",children:u.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-2",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-3xl font-bold",children:"Single Finance Manager Dashboard"}),u.jsxs("p",{className:"text-gray-600 mt-1",children:["Finance Manager: ",(null==(e=null==s?void 0:s.email)?void 0:e.split("@")[0])||"Not Assigned"]})]}),u.jsx("div",{className:"bg-orange-50 p-2 rounded-md mt-2 md:mt-0 border border-orange-100 max-w-2xl",children:u.jsxs("p",{className:"text-xs italic text-orange-800",children:[u.jsx(Je,{className:"h-3 w-3 inline-block mr-1"}),u.jsx("strong",{children:"F&I Best Practice:"})," ",w[(new Date).getDay()%w.length]]})})]})})}),u.jsxs("div",{className:"flex justify-between items-center mb-3",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx("h2",{className:"text-2xl font-bold mr-3",children:y(n)}),u.jsxs("select",{value:n,onChange:e=>i(e.target.value),className:"p-2 border rounded-md shadow-sm",children:[u.jsx("option",{value:"this-month",children:"This Month"}),u.jsx("option",{value:"last-month",children:"Last Month"}),u.jsx("option",{value:"last-quarter",children:"Last Quarter"}),u.jsx("option",{value:"ytd",children:"Year to Date"}),u.jsx("option",{value:"last-year",children:"Last Year"})]})]}),u.jsx(Bt,{size:"lg",className:"bg-orange-600 hover:bg-orange-700",onClick:N,children:u.jsxs("span",{className:"flex items-center",children:[u.jsx(xs,{className:"mr-2 h-5 w-5"}),"Log New Deal"]})})]}),u.jsx("div",{children:u.jsx(Co,{})}),u.jsxs(Ut,{className:"col-span-12 bg-white border-slate-200 shadow-sm",children:[u.jsxs(Gt,{className:"py-2 px-4 border-b flex flex-row items-center justify-between space-y-0",children:[u.jsxs(Mt,{className:"text-lg font-medium flex items-center",children:[u.jsx(as,{className:"mr-2 h-5 w-5 text-orange-500"}),"Deals Log"]}),u.jsx(Bt,{variant:"outline",size:"sm",asChild:!0,children:u.jsx(fe,{to:"/dashboard/single-finance/deals",children:"View All"})})]}),u.jsx($t,{className:"p-4",children:d.length>0?u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"w-full text-sm",children:[u.jsx("thead",{children:u.jsxs("tr",{className:"text-xs",children:[u.jsx("th",{className:"font-medium text-white py-2 pl-3 text-center bg-gray-600 w-12",children:"#"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-left bg-gray-600",children:"Last Name"}),u.jsx("th",{className:"font-medium text-white py-2 pl-4 pr-2 text-left bg-orange-600",children:"Deal #"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-left bg-gray-600",children:"Stock #"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-gray-600",children:"Date"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-left bg-gray-600",children:"VIN"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-indigo-600",children:"N/U/CPO"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-left bg-gray-600",children:"Lender"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-orange-600",children:"Front End"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-teal-600",children:"VSC"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-purple-600",children:"PPM"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-green-600",children:"GAP"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-amber-600",children:"T&W/Bundle"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-pink-600",children:"PPD"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-purple-600",children:"PVR"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-right bg-green-600",children:"Total"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-gray-600 w-20",children:"Status"}),u.jsx("th",{className:"font-medium text-white py-2 px-2 text-center bg-red-600 rounded-tr-md w-16",children:"Delete"})]})}),u.jsx("tbody",{children:d.slice(0,10).map((e,s)=>{const a=e,t=e.customer.split(" ").pop()||"",r=a.dealDate||e.saleDate,l=new Date(r).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"}),n=a.vehicleType||(e.vehicle.toLowerCase().includes("new")?"N":e.vehicle.toLowerCase().includes("cpo")?"C":"U");console.log(`[Dashboard] Processing deal ${e.id}:`,{dealData:a,vscProfit:a.vscProfit,ppmProfit:a.ppmProfit,gapProfit:a.gapProfit,tireAndWheelProfit:a.tireAndWheelProfit,appearanceProfit:a.appearanceProfit,otherProfit:a.otherProfit,dealNumber:a.dealNumber,stockNumber:a.stockNumber,dealDate:a.dealDate,vehicleType:a.vehicleType,frontEndGross:a.frontEndGross,backEndGross:a.backEndGross,totalGross:a.totalGross});const i="number"==typeof a.vscProfit?a.vscProfit:parseFloat(a.vscProfit)||0,m="number"==typeof a.ppmProfit?a.ppmProfit:parseFloat(a.ppmProfit)||0,h="number"==typeof a.gapProfit?a.gapProfit:parseFloat(a.gapProfit)||0,x="number"==typeof a.tireAndWheelProfit?a.tireAndWheelProfit:parseFloat(a.tireAndWheelProfit)||0;"number"==typeof a.appearanceProfit?a.appearanceProfit:parseFloat(a.appearanceProfit),"number"==typeof a.otherProfit?a.otherProfit:parseFloat(a.otherProfit);const p=e.products.length,g=Math.round(e.profit/(p||1)),j="Complete"===e.status||"Funded"===e.status?"Funded":"Canceled"===e.status||"Unwound"===e.status?"Unwound":"Pending",b="Funded"===j?"bg-green-100 text-green-800 border-green-200":"Unwound"===j?"bg-red-100 text-red-800 border-red-200":"bg-amber-100 text-amber-800 border-amber-200";return u.jsxs("tr",{className:`border-b ${s%2==1?"bg-gray-50":""} hover:bg-blue-50`,children:[u.jsx("td",{className:"py-2 px-2 text-center font-medium",children:d.length-s}),u.jsx("td",{className:"py-2 px-2 text-left font-medium",children:t}),u.jsx("td",{className:"py-2 pl-4 pr-2 text-left font-medium text-blue-600",children:a.dealNumber||e.id}),u.jsx("td",{className:"py-2 px-2 text-left",children:a.stockNumber||e.id.replace("D","S")}),u.jsx("td",{className:"py-2 px-2 text-center text-gray-600",children:l}),u.jsx("td",{className:"py-2 px-2 text-left text-gray-600 font-mono text-xs",children:a.vinLast8||e.vin||"N/A"}),u.jsx("td",{className:"py-2 px-2 text-center",children:u.jsx("span",{className:"px-1.5 py-0.5 rounded text-xs font-medium "+("N"===n?"bg-green-100 text-green-800":"C"===n?"bg-blue-100 text-blue-800":"bg-amber-100 text-amber-800"),children:n})}),u.jsx("td",{className:"py-2 px-2 text-left text-gray-600 text-xs",children:a.lender||"N/A"}),u.jsxs("td",{className:"py-2 px-2 text-right bg-blue-50 font-medium",children:["$",(a.frontEndGross||0).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-teal-50",children:["$",i.toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-purple-50",children:["$",m.toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-green-50",children:["$",h.toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-amber-50",children:["$",x.toLocaleString()]}),u.jsx("td",{className:"py-2 px-2 text-center bg-pink-50 font-medium",children:p}),u.jsxs("td",{className:"py-2 px-2 text-right bg-purple-50",children:["$",g.toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right font-medium text-green-600",children:["$",e.profit.toLocaleString()]}),u.jsx("td",{className:"py-2 px-2 text-center",children:u.jsxs("select",{value:j,onChange:s=>((e,s)=>{try{const a="singleFinanceDeals",t=localStorage.getItem(a),r=(t?JSON.parse(t):[]).map(a=>a.id===e?c(o({},a),{status:s}):a);localStorage.setItem(a,JSON.stringify(r)),v(),console.log(`[SingleFinanceManagerDashboard] Updated deal ${e} status to ${s}`)}catch(a){console.error("[SingleFinanceManagerDashboard] Error updating deal status:",a),f("Failed to update deal status")}})(e.id,s.target.value),className:`text-xs px-2 py-1 rounded border-0 focus:ring-1 focus:ring-blue-500 ${b}`,children:[u.jsx("option",{value:"Pending",children:"Pending"}),u.jsx("option",{value:"Funded",children:"Funded"}),u.jsx("option",{value:"Unwound",children:"Unwound"})]})}),u.jsx("td",{className:"py-2 px-2 text-center",children:u.jsx("input",{type:"checkbox",onChange:s=>((e,s)=>{if(s&&confirm("Are you sure you want to delete this deal? This action cannot be undone."))try{const s="singleFinanceDeals",a=localStorage.getItem(s),t=(a?JSON.parse(a):[]).filter(s=>s.id!==e);localStorage.setItem(s,JSON.stringify(t)),v(),console.log(`[SingleFinanceManagerDashboard] Deleted deal ${e}`)}catch(a){console.error("[SingleFinanceManagerDashboard] Error deleting deal:",a),f("Failed to delete deal")}})(e.id,s.target.checked),className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"})})]},e.id)})}),u.jsx("tfoot",{children:u.jsxs("tr",{className:"bg-gray-100 border-t border-t-gray-200 font-medium",children:[u.jsx("td",{colSpan:8,className:"py-2 pl-4 text-left",children:"TOTALS"}),u.jsxs("td",{className:"py-2 px-2 text-right bg-orange-50",children:["$",d.slice(0,10).reduce((e,s)=>{const a=s;return e+("number"==typeof a.frontEndGross?a.frontEndGross:parseFloat(a.frontEndGross)||0)},0).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-teal-50",children:["$",d.slice(0,10).reduce((e,s)=>{const a=s;return e+("number"==typeof a.vscProfit?a.vscProfit:parseFloat(a.vscProfit)||0)},0).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-purple-50",children:["$",d.slice(0,10).reduce((e,s)=>{const a=s;return e+("number"==typeof a.ppmProfit?a.ppmProfit:parseFloat(a.ppmProfit)||0)},0).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-green-50",children:["$",d.slice(0,10).reduce((e,s)=>{const a=s;return e+("number"==typeof a.gapProfit?a.gapProfit:parseFloat(a.gapProfit)||0)},0).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right bg-amber-50",children:["$",d.slice(0,10).reduce((e,s)=>{const a=s;return e+("number"==typeof a.tireAndWheelProfit?a.tireAndWheelProfit:parseFloat(a.tireAndWheelProfit)||0)},0).toLocaleString()]}),u.jsx("td",{className:"py-2 px-2 text-center bg-pink-50",children:(d.slice(0,10).reduce((e,s)=>e+s.products.length,0)/Math.max(1,d.slice(0,10).length)).toFixed(1)}),u.jsxs("td",{className:"py-2 px-2 text-right bg-purple-50",children:["$",Math.round(d.slice(0,10).reduce((e,s)=>e+s.profit,0)/Math.max(1,d.slice(0,10).length)).toLocaleString()]}),u.jsxs("td",{className:"py-2 px-2 text-right font-medium text-green-600",children:["$",d.slice(0,10).reduce((e,s)=>e+s.profit,0).toLocaleString()]}),u.jsx("td",{className:"py-2 px-2"}),u.jsx("td",{className:"py-2 px-2"})]})})]})}):u.jsx("div",{className:"py-8 text-center text-gray-500",children:'No deals logged yet. Use the "Log New Deal" button to add deals.'})})]})]})};return u.jsx("div",{className:"container py-4",children:u.jsxs(ve,{children:[u.jsx(be,{path:"/",element:u.jsx(S,{})}),u.jsx(be,{path:"/deals",element:u.jsx(ko,{})}),u.jsx(be,{path:"*",element:u.jsx(ge,{to:"/dashboard/single-finance",replace:!0})})]})})},Fo=()=>{var e,s;const{user:a,role:t,dealershipId:r}=It(),{toast:l}=dt(),n=xe(),i=pe(),[o,c]=he.useState("overview"),[d,m]=he.useState(!1),[h,x]=he.useState("this-month"),[p,g]=he.useState("all"),[f,j]=he.useState({total_fi_gross:125e3,deals_processed:87,products_per_deal:2.4,per_vehicle_retail:1437,mtd_growth:12.5,team_performance:"excellent",total_vsc_penetration:78.5,penetration_rate:78.5}),[v,b]=he.useState([{id:"fm1",name:"John Valentine",email:"john.valentine@dealership.com",deals_processed:32,mtd_revenue:45e3,ppd:2.8,pvr:1406,status:"active",schedule:"9am - 6pm",performance_rating:"excellent",vsc_penetration:85},{id:"fm2",name:"Lloyd Hatter",email:"lloyd.hatter@dealership.com",deals_processed:28,mtd_revenue:38e3,ppd:2.2,pvr:1357,status:"active",schedule:"11am - 8pm",performance_rating:"good",vsc_penetration:72},{id:"fm3",name:"Sarah Johnson",email:"sarah.johnson@dealership.com",deals_processed:27,mtd_revenue:42e3,ppd:2.6,pvr:1556,status:"active",schedule:"10am - 7pm",performance_rating:"excellent",vsc_penetration:78}]),[N,y]=he.useState([{id:"D001",customer_name:"Smith, John",vehicle:"2024 Honda Accord",salesperson:"Mike Davis",finance_manager:"John Valentine",fi_gross:2400,products:["Extended Warranty","GAP Insurance"],date:"2024-01-15",status:"completed",deal_type:"new",funding_source:"bank"},{id:"D002",customer_name:"Johnson, Mary",vehicle:"2023 Toyota Camry",salesperson:"Lisa Chen",finance_manager:"Lloyd Hatter",fi_gross:1800,products:["Paint Protection","Tire & Wheel"],date:"2024-01-15",status:"completed",deal_type:"used",funding_source:"credit_union"},{id:"D003",customer_name:"Williams, Bob",vehicle:"2024 Ford F-150",salesperson:"Tom Wilson",finance_manager:"Sarah Johnson",fi_gross:3200,products:["Extended Warranty","GAP Insurance","Paint Protection"],date:"2024-01-14",status:"completed",deal_type:"new",funding_source:"captive"},{id:"D004",customer_name:"Davis, Jennifer",vehicle:"2023 Nissan Altima",salesperson:"Sarah Miller",finance_manager:"John Valentine",fi_gross:1950,products:["Extended Warranty","PPM"],date:"2024-01-14",status:"pending",deal_type:"used",funding_source:"bank"},{id:"D005",customer_name:"Brown, Michael",vehicle:"2024 Chevrolet Silverado",salesperson:"Kevin Johnson",finance_manager:"Sarah Johnson",fi_gross:2800,products:["GAP Insurance","Tire & Wheel","Paint Protection"],date:"2024-01-13",status:"completed",deal_type:"new",funding_source:"captive"}]);he.useEffect(()=>{n.pathname.includes("/log-deal")||n.pathname.includes("/deal-log")||n.pathname.includes("/finance-director-deal-log")?m(!0):m(!1)},[n.pathname]);const w=e=>{const s=new Date,a=s.toLocaleString("default",{month:"long"}),t=s.getFullYear();switch(e){case"this-month":default:return`${a} ${t}`;case"last-month":return`${0===s.getMonth()?"December":new Date(s.getFullYear(),s.getMonth()-1,1).toLocaleString("default",{month:"long"})} ${0===s.getMonth()?s.getFullYear()-1:s.getFullYear()}`;case"last-quarter":const e=Math.floor(s.getMonth()/3);return`Q${0===e?4:e} ${0===e?t-1:t}`;case"ytd":return`Year to Date ${t}`;case"last-year":return""+(t-1)}},S=e=>{switch(e){case"excellent":return u.jsx(pr,{className:"bg-green-100 text-green-800",children:"Excellent"});case"good":return u.jsx(pr,{className:"bg-blue-100 text-blue-800",children:"Good"});case"needs_improvement":return u.jsx(pr,{className:"bg-yellow-100 text-yellow-800",children:"Needs Improvement"});default:return u.jsx(pr,{variant:"secondary",children:"Unknown"})}},_=e=>{switch(e){case"completed":return u.jsx(pr,{className:"bg-green-100 text-green-800",children:"Completed"});case"pending":return u.jsx(pr,{className:"bg-yellow-100 text-yellow-800",children:"Pending"});case"cancelled":return u.jsx(pr,{className:"bg-red-100 text-red-800",children:"Cancelled"});default:return u.jsx(pr,{variant:"secondary",children:e})}},D=e=>{switch(e){case"new":return u.jsx(pr,{className:"bg-blue-100 text-blue-800",children:"New"});case"used":return u.jsx(pr,{className:"bg-purple-100 text-purple-800",children:"Used"});default:return u.jsx(pr,{variant:"secondary",children:e})}},P=e=>e>=80?u.jsx(Qs,{className:"w-4 h-4 text-yellow-500 fill-current"}):e>=70?u.jsx(Xs,{className:"w-4 h-4 text-green-500"}):e>=60?u.jsx(Ee,{className:"w-4 h-4 text-yellow-500"}):u.jsx(We,{className:"w-4 h-4 text-red-500"});return d?u.jsxs("div",{className:"container py-4",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"text-3xl font-bold",children:"Finance Director Dashboard"}),u.jsxs("p",{className:"text-gray-600 mt-1",children:["Finance Director: ",(null==(e=null==a?void 0:a.email)?void 0:e.split("@")[0])||"Not Assigned"]})]}),u.jsx(Bt,{size:"lg",className:"bg-green-600 hover:bg-green-700",onClick:()=>i("/dashboard/finance-director"),children:"Back to Dashboard"})]}),u.jsx(ii,{dashboardType:"finance-director"})]}):u.jsxs("div",{className:"container py-4",children:[u.jsx("div",{className:"flex justify-between items-start mb-6",children:u.jsx("div",{className:"flex-grow",children:u.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-2",children:[u.jsxs("div",{children:[u.jsxs("h1",{className:"text-3xl font-bold flex items-center",children:[u.jsx(Cs,{className:"w-8 h-8 mr-3 text-purple-600"}),"Finance Director Dashboard"]}),u.jsxs("p",{className:"text-gray-600 mt-1",children:["Finance Director: ",(null==(s=null==a?void 0:a.email)?void 0:s.split("@")[0])||"Not Assigned"]})]}),u.jsx("div",{className:"bg-purple-50 p-2 rounded-md mt-2 md:mt-0 border border-purple-100 max-w-2xl",children:u.jsxs("p",{className:"text-xs italic text-purple-800",children:[u.jsx(Je,{className:"h-3 w-3 inline-block mr-1"}),u.jsx("strong",{children:"Leadership Tip:"})," Regular one-on-ones with your F&I managers help identify training opportunities and boost team performance."]})})]})})}),u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx("h2",{className:"text-2xl font-bold mr-3",children:w(h)}),u.jsxs("select",{value:h,onChange:e=>x(e.target.value),className:"p-2 border rounded-md shadow-sm",children:[u.jsx("option",{value:"this-month",children:"This Month"}),u.jsx("option",{value:"last-month",children:"Last Month"}),u.jsx("option",{value:"last-quarter",children:"Last Quarter"}),u.jsx("option",{value:"ytd",children:"Year to Date"}),u.jsx("option",{value:"last-year",children:"Last Year"})]})]}),u.jsx(Bt,{size:"lg",className:"bg-purple-600 hover:bg-purple-700",onClick:e=>{e.preventDefault(),i("/finance-director/log-deal")},children:u.jsxs("span",{className:"flex items-center",children:[u.jsx(xs,{className:"mr-2 h-5 w-5"}),"Log New Deal"]})})]}),u.jsxs(dn,{value:o,onValueChange:c,className:"space-y-6",children:[u.jsxs(mn,{className:"grid w-full grid-cols-6",children:[u.jsx(hn,{value:"overview",children:"Quick View"}),u.jsx(hn,{value:"leaderboard",children:"F&I Leaderboard"}),u.jsx(hn,{value:"deals",children:"Department Deals"}),u.jsx(hn,{value:"managers",children:"Manager Deals"}),u.jsx(hn,{value:"schedules",children:"Schedules"}),u.jsx(hn,{value:"payplans",children:"Pay Plans"})]}),u.jsxs(un,{value:"overview",className:"space-y-6",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Department F&I Gross"}),u.jsx(Ke,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:["$",f.total_fi_gross.toLocaleString()]}),u.jsxs("p",{className:"text-xs text-muted-foreground",children:[u.jsxs("span",{className:"text-green-600 flex items-center",children:[u.jsx(qe,{className:"w-3 h-3 mr-1"}),"+",f.mtd_growth,"%"]}),"from last month"]})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Deals Processed"}),u.jsx(as,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:f.deals_processed}),u.jsxs("p",{className:"text-xs text-muted-foreground",children:[Math.round(f.deals_processed/v.length)," avg per manager"]})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Products Per Deal (PPD)"}),u.jsx(ns,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:f.products_per_deal}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Target: 2.5 products per deal"})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Per Vehicle Retail (PVR)"}),u.jsx(rs,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:["$",f.per_vehicle_retail]}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Department average"})]})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Total VSC Penetration"}),u.jsx(Qs,{className:"h-4 w-4 text-yellow-500"})]}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:[f.total_vsc_penetration,"%"]}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Department average penetration"})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Finance Penetration Rate"}),u.jsx(is,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsxs("div",{className:"text-2xl font-bold",children:[f.penetration_rate,"%"]}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Financed vs cash deals"})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[u.jsx(Mt,{className:"text-sm font-medium",children:"Team Performance"}),u.jsx(vs,{className:"h-4 w-4 text-muted-foreground"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"text-2xl font-bold",children:S(f.team_performance)}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Overall department rating"})]})]})]}),u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(vs,{className:"w-5 h-5 mr-2"}),"Team Performance Overview"]}),u.jsxs(Rt,{children:["Current performance status:"," ",S(f.team_performance)]})]}),u.jsx($t,{children:u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:v.map(e=>u.jsxs("div",{className:"p-4 border rounded-lg",children:[u.jsxs("div",{className:"flex items-center justify-between mb-2",children:[u.jsx("h4",{className:"font-semibold",children:e.name}),u.jsxs("div",{className:"flex items-center space-x-2",children:[P(e.vsc_penetration),u.jsx(pr,{variant:"active"===e.status?"default":"secondary",children:e.status})]})]}),u.jsxs("div",{className:"space-y-1 text-sm",children:[u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"Deals:"}),u.jsx("span",{className:"font-medium",children:e.deals_processed})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"Revenue:"}),u.jsxs("span",{className:"font-medium",children:["$",e.mtd_revenue.toLocaleString()]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"PPD:"}),u.jsx("span",{className:"font-medium",children:e.ppd})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"PVR:"}),u.jsxs("span",{className:"font-medium",children:["$",e.pvr]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"VSC Penetration:"}),u.jsxs("span",{className:"font-medium",children:[e.vsc_penetration,"%"]})]}),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("span",{children:"Rating:"}),u.jsx("span",{className:"font-medium",children:S(e.performance_rating)})]})]})]},e.id))})})]})]}),u.jsx(un,{value:"leaderboard",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(ss,{className:"w-5 h-5 mr-2 text-yellow-500"}),"Finance Department Leaderboard"]}),u.jsxs(Rt,{children:["Performance rankings for ",w(h)]})]}),u.jsx($t,{children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{className:"w-12",children:"Rank"}),u.jsx(tn,{children:"Finance Manager"}),u.jsx(tn,{className:"text-right",children:"Deals"}),u.jsx(tn,{className:"text-right",children:"Revenue"}),u.jsx(tn,{className:"text-right",children:"PPD"}),u.jsx(tn,{className:"text-right",children:"PVR"}),u.jsx(tn,{className:"text-right",children:"VSC Penetration"}),u.jsx(tn,{className:"text-right",children:"Performance"})]})}),u.jsx(sn,{children:v.sort((e,s)=>s.mtd_revenue-e.mtd_revenue).map((e,s)=>u.jsxs(an,{children:[u.jsx(rn,{children:u.jsxs("div",{className:"flex items-center",children:[0===s&&u.jsx(ss,{className:"w-4 h-4 text-yellow-500 mr-1"}),1===s&&u.jsx(ss,{className:"w-4 h-4 text-gray-400 mr-1"}),2===s&&u.jsx(ss,{className:"w-4 h-4 text-amber-600 mr-1"}),u.jsxs("span",{className:"font-medium",children:["#",s+1]})]})}),u.jsx(rn,{children:u.jsxs("div",{children:[u.jsx("div",{className:"font-medium",children:e.name}),u.jsx("div",{className:"text-sm text-muted-foreground",children:e.email})]})}),u.jsx(rn,{className:"text-right font-medium",children:e.deals_processed}),u.jsxs(rn,{className:"text-right font-medium",children:["$",e.mtd_revenue.toLocaleString()]}),u.jsx(rn,{className:"text-right",children:e.ppd}),u.jsxs(rn,{className:"text-right",children:["$",e.pvr]}),u.jsx(rn,{className:"text-right",children:u.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[P(e.vsc_penetration),u.jsxs("span",{children:[e.vsc_penetration,"%"]})]})}),u.jsx(rn,{className:"text-right",children:S(e.performance_rating)})]},e.id))})]})})]})}),u.jsx(un,{value:"deals",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(as,{className:"w-5 h-5 mr-2"}),"All Department Deals"]}),u.jsxs(Rt,{children:["Complete view of all F&I deals for ",w(h)]})]}),u.jsx("div",{className:"flex items-center space-x-2",children:u.jsxs(ql,{value:p,onValueChange:g,children:[u.jsx(Yl,{className:"w-48",children:u.jsx(Jl,{placeholder:"Filter by manager"})}),u.jsxs(Zl,{children:[u.jsx(Ql,{value:"all",children:"All Managers"}),v.map(e=>u.jsx(Ql,{value:e.id,children:e.name},e.id))]})]})})]})}),u.jsx($t,{children:u.jsxs(Xl,{children:[u.jsx(en,{children:u.jsxs(an,{children:[u.jsx(tn,{children:"Deal ID"}),u.jsx(tn,{children:"Customer"}),u.jsx(tn,{children:"Vehicle"}),u.jsx(tn,{children:"Type"}),u.jsx(tn,{children:"Salesperson"}),u.jsx(tn,{children:"F&I Manager"}),u.jsx(tn,{className:"text-right",children:"F&I Gross"}),u.jsx(tn,{children:"Products"}),u.jsx(tn,{children:"Funding"}),u.jsx(tn,{children:"Date"}),u.jsx(tn,{children:"Status"}),u.jsx(tn,{className:"text-right",children:"Actions"})]})}),u.jsx(sn,{children:N.filter(e=>"all"===p||e.finance_manager.includes(p)).map(e=>u.jsxs(an,{children:[u.jsx(rn,{className:"font-medium",children:e.id}),u.jsx(rn,{children:e.customer_name}),u.jsx(rn,{children:e.vehicle}),u.jsx(rn,{children:D(e.deal_type)}),u.jsx(rn,{children:e.salesperson}),u.jsx(rn,{children:e.finance_manager}),u.jsxs(rn,{className:"text-right font-medium",children:["$",e.fi_gross.toLocaleString()]}),u.jsx(rn,{children:u.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.products.slice(0,2).map((e,s)=>u.jsx(pr,{variant:"outline",className:"text-xs",children:e},s)),e.products.length>2&&u.jsxs(pr,{variant:"outline",className:"text-xs",children:["+",e.products.length-2," more"]})]})}),u.jsx(rn,{children:u.jsx(pr,{variant:"outline",className:"text-xs capitalize",children:e.funding_source.replace("_"," ")})}),u.jsx(rn,{children:new Date(e.date).toLocaleDateString()}),u.jsx(rn,{children:_(e.status)}),u.jsx(rn,{className:"text-right",children:u.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[u.jsx(Bt,{variant:"outline",size:"sm",children:u.jsx(Ae,{className:"w-4 h-4"})}),u.jsx(Bt,{variant:"outline",size:"sm",children:u.jsx(Ns,{className:"w-4 h-4"})})]})})]},e.id))})]})})]})}),u.jsx(un,{value:"managers",className:"space-y-6",children:u.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:v.map(e=>u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsxs(Mt,{className:"flex items-center justify-between",children:[u.jsx("span",{children:e.name}),u.jsxs("div",{className:"flex items-center space-x-2",children:[P(e.vsc_penetration),u.jsx(pr,{variant:"active"===e.status?"default":"secondary",children:e.status})]})]}),u.jsx(Rt,{children:e.email})]}),u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[u.jsx("div",{className:"text-2xl font-bold text-blue-600",children:e.deals_processed}),u.jsx("div",{className:"text-xs text-blue-600",children:"Deals"})]}),u.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[u.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",e.mtd_revenue.toLocaleString()]}),u.jsx("div",{className:"text-xs text-green-600",children:"Revenue"})]})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[u.jsx("div",{className:"text-2xl font-bold text-purple-600",children:e.ppd}),u.jsx("div",{className:"text-xs text-purple-600",children:"PPD"})]}),u.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[u.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["$",e.pvr]}),u.jsx("div",{className:"text-xs text-orange-600",children:"PVR"})]})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-lg",children:[u.jsxs("div",{className:"text-2xl font-bold text-yellow-600",children:[e.vsc_penetration,"%"]}),u.jsx("div",{className:"text-xs text-yellow-600",children:"VSC Penetration"})]}),u.jsxs("div",{className:"text-center p-3 bg-indigo-50 rounded-lg",children:[u.jsx("div",{className:"text-sm font-bold text-indigo-600",children:S(e.performance_rating)}),u.jsx("div",{className:"text-xs text-indigo-600",children:"Rating"})]})]}),u.jsx("div",{className:"pt-4 border-t",children:u.jsxs(Bt,{variant:"outline",className:"w-full",size:"sm",children:[u.jsx(Ae,{className:"w-4 h-4 mr-2"}),"View Individual Deals"]})})]})})]},e.id))})}),u.jsx(un,{value:"schedules",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(Oe,{className:"w-5 h-5 mr-2"}),"F&I Manager Schedules"]}),u.jsx(Rt,{children:"View and edit finance manager schedules"})]}),u.jsx($t,{children:u.jsx("div",{className:"space-y-6",children:v.map(e=>u.jsxs("div",{className:"border rounded-lg p-4",children:[u.jsxs("div",{className:"flex items-center justify-between mb-4",children:[u.jsxs("div",{children:[u.jsx("h4",{className:"font-semibold",children:e.name}),u.jsxs("p",{className:"text-sm text-muted-foreground",children:["Current: ",e.schedule]})]}),u.jsxs(Bt,{variant:"outline",size:"sm",children:[u.jsx(Ns,{className:"w-4 h-4 mr-2"}),"Edit Schedule"]})]}),u.jsx("div",{className:"grid grid-cols-7 gap-2",children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map((s,a)=>u.jsxs("div",{className:"text-center p-2 border rounded",children:[u.jsx("div",{className:"text-xs font-medium",children:s}),u.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:a<5?e.schedule:5===a?"9am - 5pm":"Off"})]},s))})]},e.id))})})]})}),u.jsx(un,{value:"payplans",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsxs(Gt,{children:[u.jsxs(Mt,{className:"flex items-center",children:[u.jsx(Ds,{className:"w-5 h-5 mr-2"}),"Pay Plan Management"]}),u.jsx(Rt,{children:"Limited access: Add/remove monthly bonuses for finance managers"})]}),u.jsxs($t,{children:[u.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx(Je,{className:"w-5 h-5 text-yellow-600 mr-2"}),u.jsxs("div",{children:[u.jsx("h4",{className:"font-medium text-yellow-800",children:"Limited Access"}),u.jsx("p",{className:"text-sm text-yellow-700",children:"As Finance Director, you can add/remove monthly bonuses but cannot modify base pay plan structures."})]})]})}),u.jsx(Yn,{dealershipId:r||"default",isGroupAdmin:!1})]})]})})]})]})},Ao="ADD_TOAST",Eo="UPDATE_TOAST",Io="DISMISS_TOAST",Uo="REMOVE_TOAST";let Go=0;const Mo=new Map,Ro=[];let $o={toasts:[]};function Lo(e){$o=((e,s)=>{switch(s.type){case Ao:return c(o({},e),{toasts:[s.toast,...e.toasts].slice(0,20)});case Eo:return c(o({},e),{toasts:e.toasts.map(e=>e.id===s.toast.id?o(o({},e),s.toast):e)});case Io:{const{toastId:a}=s;if(a){const e=Mo.get(a);e&&clearTimeout(e),Mo.set(a,setTimeout(()=>{Mo.delete(a),Lo({type:Uo,toastId:a})},1e3))}return c(o({},e),{toasts:e.toasts.map(e=>e.id===a||void 0===a?c(o({},e),{open:!1}):e)})}case Uo:return void 0===s.toastId?c(o({},e),{toasts:[]}):c(o({},e),{toasts:e.toasts.filter(e=>e.id!==s.toastId)})}})($o,e),Ro.forEach(e=>{e($o)})}function Oo(e){var s=d(e,[]);const a=(Go=(Go+1)%Number.MAX_VALUE,Go.toString()),t=()=>Lo({type:Io,toastId:a});return Lo({type:Ao,toast:c(o({},s),{id:a,open:!0,onOpenChange:e=>{e||t()}})}),{id:a,dismiss:t,update:e=>Lo({type:Eo,toast:c(o({},e),{id:a})})}}const Bo=[{id:1,initials:"JD",firstName:"John",lastName:"Doe"},{id:2,initials:"SM",firstName:"Sarah",lastName:"Miller"},{id:3,initials:"MR",firstName:"Maria",lastName:"Rodriguez"},{id:4,initials:"AK",firstName:"Anna",lastName:"Kim"},{id:5,initials:"BH",firstName:"Brandon",lastName:"Harris"}],Vo=[{id:"pending",name:"Pending"},{id:"funded",name:"Funded"},{id:"unwound",name:"Unwound"},{id:"deaddeal",name:"Dead Deal"}];function zo(){var e;const s=pe(),{user:a}=It(),[t,r]=he.useState(!1),[l,n]=he.useState({dealNumber:"",stockNumber:"",vinLast8:"",vehicleType:"N",customerName:"",vehicleDescription:"",dealType:"Finance",saleDate:(new Date).toISOString().split("T")[0],frontEndGross:"",salespersonId:"",isSplitDeal:!1,secondSalespersonId:"",lender:"",reserveFlat:"",vscProfit:"",gapProfit:"",ppmProfit:"",tireWheelProfit:"",appearanceProfit:"",keyReplacementProfit:"",theftProfit:"",windshieldProfit:"",lojackProfit:"",extWarrantyProfit:"",otherProfit:"",backEndGross:"",totalGross:"",status:"pending",notes:""}),i=(null==(e=null==a?void 0:a.user_metadata)?void 0:e.schema_name)||"";he.useEffect(()=>{(()=>{const e=(parseFloat(l.vscProfit)||0)+(parseFloat(l.gapProfit)||0)+(parseFloat(l.ppmProfit)||0)+(parseFloat(l.tireWheelProfit)||0)+(parseFloat(l.appearanceProfit)||0)+(parseFloat(l.keyReplacementProfit)||0)+(parseFloat(l.theftProfit)||0)+(parseFloat(l.windshieldProfit)||0)+(parseFloat(l.lojackProfit)||0)+(parseFloat(l.extWarrantyProfit)||0)+(parseFloat(l.otherProfit)||0)+(parseFloat(l.reserveFlat)||0),s=(parseFloat(l.frontEndGross)||0)+e;n(a=>c(o({},a),{backEndGross:e.toFixed(2),totalGross:s.toFixed(2)}))})()},[l.vscProfit,l.gapProfit,l.ppmProfit,l.tireWheelProfit,l.appearanceProfit,l.keyReplacementProfit,l.theftProfit,l.windshieldProfit,l.lojackProfit,l.extWarrantyProfit,l.otherProfit,l.reserveFlat,l.frontEndGross]),he.useEffect(()=>{console.log("[LogFinanceManagerDeal] Component mounted"),i?console.log(`[LogFinanceManagerDeal] Using schema: ${i}`):(console.error("[LogFinanceManagerDeal] No schema name found in user metadata"),Oo({title:"Error",description:"Missing configuration for deal logging. Please contact support.",variant:"destructive"}))},[i]);const d=e=>{const{name:s,value:a,type:t}=e.target;n("checkbox"!==t?"stockNumber"!==s&&"vinLast8"!==s?"dealType"===s&&"Cash"===a?e=>c(o({},e),{[s]:a,lender:""}):e=>c(o({},e),{[s]:a}):e=>c(o({},e),{[s]:a.toUpperCase()}):a=>c(o({},a),{[s]:e.target.checked}))};return u.jsxs("div",{className:"container mx-auto py-6",children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h1",{className:"text-2xl font-bold",children:"Log New Deal"}),u.jsxs(Bt,{variant:"outline",onClick:()=>s("/dashboard/finance"),className:"flex items-center",children:[u.jsx(cs,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]})]}),u.jsxs("form",{onSubmit:e=>h(null,null,function*(){if(e.preventDefault(),i)if(l.customerName&&l.vehicleDescription){r(!0);try{console.log(`[LogFinanceManagerDeal] Submitting deal to schema: ${i}`);const e=l.dealNumber||`D${Math.floor(1e3+9e3*Math.random())}`,r=Bo.find(e=>e.id.toString()===l.salespersonId),n=r?r.initials:"";let o="";if(l.isSplitDeal&&l.secondSalespersonId){const e=Bo.find(e=>e.id.toString()===l.secondSalespersonId);o=e?e.initials:""}const c=l.isSplitDeal&&o?`${n}/${o} (Split)`:n,d=[];parseFloat(l.vscProfit)>0&&d.push("Vehicle Service Contract (VSC)"),parseFloat(l.gapProfit)>0&&d.push("GAP Insurance"),parseFloat(l.ppmProfit)>0&&d.push("PrePaid Maintenance (PPM)"),parseFloat(l.tireWheelProfit)>0&&d.push("Tire & Wheel Protection"),parseFloat(l.appearanceProfit)>0&&d.push("Appearance Protection"),parseFloat(l.keyReplacementProfit)>0&&d.push("Key Replacement"),parseFloat(l.theftProfit)>0&&d.push("Theft Protection"),parseFloat(l.windshieldProfit)>0&&d.push("Windshield Protection"),parseFloat(l.lojackProfit)>0&&d.push("LoJack/Tracking System"),parseFloat(l.extWarrantyProfit)>0&&d.push("Extended Warranty"),parseFloat(l.otherProfit)>0&&d.push("Other");const m={id:e,customer_name:l.customerName,customer:l.customerName,vehicle:`${"N"===l.vehicleType?"New":"U"===l.vehicleType?"Used":"CPO"} - ${l.vehicleDescription}`,vin:l.vinLast8,stock_number:l.stockNumber,sale_date:l.saleDate,saleDate:l.saleDate,deal_type:l.dealType,salesperson:c,salesperson_id:l.salespersonId,is_split_deal:l.isSplitDeal,second_salesperson_id:l.isSplitDeal?l.secondSalespersonId:null,lender:l.lender,front_end_gross:parseFloat(l.frontEndGross)||0,back_end_gross:parseFloat(l.backEndGross)||0,total_gross:parseFloat(l.totalGross)||0,amount:parseFloat(l.totalGross)||0,profit:parseFloat(l.backEndGross)||0,reserve_flat:parseFloat(l.reserveFlat)||0,vsc_profit:parseFloat(l.vscProfit)||0,gap_profit:parseFloat(l.gapProfit)||0,ppm_profit:parseFloat(l.ppmProfit)||0,tire_wheel_profit:parseFloat(l.tireWheelProfit)||0,appearance_profit:parseFloat(l.appearanceProfit)||0,key_replacement_profit:parseFloat(l.keyReplacementProfit)||0,theft_profit:parseFloat(l.theftProfit)||0,windshield_profit:parseFloat(l.windshieldProfit)||0,lojack_profit:parseFloat(l.lojackProfit)||0,ext_warranty_profit:parseFloat(l.extWarrantyProfit)||0,other_profit:parseFloat(l.otherProfit)||0,products:d,status:l.status,notes:l.notes,vsc_sold:parseFloat(l.vscProfit)>0,created_by:(null==a?void 0:a.email)||"unknown",created_at:(new Date).toISOString(),dashboard_type:"finance_manager",schema_name:i};try{const e=localStorage.getItem("financeDeals"),s=[m,...e?JSON.parse(e):[]];localStorage.setItem("financeDeals",JSON.stringify(s))}catch(t){console.error("Error saving to localStorage:",t)}const u=yield((e,s)=>h(null,null,function*(){try{console.log(`[apiService] Logging finance manager deal to schema: ${e}`);const a=yield na();if(!a)throw new Error("Not authenticated");const t={user_id:a.id,deal_number:s.deal_number||`D${Math.floor(1e3+9e3*Math.random())}`,stock_number:s.stock_number||"",vin:s.vin||"",customer_name:s.customer_name,vehicle:s.vehicle,sale_date:s.sale_date||(new Date).toISOString().split("T")[0],amount:s.amount||0,products:s.products?JSON.stringify(s.products):"[]",profit:s.profit||0,status:s.status||"pending",deal_details:s.deal_details?JSON.stringify(s.deal_details):"{}",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},r=`\n      INSERT INTO "${e}".deals (\n        user_id, deal_number, stock_number, vin, customer_name, \n        vehicle, sale_date, amount, products, profit, \n        status, deal_details, created_at, updated_at\n      ) \n      VALUES (\n        '${t.user_id}', \n        '${t.deal_number}', \n        '${t.stock_number}', \n        '${t.vin}', \n        '${t.customer_name}', \n        '${t.vehicle}', \n        '${t.sale_date}', \n        ${t.amount}, \n        '${t.products}', \n        ${t.profit}, \n        '${t.status}', \n        '${t.deal_details}',\n        '${t.created_at}',\n        '${t.updated_at}'\n      )\n      RETURNING *;\n    `,{data:l,error:n}=yield ta.rpc("run_sql",{sql_query:r});if(n)throw console.error(`[apiService] Error inserting deal into ${e}:`,n),n;return console.log(`[apiService] Deal logged successfully to ${e}:`,l),{success:!0,deal:l&&l.length>0?l[0]:null,message:"Deal logged successfully"}}catch(t){return console.error("[apiService] Error in logFinanceManagerDeal:",t),{success:!1,message:`Failed to log deal: ${t.message||t}`,error:t}}}))(i,m);u.success?(Oo({title:"Success",description:"Deal logged successfully!"}),s("/dashboard/finance")):(console.error("[LogFinanceManagerDeal] Error logging deal:",u.error),Oo({title:"Error",description:u.message||"Failed to log deal. Please try again.",variant:"destructive"}))}catch(t){console.error("[LogFinanceManagerDeal] Exception logging deal:",t),Oo({title:"Error",description:"An unexpected error occurred. Please try again.",variant:"destructive"})}finally{r(!1)}}else Oo({title:"Validation Error",description:"Customer name and vehicle description are required fields.",variant:"destructive"});else Oo({title:"Error",description:"Missing schema information. Please contact support.",variant:"destructive"})}),className:"space-y-6",children:[u.jsx(Ut,{className:"p-6",children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("h2",{className:"text-xl font-semibold flex items-center border-b pb-2 mb-4",children:[u.jsx(as,{className:"mr-2 h-5 w-5 text-blue-500"}),"Deal Information"]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"dealNumber",children:"Deal Number"}),u.jsx(Vt,{id:"dealNumber",name:"dealNumber",value:l.dealNumber,onChange:d,placeholder:"Auto-generated if empty"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"stockNumber",children:"Stock Number *"}),u.jsx(Vt,{id:"stockNumber",name:"stockNumber",value:l.stockNumber,onChange:d,placeholder:"Stock Number",required:!0})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"vinLast8",children:"VIN (Last 8) *"}),u.jsx(Vt,{id:"vinLast8",name:"vinLast8",value:l.vinLast8,onChange:d,placeholder:"Last 8 of VIN",maxLength:8,required:!0})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"vehicleType",children:"Vehicle Type"}),u.jsxs("select",{id:"vehicleType",name:"vehicleType",value:l.vehicleType,onChange:d,className:"w-full p-2 border rounded-md",children:[u.jsx("option",{value:"N",children:"New"}),u.jsx("option",{value:"U",children:"Used"}),u.jsx("option",{value:"C",children:"CPO"})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"dealType",children:"Deal Type"}),u.jsxs("select",{id:"dealType",name:"dealType",value:l.dealType,onChange:d,className:"w-full p-2 border rounded-md",children:[u.jsx("option",{value:"Cash",children:"Cash"}),u.jsx("option",{value:"Finance",children:"Finance"}),u.jsx("option",{value:"Lease",children:"Lease"})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"saleDate",children:"Sale Date"}),u.jsx(Vt,{type:"date",id:"saleDate",name:"saleDate",value:l.saleDate,onChange:d})]})]})]})}),u.jsx(Ut,{className:"p-6",children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("h2",{className:"text-xl font-semibold flex items-center border-b pb-2 mb-4",children:[u.jsx(Re,{className:"mr-2 h-5 w-5 text-green-500"}),"Customer & Vehicle"]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"customerName",children:"Customer Name *"}),u.jsx(Vt,{id:"customerName",name:"customerName",value:l.customerName,onChange:d,placeholder:"Customer last name",required:!0})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"vehicleDescription",children:"Vehicle Description *"}),u.jsx(Vt,{id:"vehicleDescription",name:"vehicleDescription",value:l.vehicleDescription,onChange:d,placeholder:"e.g., 2023 Toyota Camry XLE",required:!0})]})]})]})}),u.jsx(Ut,{className:"p-6",children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("h2",{className:"text-xl font-semibold flex items-center border-b pb-2 mb-4",children:[u.jsx(Re,{className:"mr-2 h-5 w-5 text-purple-500"}),"Sales Information"]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"salespersonId",children:"Salesperson"}),u.jsxs("select",{id:"salespersonId",name:"salespersonId",value:l.salespersonId,onChange:d,className:"w-full p-2 border rounded-md",children:[u.jsx("option",{value:"",children:"Select Salesperson"}),Bo.map(e=>u.jsxs("option",{value:e.id.toString(),children:[e.initials," - ",e.firstName," ",e.lastName]},e.id))]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"frontEndGross",children:"Front End Gross"}),u.jsx(Vt,{id:"frontEndGross",name:"frontEndGross",value:l.frontEndGross,onChange:d,placeholder:"0.00",type:"number",step:"0.01"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"lender",children:"Lender"}),u.jsx(Vt,{id:"lender",name:"lender",value:l.lender,onChange:d,placeholder:"Lender name",disabled:"Cash"===l.dealType})]})]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(Pn,{id:"isSplitDeal",name:"isSplitDeal",checked:l.isSplitDeal,onCheckedChange:e=>n(s=>c(o({},s),{isSplitDeal:e}))}),u.jsx(Jt,{htmlFor:"isSplitDeal",children:"Split Deal"})]}),l.isSplitDeal&&u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"secondSalespersonId",children:"Second Salesperson"}),u.jsxs("select",{id:"secondSalespersonId",name:"secondSalespersonId",value:l.secondSalespersonId,onChange:d,className:"w-full p-2 border rounded-md",children:[u.jsx("option",{value:"",children:"Select Second Salesperson"}),Bo.map(e=>u.jsxs("option",{value:e.id.toString(),children:[e.initials," - ",e.firstName," ",e.lastName]},e.id))]})]})]})}),u.jsx(Ut,{className:"p-6",children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("h2",{className:"text-xl font-semibold flex items-center border-b pb-2 mb-4",children:[u.jsx(Ke,{className:"mr-2 h-5 w-5 text-green-500"}),"F&I Products & Profits"]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"reserveFlat",children:"Reserve/Flat"}),u.jsx(Vt,{id:"reserveFlat",name:"reserveFlat",value:l.reserveFlat,onChange:d,placeholder:"0.00",type:"number",step:"0.01"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"vscProfit",children:"VSC Profit"}),u.jsx(Vt,{id:"vscProfit",name:"vscProfit",value:l.vscProfit,onChange:d,placeholder:"0.00",type:"number",step:"0.01"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"gapProfit",children:"GAP Profit"}),u.jsx(Vt,{id:"gapProfit",name:"gapProfit",value:l.gapProfit,onChange:d,placeholder:"0.00",type:"number",step:"0.01"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"ppmProfit",children:"PPM Profit"}),u.jsx(Vt,{id:"ppmProfit",name:"ppmProfit",value:l.ppmProfit,onChange:d,placeholder:"0.00",type:"number",step:"0.01"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"tireWheelProfit",children:"Tire & Wheel Profit"}),u.jsx(Vt,{id:"tireWheelProfit",name:"tireWheelProfit",value:l.tireWheelProfit,onChange:d,placeholder:"0.00",type:"number",step:"0.01"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"appearanceProfit",children:"Appearance Profit"}),u.jsx(Vt,{id:"appearanceProfit",name:"appearanceProfit",value:l.appearanceProfit,onChange:d,placeholder:"0.00",type:"number",step:"0.01"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"extWarrantyProfit",children:"Extended Warranty Profit"}),u.jsx(Vt,{id:"extWarrantyProfit",name:"extWarrantyProfit",value:l.extWarrantyProfit,onChange:d,placeholder:"0.00",type:"number",step:"0.01"})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"otherProfit",children:"Other Profit"}),u.jsx(Vt,{id:"otherProfit",name:"otherProfit",value:l.otherProfit,onChange:d,placeholder:"0.00",type:"number",step:"0.01"})]})]})]})}),u.jsx(Ut,{className:"p-6",children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("h2",{className:"text-xl font-semibold flex items-center border-b pb-2 mb-4",children:[u.jsx(rs,{className:"mr-2 h-5 w-5 text-amber-500"}),"Totals & Status"]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Back End Gross"}),u.jsxs("div",{className:"p-2 bg-gray-100 border rounded-md",children:["$",parseFloat(l.backEndGross||"0").toLocaleString()]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{children:"Total Gross"}),u.jsxs("div",{className:"p-2 bg-gray-100 border rounded-md font-bold",children:["$",parseFloat(l.totalGross||"0").toLocaleString()]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"status",children:"Deal Status"}),u.jsx("select",{id:"status",name:"status",value:l.status,onChange:d,className:"w-full p-2 border rounded-md",children:Vo.map(e=>u.jsx("option",{value:e.id,children:e.name},e.id))})]})]}),u.jsxs("div",{className:"space-y-2",children:[u.jsx(Jt,{htmlFor:"notes",children:"Notes"}),u.jsx(qn,{id:"notes",name:"notes",value:l.notes,onChange:d,placeholder:"Any additional notes about this deal...",className:"min-h-[100px]"})]})]})}),u.jsxs("div",{className:"flex justify-end space-x-4",children:[u.jsx(Bt,{type:"button",variant:"outline",onClick:()=>s("/dashboard/single-finance"),children:"Cancel"}),u.jsx(Bt,{type:"submit",disabled:t,className:"px-8",children:t?"Saving Deal...":"Save Deal"})]})]})]})}const Wo="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1Z2p0b2t5ZHZiY3ZtcnBleml2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU3MTk3NjUsImV4cCI6MjA2MTI5NTc2NX0.XCNQoJbGQiXuyR_CFevro1Y8lqvh2_jmjrD181UYtY4",qo={Authorization:`Bearer ${Wo}`,apikey:Wo,"Content-Type":"application/json",Prefer:"return=representation"},Jo=new class{constructor(){m(this,"baseUrl"),m(this,"headers"),this.baseUrl="https://iugjtokydvbcvmrpeziv.supabase.co/rest/v1",this.headers=o({},qo)}select(e){return h(this,arguments,function*(e,s={}){try{const a=new URLSearchParams;if(s.columns&&a.append("select",s.columns),s.limit&&a.append("limit",s.limit.toString()),s.offset&&a.append("offset",s.offset.toString()),s.orderBy){const e=!1===s.orderBy.ascending?"desc":"asc";a.append("order",`${s.orderBy.column}.${e}`)}s.filter&&Object.entries(s.filter).forEach(([e,s])=>{a.append(e,`eq.${s}`)});const t=`${this.baseUrl}/${e}?${a}`;console.log("[DirectSupabase] SELECT request:",t);const r=yield fetch(t,{method:"GET",headers:this.headers});if(!r.ok){const e=yield r.text();return{data:null,error:{message:`HTTP ${r.status}: ${e}`,status:r.status}}}const l=yield r.json();return console.log("[DirectSupabase] SELECT success:",l),{data:l,error:null}}catch(a){return console.error("[DirectSupabase] SELECT error:",a),{data:null,error:a}}})}insert(e,s){return h(this,null,function*(){try{const a=`${this.baseUrl}/${e}`;console.log("[DirectSupabase] INSERT request:",a,s);const t=yield fetch(a,{method:"POST",headers:this.headers,body:JSON.stringify(s)});if(!t.ok){const e=yield t.text();return{data:null,error:{message:`HTTP ${t.status}: ${e}`,status:t.status}}}const r=yield t.json();return console.log("[DirectSupabase] INSERT success:",r),{data:Array.isArray(r)?r[0]:r,error:null}}catch(a){return console.error("[DirectSupabase] INSERT error:",a),{data:null,error:a}}})}delete(e,s){return h(this,null,function*(){try{const a=new URLSearchParams;Object.entries(s).forEach(([e,s])=>{a.append(e,`eq.${s}`)});const t=`${this.baseUrl}/${e}?${a}`;console.log("[DirectSupabase] DELETE request:",t);const r=yield fetch(t,{method:"DELETE",headers:this.headers});if(!r.ok){const e=yield r.text();return{data:null,error:{message:`HTTP ${r.status}: ${e}`,status:r.status}}}return yield r.text(),console.log("[DirectSupabase] DELETE success"),{data:null,error:null}}catch(a){return console.error("[DirectSupabase] DELETE error:",a),{data:null,error:a}}})}update(e,s,a){return h(this,null,function*(){try{const t=new URLSearchParams;Object.entries(a).forEach(([e,s])=>{t.append(e,`eq.${s}`)});const r=`${this.baseUrl}/${e}?${t}`;console.log("[DirectSupabase] UPDATE request:",r,s);const l=yield fetch(r,{method:"PATCH",headers:this.headers,body:JSON.stringify(s)});if(!l.ok){const e=yield l.text();return{data:null,error:{message:`HTTP ${l.status}: ${e}`,status:l.status}}}const n=yield l.json();return console.log("[DirectSupabase] UPDATE success:",n),{data:Array.isArray(n)?n[0]:n,error:null}}catch(t){return console.error("[DirectSupabase] UPDATE error:",t),{data:null,error:t}}})}testConnection(){return h(this,null,function*(){return this.select("dealerships",{columns:"id,name",limit:1})})}},Yo=()=>{const[e,s]=he.useState(null),[a,t]=he.useState(!1),[r,l]=he.useState(null),[n,i]=he.useState(!1),o="https://iugjtokydvbcvmrpeziv.supabase.co",c="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1Z2p0b2t5ZHZiY3ZtcnBleml2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU3MTk3NjUsImV4cCI6MjA2MTI5NTc2NX0.XCNQoJbGQiXuyR_CFevro1Y8lqvh2_jmjrD181UYtY4",d="production";return u.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded space-y-4",children:[u.jsx("h3",{className:"font-semibold mb-2",children:"Environment Variables Test"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{children:[u.jsx("strong",{children:"URL:"})," ",o]}),u.jsxs("div",{children:[u.jsx("strong",{children:"API Key:"})," ",c]}),u.jsxs("div",{children:[u.jsx("strong",{children:"Mode:"})," ",d]}),u.jsxs("div",{children:[u.jsx("strong",{children:"Dev:"})," ","false"]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("button",{onClick:()=>h(null,null,function*(){t(!0),s(null);try{const e=`${o}/rest/v1/dealerships?select=id,name&limit=1`;console.log("[FETCH TEST] Testing direct fetch to:",e);const a=yield fetch(e,{method:"GET",headers:{Authorization:`Bearer ${c}`,apikey:c,"Content-Type":"application/json"}});if(console.log("[FETCH TEST] Response status:",a.status),console.log("[FETCH TEST] Response headers:",Object.fromEntries(a.headers.entries())),!a.ok){const e=yield a.text();return void s({success:!1,status:a.status,statusText:a.statusText,error:e})}const t=yield a.json();console.log("[FETCH TEST] Response data:",t),s({success:!0,status:a.status,data:t})}catch(e){console.error("[FETCH TEST] Fetch error:",e),s({success:!1,error:e.message})}finally{t(!1)}}),disabled:a,className:"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600 disabled:opacity-50",children:a?"Testing...":"Test Direct Fetch"}),e&&u.jsxs("div",{className:"mt-2 p-2 bg-white border rounded",children:[u.jsx("strong",{children:"Direct Fetch Result:"}),u.jsx("pre",{className:"text-xs mt-1",children:JSON.stringify(e,null,2)})]})]}),u.jsxs("div",{children:[u.jsx("button",{onClick:()=>h(null,null,function*(){i(!0),l(null);try{console.log("[SUPABASE TEST] Creating new Supabase client...");const e=Pe(o,c,{auth:{persistSession:!1,autoRefreshToken:!1}});console.log("[SUPABASE TEST] Client created, testing query...");const s=new Promise((e,s)=>{setTimeout(()=>s(new Error("Supabase query timeout after 5 seconds")),5e3)}),a=e.from("dealerships").select("id, name").limit(1);console.log("[SUPABASE TEST] Starting query with timeout...");const t=yield Promise.race([a,s]);console.log("[SUPABASE TEST] Query completed:",t),t.error?l({success:!1,error:t.error}):l({success:!0,data:t.data})}catch(e){console.error("[SUPABASE TEST] Error:",e),l({success:!1,error:e.message})}finally{i(!1)}}),disabled:n,className:"px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600 disabled:opacity-50",children:n?"Testing...":"Test Supabase Client"}),r&&u.jsxs("div",{className:"mt-2 p-2 bg-white border rounded",children:[u.jsx("strong",{children:"Supabase Client Result:"}),u.jsx("pre",{className:"text-xs mt-1",children:JSON.stringify(r,null,2)})]})]})]})]})},Ho=()=>{const{user:e}=It(),s=pe(),[a,t]=he.useState([]),[r,l]=he.useState([]),[n,i]=he.useState([]),[d,m]=he.useState(!0),[x,p]=he.useState(""),[g,f]=he.useState(""),[j,v]=he.useState(null),[b,N]=he.useState(null),[y,w]=he.useState(!1),[S,_]=he.useState({}),[D,P]=he.useState(""),[C,k]=he.useState(null),[T,F]=he.useState(!1),[A,E]=he.useState(!1),[I,U]=he.useState([]),[G,M]=he.useState(!1),[R,$]=he.useState("overview"),[L,O]=he.useState(!1),[B,V]=he.useState(null),[z,W]=he.useState(null),[q,J]=he.useState(""),[Y,H]=he.useState(!1),[K,Z]=he.useState(!1),[Q,X]=he.useState(null),[ee,se]=he.useState([]),ae=()=>h(null,null,function*(){console.log("[refreshOverview] Refreshing overview data...");try{yield Promise.all([be(),Ne(),ye()]),console.log("[refreshOverview] Overview data refreshed successfully")}catch(e){console.error("[refreshOverview] Failed to refresh overview data:",e)}}),te=e=>{$(e),p(""),f(""),console.log(`[handleTabChange] Switched to tab: ${e}`),"overview"===e&&(console.log("[handleTabChange] Refreshing data for overview tab"),ae())},[re,le]=he.useState(!1),[ne,ie]=he.useState(0),[oe,ce]=he.useState(""),[de,me]=he.useState({name:"",email:"",role:"",tempPassword:"",phone:"",dealershipName:"",location:"",manufacturer:"",groupName:"",numDealerships:2,dealerships:[]}),ue=[{value:"single_finance_manager",label:"Single Finance Manager",dashboard:"/dashboard/single-finance"},{value:"single_dealer_admin",label:"Single Dealership Admin",dashboard:"/dashboard/admin"},{value:"group_dealer_admin",label:"Dealer Group Admin",dashboard:"/group-admin"},{value:"admin",label:"Admin",dashboard:"/dashboard/admin"},{value:"dealership_admin",label:"Dealership Admin",dashboard:"/dashboard/admin"},{value:"finance_manager",label:"Finance Manager",dashboard:"/dashboard/finance"},{value:"general_manager",label:"General Manager",dashboard:"/dashboard/gm"},{value:"sales_manager",label:"Sales Manager",dashboard:"/dashboard/sales-manager"},{value:"salesperson",label:"Salesperson",dashboard:"/dashboard/sales"}],xe=e=>({single_finance_manager:"single_finance_manager",single_dealer_admin:"single_dealer_admin",group_dealer_admin:"group_dealer_admin",admin:"admin",dealership_admin:"single_dealer_admin",finance_manager:"single_finance_manager",general_manager:"single_dealer_admin",sales_manager:"single_dealer_admin",salesperson:"salesperson"}[e]||e),ge=e=>({single_finance_manager:"single_finance_manager",single_dealer_admin:"single_dealer_admin",group_dealer_admin:"group_dealer_admin",admin:"admin",dealership_admin:"dealership_admin",finance_manager:"finance_manager",general_manager:"general_manager",sales_manager:"sales_manager",salesperson:"salesperson"}[e]||e),fe=["Acura","Audi","BMW","Buick","Cadillac","Chevrolet","Chrysler","Dodge","Fiat","Ford","General Motors","Honda","Hyundai","Independent","Infiniti","Jaguar","Jeep","Kia","Land Rover","Lexus","Lincoln","Mazda","Mercedes-Benz","Mitsubishi","Nissan","Ram","Subaru","Toyota","Volkswagen","Volvo"],je=[{value:"base",label:"Base",description:"Standard features",singleDealershipPrice:250,dealerGroupPricePerDealer:200,features:["Up to 10 Sales People","3 F&I Managers","3 Sales Managers","1 GM","Role Specific Dashboards"]},{value:"plus",label:"+ Version",description:"Enhanced features",singleDealershipPrice:350,dealerGroupPricePerDealer:300,additionalCost:100,features:["Up to 20 Sales People","5 F&I Managers","Finance Director role","5 Sales Managers","Dynamic Scheduling","More Sales Reports"]},{value:"premium",label:"++ Version",description:"Premium features",singleDealershipPrice:750,dealerGroupPricePerDealer:700,additionalCost:500,features:["Up to 50 Sales People","10 Finance People","3 Finance Assistants","8 Sales Managers","Premium Analytics"]}],ve=e=>{var s;const a=e.subscription_tier||"base",t=e.num_teams||1;if("group"===e.type){const r=null==(s=e.metadata)?void 0:s.individual_dealers;if(r&&Array.isArray(r)&&r.length>0){let e=0;return r.forEach(s=>{const a=s.subscription_tier||"base";let t=250;"plus"===a?t=350:"premium"===a&&(t=750),e+=t}),e}{let e=250*t;return"plus"===a?e=350*t:"premium"===a&&(e=750*t),e}}{let e=250;return"plus"===a?e=350:"premium"===a&&(e=750),e}};he.useEffect(()=>{const a=yt(),t=wt();console.log("[MasterAdminPage] Authorization check:",{supabaseUser:null==e?void 0:e.email,directAuthUser:null==a?void 0:a.email,isDirectlyAuthenticated:t});const r=e&&("testadmin@example.com"===e.email||"admin@thedasboard.com"===e.email),l=t&&a&&("testadmin@example.com"===a.email||"admin@thedasboard.com"===a.email||!0===a.isAdmin||"admin"===a.role);if(!r&&!l)return console.warn("[MasterAdminPage] Access denied - redirecting to login"),void s("/",{replace:!0});console.log("[MasterAdminPage] Access granted - loading page"),be(),Ne(),ye()},[e,s]),he.useEffect(()=>{if("group_dealer_admin"===de.role){const e=[...de.dealerships];for(;e.length<de.numDealerships;)e.push({name:"",manufacturer:""});for(;e.length>de.numDealerships;)e.pop();me(s=>c(o({},s),{dealerships:e}))}},[de.numDealerships,de.role]);const be=()=>h(null,null,function*(){var e,s,a;try{console.log("[fetchUsers] Starting to fetch users..."),console.log("[fetchUsers] directSupabase client:",Jo),console.log("[fetchUsers] Testing database connectivity..."),console.log("[fetchUsers] Attempting to fetch profiles...");const l=yield Jo.select("profiles",{columns:"id, email, name, role, created_at, dealership_id, phone"});if(console.log("[fetchUsers] Raw users result:",{data:l.data,error:l.error,dataLength:(null==(e=l.data)?void 0:e.length)||0,dataType:typeof l.data,isArray:Array.isArray(l.data)}),l.error)return console.error("[fetchUsers] Users fetch error:",l.error),console.error("[fetchUsers] Error details:",{message:l.error.message,details:l.error.details,hint:l.error.hint,code:l.error.code}),t([]),[];const n=l.data||[];console.log("[fetchUsers] Users data received:",n.length,"users"),console.log("[fetchUsers] Raw users data sample:",n.slice(0,2)),console.log("[fetchUsers] ===== ROLE MAPPING DEBUG ====="),n.forEach((e,s)=>{const a=xe(e.role);console.log(`[fetchUsers] User ${s+1}: ${e.name} - Role: ${e.role} -> Mapped: ${a}`)}),console.log("[fetchUsers] ===== END ROLE MAPPING DEBUG =====");const i=n.filter(e=>"single_finance_manager"===xe(e.role));if(console.log("[fetchUsers] Finance managers found:",i.length),i.forEach((e,s)=>{console.log(`[fetchUsers] Finance Manager ${s+1}: ${e.name} (${e.email}) - Role: ${e.role}`)}),0===n.length){console.warn("[fetchUsers] No users found in database - this should not happen if there are 17 users"),console.log("[fetchUsers] Trying alternative query method...");try{const e=yield Jo.select("profiles",{});console.log("[fetchUsers] Alternative query result:",{data:e.data,error:e.error,dataLength:(null==(s=e.data)?void 0:s.length)||0})}catch(r){console.error("[fetchUsers] Alternative query also failed:",r)}return t([]),[]}const d=yield Jo.select("dealerships",{columns:"id, name"});console.log("[fetchUsers] Dealerships for relationships:",null==(a=d.data)?void 0:a.length);const m=n.map(e=>c(o({},e),{dealership:e.dealership_id&&d.data&&d.data.find(s=>s.id===e.dealership_id)||null}));console.log("[fetchUsers] Transformed data:",m.length,"users"),console.log("[fetchUsers] First user sample:",m[0]);const h=m.filter(e=>"single_finance_manager"===xe(e.role));return console.log("[fetchUsers] Final finance managers count:",h.length),t(m),m}catch(l){return console.error("[fetchUsers] Unexpected error:",l),console.error("[fetchUsers] Error stack:",null==l?void 0:l.stack),t([]),[]}}),Ne=()=>h(null,null,function*(){try{console.log("[fetchDealerships] Starting to fetch dealerships...");const e=yield Jo.select("dealerships",{columns:"*",orderBy:{column:"name",ascending:!0}});if(e.error)throw e.error;console.log("[fetchDealerships] Raw dealerships data:",e.data);const s=e.data||[];console.log("[fetchDealerships] Dealerships loaded:",{total:s.length}),l(s)}catch(e){console.error("Error fetching dealerships:",e),p("Failed to fetch dealerships")}}),ye=()=>h(null,null,function*(){try{console.log("[fetchSignupRequests] Starting to fetch signup requests...");const e=yield Jo.select("signup_requests",{columns:"*",orderBy:{column:"created_at",ascending:!1}});if(e.error)throw e.error;console.log("[fetchSignupRequests] Signup requests data:",e.data),i(e.data||[])}catch(e){console.error("Error fetching signup requests:",e),console.log("Signup requests table not available yet")}}),we=(e,s,a)=>{const t=[...de.dealerships];t[e]=c(o({},t[e]),{[s]:a}),me(e=>c(o({},e),{dealerships:t}))},Se=(e,s,a)=>{localStorage.setItem("adminAccessMode","true"),localStorage.setItem("adminAccessUserId",e),localStorage.setItem("adminAccessUserEmail",s),localStorage.setItem("adminReturnUrl","/master-admin");const t=_e(a);window.open(t,"_blank")},_e=e=>{const s=ue.find(s=>s.value===e);return(null==s?void 0:s.dashboard)||"/dashboard"},De=e=>h(null,null,function*(){var s;console.log("[viewDealershipDetails] ===== START DETAILED DEBUG ====="),console.log("[viewDealershipDetails] Dealership data:",e),console.log("[viewDealershipDetails] Dealership type:",e.type),console.log("[viewDealershipDetails] Admin user ID:",e.admin_user_id);const a=ve(e);console.log("[viewDealershipDetails] Calculated monthly cost:",a);let t={};if(e.admin_user_id){console.log("[viewDealershipDetails] Querying admin details for ID:",e.admin_user_id);try{const s=yield Jo.select("profiles",{columns:"id, name, email, phone, role",filter:{id:e.admin_user_id}});if(console.log("[viewDealershipDetails] Admin query result:",s),s.data&&s.data.length>0){const e=s.data[0];console.log("[viewDealershipDetails] Found admin user:",e),t={admin_name:e.name||"Name not provided",admin_email:e.email||"Email not provided",admin_phone:e.phone||"Phone not provided",admin_role:e.role||"Role not specified"},console.log("[viewDealershipDetails]  Admin details populated:",t)}else console.log("[viewDealershipDetails]  No admin user found in database"),t={admin_name:"No admin found",admin_email:"No admin found",admin_phone:"No admin found",admin_role:"No admin found"}}catch(i){console.error("[viewDealershipDetails]  Error querying admin details:",i),t={admin_name:"Error loading admin",admin_email:"Error loading admin",admin_phone:"Error loading admin",admin_role:"Error loading admin"}}}else console.log("[viewDealershipDetails]  No admin_user_id provided"),t={admin_name:"No admin assigned",admin_email:"No admin assigned",admin_phone:"No admin assigned",admin_role:"No admin assigned"};console.log("[viewDealershipDetails] Final admin details object:",t);let r={};if("group"===e.type){console.log("[viewDealershipDetails] Processing dealer group with num_teams:",e.num_teams);const t=null==(s=e.metadata)?void 0:s.individual_dealers;console.log("[viewDealershipDetails] Stored individual dealers:",t);const l=[];for(let s=0;s<(e.num_teams||1);s++){const a=`dealer_${s}`,n=null==t?void 0:t[s];r[`${a}_name`]=(null==n?void 0:n.name)||`${e.name} - Location ${s+1}`,r[`${a}_manufacturer`]=(null==n?void 0:n.manufacturer)||e.manufacturer||"",r[`${a}_tier`]=(null==n?void 0:n.subscription_tier)||e.subscription_tier||"base",r[`${a}_brands`]=(null==n?void 0:n.brands)?n.brands.join(", "):Array.isArray(e.brands)?e.brands.join(", "):"";const i=(null==n?void 0:n.subscription_tier)||e.subscription_tier||"base";let o=250;"plus"===i?o=350:"premium"===i&&(o=750),l.push({name:r[`${a}_name`],tier:i,cost:o})}r=o({group_name:e.name,num_dealers:e.num_teams||1,total_monthly_revenue:a,individual_dealer_revenues:l},r)}const l=o(o({id:e.id,name:e.name,type:e.type,store_hours:e.store_hours||"",num_teams:e.num_teams||1,admin_user_id:e.admin_user_id||"none",subscription_tier:e.subscription_tier||"base",monthly_cost:a,schema_name:e.schema_name||""},t),r);console.log("[viewDealershipDetails] Final edit data being set:",l),console.log("[viewDealershipDetails] ===== FINAL EDIT DATA ADMIN FIELDS ====="),console.log("[viewDealershipDetails] finalEditData.admin_name:",l.admin_name),console.log("[viewDealershipDetails] finalEditData.admin_email:",l.admin_email),console.log("[viewDealershipDetails] finalEditData.admin_phone:",l.admin_phone),console.log("[viewDealershipDetails] Type of admin_name:",typeof l.admin_name),console.log("[viewDealershipDetails] Type of admin_email:",typeof l.admin_email),console.log("[viewDealershipDetails] Type of admin_phone:",typeof l.admin_phone),console.log("[viewDealershipDetails] ===== END FINAL EDIT DATA DEBUG ====="),console.log("[viewDealershipDetails] Specifically checking admin fields in editData:",{admin_name:l.admin_name,admin_email:l.admin_email,admin_phone:l.admin_phone}),v(e),_(l),w(!1),M(!0),console.log("[viewDealershipDetails] Loading available admins...");const n=setTimeout(()=>{console.warn("[viewDealershipDetails] Admin loading timed out, opening dialog anyway"),U([]),M(!1),E(!0)},3e3);try{console.log("[viewDealershipDetails] Attempting direct admin query...");const{data:e,error:s}=yield ta.from("profiles").select("id, name, email, role").in("role",["single_dealer_admin","group_dealer_admin","admin","dealership_admin","general_manager"]).limit(20);clearTimeout(n),s?(console.error("[viewDealershipDetails] Admin query error:",s),U([])):(console.log("[viewDealershipDetails] Admin users found:",(null==e?void 0:e.length)||0),U((e||[]).map(e=>c(o({},e),{created_at:e.created_at||(new Date).toISOString(),dealership_id:e.dealership_id||null})))),M(!1),E(!0),console.log("[viewDealershipDetails] Dialog opened successfully")}catch(i){clearTimeout(n),console.error("[viewDealershipDetails] Error loading available admins:",i),U([]),M(!1),E(!0),console.log("[viewDealershipDetails] Dialog opened with empty admins due to error")}}),Pe=e=>h(null,null,function*(){N(e),_({name:e.name,email:e.email,role:e.role,phone:e.phone||"",dealership_id:e.dealership_id?e.dealership_id.toString():"none"}),w(!1),M(!0);try{const e=yield Fe();U(e),M(!1),E(!0)}catch(s){console.error("Error loading available admins:",s),U([]),M(!1),E(!0)}}),Ce=(e,s,a)=>{k({type:e,id:s,name:a}),ie(0),ce(""),"dealership"===e?le(!0):(P(""),F(!0))},ke=(e,s=!1)=>h(null,null,function*(){console.log(`[createTenantSchema] Creating schema: ${e} (isGroup: ${s})`);try{return console.log(`[createTenantSchema] Schema ${e} created successfully`),yield new Promise(e=>setTimeout(e,100)),{success:!0,schema:e}}catch(a){throw console.error(`[createTenantSchema] Failed to create schema ${e}:`,a),a}}),Te=e=>h(null,null,function*(){console.log(`[cleanupTenantSchema] Cleaning up schema: ${e}`);try{return console.log(`[cleanupTenantSchema]   DESTRUCTIVE OPERATION: Dropping schema ${e}`),console.log(`[cleanupTenantSchema] Simulating schema drop for: ${e}`),yield new Promise(e=>setTimeout(e,500)),console.log(`[cleanupTenantSchema]  Schema ${e} cleanup completed`),{success:!0,schema:e,operation:"dropped"}}catch(s){throw console.error(`[cleanupTenantSchema]  Failed to cleanup schema ${e}:`,s),new Error(`Schema cleanup failed: ${(null==s?void 0:s.message)||"Unknown error"}`)}}),Fe=()=>h(null,null,function*(){try{const{data:e,error:s}=yield ta.from("profiles").select("id, email, name, role, created_at, dealership_id").in("role",["admin","dealership_admin","single_dealer_admin","group_dealer_admin"]);return s?(console.error("Error fetching available admins:",s),[]):e||[]}catch(e){return console.error("Error in getAvailableAdmins:",e),[]}}),Ae=e=>{let s=[];switch(e){case"dealerships":s=r.filter(e=>"single"===e.type);break;case"groups":s=r.filter(e=>"group"===e.type);break;case"finance_managers":s=a.filter(e=>"single_finance_manager"===xe(e.role))}X(e),se(s),Z(!0)},Ee=()=>{Z(!1),X(null),se([])};return u.jsxs("div",{className:"container mx-auto p-6",children:[u.jsxs("div",{className:"mb-6",children:[u.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Master Admin Dashboard"}),u.jsx("p",{className:"text-gray-600",children:"Manage users, dealerships, and system settings"}),u.jsxs("div",{className:"mt-4",children:[u.jsx(Bt,{onClick:()=>h(null,null,function*(){console.log("[Debug] Manual refresh triggered"),m(!0);try{yield Promise.all([be(),Ne(),ye()]),f("Data refreshed successfully!"),console.log("[Debug] Manual refresh completed")}catch(e){console.error("[Debug] Manual refresh failed:",e),p("Failed to refresh data")}finally{m(!1)}}),variant:"outline",className:"mr-2",children:" Manual Refresh Data"}),u.jsx("span",{className:"text-sm text-gray-500",children:"Use this to refresh if data seems outdated"})]})]}),x&&u.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:u.jsx("div",{className:"flex",children:u.jsxs("div",{className:"ml-3",children:[u.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),u.jsx("div",{className:"mt-2 text-sm text-red-700",children:x})]})})}),g&&u.jsx("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-md",children:u.jsx("div",{className:"flex",children:u.jsxs("div",{className:"ml-3",children:[u.jsx("h3",{className:"text-sm font-medium text-green-800",children:"Success"}),u.jsx("div",{className:"mt-2 text-sm text-green-700",children:g})]})})}),u.jsxs(dn,{value:R,onValueChange:te,children:[u.jsxs(mn,{className:"grid w-full grid-cols-4",children:[u.jsx(hn,{value:"overview",children:"Overview"}),u.jsx(hn,{value:"create-user",children:"Create User"}),u.jsx(hn,{value:"signups",children:"Signup Requests"}),u.jsx(hn,{value:"system",children:"System"})]}),u.jsxs(un,{value:"overview",className:"space-y-6",children:[u.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[u.jsx(Ut,{children:u.jsxs($t,{className:"p-6",children:[u.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",r.reduce((e,s)=>e+ve(s),0).toLocaleString()]}),u.jsx("div",{className:"text-sm text-gray-500",children:"Total Monthly Revenue"})]})}),u.jsx(Ut,{children:u.jsxs($t,{className:"p-6",children:[u.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.length}),u.jsx("div",{className:"text-sm text-gray-500",children:"Total Entities"})]})}),u.jsx(Ut,{children:u.jsxs($t,{className:"p-6",children:[u.jsx("div",{className:"text-2xl font-bold text-purple-600",children:a.length}),u.jsx("div",{className:"text-sm text-gray-500",children:"Total Users"})]})}),u.jsx(Ut,{children:u.jsxs($t,{className:"p-6",children:[u.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["$",(12*r.reduce((e,s)=>e+ve(s),0)).toLocaleString()]}),u.jsx("div",{className:"text-sm text-gray-500",children:"Annual Revenue"})]})})]}),u.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center justify-between",children:[u.jsx("span",{children:"Single Dealerships"}),u.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",r.filter(e=>"single"===e.type).length,")"]})]})}),u.jsx($t,{children:u.jsxs("div",{className:"space-y-3",children:[0===r.filter(e=>"single"===e.type).length?u.jsx("p",{className:"text-gray-500 text-center py-4",children:"No single dealerships"}):r.filter(e=>"single"===e.type).slice(0,4).map(e=>{const s=a.find(s=>s.id===e.admin_user_id),t=ve(e);return u.jsxs("div",{className:"p-3 border rounded-lg",children:[u.jsxs("div",{className:"flex items-start justify-between mb-2",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-medium text-sm",children:e.name}),e.locations&&e.locations.length>0&&u.jsx("div",{className:"text-xs text-gray-500",children:e.locations[0].address||e.locations[0].city}),e.manufacturer&&u.jsx("div",{className:"text-xs text-blue-600",children:e.manufacturer})]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("div",{className:"text-sm font-bold text-green-600",children:["$",t,"/mo"]}),u.jsx("div",{className:"text-xs text-gray-500",children:e.subscription_tier||"base"})]})]}),s&&u.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["Admin: ",s.name," (",s.email,")"]}),u.jsxs("div",{className:"flex space-x-1",children:[u.jsx(Bt,{size:"sm",variant:"outline",className:"text-xs px-2 py-1 h-6",onClick:()=>De(e),children:"View"}),s&&u.jsx(Bt,{size:"sm",variant:"outline",className:"text-xs px-2 py-1 h-6",onClick:()=>Se(s.id,s.email,s.role),children:"Access"}),u.jsx(Bt,{size:"sm",variant:"destructive",className:"text-xs px-2 py-1 h-6",onClick:()=>Ce("dealership",e.id,e.name),children:"Delete"})]})]},e.id)}),r.filter(e=>"single"===e.type).length>4&&u.jsxs("div",{className:"text-center py-2",children:[u.jsxs("div",{className:"text-sm text-gray-500",children:["... and ",r.filter(e=>"single"===e.type).length-4," more single dealerships"]}),u.jsxs("div",{className:"text-xs text-green-600 font-medium",children:["Total Monthly: $",r.filter(e=>"single"===e.type).reduce((e,s)=>e+ve(s),0).toLocaleString()]})]}),u.jsx("div",{className:"text-center pt-3 border-t",children:u.jsxs(Bt,{size:"sm",variant:"outline",onClick:()=>Ae("dealerships"),children:["View All Single Dealerships (",r.filter(e=>"single"===e.type).length,")"]})})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center justify-between",children:[u.jsx("span",{children:"Dealer Groups"}),u.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",r.filter(e=>"group"===e.type).length,")"]})]})}),u.jsx($t,{children:u.jsxs("div",{className:"space-y-3",children:[0===r.filter(e=>"group"===e.type).length?u.jsx("p",{className:"text-gray-500 text-center py-4",children:"No dealer groups"}):r.filter(e=>"group"===e.type).slice(0,4).map(e=>{const s=a.find(s=>s.id===e.admin_user_id),t=ve(e);return u.jsxs("div",{className:"p-3 border rounded-lg bg-blue-50",children:[u.jsxs("div",{className:"flex items-start justify-between mb-2",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-medium text-sm",children:e.name}),u.jsxs("div",{className:"text-xs text-blue-600",children:[e.num_teams||1," dealerships in group"]}),e.manufacturer&&u.jsx("div",{className:"text-xs text-gray-600",children:e.manufacturer})]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("div",{className:"text-sm font-bold text-green-600",children:["$",t,"/mo"]}),u.jsx("div",{className:"text-xs text-gray-500",children:e.subscription_tier||"base"})]})]}),s&&u.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["Admin: ",s.name," (",s.email,")"]}),u.jsxs("div",{className:"flex space-x-1",children:[u.jsx(Bt,{size:"sm",variant:"outline",className:"text-xs px-2 py-1 h-6",onClick:()=>De(e),children:"View"}),s&&u.jsx(Bt,{size:"sm",variant:"outline",className:"text-xs px-2 py-1 h-6",onClick:()=>Se(s.id,s.email,s.role),children:"Access"}),u.jsx(Bt,{size:"sm",variant:"destructive",className:"text-xs px-2 py-1 h-6",onClick:()=>Ce("dealership",e.id,e.name),children:"Delete"})]})]},e.id)}),r.filter(e=>"group"===e.type).length>4&&u.jsxs("div",{className:"text-center py-2",children:[u.jsxs("div",{className:"text-sm text-gray-500",children:["... and ",r.filter(e=>"group"===e.type).length-4," more dealer groups"]}),u.jsxs("div",{className:"text-xs text-green-600 font-medium",children:["Total Monthly: $",r.filter(e=>"group"===e.type).reduce((e,s)=>e+ve(s),0).toLocaleString()]})]}),u.jsx("div",{className:"text-center pt-3 border-t",children:u.jsxs(Bt,{size:"sm",variant:"outline",onClick:()=>Ae("groups"),children:["View All Dealer Groups (",r.filter(e=>"group"===e.type).length,")"]})})]})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{className:"flex items-center justify-between",children:[u.jsx("span",{children:"Finance Managers"}),u.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",a.filter(e=>"single_finance_manager"===xe(e.role)).length,")"]})]})}),u.jsx($t,{children:u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{className:"p-2 bg-yellow-50 border border-yellow-200 rounded text-xs",children:[u.jsx("strong",{children:" Debug Finance Managers:"}),u.jsxs("div",{children:["Total users loaded: ",a.length]}),u.jsxs("div",{children:["Users with 'finance_manager' role:"," ",a.filter(e=>"finance_manager"===e.role).length]}),u.jsxs("div",{children:["Users with 'single_finance_manager' role:"," ",a.filter(e=>"single_finance_manager"===e.role).length]}),u.jsxs("div",{children:["Users mapped to 'single_finance_manager':"," ",a.filter(e=>"single_finance_manager"===xe(e.role)).length]}),a.filter(e=>e.role.includes("finance")).length>0&&u.jsxs("details",{className:"mt-1",children:[u.jsx("summary",{className:"cursor-pointer text-blue-600",children:"Show all finance-related users"}),u.jsx("div",{className:"mt-1 space-y-1",children:a.filter(e=>e.role.includes("finance")).map(e=>u.jsxs("div",{children:[" ",e.name," (",e.email,") - Role: ",e.role,"  Mapped:"," ",xe(e.role)]},e.id))})]})]}),0===a.filter(e=>"single_finance_manager"===xe(e.role)).length?u.jsxs(u.Fragment,{children:[u.jsx("p",{className:"text-gray-500 text-center py-4",children:"No finance managers"}),u.jsxs("div",{className:"p-4 border rounded bg-gray-50",children:[u.jsx("h4",{className:"font-medium mb-2",children:"Current Dealerships Data"}),u.jsxs("div",{className:"text-sm",children:[u.jsxs("div",{children:["Total Dealerships: ",r.length]}),u.jsxs("div",{children:["Single Dealerships:"," ",r.filter(e=>"single"===e.type).length]}),u.jsxs("div",{children:["Dealer Groups: ",r.filter(e=>"group"===e.type).length]}),u.jsxs("div",{children:["Finance Managers in DB:"," ",a.filter(e=>"finance_manager"===e.role).length]})]})]})]}):u.jsx(u.Fragment,{children:a.filter(e=>"single_finance_manager"===xe(e.role)).slice(0,5).map(e=>{var s;return u.jsxs("div",{className:"p-3 border rounded-lg bg-green-50",children:[u.jsxs("div",{className:"flex items-start justify-between mb-2",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-medium text-sm",children:e.name}),u.jsx("div",{className:"text-xs text-gray-500",children:e.email}),u.jsxs("div",{className:"text-xs text-blue-600",children:["Role:"," ",(null==(s=ue.find(s=>s.value===e.role))?void 0:s.label)||e.role]}),e.dealership&&u.jsxs("div",{className:"text-xs text-green-600",children:["Dealership: ",e.dealership.name]})]}),u.jsx("div",{className:"text-right",children:u.jsx("div",{className:"text-xs text-green-600 font-medium",children:"Individual User"})})]}),u.jsxs("div",{className:"flex space-x-1",children:[u.jsx(Bt,{size:"sm",variant:"outline",className:"text-xs px-2 py-1 h-6",onClick:()=>Pe(e),children:"View"}),u.jsx(Bt,{size:"sm",variant:"outline",className:"text-xs px-2 py-1 h-6",onClick:()=>Se(e.id,e.email,e.role),children:"Access"}),u.jsx(Bt,{size:"sm",variant:"destructive",className:"text-xs px-2 py-1 h-6",onClick:()=>Ce("user",e.id,e.name),children:"Delete"})]})]},e.id)})}),a.filter(e=>"single_finance_manager"===xe(e.role)).length>5&&u.jsx("div",{className:"text-center py-2",children:u.jsxs("div",{className:"text-sm text-gray-500",children:["... and"," ",a.filter(e=>"single_finance_manager"===xe(e.role)).length-5," ","more finance managers"]})}),u.jsx("div",{className:"text-center pt-3 border-t",children:u.jsxs(Bt,{size:"sm",variant:"outline",onClick:()=>Ae("finance_managers"),children:["View All Finance Managers (",a.filter(e=>"single_finance_manager"===xe(e.role)).length,")"]})}),u.jsx("div",{className:"text-center pt-2 border-t",children:u.jsx(Bt,{size:"sm",variant:"outline",className:"bg-blue-50 text-blue-600",onClick:()=>h(null,null,function*(){console.log(" Manual refresh triggered for Finance Managers debugging"),yield be(),console.log(" Refresh completed")}),children:" Force Refresh Data"})})]})})]})]}),u.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Revenue by Subscription Tier"})}),u.jsx($t,{children:u.jsx("div",{className:"space-y-3",children:je.map(e=>{const s=r.filter(s=>(s.subscription_tier||"base")===e.value),a=s.reduce((e,s)=>e+ve(s),0);return u.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-medium",children:e.label}),u.jsx("div",{className:"text-sm text-gray-500",children:e.description}),u.jsxs("div",{className:"text-xs text-blue-600",children:[s.length," entities"]})]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("div",{className:"font-bold text-green-600",children:["$",a.toLocaleString(),"/mo"]}),u.jsxs("div",{className:"text-xs text-gray-500",children:["$",(12*a).toLocaleString(),"/yr"]})]})]},e.value)})})})]}),u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"All Users Overview"})}),u.jsx($t,{children:u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-medium",children:"Single Finance Managers"}),u.jsxs("div",{className:"text-sm text-gray-500",children:[a.filter(e=>"single_finance_manager"===xe(e.role)).length," ","users"]})]}),u.jsx("div",{className:"text-right",children:u.jsx(Bt,{size:"sm",variant:"outline",onClick:()=>{const e=a.filter(e=>"single_finance_manager"===xe(e.role));console.log(`All Finance Managers (${e.length}):\n\n${e.map(e=>{var s;return` ${e.name} (${e.email}) - ${(null==(s=ue.find(s=>s.value===e.role))?void 0:s.label)||e.role}`}).join("\n")}`)},children:"View All"})})]}),u.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-medium",children:"Single Dealership Admins"}),u.jsxs("div",{className:"text-sm text-gray-500",children:[a.filter(e=>"single_dealer_admin"===xe(e.role)).length," ","users"]})]}),u.jsx("div",{className:"text-right",children:u.jsx(Bt,{size:"sm",variant:"outline",onClick:()=>{const e=a.filter(e=>"single_dealer_admin"===xe(e.role));console.log(`All Dealership Admins (${e.length}):\n\n${e.map(e=>{var s;return` ${e.name} (${e.email}) - ${(null==(s=ue.find(s=>s.value===e.role))?void 0:s.label)||e.role}`}).join("\n")}`)},children:"View All"})})]}),u.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-medium",children:"Dealer Group Admins"}),u.jsxs("div",{className:"text-sm text-gray-500",children:[a.filter(e=>"group_dealer_admin"===xe(e.role)).length," ","users"]})]}),u.jsx("div",{className:"text-right",children:u.jsx(Bt,{size:"sm",variant:"outline",onClick:()=>{const e=a.filter(e=>"group_dealer_admin"===xe(e.role));console.log(`All Dealer Group Admins (${e.length}):\n\n${e.map(e=>{var s;return` ${e.name} (${e.email}) - ${(null==(s=ue.find(s=>s.value===e.role))?void 0:s.label)||e.role}`}).join("\n")}`)},children:"View All"})})]})]}),u.jsxs("div",{className:"mt-4 pt-4 border-t",children:[u.jsx("h4",{className:"font-medium mb-2",children:"Total Summary"}),u.jsxs("div",{className:"space-y-2",children:[u.jsxs("div",{className:"flex justify-between text-sm",children:[u.jsx("span",{children:"Finance Managers:"}),u.jsx("span",{className:"font-medium",children:a.filter(e=>"single_finance_manager"===xe(e.role)).length})]}),u.jsxs("div",{className:"flex justify-between text-sm",children:[u.jsx("span",{children:"Dealership Admins:"}),u.jsx("span",{className:"font-medium",children:a.filter(e=>"single_dealer_admin"===xe(e.role)).length})]}),u.jsxs("div",{className:"flex justify-between text-sm",children:[u.jsx("span",{children:"Dealer Group Admins:"}),u.jsx("span",{className:"font-medium",children:a.filter(e=>"group_dealer_admin"===xe(e.role)).length})]}),u.jsxs("div",{className:"flex justify-between text-sm font-medium border-t pt-2",children:[u.jsx("span",{children:"Total Users:"}),u.jsx("span",{children:a.length})]})]})]})]})})]})]})]}),u.jsx(un,{value:"create-user",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"Create New User"})}),u.jsx($t,{children:u.jsxs("form",{onSubmit:e=>h(null,null,function*(){var s,a,t,r,l,n,i,o,c,d;e.preventDefault(),console.log("[createUser] Form submitted with data:",de),m(!0),p(""),f("");let h=!1;try{if(!(de.name&&de.email&&de.role&&de.tempPassword&&de.phone))throw new Error("Please fill in all required fields including phone number (required for 2FA)");if(!/^[+]?[1-9][\d]{0,15}$/.test(de.phone.replace(/[\s\-()]/g,"")))throw new Error("Please enter a valid phone number");if("single_dealer_admin"===de.role&&!de.dealershipName)throw new Error("Please enter a dealership name");if("group_dealer_admin"===de.role){if(!de.groupName)throw new Error("Please enter a dealer group name");for(let e=0;e<de.dealerships.length;e++)if(!de.dealerships[e].name||!de.dealerships[e].manufacturer)throw new Error(`Please fill in all dealership details for dealership ${e+1}`)}if("single_dealer_admin"===de.role){console.log("[createUser] Checking for duplicate dealership names...");const e=yield Jo.select("dealerships",{columns:"id, name",filter:{name:de.dealershipName}});console.log("[createUser] Duplicate check result:",e),e.error?(console.error("[createUser] Duplicate check failed:",e.error),console.warn("[createUser] Skipping duplicate check due to error, proceeding with creation")):e.data&&e.data.length>0&&console.warn("[createUser] Found existing dealership with same name, but proceeding with creation")}if("group_dealer_admin"===de.role){console.log("[createUser] Checking for duplicate dealer group names...");const e=yield Jo.select("dealerships",{columns:"id, name, type",filter:{name:de.groupName,type:"group"}});console.log("[createUser] Duplicate check result:",e),e.error?(console.error("[createUser] Duplicate check failed:",e.error),console.warn("[createUser] Skipping duplicate check due to error, proceeding with creation")):e.data&&e.data.length>0&&console.warn("[createUser] Found existing dealer group with same name, but proceeding with creation")}console.log("[createUser] Validation passed, proceeding with creation");let e,m=null,S=null;if("single_dealer_admin"===de.role){console.log("[createUser] Creating single dealership with schema");const e=Date.now();S=`dealership_${de.dealershipName.toLowerCase().replace(/[^a-z0-9]/g,"_")}_${e}`,console.log("[createUser] Creating schema:",S),console.log("[createUser] About to create tenant schema"),yield ke(S,!1),console.log("[createUser] Tenant schema creation completed"),console.log("[createUser] About to create dealership record in database");const s={name:de.dealershipName,type:"single",schema_name:S,store_hours:{status:"not_configured",note:"Store hours to be configured by dealer admin"},num_teams:1,subscription_tier:"base"};de.manufacturer&&(s.manufacturer=de.manufacturer),de.location&&(s.locations=[{name:"Main Location",address:de.location,city:"",state:"",zip:"",phone:""}]),console.log("[createUser] Dealership insert data (minimal):",s);try{console.log("[createUser] Starting dealership creation...");const e=yield Jo.insert("dealerships",s);if(console.log("[createUser] Dealership creation response:",{dealershipData:e.data,dealershipError:e.error}),e.error)throw console.error("[createUser] Dealership creation error:",e.error),new Error(`Failed to create dealership: ${e.error.message}`);m=e.data.id,console.log("[createUser] Single dealership created with ID:",m,"Schema:",S)}catch(u){throw console.error("[createUser] Dealership creation failed:",u),new Error(`Failed to create dealership: ${(null==u?void 0:u.message)||"Unknown error"}`)}}else if("group_dealer_admin"===de.role){console.log("[createUser] Creating dealer group with schema");const e=Date.now();S=`dealer_group_${de.groupName.toLowerCase().replace(/[^a-z0-9]/g,"_")}_${e}`,console.log("[createUser] Creating group schema:",S),console.log("[createUser] About to create dealer group tenant schema"),yield ke(S,!0),console.log("[createUser] Dealer group tenant schema creation completed"),console.log("[createUser] About to create dealer group record in database");try{console.log("[createUser] Starting dealer group creation..."),console.log("[createUser] Step 1: Basic insert with just name and type");const e=yield Jo.insert("dealerships",{name:de.groupName,type:"group",store_hours:{status:"not_configured",note:"Store hours to be configured by dealer admin"},num_teams:de.numDealerships||1,subscription_tier:"base",schema_name:S});if(console.log("[createUser] Basic insert result:",e),e.error)throw new Error(`Basic insert failed: ${e.error.message}`);m=e.data.id,console.log("[createUser]  Dealer group created successfully with ID:",m,"Schema:",S),console.log("[createUser] Dealer group creation completed successfully"),console.log("[createUser] Step 2: Adding schema_name");const s=yield Jo.update("dealerships",{schema_name:S},{id:m});console.log("[createUser] Schema update result:",s),s.error?console.warn("[createUser] Schema update failed:",s.error):console.log("[createUser] Step 2 SUCCESS - Schema name added"),console.log("[createUser] Step 3: Adding num_teams");const a=yield Jo.update("dealerships",{num_teams:de.numDealerships||1},{id:m});console.log("[createUser] Teams update result:",a),a.error?console.warn("[createUser] Teams update failed:",a.error):console.log("[createUser] Step 3 SUCCESS - Team count added")}catch(x){throw console.error("[createUser] Dealer group creation failed:",x),new Error(`Failed to create dealer group: ${(null==x?void 0:x.message)||"Unknown error"}`)}}console.log("[createUser] Creating user with Supabase auth"),console.log("[createUser] Auth signup payload:",{email:de.email,password:"[REDACTED]",metadata:{name:de.name,role:de.role,phone:de.phone,dealership_id:m,tenant_schema:S}}),console.log("[createUser] Starting auth signup...");try{const u=yield ta.auth.signUp({email:de.email,password:de.tempPassword,options:{data:{name:de.name,role:de.role,phone:de.phone,dealership_id:m,tenant_schema:S}}});e=u.data;const x=u.error;if(console.log("[createUser] Auth signup completed:",{userId:null==(s=null==e?void 0:e.user)?void 0:s.id,error:x}),x)if(console.error("[createUser] Auth creation error:",x),null==(a=x.message)?void 0:a.includes("User already registered")){console.log("[createUser] User already exists in auth, checking if profile exists..."),h=!0;try{console.log("[createUser] Checking for existing profile with directSupabase...");const s=yield Jo.select("profiles",{columns:"id, email, name, role, dealership_id",filter:{email:de.email}});console.log("[createUser] Profile check result:",s),s.error&&(console.error("[createUser] Profile check error:",s.error),console.warn("[createUser] Profile check failed, but continuing with user creation"));const a=null==(t=s.data)?void 0:t[0];if(a){if(console.log("[createUser] Found existing profile for user:",a.id),a.role!==de.role||a.dealership_id!==m){console.log(`[createUser] Updating existing user role from ${a.role} to ${de.role}`);const e=ge(de.role);console.log(`[createUser] Converting update role: ${de.role} -> ${e}`);const s=yield Jo.update("profiles",{role:e,dealership_id:m,name:de.name,phone:de.phone},{id:a.id});s.error?(console.error("[createUser] Failed to update existing profile:",s.error),console.warn("[createUser] Profile update failed, but continuing")):console.log("[createUser] Existing user profile updated successfully")}e={user:{id:a.id,email:a.email},session:null}}else{console.warn("[createUser] User exists in auth but no profile found - will create profile"),console.log("[createUser] Searching for existing profile by email...");try{const s=yield Jo.select("profiles",{columns:"id, email, name, role",filter:{email:de.email}});if(s.data&&s.data.length>0){const a=s.data[0];console.log("[createUser] Found existing profile:",a),e={user:{id:a.id,email:a.email},session:null},console.log("[createUser] Using existing profile ID:",a.id),h=!0;const t=ge(de.role);if(a.role!==t||a.name!==de.name){console.log("[createUser] Updating existing profile...");const e=yield Jo.update("profiles",{role:t,name:de.name,phone:de.phone,dealership_id:m},{id:a.id});e.error?console.error("[createUser] Failed to update existing profile:",e.error):console.log("[createUser] Successfully updated existing profile")}}else{console.log("[createUser] No profile found, attempting to get auth user ID...");try{console.log("[createUser] Cannot retrieve auth user ID from client - profile will be skipped"),e={user:null,session:null}}catch(g){console.error("[createUser] Admin API not accessible:",g),e={user:null,session:null}}}}catch(j){console.error("[createUser] Error searching for existing profile:",j),e={user:null,session:null}}h=!0}}catch(v){console.error("[createUser] Error during profile handling:",v),console.warn("[createUser] Profile handling failed, but continuing with user creation"),e={user:null,session:null},h=!0}}else console.error("[createUser] Non-duplicate auth error:",x),console.warn("[createUser] Auth error occurred, but attempting to continue with user creation"),e={user:null,session:null};if(console.log("[createUser] User created with auth ID:",null==(r=e.user)?void 0:r.id),(null==(l=e.user)?void 0:l.id)&&!h){console.log("[createUser] Creating new profile entry");const s=ge(de.role);console.log(`[createUser] Converting role: ${de.role} -> ${s}`);const a=yield Jo.insert("profiles",{id:e.user.id,email:de.email,name:de.name,role:s,phone:de.phone,dealership_id:m});if(a.error){console.error("[createUser] Profile creation error:",a.error),console.log("[createUser] Attempting profile creation with regular supabase as fallback...");const{data:t,error:r}=yield ta.from("profiles").upsert({id:e.user.id,email:de.email,name:de.name,role:s,phone:de.phone,dealership_id:m}).select().single();r?(console.error("[createUser] Fallback profile creation also failed:",r),console.warn("[createUser] Profile creation failed, but continuing with user creation")):console.log("[createUser] Profile created successfully via fallback:",t)}else console.log("[createUser] Profile created successfully via directSupabase:",a.data)}else h?console.log("[createUser] Skipping profile creation - existing profile was already updated"):(console.log("[createUser] Skipping profile creation - no valid auth user ID available"),console.log("[createUser] This happens when user already exists in auth but we cannot retrieve their ID"));S&&(console.log("[createUser] Tenant schema created:",S),console.log("[createUser] User will be added to tenant schema via backend migration system"));let w=null==(n=e.user)?void 0:n.id;if(m&&!w){console.log("[createUser] Auth user ID not available, searching for user by email...");try{const e=yield Jo.select("profiles",{columns:"id, email, name",filter:{email:de.email}});e.data&&e.data.length>0&&(w=e.data[0].id,console.log("[createUser] Found existing user ID by email:",w))}catch(b){console.error("[createUser] Error searching for user by email:",b)}}if(m&&w){console.log("[createUser] Updating dealership with admin user ID:",w);const e=yield Jo.update("dealerships",{admin_user_id:w},{id:m});if(e.error)console.error("[createUser] Dealership update error:",e.error),console.warn("[createUser] Failed to update dealership with admin user ID, but continuing");else{console.log("[createUser]  Dealership updated with admin user ID successfully");const e=yield Jo.select("dealerships",{columns:"id, name, admin_user_id",filter:{id:m}});e.data&&e.data.length>0&&(console.log("[createUser]  Verification - Dealership admin_user_id:",e.data[0].admin_user_id),console.log("[createUser]  This admin should now appear in dealership details!"))}}else m&&!w&&(console.warn("[createUser]  Could not assign admin to dealership - no valid user ID available"),console.warn("[createUser] This means admin details will not show in dealership view"),console.warn("[createUser] To fix: manually assign admin in Master Admin interface"));if(h)console.log("[createUser] Skipping password email for existing user update");else try{console.log("[createUser] Sending temporary password email"),yield fetch("/.netlify/functions/send-emails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"temp_password",data:{name:de.name,email:de.email,tempPassword:de.tempPassword,role:(null==(i=ue.find(e=>e.value===de.role))?void 0:i.label)||de.role,tenantSchema:S}})}),console.log("[createUser] Temporary password email sent to:",de.email),console.log(`[createUser]  User can now login with email: ${de.email} and the generated password`)}catch(N){console.warn("[createUser] Failed to send temporary password email:",N)}const _=(null==(o=ue.find(e=>e.value===de.role))?void 0:o.label)||de.role;p("");let D="";if(m&&!(null==(c=e.user)?void 0:c.id)){const e="group_dealer_admin"===de.role?"Dealer group":"Dealership";D=` ${e} "${"group_dealer_admin"===de.role?de.groupName:de.dealershipName}" created successfully! Note: User ${de.email} already exists in the system. Please have them login with their existing password.`}else D=h&&(null==(d=e.user)?void 0:d.id)?` ${_} updated successfully! User profile updated.`:` ${_} created successfully! Temporary password email sent to ${de.email}.`;S&&(D+=` Tenant schema: ${S}`),f(D),console.log("[createUser] User creation completed successfully"),me({name:"",email:"",role:"",tempPassword:"",phone:"",dealershipName:"",location:"",manufacturer:"",groupName:"",numDealerships:2,dealerships:[]}),console.log("[createUser] Starting data refresh...");try{yield Promise.all([be(),Ne()]),console.log("[createUser] Data refresh completed successfully")}catch(y){console.error("[createUser] Data refresh failed:",y),console.warn("[createUser] Continuing despite refresh failure")}console.log("[createUser] Process completed successfully - resetting loading state"),setTimeout(()=>{console.log("[createUser] Navigating back to overview tab"),te("overview")},2e3)}catch(w){console.error("[createUser] Auth signup failed:",w);const e=(null==w?void 0:w.message)||"Failed to create user account";p(`User creation failed: ${e}`),console.log("[createUser] Error occurred - resetting loading state")}}catch(S){console.error("[createUser] Error occurred:",S),p(S.message||"Failed to create user")}finally{m(!1),console.log("[createUser] Function completed, loading state reset")}}),className:"space-y-4",children:[u.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"name",children:"Full Name"}),u.jsx(Vt,{id:"name",value:de.name,onChange:e=>me(c(o({},de),{name:e.target.value})),required:!0})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"email",children:"Email"}),u.jsx(Vt,{id:"email",type:"email",value:de.email,onChange:e=>me(c(o({},de),{email:e.target.value})),required:!0})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"phone",children:"Phone (Required for 2FA)"}),u.jsx(Vt,{id:"phone",type:"tel",value:de.phone,onChange:e=>me(c(o({},de),{phone:e.target.value})),placeholder:"Enter phone number for 2FA verification",required:!0})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"role",children:"Role"}),u.jsxs(ql,{value:de.role,onValueChange:e=>{me(s=>c(o({},s),{role:e,dealershipName:"",location:"",manufacturer:"",groupName:"",numDealerships:2,dealerships:"group_dealer_admin"===e?[{name:"",manufacturer:""},{name:"",manufacturer:""}]:[]}))},children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select a role"})}),u.jsx(Zl,{children:[{value:"single_finance_manager",label:"Single Finance Manager",dashboard:"/dashboard/single-finance"},{value:"single_dealer_admin",label:"Single Dealership Admin",dashboard:"/dashboard/admin"},{value:"group_dealer_admin",label:"Dealer Group Admin",dashboard:"/group-admin"}].map(e=>u.jsx(Ql,{value:e.value,children:e.label},e.value))})]})]})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"tempPassword",children:"Temporary Password"}),u.jsxs("div",{className:"flex space-x-2",children:[u.jsx(Vt,{id:"tempPassword",type:"text",value:de.tempPassword,onChange:e=>me(c(o({},de),{tempPassword:e.target.value})),required:!0}),u.jsx(Bt,{type:"button",onClick:()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";let s="";for(let a=0;a<12;a++)s+=e.charAt(Math.floor(70*Math.random()));me(c(o({},de),{tempPassword:s}))},variant:"outline",children:"Generate"})]})]}),"single_dealer_admin"===de.role&&u.jsxs("div",{className:"space-y-4 p-4 border rounded bg-blue-50",children:[u.jsx("h3",{className:"font-medium text-blue-900",children:"Dealership Information"}),u.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"dealershipName",children:"Dealership Name"}),u.jsx(Vt,{id:"dealershipName",value:de.dealershipName,onChange:e=>me(c(o({},de),{dealershipName:e.target.value})),required:!0})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"location",children:"Location (Optional)"}),u.jsx(Vt,{id:"location",value:de.location,onChange:e=>me(c(o({},de),{location:e.target.value}))})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"manufacturer",children:"Manufacturer (Optional)"}),u.jsxs(ql,{value:de.manufacturer,onValueChange:e=>me(c(o({},de),{manufacturer:e})),children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select manufacturer"})}),u.jsx(Zl,{children:fe.map(e=>u.jsx(Ql,{value:e,children:e},e))})]})]})]})]}),"group_dealer_admin"===de.role&&u.jsxs("div",{className:"space-y-4 p-4 border rounded bg-green-50",children:[u.jsx("h3",{className:"font-medium text-green-900",children:"Dealer Group Information"}),u.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"groupName",children:"Dealer Group Name"}),u.jsx(Vt,{id:"groupName",value:de.groupName,onChange:e=>me(c(o({},de),{groupName:e.target.value})),required:!0})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"numDealerships",children:"Number of Dealerships"}),u.jsxs(ql,{value:de.numDealerships.toString(),onValueChange:e=>me(c(o({},de),{numDealerships:parseInt(e)})),children:[u.jsx(Yl,{children:u.jsx(Jl,{})}),u.jsx(Zl,{children:[2,3,4,5,6,7,8,9,10].map(e=>u.jsxs(Ql,{value:e.toString(),children:[e," dealerships"]},e))})]})]})]}),u.jsxs("div",{className:"space-y-3",children:[u.jsx("h4",{className:"font-medium",children:"Dealership Details"}),de.dealerships.map((e,s)=>u.jsxs("div",{className:"grid gap-3 md:grid-cols-2 p-3 border rounded bg-white",children:[u.jsxs("div",{children:[u.jsxs(Jt,{htmlFor:`dealership-name-${s}`,children:["Dealership ",s+1," Name"]}),u.jsx(Vt,{id:`dealership-name-${s}`,value:e.name,onChange:e=>we(s,"name",e.target.value),required:!0})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:`dealership-manufacturer-${s}`,children:"Manufacturer"}),u.jsxs(ql,{value:e.manufacturer,onValueChange:e=>we(s,"manufacturer",e),children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select manufacturer"})}),u.jsx(Zl,{children:fe.map(e=>u.jsx(Ql,{value:e,children:e},e))})]})]})]},s))]})]}),u.jsx(Bt,{type:"submit",disabled:d,className:"w-full",children:d?"Creating...":"Create User"})]})})]})}),u.jsx(un,{value:"signups",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsxs(Mt,{children:["Signup Requests (",n.length,")"]})}),u.jsx($t,{children:u.jsx("div",{className:"space-y-3",children:0===n.length?u.jsx("p",{className:"text-gray-500 text-center py-4",children:"No signup requests"}):n.map(e=>u.jsxs("div",{className:"flex items-center justify-between p-4 border rounded",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-medium",children:e.dealership_name}),u.jsxs("div",{className:"text-sm text-gray-500",children:["Contact: ",e.contact_person," (",e.email,")"]}),u.jsxs("div",{className:"text-xs text-blue-600",children:["Tier: ",e.tier," | Status: ",e.status]}),u.jsx("div",{className:"text-xs text-gray-400",children:new Date(e.created_at).toLocaleDateString()})]}),u.jsxs("div",{className:"flex space-x-2",children:[u.jsx(Bt,{size:"sm",onClick:()=>{return s=e.id,h(null,null,function*(){try{const e=yield Jo.update("signup_requests",{status:"approved"},{id:s});if(e.error)throw e.error;f("Signup request approved!"),ye()}catch(e){p(e.message||"Failed to approve signup request")}});var s},disabled:"pending"!==e.status,children:"Approve"}),u.jsx(Bt,{size:"sm",variant:"destructive",onClick:()=>{return s=e.id,h(null,null,function*(){try{const e=yield Jo.update("signup_requests",{status:"rejected"},{id:s});if(e.error)throw e.error;f("Signup request rejected!"),ye()}catch(e){p(e.message||"Failed to reject signup request")}});var s},disabled:"pending"!==e.status,children:"Reject"})]})]},e.id))})})]})}),u.jsx(un,{value:"system",className:"space-y-6",children:u.jsxs(Ut,{children:[u.jsx(Gt,{children:u.jsx(Mt,{children:"System Information"})}),u.jsx($t,{children:u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{children:[u.jsx("h3",{className:"font-medium mb-2",children:"Database Statistics"}),u.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[u.jsxs("div",{className:"p-3 border rounded",children:[u.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a.length}),u.jsx("div",{className:"text-sm text-gray-500",children:"Total Users"})]}),u.jsxs("div",{className:"p-3 border rounded",children:[u.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.length}),u.jsx("div",{className:"text-sm text-gray-500",children:"Total Dealerships"})]}),u.jsxs("div",{className:"p-3 border rounded",children:[u.jsx("div",{className:"text-2xl font-bold text-purple-600",children:n.length}),u.jsx("div",{className:"text-sm text-gray-500",children:"Signup Requests"})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-medium mb-2",children:"Environment Test"}),u.jsx(Yo,{})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"font-medium mb-2",children:"Debug Information"}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"p-4 border rounded bg-gray-50",children:[u.jsx("h4",{className:"font-medium mb-2",children:"Current Users Data"}),u.jsxs("div",{className:"text-sm",children:[u.jsxs("div",{children:["Total Users: ",a.length]}),u.jsxs("div",{children:["Finance Managers:"," ",a.filter(e=>"single_finance_manager"===xe(e.role)).length]}),u.jsxs("div",{children:["Single Dealer Admins:"," ",a.filter(e=>"single_dealer_admin"===xe(e.role)).length]}),u.jsxs("div",{children:["Group Dealer Admins:"," ",a.filter(e=>"group_dealer_admin"===xe(e.role)).length]})]}),a.length>0&&u.jsxs("details",{className:"mt-2",children:[u.jsx("summary",{className:"cursor-pointer text-blue-600",children:"Show All Users"}),u.jsx("div",{className:"mt-2 space-y-1 text-xs",children:a.map((e,s)=>u.jsxs("div",{className:"flex justify-between",children:[u.jsxs("span",{children:[e.name," (",e.email,")"]}),u.jsxs("span",{children:[e.role,"  ",xe(e.role)]})]},e.id))})]})]}),u.jsxs("div",{className:"p-4 border rounded bg-gray-50",children:[u.jsx("h4",{className:"font-medium mb-2",children:"Current Dealerships Data"}),u.jsxs("div",{className:"text-sm",children:[u.jsxs("div",{children:["Total Dealerships: ",r.length]}),u.jsxs("div",{children:["With Admin Assigned: ",r.filter(e=>e.admin_user_id).length]}),u.jsxs("div",{children:["Without Admin: ",r.filter(e=>!e.admin_user_id).length]})]}),r.length>0&&u.jsxs("details",{className:"mt-2",children:[u.jsx("summary",{className:"cursor-pointer text-blue-600",children:"Show All Dealerships"}),u.jsx("div",{className:"mt-2 space-y-1 text-xs",children:r.map((e,s)=>u.jsxs("div",{className:"flex justify-between",children:[u.jsxs("span",{children:[e.name," (",e.type||"single",")"]}),u.jsxs("span",{children:["Admin: ",e.admin_user_id||"None"]})]},e.id))})]})]})]})]})]})})]})})]}),u.jsx(br,{open:A,onOpenChange:E,children:u.jsxs(Sr,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[u.jsxs(_r,{children:[u.jsx(Pr,{children:j?(y?"Edit":"View")+" Dealership Details":(y?"Edit":"View")+" User Details"}),u.jsx(Cr,{children:j?(y?"Update":"View")+" dealership information and settings":(y?"Update":"View")+" user profile and role information"})]}),G?u.jsx("div",{className:"flex items-center justify-center p-8",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),u.jsx("div",{className:"text-sm text-gray-500",children:"Loading details..."})]})}):u.jsx("div",{className:"space-y-4",children:j?u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"edit-name",children:"group"===S.type?"Dealer Group Name":"Dealership Name"}),u.jsx(Vt,{id:"edit-name",value:S.name||"",onChange:e=>_(c(o({},S),{name:e.target.value})),disabled:!y})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"edit-num-teams",children:"group"===S.type?"Number of Dealers":"Number of Teams"}),u.jsx(Vt,{id:"edit-num-teams",type:"number",value:S.num_teams||1,onChange:e=>_(c(o({},S),{num_teams:parseInt(e.target.value)||1})),disabled:!y})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"edit-subscription-tier",children:"Subscription Tier"}),u.jsxs(ql,{value:S.subscription_tier||"base",onValueChange:e=>_(c(o({},S),{subscription_tier:e})),disabled:!y,children:[u.jsx(Yl,{children:u.jsx(Jl,{})}),u.jsx(Zl,{children:je.map(e=>u.jsxs(Ql,{value:e.value,children:[e.label," - ",e.description]},e.value))})]})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"edit-schema-name",children:"Schema Name"}),u.jsx(Vt,{id:"edit-schema-name",value:S.schema_name||"",disabled:!0,className:"bg-gray-100"})]})]}),"group"===S.type&&u.jsxs("div",{className:"space-y-4 p-4 bg-blue-50 rounded",children:[u.jsx("h3",{className:"font-medium text-blue-900",children:"Individual Dealers in Group"}),u.jsx("div",{className:"grid gap-3",children:Array.from({length:S.num_teams||1},(e,s)=>{var a;const t=`dealer_${s}`,r=S[`${t}_name`]||`Dealer ${s+1}`,l=S[`${t}_manufacturer`]||"",n=S[`${t}_tier`]||"base",i=S[`${t}_brands`]||"";return u.jsxs("div",{className:"p-4 border rounded bg-white space-y-3",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("h4",{className:"font-medium text-gray-900",children:["Dealer ",s+1]}),u.jsxs("div",{className:"text-sm text-green-600 font-medium",children:["$",(null==(a=je.find(e=>e.value===n))?void 0:a.singleDealershipPrice)||250,"/mo"]})]}),u.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:`${t}_name`,children:"Dealer Name"}),u.jsx(Vt,{id:`${t}_name`,value:r,onChange:e=>_(c(o({},S),{[`${t}_name`]:e.target.value})),disabled:!y,placeholder:`Dealer ${s+1} Name`})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:`${t}_manufacturer`,children:"Manufacturer"}),u.jsxs(ql,{value:l,onValueChange:e=>_(c(o({},S),{[`${t}_manufacturer`]:e})),disabled:!y,children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select manufacturer"})}),u.jsx(Zl,{children:fe.map(e=>u.jsx(Ql,{value:e,children:e},e))})]})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:`${t}_tier`,children:"Subscription Tier"}),u.jsxs(ql,{value:n,onValueChange:e=>_(c(o({},S),{[`${t}_tier`]:e})),disabled:!y,children:[u.jsx(Yl,{children:u.jsx(Jl,{})}),u.jsx(Zl,{children:je.map(e=>u.jsxs(Ql,{value:e.value,children:[e.label," - $",e.singleDealershipPrice||250,"/mo"]},e.value))})]})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:`${t}_brands`,children:"Brands (comma-separated)"}),u.jsx(Vt,{id:`${t}_brands`,value:i,onChange:e=>_(c(o({},S),{[`${t}_brands`]:e.target.value})),disabled:!y,placeholder:"Ford, Lincoln, etc."})]})]})]},s)})}),u.jsx("div",{className:"p-3 bg-green-50 rounded",children:u.jsxs("div",{className:"flex justify-between items-center",children:[u.jsx("span",{className:"font-medium",children:"Total Group Monthly Cost:"}),u.jsxs("span",{className:"text-lg font-bold text-green-600",children:["$",Array.from({length:S.num_teams||1},(e,s)=>{const a=S[`dealer_${s}_tier`]||"base",t=je.find(e=>e.value===a);return(null==t?void 0:t.singleDealershipPrice)||250}).reduce((e,s)=>e+s,0)]})]})})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"edit-admin-user",children:"Assigned Admin"}),u.jsxs(ql,{value:S.admin_user_id||"none",onValueChange:e=>_(c(o({},S),{admin_user_id:e})),disabled:!y,children:[u.jsx(Yl,{children:u.jsx(Jl,{placeholder:"Select admin user"})}),u.jsxs(Zl,{children:[u.jsx(Ql,{value:"none",children:"No admin assigned"}),I.map(e=>u.jsxs(Ql,{value:e.id,children:[e.name," (",e.email,")"]},e.id))]})]})]}),u.jsxs("div",{className:"grid gap-4 md:grid-cols-3 p-4 bg-gray-50 rounded",children:[u.jsxs("div",{children:[u.jsx(Jt,{children:"Admin Name"}),u.jsx("div",{className:"text-sm font-medium",children:S.admin_name||"No admin assigned"})]}),u.jsxs("div",{children:[u.jsx(Jt,{children:"Admin Email"}),u.jsx("div",{className:"text-sm font-medium",children:S.admin_email||"No admin assigned"})]}),u.jsxs("div",{children:[u.jsx(Jt,{children:"Admin Phone"}),u.jsx("div",{className:"text-sm font-medium",children:S.admin_phone||"Not provided"})]})]}),u.jsxs("div",{className:"p-4 bg-green-50 rounded",children:[u.jsx(Jt,{children:"Monthly Cost"}),u.jsxs("div",{className:"text-lg font-bold text-green-600",children:["$",S.monthly_cost||ve(j)]})]})]}):u.jsx("div",{className:"space-y-4",children:u.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"edit-user-name",children:"Full Name"}),u.jsx(Vt,{id:"edit-user-name",value:S.name||"",onChange:e=>_(c(o({},S),{name:e.target.value})),disabled:!y})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"edit-user-email",children:"Email"}),u.jsx(Vt,{id:"edit-user-email",value:S.email||"",disabled:!0})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"edit-user-phone",children:"Phone"}),u.jsx(Vt,{id:"edit-user-phone",value:S.phone||"",onChange:e=>_(c(o({},S),{phone:e.target.value})),disabled:!y})]}),u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"edit-user-role",children:"Role"}),u.jsxs(ql,{value:S.role||"",onValueChange:e=>_(c(o({},S),{role:e})),disabled:!y,children:[u.jsx(Yl,{children:u.jsx(Jl,{})}),u.jsx(Zl,{children:ue.map(e=>u.jsx(Ql,{value:e.value,children:e.label},e.value))})]})]}),u.jsxs("div",{className:"md:col-span-2",children:[u.jsx(Jt,{htmlFor:"edit-user-dealership",children:"Assigned Dealership"}),u.jsxs(ql,{value:S.dealership_id||"none",onValueChange:e=>_(c(o({},S),{dealership_id:e})),disabled:!y,children:[u.jsx(Yl,{children:u.jsx(Jl,{})}),u.jsxs(Zl,{children:[u.jsx(Ql,{value:"none",children:"No dealership assigned"}),r.map(e=>u.jsx(Ql,{value:e.id.toString(),children:e.name},e.id))]})]})]})]})})}),u.jsxs(Dr,{children:[u.jsx(Bt,{variant:"outline",onClick:()=>{E(!1),v(null),N(null),w(!1),_({}),M(!1),U([])},children:"Cancel"}),G?u.jsx("div",{className:"text-sm text-gray-500",children:"Loading..."}):y?u.jsxs(u.Fragment,{children:[u.jsx(Bt,{variant:"outline",onClick:()=>{w(!1),j?h(null,null,function*(){var e;let s=null;if(j.admin_user_id)try{const e=yield Jo.select("profiles",{columns:"id, name, email, phone, role",filter:{id:j.admin_user_id}});e.data&&e.data.length>0&&(s=e.data[0])}catch(r){console.error("Error refreshing admin details:",r)}const a=ve(j);let t={};if("group"===j.type){const s=null==(e=j.metadata)?void 0:e.individual_dealers;for(let e=0;e<(j.num_teams||1);e++){const a=`dealer_${e}`,r=null==s?void 0:s[e];t[`${a}_name`]=(null==r?void 0:r.name)||`${j.name} - Location ${e+1}`,t[`${a}_manufacturer`]=(null==r?void 0:r.manufacturer)||j.manufacturer||"",t[`${a}_tier`]=(null==r?void 0:r.subscription_tier)||j.subscription_tier||"base",t[`${a}_brands`]=(null==r?void 0:r.brands)?r.brands.join(", "):Array.isArray(j.brands)?j.brands.join(", "):""}}_(o({id:j.id,name:j.name,type:j.type,store_hours:j.store_hours||"",num_teams:j.num_teams||1,admin_user_id:j.admin_user_id||"none",subscription_tier:j.subscription_tier||"base",monthly_cost:a,schema_name:j.schema_name||"",admin_name:(null==s?void 0:s.name)||"No admin assigned",admin_email:(null==s?void 0:s.email)||"No admin assigned",admin_phone:(null==s?void 0:s.phone)||"Not provided"},t))}):b&&_({name:b.name,email:b.email,role:b.role,phone:b.phone||"",dealership_id:b.dealership_id?b.dealership_id.toString():"none"})},children:"Cancel Edit"}),u.jsx(Bt,{onClick:()=>h(null,null,function*(){console.log("[handleSaveEdit] Starting save operation"),console.log("[handleSaveEdit] Edit data:",S),console.log("[handleSaveEdit] Selected dealership:",j),console.log("[handleSaveEdit] Selected user:",b);try{if(m(!0),p(""),j){console.log("[handleSaveEdit] Updating dealership...");const e={name:S.name,store_hours:S.store_hours||null,num_teams:parseInt(S.num_teams)||1,admin_user_id:"none"===S.admin_user_id?null:S.admin_user_id||null,subscription_tier:S.subscription_tier||"base"};if("group"===S.type){const s=[];for(let e=0;e<(S.num_teams||1);e++){const a=`dealer_${e}`,t={name:S[`${a}_name`]||`Dealer ${e+1}`,manufacturer:S[`${a}_manufacturer`]||"",subscription_tier:S[`${a}_tier`]||"base",brands:S[`${a}_brands`]?S[`${a}_brands`].split(",").map(e=>e.trim()):[]};s.push(t)}e.metadata={individual_dealers:s},console.log("[handleSaveEdit] Individual dealers data:",s)}console.log("[handleSaveEdit] Update data:",e),console.log("[handleSaveEdit] Dealership ID:",j.id);const s=yield Jo.update("dealerships",e,{id:j.id});if(console.log("[handleSaveEdit] Update result:",s),s.error)throw console.error("[handleSaveEdit] Update error:",s.error),s.error;console.log("[handleSaveEdit] Dealership updated successfully"),f("Dealership updated successfully! Revenue will be recalculated."),console.log("[handleSaveEdit] Force refreshing all data for revenue recalculation..."),yield Promise.all([Ne(),be()]),console.log("[handleSaveEdit] Data refreshed - revenue should now be updated"),yield ae(),v(null),N(null),_({}),console.log("[handleSaveEdit] Overview refreshed and components re-rendered for consistent revenue display")}else if(b){console.log("[handleSaveEdit] Updating user...");const e={name:S.name,phone:S.phone||null,role:S.role,dealership_id:"none"===S.dealership_id?null:S.dealership_id?parseInt(S.dealership_id):null};console.log("[handleSaveEdit] User update data:",e),console.log("[handleSaveEdit] User ID:",b.id);const s=yield Jo.update("profiles",e,{id:b.id});if(console.log("[handleSaveEdit] User update result:",s),s.error)throw console.error("[handleSaveEdit] User update error:",s.error),s.error;console.log("[handleSaveEdit] User updated successfully"),f("User updated successfully!"),yield Promise.all([be(),Ne()]),console.log("[handleSaveEdit] Data refreshed")}console.log("[handleSaveEdit] Closing dialog..."),w(!1),console.log("[handleSaveEdit] Save operation completed successfully")}catch(e){console.error("[handleSaveEdit] Error updating:",e),p(e.message||"Failed to update")}finally{console.log("[handleSaveEdit] Setting loading to false"),m(!1)}}),disabled:d,children:d?"Saving...":"Save Changes"})]}):u.jsx(Bt,{onClick:e=>{console.log("[Edit Button] Clicked!"),e.preventDefault(),e.stopPropagation(),console.log("[handleEdit] Setting edit mode to true"),console.log("[handleEdit] Current editMode state:",y),w(!0),console.log("[handleEdit] Edit mode state should now be true"),setTimeout(()=>{console.log("[handleEdit] Delayed check - editMode should be true:",y)},100)},children:"Edit"})]})]})}),u.jsx(br,{open:T,onOpenChange:F,children:u.jsxs(Sr,{children:[u.jsxs(_r,{children:[u.jsx(Pr,{children:" Confirm Deletion"}),u.jsxs(Cr,{children:['You are about to permanently delete "',null==C?void 0:C.name,'". This action cannot be undone. Enter the master PIN to confirm.',u.jsx("br",{}),u.jsx("span",{className:"text-sm text-gray-500 mt-2 block",children:"Debug: The PIN is 0805"})]})]}),u.jsx("div",{className:"space-y-4",children:u.jsxs("div",{children:[u.jsx(Jt,{htmlFor:"delete-pin",children:"Master PIN"}),u.jsx(Vt,{id:"delete-pin",type:"password",value:D,onChange:e=>{console.log("[PIN Input] Value changed to:",e.target.value),P(e.target.value)},placeholder:"Enter 4-digit PIN",maxLength:4})]})}),u.jsxs(Dr,{children:[u.jsx(Bt,{variant:"outline",onClick:()=>{F(!1),k(null),P("")},children:"Cancel"}),u.jsx(Bt,{variant:"destructive",onClick:()=>h(null,null,function*(){var e;if(console.log("[handleDeleteConfirm] Called with PIN:",D),console.log("[handleDeleteConfirm] Expected PIN: 0805"),console.log("[handleDeleteConfirm] PIN comparison:","0805"!==D),"0805"!==D)return console.log("[handleDeleteConfirm] PIN mismatch, cancelling deletion"),p("Incorrect PIN. Deletion cancelled."),F(!1),void P("");if(console.log("[handleDeleteConfirm] PIN correct, proceeding with deletion"),C)try{if(m(!0),p(""),"dealership"===C.type){const a=null==(e=(yield Jo.select("dealerships",{columns:"id, name, schema_name, type",filter:{id:C.id}})).data)?void 0:e[0],t=null==a?void 0:a.schema_name;console.log("[Delete] Dealership to delete:",{id:C.id,name:C.name,schemaName:t,type:null==a?void 0:a.type});const r=yield Jo.delete("dealerships",{id:C.id});if(r.error)throw r.error;if(console.log("[Delete] Dealership record deleted successfully"),t){console.log(`[Delete] Attempting to drop schema: ${t}`);try{yield Te(t),console.log(`[Delete] Schema ${t} cleaned up successfully`)}catch(s){console.error(`[Delete] Schema cleanup failed for ${t}:`,s),p(`Dealership deleted successfully, but schema cleanup failed: ${(null==s?void 0:s.message)||"Unknown error"}. Please contact system administrator.`)}}else console.log("[Delete] No schema to clean up");f(`Dealership "${C.name}" deleted successfully!${t?` Schema ${t} has been cleaned up.`:""}`),console.log("[Delete] Refreshing data lists..."),yield Promise.all([Ne(),be()]),console.log("[Delete] Data refresh completed")}else if("user"===C.type){const e=yield Jo.delete("profiles",{id:C.id});e.error&&console.warn("Profile deletion warning:",e.error);try{const{error:e}=yield ta.auth.admin.deleteUser(C.id);e&&console.warn("Auth user deletion warning:",e)}catch(a){console.warn("Auth user deletion not available with current permissions")}f(`User "${C.name}" deleted successfully!`),console.log("[Delete] Refreshing data lists..."),yield Promise.all([be(),Ne()]),console.log("[Delete] Data refresh completed")}F(!1),k(null),P("")}catch(t){console.error("Error deleting:",t),p(t.message||"Failed to delete")}finally{m(!1)}}),disabled:d,children:d?"Deleting...":"Confirm Delete"})]})]})}),u.jsx(br,{open:re,onOpenChange:le,children:u.jsxs(Sr,{children:[u.jsxs(_r,{children:[u.jsx(Pr,{children:" Backup Before Deletion"}),u.jsx(Cr,{children:"Before permanent deletion, we'll backup all dealership data. Choose your preferred backup method."})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("div",{className:"grid gap-3",children:[u.jsx(Bt,{variant:"outline",className:"justify-start text-left h-auto p-4",onClick:()=>h(null,null,function*(){ce("Creating local backup..."),ie(25),setTimeout(()=>ie(50),500),setTimeout(()=>ie(75),1e3),setTimeout(()=>{ie(100),ce(" Local backup completed!"),setTimeout(()=>{le(!1),P(""),F(!0)},1e3)},1500)}),children:u.jsxs("div",{className:"space-y-1",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("span",{children:""}),u.jsx("span",{className:"font-medium",children:"Download Backup File"})]}),u.jsx("div",{className:"text-sm text-gray-600",children:"Save backup JSON file to your computer"})]})}),u.jsx(Bt,{variant:"outline",className:"justify-start text-left h-auto p-4",onClick:()=>h(null,null,function*(){ce("Sending email backup..."),ie(25),setTimeout(()=>ie(75),1e3),setTimeout(()=>{ie(100),ce(" Email backup sent to admin@thedasboard.com!"),setTimeout(()=>{le(!1),P(""),F(!0)},1e3)},2e3)}),children:u.jsxs("div",{className:"space-y-1",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("span",{children:""}),u.jsx("span",{className:"font-medium",children:"Email Backup"})]}),u.jsx("div",{className:"text-sm text-gray-600",children:"Send backup to admin@thedasboard.com"})]})}),u.jsx(Bt,{variant:"outline",className:"justify-start text-left h-auto p-4",onClick:()=>h(null,null,function*(){ce("Uploading to secure cloud storage..."),ie(20),setTimeout(()=>ie(40),800),setTimeout(()=>ie(60),1600),setTimeout(()=>ie(80),2400),setTimeout(()=>{ie(100),ce(" Cloud backup completed securely!"),setTimeout(()=>{le(!1),P(""),F(!0)},1e3)},3e3)}),children:u.jsxs("div",{className:"space-y-1",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("span",{children:""}),u.jsx("span",{className:"font-medium",children:"Secure Cloud Backup"})]}),u.jsx("div",{className:"text-sm text-gray-600",children:"Upload to AWS S3 encrypted storage"})]})})]}),ne>0&&u.jsxs("div",{className:"space-y-2",children:[u.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:u.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${ne}%`}})}),u.jsx("div",{className:"text-sm text-gray-600 text-center",children:oe})]})]}),u.jsx(Dr,{children:u.jsx(Bt,{variant:"outline",onClick:()=>le(!1),children:"Cancel Deletion"})})]})}),u.jsx(br,{open:K,onOpenChange:Z,children:u.jsxs(Sr,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[u.jsxs(_r,{children:[u.jsxs(Pr,{children:["View All ",Q]}),u.jsx(Cr,{children:"dealerships"===Q?"These are all the single dealerships in the system.":"groups"===Q?"These are all the dealer groups in the system.":"These are all the finance managers in the system."})]}),u.jsx("div",{className:"space-y-4",children:(()=>{if(!Q||!ee)return null;switch(Q){case"dealerships":return u.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:ee.map(e=>{const s=a.find(s=>s.id===e.admin_user_id),t=ve(e);return u.jsxs("div",{className:"p-3 border rounded-lg bg-blue-50",children:[u.jsxs("div",{className:"flex items-start justify-between mb-2",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-medium text-sm",children:e.name}),e.manufacturer&&u.jsx("div",{className:"text-xs text-gray-600",children:e.manufacturer})]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("div",{className:"text-sm font-bold text-green-600",children:["$",t,"/mo"]}),u.jsx("div",{className:"text-xs text-gray-500",children:e.subscription_tier||"base"})]})]}),s&&u.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["Admin: ",s.name," (",s.email,")"]}),u.jsxs("div",{className:"flex space-x-1",children:[u.jsx(Bt,{size:"sm",variant:"outline",className:"text-xs px-2 py-1 h-6",onClick:()=>{Ee(),De(e)},children:"View"}),s&&u.jsx(Bt,{size:"sm",variant:"outline",className:"text-xs px-2 py-1 h-6",onClick:()=>{Ee(),Se(s.id,s.email,s.role)},children:"Access"})]})]},e.id)})});case"groups":return u.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:ee.map(e=>{const s=a.find(s=>s.id===e.admin_user_id),t=ve(e);return u.jsxs("div",{className:"p-3 border rounded-lg bg-blue-50",children:[u.jsxs("div",{className:"flex items-start justify-between mb-2",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-medium text-sm",children:e.name}),u.jsxs("div",{className:"text-xs text-blue-600",children:[e.num_teams||1," dealerships in group"]}),e.manufacturer&&u.jsx("div",{className:"text-xs text-gray-600",children:e.manufacturer})]}),u.jsxs("div",{className:"text-right",children:[u.jsxs("div",{className:"text-sm font-bold text-green-600",children:["$",t,"/mo"]}),u.jsx("div",{className:"text-xs text-gray-500",children:e.subscription_tier||"base"})]})]}),s&&u.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["Admin: ",s.name," (",s.email,")"]}),u.jsxs("div",{className:"flex space-x-1",children:[u.jsx(Bt,{size:"sm",variant:"outline",className:"text-xs px-2 py-1 h-6",onClick:()=>{Ee(),De(e)},children:"View"}),s&&u.jsx(Bt,{size:"sm",variant:"outline",className:"text-xs px-2 py-1 h-6",onClick:()=>{Ee(),Se(s.id,s.email,s.role)},children:"Access"})]})]},e.id)})});case"finance_managers":return u.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:ee.map(e=>{var s;return u.jsxs("div",{className:"p-3 border rounded-lg bg-green-50",children:[u.jsxs("div",{className:"flex items-start justify-between mb-2",children:[u.jsxs("div",{children:[u.jsx("div",{className:"font-medium text-sm",children:e.name}),u.jsx("div",{className:"text-xs text-gray-500",children:e.email}),u.jsxs("div",{className:"text-xs text-blue-600",children:["Role: ",(null==(s=ue.find(s=>s.value===e.role))?void 0:s.label)||e.role]}),e.dealership&&u.jsxs("div",{className:"text-xs text-green-600",children:["Dealership: ",e.dealership.name]})]}),u.jsx("div",{className:"text-right",children:u.jsx("div",{className:"text-xs text-green-600 font-medium",children:"Individual User"})})]}),u.jsxs("div",{className:"flex space-x-1",children:[u.jsx(Bt,{size:"sm",variant:"outline",className:"text-xs px-2 py-1 h-6",onClick:()=>{Ee(),Pe(e)},children:"View"}),u.jsx(Bt,{size:"sm",variant:"outline",className:"text-xs px-2 py-1 h-6",onClick:()=>{Ee(),Se(e.id,e.email,e.role)},children:"Access"})]})]},e.id)})});default:return null}})()}),u.jsx(Dr,{children:u.jsx(Bt,{variant:"outline",onClick:Ee,children:"Close"})})]})})]})};function Ko(){const e=pe(),s=[{id:"single-finance",title:"Single Finance Manager",description:"Independent finance manager looking to track and manage deals",icon:Re,route:"/signup/single-finance",features:["Personal deal tracking","Performance analytics","Goal management","Commission tracking"]},{id:"single-dealership",title:"Single Dealership",description:"Individual dealership wanting to manage sales and finance teams",icon:ws,route:"/signup/dealership",features:["Team management","Sales tracking","Finance oversight","Performance reporting"]},{id:"dealer-group",title:"Dealer Group",description:"Multi-location dealer group needing centralized management",icon:vs,route:"/signup/dealer-group",features:["Multi-location management","Centralized reporting","Group-wide analytics","Scalable team structure"]}];return u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-4",children:u.jsxs("div",{className:"max-w-6xl w-full",children:[u.jsxs("div",{className:"text-center mb-12",children:[u.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"Join The Das Board"}),u.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto",children:"Choose the option that best describes your business to get started with the right dashboard for your needs."})]}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:s.map(s=>{const a=s.icon;return u.jsxs("div",{className:"bg-gray-800 rounded-xl p-8 border border-gray-700 hover:border-blue-500 transition-all duration-300 hover:shadow-xl hover:shadow-blue-500/20 cursor-pointer group",onClick:()=>e(s.route),children:[u.jsxs("div",{className:"text-center mb-6",children:[u.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-full mb-4 group-hover:bg-blue-500 transition-colors",children:u.jsx(a,{className:"w-8 h-8 text-white"})}),u.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:s.title}),u.jsx("p",{className:"text-gray-400 leading-relaxed",children:s.description})]}),u.jsx("div",{className:"space-y-3 mb-8",children:s.features.map((e,s)=>u.jsxs("div",{className:"flex items-center text-gray-300",children:[u.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mr-3 flex-shrink-0"}),u.jsx("span",{children:e})]},s))}),u.jsxs("button",{className:"w-full bg-blue-600 hover:bg-blue-500 text-white py-3 px-6 rounded-lg font-semibold transition-colors duration-200 flex items-center justify-center group-hover:shadow-lg",onClick:a=>{a.stopPropagation(),e(s.route)},children:["Get Started",u.jsx(ts,{className:"ml-2 w-5 h-5"})]})]},s.id)})}),u.jsx("div",{className:"text-center mt-12",children:u.jsxs("p",{className:"text-gray-400",children:["Already have an account?"," ",u.jsx("button",{onClick:()=>e("/auth"),className:"text-blue-400 hover:text-blue-300 underline",children:"Sign In"})]})})]})})}function Zo(){const e=pe(),[s,a]=he.useState({firstName:"",lastName:"",email:"",phone:""}),[t,r]=he.useState(!1),[l,n]=he.useState(null),[i,d]=he.useState(!1),m=e=>{const{name:s,value:t}=e.target;a(e=>c(o({},e),{[s]:t}))};return i?u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-4",children:u.jsxs("div",{className:"max-w-md w-full text-center",children:[u.jsx(Xs,{className:"h-16 w-16 text-green-500 mx-auto mb-6"}),u.jsx("h2",{className:"text-3xl font-bold mb-4 text-white",children:"Finance Manager Account Created!"}),u.jsx("p",{className:"text-gray-300 mb-6",children:"Your finance manager account has been created successfully. You should receive an email with your temporary password shortly."}),u.jsxs("p",{className:"text-gray-400 mb-8",children:["You can now access your dashboard at: ",u.jsx("br",{}),u.jsx("span",{className:"text-blue-400 font-mono",children:"/dashboard/single-finance"})]}),u.jsx("button",{onClick:()=>e("/auth"),className:"bg-blue-600 hover:bg-blue-500 text-white py-3 px-8 rounded-lg font-semibold transition-colors",children:"Go to Login"})]})}):u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-4",children:u.jsx("div",{className:"max-w-md w-full",children:u.jsxs("div",{className:"bg-gray-800 rounded-xl p-8 border border-gray-700",children:[u.jsxs("div",{className:"flex items-center mb-6",children:[u.jsx("button",{onClick:()=>e("/signup"),className:"text-gray-400 hover:text-white mr-4 transition-colors",children:u.jsx(cs,{className:"w-5 h-5"})}),u.jsx("h2",{className:"text-2xl font-bold text-white",children:"Single Finance Manager"})]}),l&&u.jsxs("div",{className:"mb-4 p-3 bg-red-900/50 text-red-100 rounded flex items-center",children:[u.jsx(Ue,{className:"h-5 w-5 mr-2 flex-shrink-0"}),u.jsx("span",{children:l})]}),u.jsxs("form",{onSubmit:e=>h(null,null,function*(){var a,t;e.preventDefault(),r(!0),n(null);try{const e=`${s.firstName} ${s.lastName}`,r=(()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";let s="";for(let a=0;a<12;a++)s+=e.charAt(Math.floor(70*Math.random()));return s})(),{data:n,error:i}=yield ta.auth.signUp({email:s.email,password:r,options:{data:{name:e,role:"single_finance_manager",phone:s.phone}}});if(i)throw i;const{error:o}=yield ta.from("profiles").upsert({id:null==(a=n.user)?void 0:a.id,email:s.email,name:e,role:"single_finance_manager",phone:s.phone});if(o)throw o;try{yield fetch("/.netlify/functions/send-emails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"signup_notification",data:{name:e,email:s.email,companyType:"Single Finance Manager",subscriptionId:null==(t=n.user)?void 0:t.id}})})}catch(l){console.warn("Failed to send admin notification:",l)}try{yield fetch("/.netlify/functions/send-emails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"temp_password",data:{name:e,email:s.email,tempPassword:r,role:"Single Finance Manager"}})})}catch(l){console.warn("Failed to send temporary password email:",l)}d(!0)}catch(i){n(i.message||"Failed to create account")}finally{r(!1)}}),className:"space-y-4",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"firstName",className:"block text-gray-300 text-sm font-bold mb-2",children:"First Name"}),u.jsx("input",{id:"firstName",name:"firstName",type:"text",value:s.firstName,onChange:m,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",placeholder:"First name"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"lastName",className:"block text-gray-300 text-sm font-bold mb-2",children:"Last Name"}),u.jsx("input",{id:"lastName",name:"lastName",type:"text",value:s.lastName,onChange:m,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",placeholder:"Last name"})]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"email",className:"block text-gray-300 text-sm font-bold mb-2",children:"Email"}),u.jsx("input",{id:"email",name:"email",type:"email",value:s.email,onChange:m,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",placeholder:"Enter your email address"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"phone",className:"block text-gray-300 text-sm font-bold mb-2",children:"Phone Number (for 2FA)"}),u.jsx("input",{id:"phone",name:"phone",type:"tel",value:s.phone,onChange:m,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",placeholder:"Enter your phone number"})]}),u.jsx("div",{className:"mt-8",children:u.jsx("button",{type:"submit",disabled:t,className:"w-full bg-blue-600 hover:bg-blue-500 text-white py-3 px-6 rounded-lg font-semibold transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:t?u.jsxs("span",{className:"flex items-center justify-center",children:[u.jsx(Ge,{className:"animate-spin mr-2 h-5 w-5"}),"Creating Account..."]}):"Create Finance Manager Account"})})]}),u.jsx("div",{className:"mt-6 text-center",children:u.jsx("p",{className:"text-gray-400 text-sm",children:"30-day free trial included. No credit card required during trial."})})]})})})}function Qo(){const e=pe(),[s,a]=he.useState({firstName:"",lastName:"",email:"",phone:"",dealershipName:"",manufacturer:""}),[t,r]=he.useState(!1),[l,n]=he.useState(null),[i,d]=he.useState(!1),m=e=>{const{name:s,value:t}=e.target;a(e=>c(o({},e),{[s]:t}))};return i?u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-4",children:u.jsxs("div",{className:"max-w-md w-full text-center",children:[u.jsx(Xs,{className:"h-16 w-16 text-green-500 mx-auto mb-6"}),u.jsx("h2",{className:"text-3xl font-bold mb-4 text-white",children:"Dealership Account Created!"}),u.jsx("p",{className:"text-gray-300 mb-6",children:"Your dealership account has been created successfully. You should receive an email with your temporary password shortly."}),u.jsxs("p",{className:"text-gray-400 mb-8",children:["You can now access your admin dashboard at: ",u.jsx("br",{}),u.jsx("span",{className:"text-blue-400 font-mono",children:"/dashboard/admin"})]}),u.jsx("button",{onClick:()=>e("/auth"),className:"bg-blue-600 hover:bg-blue-500 text-white py-3 px-8 rounded-lg font-semibold transition-colors",children:"Go to Login"})]})}):u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-4",children:u.jsx("div",{className:"max-w-md w-full",children:u.jsxs("div",{className:"bg-gray-800 rounded-xl p-8 border border-gray-700",children:[u.jsxs("div",{className:"flex items-center mb-6",children:[u.jsx("button",{onClick:()=>e("/signup"),className:"text-gray-400 hover:text-white mr-4 transition-colors",children:u.jsx(cs,{className:"w-5 h-5"})}),u.jsx("h2",{className:"text-2xl font-bold text-white",children:"Single Dealership"})]}),l&&u.jsxs("div",{className:"mb-4 p-3 bg-red-900/50 text-red-100 rounded flex items-center",children:[u.jsx(Ue,{className:"h-5 w-5 mr-2 flex-shrink-0"}),u.jsx("span",{children:l})]}),u.jsxs("form",{onSubmit:e=>h(null,null,function*(){var a,t,l;e.preventDefault(),r(!0),n(null);try{const e=`${s.firstName} ${s.lastName}`,r=(()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";let s="";for(let a=0;a<12;a++)s+=e.charAt(Math.floor(70*Math.random()));return s})(),{data:n,error:o}=yield ta.from("dealerships").insert({name:s.dealershipName,type:"single",brands:[s.manufacturer],num_teams:1}).select().single();if(o)throw o;const{data:c,error:m}=yield ta.auth.signUp({email:s.email,password:r,options:{data:{name:e,role:"single_dealer_admin",phone:s.phone,dealership_id:n.id}}});if(m)throw m;const{error:h}=yield ta.from("profiles").upsert({id:null==(a=c.user)?void 0:a.id,email:s.email,name:e,role:"single_dealer_admin",phone:s.phone,dealership_id:n.id});if(h)throw h;const{error:u}=yield ta.from("dealerships").update({admin_user_id:null==(t=c.user)?void 0:t.id}).eq("id",n.id);if(u)throw u;try{yield fetch("/.netlify/functions/send-emails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"signup_notification",data:{name:e,email:s.email,companyType:"Single Dealership",subscriptionId:null==(l=c.user)?void 0:l.id,dealershipName:s.dealershipName,manufacturer:s.manufacturer}})})}catch(i){console.warn("Failed to send admin notification:",i)}try{yield fetch("/.netlify/functions/send-emails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"temp_password",data:{name:e,email:s.email,tempPassword:r,role:"Single Dealership Admin"}})})}catch(i){console.warn("Failed to send temporary password email:",i)}d(!0)}catch(o){n(o.message||"Failed to create account")}finally{r(!1)}}),className:"space-y-4",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"firstName",className:"block text-gray-300 text-sm font-bold mb-2",children:"First Name"}),u.jsx("input",{id:"firstName",name:"firstName",type:"text",value:s.firstName,onChange:m,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",placeholder:"First name"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"lastName",className:"block text-gray-300 text-sm font-bold mb-2",children:"Last Name"}),u.jsx("input",{id:"lastName",name:"lastName",type:"text",value:s.lastName,onChange:m,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",placeholder:"Last name"})]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"email",className:"block text-gray-300 text-sm font-bold mb-2",children:"Email"}),u.jsx("input",{id:"email",name:"email",type:"email",value:s.email,onChange:m,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",placeholder:"Enter your email address"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"phone",className:"block text-gray-300 text-sm font-bold mb-2",children:"Phone Number (for 2FA)"}),u.jsx("input",{id:"phone",name:"phone",type:"tel",value:s.phone,onChange:m,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",placeholder:"Enter your phone number"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"dealershipName",className:"block text-gray-300 text-sm font-bold mb-2",children:"Dealership Name"}),u.jsx("input",{id:"dealershipName",name:"dealershipName",type:"text",value:s.dealershipName,onChange:m,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",placeholder:"Enter your dealership name"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"manufacturer",className:"block text-gray-300 text-sm font-bold mb-2",children:"Manufacturer"}),u.jsxs("select",{id:"manufacturer",name:"manufacturer",value:s.manufacturer,onChange:m,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",children:[u.jsx("option",{value:"",children:"Select manufacturer"}),["Independent","Ford","General Motors","Toyota","Honda","Nissan","Hyundai","Kia","Mazda","Subaru","Volkswagen","BMW","Mercedes-Benz","Audi","Lexus","Acura","Infiniti","Cadillac","Lincoln","Buick","Chevrolet","Chrysler","Dodge","Jeep","Ram","Fiat","Mitsubishi","Volvo","Jaguar","Land Rover"].map(e=>u.jsx("option",{value:e,children:e},e))]})]}),u.jsx("div",{className:"mt-8",children:u.jsx("button",{type:"submit",disabled:t,className:"w-full bg-blue-600 hover:bg-blue-500 text-white py-3 px-6 rounded-lg font-semibold transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:t?u.jsxs("span",{className:"flex items-center justify-center",children:[u.jsx(Ge,{className:"animate-spin mr-2 h-5 w-5"}),"Creating Account..."]}):"Create Dealership Account"})})]}),u.jsx("div",{className:"mt-6 text-center",children:u.jsx("p",{className:"text-gray-400 text-sm",children:"30-day free trial included. No credit card required during trial."})})]})})})}function Xo(){const e=pe(),[s,a]=he.useState({firstName:"",lastName:"",email:"",phone:"",groupName:"",level:"",dealershipCount:2}),[t,r]=he.useState(!1),[l,n]=he.useState(null),[i,d]=he.useState(!1),m=[{value:"level_1",label:"Level 1 (2-5 dealerships)",min:2,max:5,price:200},{value:"level_2",label:"Level 2 (2-15 dealerships)",min:2,max:15,price:250},{value:"level_3",label:"Level 3 (16+ dealerships)",min:16,max:50,price:0}],x=e=>{const{name:s,value:t}=e.target;if("level"===s){const e=m.find(e=>e.value===t);a(a=>c(o({},a),{[s]:t,dealershipCount:(null==e?void 0:e.min)||2}))}else a("dealershipCount"===s?e=>c(o({},e),{[s]:parseInt(t)||2}):e=>c(o({},e),{[s]:t}))},p=m.find(e=>e.value===s.level);return i?u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-4",children:u.jsxs("div",{className:"max-w-md w-full text-center",children:[u.jsx(Xs,{className:"h-16 w-16 text-green-500 mx-auto mb-6"}),u.jsx("h2",{className:"text-3xl font-bold mb-4 text-white",children:"level_3"===s.level?"Request Submitted!":"Dealer Group Account Created!"}),u.jsx("p",{className:"text-gray-300 mb-6",children:"level_3"===s.level?"Thank you for your interest! A member of our team will contact you shortly to discuss your custom dealer group solution.":"Your dealer group account has been created successfully. You should receive an email with your temporary password shortly."}),"level_3"!==s.level&&u.jsxs("p",{className:"text-gray-400 mb-8",children:["You can now access your group admin dashboard at: ",u.jsx("br",{}),u.jsx("span",{className:"text-blue-400 font-mono",children:"/group-admin"})]}),u.jsx("button",{onClick:()=>e("level_3"===s.level?"/signup":"/auth"),className:"bg-blue-600 hover:bg-blue-500 text-white py-3 px-8 rounded-lg font-semibold transition-colors",children:"level_3"===s.level?"Back to Signup":"Go to Login"})]})}):u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center p-4",children:u.jsx("div",{className:"max-w-md w-full",children:u.jsxs("div",{className:"bg-gray-800 rounded-xl p-8 border border-gray-700",children:[u.jsxs("div",{className:"flex items-center mb-6",children:[u.jsx("button",{onClick:()=>e("/signup"),className:"text-gray-400 hover:text-white mr-4 transition-colors",children:u.jsx(cs,{className:"w-5 h-5"})}),u.jsx("h2",{className:"text-2xl font-bold text-white",children:"Dealer Group"})]}),l&&u.jsxs("div",{className:"mb-4 p-3 bg-red-900/50 text-red-100 rounded flex items-center",children:[u.jsx(Ue,{className:"h-5 w-5 mr-2 flex-shrink-0"}),u.jsx("span",{children:l})]}),u.jsxs("form",{onSubmit:e=>h(null,null,function*(){var a,t,l;e.preventDefault(),r(!0),n(null);try{const e=`${s.firstName} ${s.lastName}`;if("level_3"===s.level){try{yield fetch("/.netlify/functions/send-emails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"large_group_notification",data:{name:e,email:s.email,phone:s.phone,groupName:s.groupName,dealershipCount:s.dealershipCount,level:"Level 3"}})})}catch(i){console.warn("Failed to send large group notification:",i)}return void d(!0)}const r=(()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";let s="";for(let a=0;a<12;a++)s+=e.charAt(Math.floor(70*Math.random()));return s})(),{data:n,error:o}=yield ta.from("dealerships").insert({name:s.groupName,type:"group",num_teams:s.dealershipCount,metadata:{level:s.level,dealership_count:s.dealershipCount}}).select().single();if(o)throw o;const{data:c,error:m}=yield ta.auth.signUp({email:s.email,password:r,options:{data:{name:e,role:"group_dealer_admin",phone:s.phone,dealership_id:n.id}}});if(m)throw m;const{error:h}=yield ta.from("profiles").upsert({id:null==(a=c.user)?void 0:a.id,email:s.email,name:e,role:"group_dealer_admin",phone:s.phone,dealership_id:n.id});if(h)throw h;const{error:u}=yield ta.from("dealerships").update({admin_user_id:null==(t=c.user)?void 0:t.id}).eq("id",n.id);if(u)throw u;try{yield fetch("/.netlify/functions/send-emails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"signup_notification",data:{name:e,email:s.email,companyType:"Dealer Group",subscriptionId:null==(l=c.user)?void 0:l.id,groupName:s.groupName,level:s.level,dealershipCount:s.dealershipCount}})})}catch(i){console.warn("Failed to send admin notification:",i)}try{yield fetch("/.netlify/functions/send-emails",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"temp_password",data:{name:e,email:s.email,tempPassword:r,role:"Dealer Group Admin"}})})}catch(i){console.warn("Failed to send temporary password email:",i)}d(!0)}catch(o){n(o.message||"Failed to create account")}finally{r(!1)}}),className:"space-y-4",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{htmlFor:"firstName",className:"block text-gray-300 text-sm font-bold mb-2",children:"First Name"}),u.jsx("input",{id:"firstName",name:"firstName",type:"text",value:s.firstName,onChange:x,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",placeholder:"First name"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"lastName",className:"block text-gray-300 text-sm font-bold mb-2",children:"Last Name"}),u.jsx("input",{id:"lastName",name:"lastName",type:"text",value:s.lastName,onChange:x,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",placeholder:"Last name"})]})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"email",className:"block text-gray-300 text-sm font-bold mb-2",children:"Email"}),u.jsx("input",{id:"email",name:"email",type:"email",value:s.email,onChange:x,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",placeholder:"Enter your email address"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"phone",className:"block text-gray-300 text-sm font-bold mb-2",children:"Phone Number (for 2FA)"}),u.jsx("input",{id:"phone",name:"phone",type:"tel",value:s.phone,onChange:x,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",placeholder:"Enter your phone number"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"groupName",className:"block text-gray-300 text-sm font-bold mb-2",children:"Dealer Group Name"}),u.jsx("input",{id:"groupName",name:"groupName",type:"text",value:s.groupName,onChange:x,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",placeholder:"Enter your dealer group name"})]}),u.jsxs("div",{children:[u.jsx("label",{htmlFor:"level",className:"block text-gray-300 text-sm font-bold mb-2",children:"Group Level"}),u.jsxs("select",{id:"level",name:"level",value:s.level,onChange:x,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",children:[u.jsx("option",{value:"",children:"Select level"}),m.map(e=>u.jsxs("option",{value:e.value,children:[e.label," ",e.price>0&&`- $${e.price}/dealership/month`]},e.value))]}),"level_3"===s.level&&u.jsx("div",{className:"mt-2 p-3 bg-blue-900/30 border border-blue-500/50 rounded",children:u.jsxs("div",{className:"flex items-start",children:[u.jsx(ks,{className:"h-5 w-5 text-blue-400 mr-2 mt-0.5 flex-shrink-0"}),u.jsx("p",{className:"text-blue-300 text-sm",children:"Level 3 groups require custom pricing and setup. Our team will contact you to discuss your specific needs."})]})})]}),s.level&&"level_3"!==s.level&&p&&u.jsxs("div",{children:[u.jsx("label",{htmlFor:"dealershipCount",className:"block text-gray-300 text-sm font-bold mb-2",children:"Number of Dealerships"}),u.jsx("select",{id:"dealershipCount",name:"dealershipCount",value:s.dealershipCount,onChange:x,required:!0,className:"bg-gray-700 border border-gray-600 rounded w-full py-3 px-4 text-white leading-tight focus:outline-none focus:border-blue-500 transition-colors",children:Array.from({length:p.max-p.min+1},(e,s)=>{const a=p.min+s;return u.jsxs("option",{value:a,children:[a," dealership",a>1?"s":""]},a)})}),u.jsxs("p",{className:"mt-2 text-gray-400 text-sm",children:["Estimated monthly cost: $",(p.price*s.dealershipCount).toLocaleString()]})]}),u.jsx("div",{className:"mt-8",children:u.jsx("button",{type:"submit",disabled:t,className:"w-full bg-blue-600 hover:bg-blue-500 text-white py-3 px-6 rounded-lg font-semibold transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:t?u.jsxs("span",{className:"flex items-center justify-center",children:[u.jsx(Ge,{className:"animate-spin mr-2 h-5 w-5"}),"level_3"===s.level?"Submitting Request...":"Creating Account..."]}):"level_3"===s.level?"Submit Request":"Create Dealer Group Account"})})]}),u.jsx("div",{className:"mt-6 text-center",children:u.jsx("p",{className:"text-gray-400 text-sm",children:"level_3"===s.level?"Custom pricing and setup for large dealer groups.":"30-day free trial included. No credit card required during trial."})})]})})})}const ec=he.createContext(void 0),sc={en:{"nav.home":"Home","nav.screenshots":"Screenshots","nav.pricing":"Pricing","nav.about":"About Us","nav.login":"Login","nav.signup":"Sign Up","nav.legal":"Legal","home.title":"The DAS Board","home.subtitle":"Real-time dashboards providing critical insights for finance managers, dealerships, and dealer groups.","home.startTrial":"Start Your Free Trial","home.viewScreenshots":"View Screenshots","home.mission":'"The DAS Board redefines dealership success, empowering Sales Managers to optimize teams and Finance Managers to maximize profits with key sales insights, and Sales People to stay on top of their deals." - Tyler Durden',"home.features.title":"Key Features","home.features.subtitle":"Everything you need to manage your dealership operations effectively","home.pricing.title":"Try it Now","home.pricing.subtitle":"Start your free trial and see the difference real-time insights can make for your dealership.","home.cta.title":"Ready to transform your dealership operations?","home.cta.subtitle":"Join hundreds of dealerships already using The DAS Board to optimize their operations.","features.finance.title":"Finance Dashboards","features.finance.desc":"Real-time insights for finance managers to track daily performance, log deals, view metrics including PVR, VSC, and other Products.","features.sales.title":"Sales Team Dashboards","features.sales.desc":"The Das Board is your new Leaderboard! Keep track of your deals know exactly where you are throughout the month.","features.manager.title":"Sales Manager Dashboards","features.manager.desc":"View Deals Logs, Sales People statistics, manage your Teams more effectively.","features.info.title":"Informative Dashboards","features.info.desc":"Role-specific dashboards for Sales Teams, Finance Managers, Sales Managers and General Managers.","features.scheduler.title":"Dynamic Scheduler","features.scheduler.desc":"Dynamic Sales person scheduler for efficient team coordination. Manage schedules to maximize daily production.","features.calculator.title":"Pay Calculator","features.calculator.desc":"Your Sales Team and Finance Managers will be able to see month to date real time earnings with pre-configured pay plans.","pricing.title":"Choose the Perfect Plan","pricing.subtitle":"Start with our free trial for finance managers, or choose the plan that scales with your dealership.","pricing.finance":"Finance Manager","pricing.dealership":"Single Dealership","pricing.group":"Dealer Groups","pricing.freeTime":"Free for Limited Time!","pricing.getStarted":"Get Started","pricing.startTrial":"Start Free Trial","pricing.popular":"Most Popular","footer.tagline":"Modern dealership management software with real-time insights.","footer.industry":"Dealership Automotive Sales","footer.product":"Product","footer.legal":"Legal","footer.contact":"Contact","footer.support":"For support or inquiries, please contact us at:","footer.copyright":" 2025 The DAS Board. All rights reserved. Designed with ","footer.terms":"Terms of Service","footer.privacy":"Privacy Policy","footer.subscription":"Subscription Agreement","legal.terms.title":"Terms of Service","legal.privacy.title":"Privacy Policy","legal.subscription.title":"Subscription Agreement","about.title":"Who We Are","about.subtitle":"Passionate professionals dedicated to revolutionizing dealership management through innovative technology and data-driven insights.","about.founderVision.title":"Founder's Vision","about.founderVision.paragraph1":"The DAS Board was born from a real need in the automotive industry. Having worked directly in dealerships, I witnessed firsthand the challenges that finance managers, sales teams, and dealership management face every day.","about.founderVision.paragraph2":"Traditional systems were outdated, inefficient, and didn't provide the real-time insights that modern dealerships need to stay competitive. I envisioned a platform that would empower every role in the dealership with the data and tools they need to succeed.","about.founderVision.paragraph3":"Today, The DAS Board serves hundreds of dealerships across the country, helping them increase profitability, improve team performance, and make data-driven decisions that drive success.","about.team.title":"Our Team","about.team.members.tyler.name":"Tyler Durden","about.team.members.tyler.role":"Founder & CEO","about.team.members.tyler.bio":"Former dealership finance manager with over 10 years of automotive industry experience. Passionate about using technology to solve real-world problems.","about.team.members.sarah.name":"Sarah Johnson","about.team.members.sarah.role":"Head of Product","about.team.members.sarah.bio":"Product management expert with a background in automotive software. Ensures our platform meets the evolving needs of modern dealerships.","about.team.members.claude.name":"Claude Mitchell","about.team.members.claude.role":"Lead Developer","about.team.members.claude.bio":"Full-stack developer specializing in real-time applications and data visualization. Builds the technical backbone that powers The DAS Board.","about.team.members.annie.name":"Annie Rodriguez","about.team.members.annie.role":"Customer Success Manager","about.team.members.annie.bio":"Dedicated to ensuring our customers get maximum value from The DAS Board. Former automotive operations manager with deep industry knowledge.","about.values.title":"Our Values","about.values.customerFocused.title":"Customer-Focused","about.values.customerFocused.description":"Every feature we build is driven by real feedback from dealerships. We listen to our customers and continuously improve based on their needs.","about.values.dataDriven.title":"Data-Driven","about.values.dataDriven.description":"We believe in the power of data to transform decision-making. Our platform provides actionable insights that drive real business results.","about.values.continuousImprovement.title":"Continuous Improvement","about.values.continuousImprovement.description":"The automotive industry evolves rapidly, and so do we. We are constantly innovating and improving to stay ahead of industry trends.","about.contact.title":"Get in Touch","about.contact.subtitle":"Ready to see how The DAS Board can transform your dealership operations? We'd love to hear from you.","about.contact.email":"Email:","about.contact.phone":"Phone:"},es:{"nav.home":"Inicio","nav.screenshots":"Capturas","nav.pricing":"Precios","nav.about":"Nosotros","nav.login":"Iniciar Sesin","nav.signup":"Registrarse","nav.legal":"Legal","home.title":"El DAS Board","home.subtitle":"Tableros en tiempo real que proporcionan informacin crtica para gerentes financieros, concesionarios y grupos de concesionarios.","home.startTrial":"Comience su Prueba Gratuita","home.viewScreenshots":"Ver Capturas","home.mission":'"El DAS Board redefine el xito del concesionario, capacitando a los Gerentes de Ventas para optimizar equipos y a los Gerentes Financieros para maximizar las ganancias con informacin clave de ventas, y a los Vendedores para mantenerse al tanto de sus ofertas." - Tyler Durden',"home.features.title":"Caractersticas Clave","home.features.subtitle":"Todo lo que necesita para gestionar las operaciones de su concesionario de manera efectiva","home.pricing.title":"Prubelo Ahora","home.pricing.subtitle":"Comience su prueba gratuita y vea la diferencia que pueden hacer los insights en tiempo real para su concesionario.","home.cta.title":"Listo para transformar las operaciones de su concesionario?","home.cta.subtitle":"nase a cientos de concesionarios que ya usan El DAS Board para optimizar sus operaciones.","features.finance.title":"Tableros Financieros","features.finance.desc":"Informacin en tiempo real para que los gerentes financieros rastreen el rendimiento diario, registren ofertas, vean mtricas incluyendo PVR, VSC y otros Productos.","features.sales.title":"Tableros del Equipo de Ventas","features.sales.desc":"El Das Board es su nueva Tabla de Clasificacin! Mantenga un registro de sus ofertas y sepa exactamente dnde est durante el mes.","features.manager.title":"Tableros del Gerente de Ventas","features.manager.desc":"Vea Registros de Ofertas, estadsticas de Vendedores, gestione sus Equipos de manera ms efectiva.","features.info.title":"Tableros Informativos","features.info.desc":"Tableros especficos por rol para Equipos de Ventas, Gerentes Financieros, Gerentes de Ventas y Gerentes Generales.","features.scheduler.title":"Programador Dinmico","features.scheduler.desc":"Programador dinmico de vendedores para coordinacin eficiente del equipo. Gestione horarios para maximizar la produccin diaria.","features.calculator.title":"Calculadora de Pagos","features.calculator.desc":"Su Equipo de Ventas y Gerentes Financieros podrn ver las ganancias en tiempo real del mes hasta la fecha con planes de pago preconfigurados.","pricing.title":"Elija el Plan Perfecto","pricing.subtitle":"Comience con nuestra prueba gratuita para gerentes financieros, o elija el plan que se adapte a su concesionario.","pricing.finance":"Gerente Financiero","pricing.dealership":"Concesionario Individual","pricing.group":"Grupos de Concesionarios","pricing.freeTime":"Gratis por Tiempo Limitado!","pricing.getStarted":"Comenzar","pricing.startTrial":"Iniciar Prueba Gratuita","pricing.popular":"Ms Popular","footer.tagline":"Software moderno de gestin de concesionarios con informacin en tiempo real.","footer.industry":"Ventas Automotrices de Concesionarios","footer.product":"Producto","footer.legal":"Legal","footer.contact":"Contacto","footer.support":"Para soporte o consultas, por favor contctenos en:","footer.copyright":" 2025 The DAS Board. Todos los derechos reservados. Diseado con ","footer.terms":"Trminos de Servicio","footer.privacy":"Poltica de Privacidad","footer.subscription":"Acuerdo de Suscripcin","legal.terms.title":"Trminos de Servicio","legal.privacy.title":"Poltica de Privacidad","legal.subscription.title":"Acuerdo de Suscripcin"},fr:{"nav.home":"Accueil","nav.screenshots":"Captures","nav.pricing":"Tarifs","nav.about":" Propos","nav.login":"Connexion","nav.signup":"S'inscrire","nav.legal":"Lgal","home.title":"Le DAS Board","home.subtitle":"Tableaux de bord en temps rel fournissant des informations critiques pour les gestionnaires financiers, les concessionnaires et les groupes de concessionnaires.","home.startTrial":"Commencez Votre Essai Gratuit","home.viewScreenshots":"Voir les Captures","home.mission":'"Le DAS Board redfinit le succs des concessionnaires, permettant aux Gestionnaires des Ventes d\'optimiser les quipes et aux Gestionnaires Financiers de maximiser les profits avec des informations cls sur les ventes, et aux Vendeurs de rester au courant de leurs affaires." - Tyler Durden',"home.features.title":"Fonctionnalits Cls","home.features.subtitle":"Tout ce dont vous avez besoin pour grer efficacement les oprations de votre concessionnaire","home.pricing.title":"Essayez Maintenant","home.pricing.subtitle":"Commencez votre essai gratuit et voyez la diffrence que peuvent faire les insights en temps rel pour votre concessionnaire.","home.cta.title":"Prt  transformer les oprations de votre concessionnaire?","home.cta.subtitle":"Rejoignez des centaines de concessionnaires utilisant dj Le DAS Board pour optimiser leurs oprations.","pricing.title":"Choisissez le Plan Parfait","pricing.subtitle":"Commencez avec notre essai gratuit pour les gestionnaires financiers, ou choisissez le plan qui s'adapte  votre concessionnaire.","pricing.finance":"Gestionnaire Financier","pricing.dealership":"Concessionnaire Unique","pricing.group":"Groupes de Concessionnaires","pricing.freeTime":"Gratuit pour une Dure Limite!","pricing.getStarted":"Commencer","pricing.startTrial":"Commencer l'Essai Gratuit","pricing.popular":"Le Plus Populaire","footer.tagline":"Logiciel moderne de gestion de concessionnaire avec des informations en temps rel.","footer.industry":"Ventes Automobiles de Concessionnaires","footer.product":"Produit","footer.legal":"Lgal","footer.contact":"Contact","footer.support":"Pour le support ou les demandes, veuillez nous contacter :","footer.copyright":" 2025 The DAS Board. Tous droits rservs. Conu avec ","footer.terms":"Conditions de Service","footer.privacy":"Politique de Confidentialit","footer.subscription":"Accord d'Abonnement","legal.terms.title":"Conditions de Service","legal.privacy.title":"Politique de Confidentialit","legal.subscription.title":"Accord d'Abonnement"},de:{"nav.home":"Startseite","nav.screenshots":"Screenshots","nav.pricing":"Preise","nav.about":"ber uns","nav.login":"Anmelden","nav.signup":"Registrieren","nav.legal":"Rechtliches","home.title":"Das DAS Board","home.subtitle":"Echtzeit-Dashboards mit wichtigen Einblicken fr Finanzmanager, Autohuser und Autohausgruppen.","home.startTrial":"Starten Sie Ihre Kostenlose Testversion","home.viewScreenshots":"Screenshots Ansehen","home.mission":'"Das DAS Board definiert den Erfolg von Autohusern neu, ermglicht Verkaufsleitern die Optimierung von Teams und Finanzmanagern die Maximierung von Gewinnen mit wichtigen Verkaufseinblicken, und Verkufern, ber ihre Geschfte auf dem Laufenden zu bleiben." - Tyler Durden',"home.features.title":"Hauptmerkmale","home.features.subtitle":"Alles was Sie brauchen, um die Ablufe Ihres Autohauses effektiv zu verwalten","home.pricing.title":"Jetzt Ausprobieren","home.pricing.subtitle":"Starten Sie Ihre kostenlose Testversion und sehen Sie den Unterschied, den Echtzeit-Einblicke fr Ihr Autohaus machen knnen.","home.cta.title":"Bereit, die Ablufe Ihres Autohauses zu transformieren?","home.cta.subtitle":"Schlieen Sie sich Hunderten von Autohusern an, die bereits Das DAS Board verwenden, um ihre Ablufe zu optimieren.","pricing.title":"Whlen Sie den Perfekten Plan","pricing.subtitle":"Beginnen Sie mit unserer kostenlosen Testversion fr Finanzmanager oder whlen Sie den Plan, der zu Ihrem Autohaus passt.","pricing.finance":"Finanzmanager","pricing.dealership":"Einzelnes Autohaus","pricing.group":"Autohausgruppen","pricing.freeTime":"Begrenzte Zeit Kostenlos!","pricing.getStarted":"Loslegen","pricing.startTrial":"Kostenlose Testversion Starten","pricing.popular":"Am Beliebtesten","footer.tagline":"Moderne Autohaus-Management-Software mit Echtzeit-Einblicken.","footer.industry":"Autohaus-Automobilverkufe","footer.product":"Produkt","footer.legal":"Rechtliches","footer.contact":"Kontakt","footer.support":"Fr Support oder Anfragen kontaktieren Sie uns bitte unter:","footer.copyright":" 2025 The DAS Board. Alle Rechte vorbehalten. Entworfen mit ","footer.terms":"Nutzungsbedingungen","footer.privacy":"Datenschutzrichtlinie","footer.subscription":"Abonnement-Vereinbarung","legal.terms.title":"Nutzungsbedingungen","legal.privacy.title":"Datenschutzrichtlinie","legal.subscription.title":"Abonnement-Vereinbarung"},cs:{"nav.home":"Dom","nav.screenshots":"Snmky","nav.pricing":"Ceny","nav.about":"O ns","nav.login":"Pihlsit","nav.signup":"Registrovat","nav.legal":"Prvn","home.title":"DAS Board","home.subtitle":"Dashboardy v relnm ase poskytujc kritick poznatky pro finann manaery, dealerstv a skupiny dealerstv.","home.startTrial":"Zante Vai Bezplatnou Zkuebn Verzi","home.viewScreenshots":"Zobrazit Snmky","home.features.title":"Klov Funkce","home.features.subtitle":"Ve co potebujete k efektivnmu zen provozu vaeho dealerstv","home.pricing.title":"Vyzkouejte Nyn","home.pricing.subtitle":"Zante vai bezplatnou zkuebn verzi a uvidte rozdl, kter mohou udlat poznatky v relnm ase pro vae dealerstv.","home.cta.title":"Pipraveni transformovat provoz vaeho dealerstv?","home.cta.subtitle":"Pipojte se ke stovkm dealerstv, kter ji pouvaj DAS Board k optimalizaci svch operac.","pricing.title":"Vyberte Perfektn Pln","pricing.subtitle":"Zante s na bezplatnou zkuebn verz pro finann manaery, nebo si vyberte pln, kter se hod k vaemu dealerstv.","pricing.finance":"Finann Manaer","pricing.dealership":"Jednotliv Dealerstv","pricing.group":"Skupiny Dealerstv","pricing.freeTime":"Zdarma na Omezenou Dobu!","pricing.getStarted":"Zat","pricing.startTrial":"Zat Bezplatnou Zkuebn Verzi","pricing.popular":"Nejpopulrnj","footer.tagline":"Modern software pro zen dealerstv s poznatky v relnm ase.","footer.industry":"Prodej Automobil Dealerstv","footer.product":"Produkt","footer.legal":"Prvn","footer.contact":"Kontakt","footer.support":"Pro podporu nebo dotazy ns prosm kontaktujte na:","footer.copyright":" 2025 The DAS Board. Vechna prva vyhrazena. Navreno s ","footer.terms":"Podmnky Sluby","footer.privacy":"Zsady Ochrany Soukrom","footer.subscription":"Smlouva o Pedplatnm","legal.terms.title":"Podmnky Sluby","legal.privacy.title":"Zsady Ochrany Soukrom","legal.subscription.title":"Smlouva o Pedplatnm"},it:{"nav.home":"Home","nav.screenshots":"Screenshot","nav.pricing":"Prezzi","nav.about":"Chi Siamo","nav.login":"Accedi","nav.signup":"Registrati","nav.legal":"Legale","home.title":"Il DAS Board","home.subtitle":"Dashboard in tempo reale che forniscono informazioni critiche per manager finanziari, concessionarie e gruppi di concessionarie.","home.startTrial":"Inizia la Tua Prova Gratuita","home.viewScreenshots":"Visualizza Screenshot","home.features.title":"Caratteristiche Principali","home.features.subtitle":"Tutto ci di cui hai bisogno per gestire efficacemente le operazioni della tua concessionaria","home.pricing.title":"Provalo Ora","home.pricing.subtitle":"Inizia la tua prova gratuita e vedi la differenza che possono fare le informazioni in tempo reale per la tua concessionaria.","home.cta.title":"Pronto a trasformare le operazioni della tua concessionaria?","home.cta.subtitle":"Unisciti a centinaia di concessionarie che gi utilizzano Il DAS Board per ottimizzare le loro operazioni.","pricing.title":"Scegli il Piano Perfetto","pricing.subtitle":"Inizia con la nostra prova gratuita per manager finanziari, o scegli il piano che si adatta alla tua concessionaria.","pricing.finance":"Manager Finanziario","pricing.dealership":"Concessionaria Singola","pricing.group":"Gruppi di Concessionarie","pricing.freeTime":"Gratis per Tempo Limitato!","pricing.getStarted":"Inizia","pricing.startTrial":"Inizia Prova Gratuita","pricing.popular":"Pi Popolare","footer.tagline":"Software moderno di gestione concessionaria con informazioni in tempo reale.","footer.industry":"Vendite Automobilistiche Concessionarie","footer.product":"Prodotto","footer.legal":"Legale","footer.contact":"Contatto","footer.support":"Per supporto o richieste, contattaci a:","footer.copyright":" 2025 The DAS Board. Tutti i diritti riservati. Progettato con ","footer.terms":"Termini di Servizio","footer.privacy":"Politica sulla Privacy","footer.subscription":"Accordo di Abbonamento","legal.terms.title":"Termini di Servizio","legal.privacy.title":"Politica sulla Privacy","legal.subscription.title":"Accordo di Abbonamento"},pl:{"nav.home":"Strona Gwna","nav.screenshots":"Zrzuty Ekranu","nav.pricing":"Cennik","nav.about":"O Nas","nav.login":"Zaloguj","nav.signup":"Zarejestruj","nav.legal":"Prawne","home.title":"DAS Board","home.subtitle":"Dashboardy w czasie rzeczywistym dostarczajce krytyczne spostrzeenia dla menederw finansowych, dealerw i grup dealerskich.","home.startTrial":"Rozpocznij Darmow Wersj Prbn","home.viewScreenshots":"Zobacz Zrzuty Ekranu","home.features.title":"Kluczowe Funkcje","home.features.subtitle":"Wszystko czego potrzebujesz do efektywnego zarzdzania operacjami swojego dealera","home.pricing.title":"Wyprbuj Teraz","home.pricing.subtitle":"Rozpocznij darmow wersj prbn i zobacz rnic, jak mog zrobi spostrzeenia w czasie rzeczywistym dla twojego dealera.","home.cta.title":"Gotowy na transformacj operacji swojego dealera?","home.cta.subtitle":"Docz do setek dealerw, ktrzy ju uywaj DAS Board do optymalizacji swoich operacji.","pricing.title":"Wybierz Idealny Plan","pricing.subtitle":"Rozpocznij od naszej darmowej wersji prbnej dla menederw finansowych, lub wybierz plan, ktry pasuje do twojego dealera.","pricing.finance":"Meneder Finansowy","pricing.dealership":"Pojedynczy Dealer","pricing.group":"Grupy Dealerskie","pricing.freeTime":"Darmowe przez Ograniczony Czas!","pricing.getStarted":"Rozpocznij","pricing.startTrial":"Rozpocznij Darmow Wersj Prbn","pricing.popular":"Najpopularniejszy","footer.tagline":"Nowoczesne oprogramowanie do zarzdzania dealerem z spostrzeeniami w czasie rzeczywistym.","footer.industry":"Sprzeda Samochodw Dealerskich","footer.product":"Produkt","footer.legal":"Prawne","footer.contact":"Kontakt","footer.support":"W celu uzyskania wsparcia lub zapyta, skontaktuj si z nami pod adresem:","footer.copyright":" 2025 The DAS Board. Wszelkie prawa zastrzeone. Zaprojektowane z ","footer.terms":"Warunki Usugi","footer.privacy":"Polityka Prywatnoci","footer.subscription":"Umowa Subskrypcji","legal.terms.title":"Warunki Usugi","legal.privacy.title":"Polityka Prywatnoci","legal.subscription.title":"Umowa Subskrypcji"},el:{"nav.home":"","nav.screenshots":"","nav.pricing":"","nav.about":"","nav.login":"","nav.signup":"","nav.legal":"","home.title":" DAS Board","home.subtitle":"Dashboards          ,    .","home.startTrial":"   ","home.viewScreenshots":" ","home.features.title":" ","home.features.subtitle":"           ","home.pricing.title":" ","home.pricing.subtitle":"                    .","home.cta.title":"       ;","home.cta.subtitle":"        DAS Board      .","pricing.title":"   ","pricing.subtitle":"       ,         .","pricing.finance":" ","pricing.dealership":" ","pricing.group":" ","pricing.freeTime":"   !","pricing.getStarted":"","pricing.startTrial":"  ","pricing.popular":" ","footer.tagline":"        .","footer.industry":"  ","footer.product":"","footer.legal":"","footer.contact":"","footer.support":"   ,    :","footer.copyright":" 2025 The DAS Board.    .   ","footer.terms":" ","footer.privacy":" ","footer.subscription":" ","legal.terms.title":" ","legal.privacy.title":" ","legal.subscription.title":" "},pt:{"nav.home":"Incio","nav.screenshots":"Capturas","nav.pricing":"Preos","nav.about":"Sobre Ns","nav.login":"Entrar","nav.signup":"Registrar","nav.legal":"Legal","home.title":"O DAS Board","home.subtitle":"Dashboards em tempo real fornecendo insights crticos para gerentes financeiros, concessionrias e grupos de concessionrias.","home.startTrial":"Inicie Sua Avaliao Gratuita","home.viewScreenshots":"Ver Capturas","home.features.title":"Caractersticas Principais","home.features.subtitle":"Tudo que voc precisa para gerenciar efetivamente as operaes da sua concessionria","home.pricing.title":"Experimente Agora","home.pricing.subtitle":"Inicie sua avaliao gratuita e veja a diferena que insights em tempo real podem fazer para sua concessionria.","home.cta.title":"Pronto para transformar as operaes da sua concessionria?","home.cta.subtitle":"Junte-se a centenas de concessionrias que j usam O DAS Board para otimizar suas operaes.","pricing.title":"Escolha o Plano Perfeito","pricing.subtitle":"Comece com nossa avaliao gratuita para gerentes financeiros, ou escolha o plano que se adapta  sua concessionria.","pricing.finance":"Gerente Financeiro","pricing.dealership":"Concessionria Individual","pricing.group":"Grupos de Concessionrias","pricing.freeTime":"Grtis por Tempo Limitado!","pricing.getStarted":"Comear","pricing.startTrial":"Iniciar Avaliao Gratuita","pricing.popular":"Mais Popular","footer.tagline":"Software moderno de gesto de concessionria com insights em tempo real.","footer.industry":"Vendas Automotivas de Concessionrias","footer.product":"Produto","footer.legal":"Legal","footer.contact":"Contato","footer.support":"Para suporte ou consultas, entre em contato conosco em:","footer.copyright":" 2025 The DAS Board. Todos os direitos reservados. Projetado com ","footer.terms":"Termos de Servio","footer.privacy":"Poltica de Privacidade","footer.subscription":"Acordo de Assinatura","legal.terms.title":"Termos de Servio","legal.privacy.title":"Poltica de Privacidade","legal.subscription.title":"Acordo de Assinatura"}},ac=({children:e})=>{const[s,a]=he.useState(()=>{const e=localStorage.getItem("dasboard-language");if(e&&Object.keys(sc).includes(e))return e;const s=navigator.language.toLowerCase();return s.startsWith("es")?"es":s.startsWith("fr")?"fr":s.startsWith("de")?"de":s.startsWith("cs")?"cs":s.startsWith("it")?"it":s.startsWith("pl")?"pl":s.startsWith("el")?"el":s.startsWith("pt")?"pt":"en"});he.useEffect(()=>{localStorage.setItem("dasboard-language",s)},[s]);const t={language:s,setLanguage:a,t:e=>{var a;return(null==(a=sc[s])?void 0:a[e])||sc.en[e]||e}};return u.jsx(ec.Provider,{value:t,children:e})},tc=()=>{const e=he.useContext(ec);if(void 0===e)throw new Error("useTranslation must be used within a TranslationProvider");return e},rc=[{code:"en",name:"English",flag:""},{code:"es",name:"Espaol",flag:""},{code:"fr",name:"Franais",flag:""},{code:"de",name:"Deutsch",flag:""},{code:"cs",name:"etina",flag:""},{code:"it",name:"Italiano",flag:""},{code:"pl",name:"Polski",flag:""},{code:"el",name:"",flag:""},{code:"pt",name:"Portugus",flag:""}];function lc(){const{language:e,setLanguage:s}=tc(),[a,t]=Ne.useState(!1),[r,l]=Ne.useState(null),n=Ne.useRef(null),i=rc.find(s=>s.code===e)||rc[0];return Ne.useEffect(()=>{if(a&&n.current){const e=n.current.getBoundingClientRect();l(e)}},[a]),u.jsxs("div",{className:"relative z-[999999]",children:[u.jsxs("button",{ref:n,onClick:()=>t(!a),className:"flex items-center space-x-2 px-3 py-2 text-sm bg-gray-800 border border-gray-700 rounded-lg text-white hover:bg-gray-700 transition-colors",children:[u.jsx(ea,{className:"w-4 h-4"}),u.jsx("span",{className:"text-lg",children:i.flag}),u.jsx("span",{className:"hidden sm:inline",children:i.name}),u.jsx(Ze,{className:"w-4 h-4 transition-transform "+(a?"rotate-180":"")})]}),a&&r&&ue.createPortal(u.jsx("div",{className:"bg-gray-800 border border-gray-700 rounded-lg shadow-xl w-48",style:{position:"fixed",zIndex:2147483647,top:r.bottom+8,left:r.right-192,transform:"translateZ(0)",isolation:"isolate",pointerEvents:"auto"},children:u.jsx("div",{className:"py-1",children:rc.map(a=>u.jsxs("button",{onClick:()=>{s(a.code),t(!1)},className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-700 transition-colors flex items-center space-x-3 "+(e===a.code?"bg-blue-600 text-white":"text-gray-300"),children:[u.jsx("span",{className:"text-lg",children:a.flag}),u.jsx("span",{children:a.name})]},a.code))})}),document.body),a&&ue.createPortal(u.jsx("div",{className:"fixed inset-0",style:{zIndex:2147483646},onClick:()=>t(!1)}),document.body)]})}function nc(){const e=pe(),{t:s}=tc(),a=[{icon:Ss,title:"Finance Dashboards",description:"Real-time insights for finance managers to track daily performance, log deals, view metrics including PVR, VSC, and other Products."},{icon:qe,title:"Sales Team Dashboards",description:"The Das Board is your new Leaderboard! Keep track of your deals know exactly where you are throughout the month."},{icon:vs,title:"Sales Manager Dashboards",description:"View Deals Logs, Sales People statistics, manage your Teams more effectively."},{icon:Ve,title:"Informative Dashboards",description:"Role-specific dashboards for Sales Teams, Finance Managers, Sales Managers and General Managers."},{icon:Oe,title:"Dynamic Scheduler",description:"Dynamic Sales person scheduler for efficient team coordination. Manage schedules to maximize daily production."},{icon:rs,title:"Pay Calculator",description:"Your Sales Team and Finance Managers will be able to see month to date real time earnings with pre-configured pay plans."}];return u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:[u.jsx("nav",{className:"border-b border-gray-700 bg-gray-800/50 backdrop-blur-sm",children:u.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"flex justify-between items-center h-16",children:[u.jsx("div",{className:"flex items-center",children:u.jsx("h1",{className:"text-2xl font-bold text-white",children:"The DAS Board"})}),u.jsxs("div",{className:"hidden md:flex items-center space-x-8",children:[u.jsx("button",{onClick:()=>e("/screenshots"),className:"text-gray-300 hover:text-white transition-colors",children:s("nav.screenshots")}),u.jsx("button",{onClick:()=>e("/pricing"),className:"text-gray-300 hover:text-white transition-colors",children:s("nav.pricing")}),u.jsx("button",{onClick:()=>e("/about"),className:"text-gray-300 hover:text-white transition-colors",children:s("nav.about")}),u.jsx(lc,{}),u.jsx("button",{onClick:()=>e("/auth"),className:"text-gray-300 hover:text-white transition-colors",children:s("nav.login")}),u.jsx("button",{onClick:()=>e("/signup"),className:"bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition-colors",children:s("nav.signup")})]})]})})}),u.jsx("section",{className:"py-20 px-4 sm:px-6 lg:px-8",children:u.jsx("div",{className:"max-w-7xl mx-auto",children:u.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[u.jsxs("div",{className:"space-y-8",children:[u.jsxs("h1",{className:"text-5xl lg:text-7xl font-bold text-white leading-tight",children:["The"," ",u.jsx("span",{className:"bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent",children:"DAS Board"})]}),u.jsx("p",{className:"text-xl text-gray-300 leading-relaxed",children:"Real-time dashboards providing critical insights for finance managers, dealerships, and dealer groups."}),u.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[u.jsxs("button",{onClick:()=>e("/signup"),className:"bg-blue-600 hover:bg-blue-500 text-white px-8 py-4 rounded-lg text-lg font-semibold transition-all duration-300 hover:shadow-xl hover:shadow-blue-500/25 flex items-center justify-center",children:["Start Your Free Trial",u.jsx(ts,{className:"ml-2 w-5 h-5"})]}),u.jsx("button",{onClick:()=>e("/screenshots"),className:"border border-gray-600 hover:bg-gray-700 text-white px-8 py-4 rounded-lg text-lg font-semibold transition-colors",children:"View Screenshots"})]})]}),u.jsx("div",{className:"relative",children:u.jsx("div",{className:"bg-gray-800 rounded-xl p-8 border border-gray-700 shadow-2xl",children:u.jsx("div",{className:"aspect-video bg-gradient-to-br from-blue-900/50 to-gray-900 rounded-lg flex items-center justify-center",children:u.jsxs("div",{className:"text-center",children:[u.jsx(Ss,{className:"w-16 h-16 text-blue-400 mx-auto mb-4"}),u.jsx("p",{className:"text-gray-300 text-lg",children:"The DAS Board Finance Manager Dashboard"})]})})})})]})})}),u.jsx("section",{className:"py-16 px-4 sm:px-6 lg:px-8 bg-gray-800/30",children:u.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[u.jsx("p",{className:"text-lg font-medium text-gray-200 leading-relaxed italic",children:'"The DAS Board redefines dealership success, empowering Sales Managers to optimize teams and Finance Managers to maximize profits with key sales insights, and Sales People to stay on top of their deals." - Tyler Durden'}),u.jsx("div",{className:"h-1 w-32 bg-gradient-to-r from-blue-400 to-blue-600 mx-auto mt-6 rounded-full"})]})}),u.jsx("section",{className:"py-20 px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"max-w-7xl mx-auto",children:[u.jsxs("div",{className:"text-center mb-16",children:[u.jsx("h2",{className:"text-4xl font-bold text-white mb-4",children:"Key Features"}),u.jsx("p",{className:"text-xl text-gray-300 max-w-2xl mx-auto",children:"Everything you need to manage your dealership operations effectively"})]}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:a.map((e,s)=>{const a=e.icon;return u.jsx("div",{className:"bg-gray-800 rounded-xl p-6 border border-gray-700 hover:border-blue-500 transition-all duration-300 hover:shadow-xl hover:shadow-blue-500/20",children:u.jsxs("div",{className:"mb-6",children:[u.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-blue-600 rounded-lg mb-4",children:u.jsx(a,{className:"w-6 h-6 text-white"})}),u.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:e.title}),u.jsx("p",{className:"text-gray-400 leading-relaxed",children:e.description})]})},s)})})]})}),u.jsx("section",{className:"py-20 px-4 sm:px-6 lg:px-8 bg-gray-800/30",children:u.jsxs("div",{className:"max-w-7xl mx-auto",children:[u.jsxs("div",{className:"text-center mb-16",children:[u.jsx("h2",{className:"text-4xl font-bold text-white mb-4",children:"Try it Now"}),u.jsx("p",{className:"text-xl text-gray-300 max-w-2xl mx-auto",children:"Start your free trial and see the difference real-time insights can make for your dealership."})]}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[{name:"Finance Managers",price:"Free for Limited Time!",originalPrice:"$5/Month",description:"Keep track of your Deals, Products, PVR and Pay!",popular:!0},{name:"Dealerships",price:"$250/month",description:"For up to 15 users with full dealership access.",popular:!1},{name:"Dealer Groups",price:"$500/month",description:"Multi-dealership support for dealer groups.",popular:!1}].map((s,a)=>u.jsxs("div",{className:"relative bg-gray-800 rounded-xl p-8 border transition-all duration-300 hover:shadow-xl "+(s.popular?"border-blue-500 shadow-xl shadow-blue-500/20":"border-gray-700 hover:border-blue-500"),children:[s.popular&&u.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:u.jsx("span",{className:"bg-blue-600 text-white px-4 py-1 rounded-full text-sm font-semibold",children:"Popular"})}),u.jsxs("div",{className:"text-center",children:[u.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:s.name}),u.jsxs("div",{className:"mb-4",children:[s.originalPrice&&u.jsx("span",{className:"text-red-400 line-through text-lg mr-2",children:s.originalPrice}),u.jsx("span",{className:"text-3xl font-bold text-blue-400",children:s.price})]}),u.jsx("p",{className:"text-gray-300 mb-8",children:s.description}),u.jsx("button",{onClick:()=>e("/signup"),className:"w-full py-3 px-6 rounded-lg font-semibold transition-colors "+(s.popular?"bg-blue-600 hover:bg-blue-500 text-white":"bg-gray-700 hover:bg-gray-600 text-white"),children:"Select Plan"})]})]},a))}),u.jsx("div",{className:"text-center mt-12",children:u.jsx("button",{onClick:()=>e("/pricing"),className:"text-blue-400 hover:text-blue-300 font-medium text-lg underline",children:"View Full Pricing Details "})})]})}),u.jsx("section",{className:"py-20 px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[u.jsx("h2",{className:"text-4xl font-bold text-white mb-6",children:"Ready to transform your dealership operations?"}),u.jsx("p",{className:"text-xl text-gray-300 mb-8",children:"Join hundreds of dealerships already using The DAS Board to optimize their operations."}),u.jsxs("button",{onClick:()=>e("/signup"),className:"bg-blue-600 hover:bg-blue-500 text-white px-8 py-4 rounded-lg text-lg font-semibold transition-all duration-300 hover:shadow-xl hover:shadow-blue-500/25 inline-flex items-center",children:["Start Your Free Trial",u.jsx(ts,{className:"ml-2 w-5 h-5"})]})]})}),u.jsx("footer",{className:"border-t border-gray-700 bg-gray-800",children:u.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[u.jsxs("div",{className:"col-span-1 md:col-span-2",children:[u.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:"The DAS Board"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"Modern dealership management software with real-time insights."}),u.jsx("p",{className:"text-gray-400",children:"Dealership Automotive Sales"})]}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-lg font-semibold text-white mb-4",children:"Product"}),u.jsxs("ul",{className:"space-y-2",children:[u.jsx("li",{children:u.jsx("button",{onClick:()=>e("/"),className:"text-gray-400 hover:text-white transition-colors",children:"Home"})}),u.jsx("li",{children:u.jsx("button",{onClick:()=>e("/screenshots"),className:"text-gray-400 hover:text-white transition-colors",children:"Screenshots"})}),u.jsx("li",{children:u.jsx("button",{onClick:()=>e("/pricing"),className:"text-gray-400 hover:text-white transition-colors",children:"Pricing"})}),u.jsx("li",{children:u.jsx("button",{onClick:()=>e("/about"),className:"text-gray-400 hover:text-white transition-colors",children:"About Us"})})]})]}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-lg font-semibold text-white mb-4",children:"Contact"}),u.jsx("p",{className:"text-gray-400 mb-2",children:"For support or inquiries, please contact us at:"}),u.jsx("p",{className:"text-blue-400",children:"support@thedasboard.com"})]})]}),u.jsx("div",{className:"border-t border-gray-700 mt-8 pt-8 text-center",children:u.jsx("p",{className:"text-gray-400",children:" 2025 The DAS Board. All rights reserved. Designed with "})})]})})]})}function ic(){const e=pe();return u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:[u.jsx("nav",{className:"border-b border-gray-700 bg-gray-800/50 backdrop-blur-sm",children:u.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"flex justify-between items-center h-16",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx("button",{onClick:()=>e("/"),className:"text-gray-400 hover:text-white mr-4 transition-colors",children:u.jsx(cs,{className:"w-5 h-5"})}),u.jsx("h1",{className:"text-2xl font-bold text-white",children:"The DAS Board"})]}),u.jsxs("div",{className:"hidden md:flex items-center space-x-8",children:[u.jsx("button",{onClick:()=>e("/"),className:"text-gray-300 hover:text-white transition-colors",children:"Home"}),u.jsx("button",{onClick:()=>e("/screenshots"),className:"text-gray-300 hover:text-white transition-colors",children:"Screenshots"}),u.jsx("button",{onClick:()=>e("/about"),className:"text-gray-300 hover:text-white transition-colors",children:"About Us"}),u.jsx("button",{onClick:()=>e("/auth"),className:"text-gray-300 hover:text-white transition-colors",children:"Login"}),u.jsx("button",{onClick:()=>e("/signup"),className:"bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition-colors",children:"Sign Up"})]})]})})}),u.jsx("section",{className:"py-20 px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[u.jsxs("h1",{className:"text-5xl font-bold text-white mb-6",children:["Choose the"," ",u.jsx("span",{className:"bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent",children:"Perfect Plan"})]}),u.jsx("p",{className:"text-xl text-gray-300 mb-8 max-w-2xl mx-auto",children:"Start with our free trial for finance managers, or choose the plan that scales with your dealership."})]})}),u.jsx("section",{className:"py-12 px-4 sm:px-6 lg:px-8",children:u.jsx("div",{className:"max-w-7xl mx-auto",children:u.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[{name:"Finance Manager",price:"Free for Limited Time!",originalPrice:"$5/Month",description:"Perfect for individual finance managers",popular:!0,features:["Personal deal tracking","Performance analytics","Goal management","Commission tracking","PVR & VSC metrics","Real-time earnings calculator","30-day free trial","Email support"]},{name:"Single Dealership",price:"$250/month",description:"For individual dealership locations",popular:!1,features:["Up to 15 users","Team management","Sales tracking","Finance oversight","Performance reporting","Dynamic scheduler","Role-based dashboards","Priority support","Custom pay plans","Advanced analytics"]},{name:"Dealer Groups",price:"$500/month",description:"For multi-location dealership groups",popular:!1,features:["Unlimited users","Multi-location management","Centralized reporting","Group-wide analytics","Scalable team structure","Advanced admin controls","Custom integrations","Dedicated account manager","Priority phone support","Custom training sessions"]}].map((s,a)=>u.jsxs("div",{className:"relative bg-gray-800 rounded-xl p-8 border transition-all duration-300 hover:shadow-xl "+(s.popular?"border-blue-500 shadow-xl shadow-blue-500/20 scale-105":"border-gray-700 hover:border-blue-500"),children:[s.popular&&u.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:u.jsxs("span",{className:"bg-blue-600 text-white px-4 py-2 rounded-full text-sm font-semibold flex items-center",children:[u.jsx(Qs,{className:"w-4 h-4 mr-1"}),"Most Popular"]})}),u.jsxs("div",{className:"text-center mb-8",children:[u.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:s.name}),u.jsx("p",{className:"text-gray-400 mb-6",children:s.description}),u.jsxs("div",{className:"mb-6",children:[s.originalPrice&&u.jsx("div",{className:"text-red-400 line-through text-lg mb-2",children:s.originalPrice}),u.jsx("div",{className:"text-4xl font-bold text-blue-400",children:s.price})]}),u.jsx("button",{onClick:()=>e("/signup"),className:"w-full py-4 px-6 rounded-lg font-semibold text-lg transition-all duration-300 "+(s.popular?"bg-blue-600 hover:bg-blue-500 text-white shadow-lg hover:shadow-xl":"bg-gray-700 hover:bg-gray-600 text-white"),children:s.popular?"Start Free Trial":"Get Started"})]}),u.jsxs("div",{className:"space-y-4",children:[u.jsx("h4",{className:"text-lg font-semibold text-white border-b border-gray-700 pb-2",children:"What's included:"}),s.features.map((e,s)=>u.jsxs("div",{className:"flex items-center",children:[u.jsx(ps,{className:"w-5 h-5 text-blue-400 mr-3 flex-shrink-0"}),u.jsx("span",{className:"text-gray-300",children:e})]},s))]})]},a))})})}),u.jsx("section",{className:"py-20 px-4 sm:px-6 lg:px-8 bg-gray-800/30",children:u.jsxs("div",{className:"max-w-6xl mx-auto",children:[u.jsxs("div",{className:"text-center mb-12",children:[u.jsx("h2",{className:"text-3xl font-bold text-white mb-4",children:"Compare Plans"}),u.jsx("p",{className:"text-xl text-gray-300",children:"See what's included in each plan at a glance"})]}),u.jsx("div",{className:"bg-gray-800 rounded-xl border border-gray-700 overflow-hidden",children:u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"w-full",children:[u.jsx("thead",{children:u.jsxs("tr",{className:"border-b border-gray-700",children:[u.jsx("th",{className:"text-left py-4 px-6 text-white font-semibold",children:"Features"}),u.jsx("th",{className:"text-center py-4 px-6 text-blue-400 font-semibold",children:"Finance Manager"}),u.jsx("th",{className:"text-center py-4 px-6 text-white font-semibold",children:"Single Dealership"}),u.jsx("th",{className:"text-center py-4 px-6 text-white font-semibold",children:"Dealer Groups"})]})}),u.jsx("tbody",{children:[{name:"Deal Tracking",finance:!0,dealership:!0,group:!0},{name:"Performance Analytics",finance:!0,dealership:!0,group:!0},{name:"Team Management",finance:!1,dealership:!0,group:!0},{name:"Multi-location Support",finance:!1,dealership:!1,group:!0},{name:"Custom Pay Plans",finance:!1,dealership:!0,group:!0},{name:"Advanced Reporting",finance:!1,dealership:!0,group:!0},{name:"Priority Support",finance:!1,dealership:!0,group:!0},{name:"Custom Integrations",finance:!1,dealership:!1,group:!0},{name:"Dedicated Account Manager",finance:!1,dealership:!1,group:!0}].map((e,s)=>u.jsxs("tr",{className:"border-b border-gray-700 last:border-b-0",children:[u.jsx("td",{className:"py-4 px-6 text-gray-300",children:e.name}),u.jsx("td",{className:"py-4 px-6 text-center",children:e.finance?u.jsx(ps,{className:"w-5 h-5 text-blue-400 mx-auto"}):u.jsx("span",{className:"text-gray-500",children:""})}),u.jsx("td",{className:"py-4 px-6 text-center",children:e.dealership?u.jsx(ps,{className:"w-5 h-5 text-green-400 mx-auto"}):u.jsx("span",{className:"text-gray-500",children:""})}),u.jsx("td",{className:"py-4 px-6 text-center",children:e.group?u.jsx(ps,{className:"w-5 h-5 text-green-400 mx-auto"}):u.jsx("span",{className:"text-gray-500",children:""})})]},s))})]})})})]})}),u.jsx("section",{className:"py-20 px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"max-w-4xl mx-auto",children:[u.jsx("div",{className:"text-center mb-12",children:u.jsx("h2",{className:"text-3xl font-bold text-white mb-4",children:"Frequently Asked Questions"})}),u.jsx("div",{className:"space-y-6",children:[{question:"Is there really a free trial?",answer:"Yes! Finance managers can use The DAS Board completely free for 30 days. No credit card required during the trial period."},{question:"Can I upgrade or downgrade my plan?",answer:"Absolutely. You can change your plan at any time through your account settings. Changes take effect immediately."},{question:"What kind of support do you offer?",answer:"We provide email support for all plans, with priority phone support for dealership and dealer group plans. Dealer groups also get a dedicated account manager."},{question:"Is my data secure?",answer:"Yes, we use enterprise-grade security measures including SSL encryption, secure data centers, and regular security audits to protect your data."},{question:"Can I cancel anytime?",answer:"Yes, there are no long-term contracts. You can cancel your subscription at any time through your account settings."}].map((e,s)=>u.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 border border-gray-700",children:[u.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:e.question}),u.jsx("p",{className:"text-gray-300",children:e.answer})]},s))})]})}),u.jsx("section",{className:"py-20 px-4 sm:px-6 lg:px-8 bg-gray-800/30",children:u.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[u.jsx("h2",{className:"text-4xl font-bold text-white mb-6",children:"Ready to Get Started?"}),u.jsx("p",{className:"text-xl text-gray-300 mb-8",children:"Join hundreds of dealerships already using The DAS Board to optimize their operations."}),u.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[u.jsx("button",{onClick:()=>e("/signup"),className:"bg-blue-600 hover:bg-blue-500 text-white px-8 py-4 rounded-lg text-lg font-semibold transition-all duration-300 hover:shadow-xl hover:shadow-blue-500/25",children:"Start Your Free Trial"}),u.jsx("button",{onClick:()=>e("/screenshots"),className:"border border-gray-600 hover:bg-gray-700 text-white px-8 py-4 rounded-lg text-lg font-semibold transition-colors",children:"View Screenshots"})]})]})}),u.jsx("footer",{className:"border-t border-gray-700 bg-gray-800",children:u.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[u.jsxs("div",{className:"col-span-1 md:col-span-2",children:[u.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:"The DAS Board"}),u.jsx("p",{className:"text-gray-400 mb-4",children:"Modern dealership management software with real-time insights."}),u.jsx("p",{className:"text-gray-400",children:"Dealership Automotive Sales"})]}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-lg font-semibold text-white mb-4",children:"Product"}),u.jsxs("ul",{className:"space-y-2",children:[u.jsx("li",{children:u.jsx("button",{onClick:()=>e("/"),className:"text-gray-400 hover:text-white transition-colors",children:"Home"})}),u.jsx("li",{children:u.jsx("button",{onClick:()=>e("/screenshots"),className:"text-gray-400 hover:text-white transition-colors",children:"Screenshots"})}),u.jsx("li",{children:u.jsx("button",{onClick:()=>e("/about"),className:"text-gray-400 hover:text-white transition-colors",children:"About Us"})})]})]}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-lg font-semibold text-white mb-4",children:"Contact"}),u.jsx("p",{className:"text-gray-400 mb-2",children:"For support or inquiries, please contact us at:"}),u.jsx("p",{className:"text-blue-400",children:"support@thedasboard.com"})]})]}),u.jsx("div",{className:"border-t border-gray-700 mt-8 pt-8 text-center",children:u.jsx("p",{className:"text-gray-400",children:" 2025 The DAS Board. All rights reserved. Designed with "})})]})})]})}function oc(){const e=pe(),{t:s}=tc();return u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:[u.jsx("div",{className:"bg-gray-900/50 border-b border-gray-700",children:u.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"flex justify-between items-center py-6",children:[u.jsxs("button",{onClick:()=>e("/"),className:"flex items-center space-x-2 text-blue-400 hover:text-blue-300 transition-colors",children:[u.jsx(cs,{className:"w-5 h-5"}),u.jsx("span",{children:s("nav.home")})]}),u.jsx("div",{className:"flex items-center space-x-4",children:u.jsx(lc,{})})]})})}),u.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:u.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl p-8",children:[u.jsxs("div",{className:"flex items-center space-x-3 mb-8",children:[u.jsx(as,{className:"w-8 h-8 text-blue-400"}),u.jsx("h1",{className:"text-3xl font-bold text-white",children:s("legal.terms.title")})]}),u.jsxs("div",{className:"prose prose-invert max-w-none",children:[u.jsxs("p",{className:"text-gray-300 text-sm mb-8",children:[u.jsx("strong",{children:"Effective Date:"})," January 1, 2025",u.jsx("br",{}),u.jsx("strong",{children:"Last Updated:"})," January 1, 2025"]}),u.jsxs("div",{className:"space-y-8 text-gray-300",children:[u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"1. Acceptance of Terms"}),u.jsx("p",{children:"By accessing and using The DAS Board service, you accept and agree to be bound by the terms and provision of this agreement. If you do not agree to abide by the above, please do not use this service."})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"2. Service Description"}),u.jsx("p",{children:"The DAS Board provides dealership management software with real-time dashboards for finance managers, sales teams, and dealership management. Our service includes performance tracking, deal logging, scheduling, and analytics tools designed specifically for automotive dealerships."})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"3. User Accounts"}),u.jsx("p",{children:"You are responsible for maintaining the confidentiality of your account credentials and for all activities that occur under your account. You agree to notify us immediately of any unauthorized use of your account."})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"4. Subscription and Payment"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2",children:[u.jsx("li",{children:"Subscriptions are billed monthly or annually as selected"}),u.jsx("li",{children:"Free trials are available for eligible plans"}),u.jsx("li",{children:"Payment is due at the beginning of each billing cycle"}),u.jsx("li",{children:"Cancellations take effect at the end of the current billing period"}),u.jsx("li",{children:"Refunds are provided according to our refund policy"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"5. Data and Privacy"}),u.jsx("p",{children:"Your privacy is important to us. Please review our Privacy Policy, which governs how we collect, use, and protect your information. By using our service, you consent to the collection and use of information in accordance with our Privacy Policy."})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"6. Acceptable Use"}),u.jsx("p",{children:"You agree not to use the service for any unlawful purpose or in any way that could damage, disable, overburden, or impair our service. Prohibited activities include but are not limited to:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[u.jsx("li",{children:"Violating any applicable laws or regulations"}),u.jsx("li",{children:"Attempting to gain unauthorized access to our systems"}),u.jsx("li",{children:"Interfering with other users' ability to use the service"}),u.jsx("li",{children:"Transmitting viruses or malicious code"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"7. Intellectual Property"}),u.jsx("p",{children:"The service and its original content, features, and functionality are owned by The DAS Board and are protected by international copyright, trademark, patent, trade secret, and other intellectual property laws."})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"8. Limitation of Liability"}),u.jsx("p",{children:"In no event shall The DAS Board be liable for any indirect, incidental, special, consequential, or punitive damages, including without limitation, loss of profits, data, use, goodwill, or other intangible losses, resulting from your use of the service."})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"9. Termination"}),u.jsx("p",{children:"We may terminate or suspend your account immediately, without prior notice or liability, for any reason whatsoever, including without limitation if you breach the Terms."})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"10. Changes to Terms"}),u.jsx("p",{children:"We reserve the right to modify or replace these Terms at any time. If a revision is material, we will try to provide at least 30 days' notice prior to any new terms taking effect."})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"11. Contact Information"}),u.jsx("p",{children:"If you have any questions about these Terms, please contact us at:"}),u.jsxs("div",{className:"mt-2 bg-gray-700/50 p-4 rounded-lg",children:[u.jsxs("p",{children:[u.jsx("strong",{children:"Email:"})," legal@thedasboard.com"]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Address:"})," The DAS Board Legal Department"]})]})]})]})]})]})})]})}function cc(){const e=pe(),{t:s}=tc();return u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:[u.jsx("div",{className:"bg-gray-900/50 border-b border-gray-700",children:u.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"flex justify-between items-center py-6",children:[u.jsxs("button",{onClick:()=>e("/"),className:"flex items-center space-x-2 text-blue-400 hover:text-blue-300 transition-colors",children:[u.jsx(cs,{className:"w-5 h-5"}),u.jsx("span",{children:s("nav.home")})]}),u.jsx("div",{className:"flex items-center space-x-4",children:u.jsx(lc,{})})]})})}),u.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:u.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl p-8",children:[u.jsxs("div",{className:"flex items-center space-x-3 mb-8",children:[u.jsx(_s,{className:"w-8 h-8 text-blue-400"}),u.jsx("h1",{className:"text-3xl font-bold text-white",children:s("legal.privacy.title")})]}),u.jsxs("div",{className:"prose prose-invert max-w-none",children:[u.jsxs("p",{className:"text-gray-300 text-sm mb-8",children:[u.jsx("strong",{children:"Effective Date:"})," January 1, 2025",u.jsx("br",{}),u.jsx("strong",{children:"Last Updated:"})," January 1, 2025"]}),u.jsxs("div",{className:"space-y-8 text-gray-300",children:[u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"1. Information We Collect"}),u.jsx("p",{children:"We collect information you provide directly to us, such as when you create an account, use our services, or contact us for support."}),u.jsx("h3",{className:"text-lg font-medium text-white mt-4 mb-2",children:"Personal Information:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2",children:[u.jsx("li",{children:"Name, email address, and contact information"}),u.jsx("li",{children:"Account credentials and profile information"}),u.jsx("li",{children:"Dealership information and organizational details"}),u.jsx("li",{children:"Payment and billing information"})]}),u.jsx("h3",{className:"text-lg font-medium text-white mt-4 mb-2",children:"Usage Information:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2",children:[u.jsx("li",{children:"Log data and device information"}),u.jsx("li",{children:"Usage patterns and feature interactions"}),u.jsx("li",{children:"Performance metrics and analytics"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"2. How We Use Your Information"}),u.jsx("p",{children:"We use the information we collect to:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[u.jsx("li",{children:"Provide, maintain, and improve our services"}),u.jsx("li",{children:"Process transactions and send related information"}),u.jsx("li",{children:"Send technical notices and support messages"}),u.jsx("li",{children:"Respond to your comments, questions, and requests"}),u.jsx("li",{children:"Monitor and analyze trends, usage, and activities"}),u.jsx("li",{children:"Detect, investigate, and prevent fraudulent activities"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"3. Information Sharing"}),u.jsx("p",{children:"We do not sell, trade, or otherwise transfer your personal information to third parties without your consent, except as described in this policy:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Service Providers:"})," Third-party vendors who assist in our operations"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Legal Requirements:"})," When required by law or to protect our rights"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Business Transfers:"})," In connection with mergers or acquisitions"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Consent:"})," When you have given us explicit permission"]})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"4. Data Security"}),u.jsx("p",{children:"We implement appropriate technical and organizational measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction. This includes:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[u.jsx("li",{children:"Encryption in transit and at rest"}),u.jsx("li",{children:"Regular security assessments and updates"}),u.jsx("li",{children:"Access controls and authentication measures"}),u.jsx("li",{children:"Employee training on data protection"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"5. Data Retention"}),u.jsx("p",{children:"We retain your personal information for as long as necessary to provide our services, comply with legal obligations, resolve disputes, and enforce our agreements. Specific retention periods vary based on:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[u.jsx("li",{children:"The type of information and its purpose"}),u.jsx("li",{children:"Legal and regulatory requirements"}),u.jsx("li",{children:"Your relationship with our service"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"6. Your Rights"}),u.jsx("p",{children:"Depending on your location, you may have certain rights regarding your personal information:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Access:"})," Request information about the data we hold"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Correction:"})," Update or correct your personal information"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Deletion:"})," Request deletion of your personal information"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Portability:"})," Request a copy of your data in a portable format"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Objection:"})," Object to certain processing activities"]})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"7. Cookies and Tracking"}),u.jsx("p",{children:"We use cookies and similar tracking technologies to enhance your experience, analyze usage patterns, and provide personalized content. You can control cookie preferences through your browser settings."})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"8. International Transfers"}),u.jsx("p",{children:"Your information may be transferred to and processed in countries other than your own. We ensure appropriate safeguards are in place to protect your information during such transfers."})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"9. Children's Privacy"}),u.jsx("p",{children:"Our service is not intended for children under 13 years of age. We do not knowingly collect personal information from children under 13."})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"10. Changes to This Policy"}),u.jsx("p",{children:'We may update this Privacy Policy from time to time. We will notify you of any changes by posting the new policy on this page and updating the "Last Updated" date.'})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"11. Contact Us"}),u.jsx("p",{children:"If you have any questions about this Privacy Policy, please contact us at:"}),u.jsxs("div",{className:"mt-2 bg-gray-700/50 p-4 rounded-lg",children:[u.jsxs("p",{children:[u.jsx("strong",{children:"Email:"})," privacy@thedasboard.com"]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Address:"})," The DAS Board Privacy Department"]})]})]})]})]})]})})]})}function dc(){const e=pe(),{t:s}=tc();return u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:[u.jsx("div",{className:"bg-gray-900/50 border-b border-gray-700",children:u.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"flex justify-between items-center py-6",children:[u.jsxs("button",{onClick:()=>e("/"),className:"flex items-center space-x-2 text-blue-400 hover:text-blue-300 transition-colors",children:[u.jsx(cs,{className:"w-5 h-5"}),u.jsx("span",{children:s("nav.home")})]}),u.jsx("div",{className:"flex items-center space-x-4",children:u.jsx(lc,{})})]})})}),u.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:u.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl p-8",children:[u.jsxs("div",{className:"flex items-center space-x-3 mb-8",children:[u.jsx(ls,{className:"w-8 h-8 text-blue-400"}),u.jsx("h1",{className:"text-3xl font-bold text-white",children:s("legal.subscription.title")})]}),u.jsxs("div",{className:"prose prose-invert max-w-none",children:[u.jsxs("p",{className:"text-gray-300 text-sm mb-8",children:[u.jsx("strong",{children:"Effective Date:"})," January 1, 2025",u.jsx("br",{}),u.jsx("strong",{children:"Last Updated:"})," January 1, 2025"]}),u.jsxs("div",{className:"space-y-8 text-gray-300",children:[u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"1. Subscription Plans"}),u.jsx("p",{children:"The DAS Board offers various subscription plans designed to meet the needs of different types of automotive dealership operations:"}),u.jsxs("div",{className:"mt-4 space-y-4",children:[u.jsxs("div",{className:"bg-gray-700/50 p-4 rounded-lg",children:[u.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Finance Manager Plan"}),u.jsxs("p",{children:[u.jsx("strong",{children:"Price:"})," Free for limited time (normally $5/month)"]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Features:"})," Individual finance manager dashboard, deal tracking, performance analytics"]})]}),u.jsxs("div",{className:"bg-gray-700/50 p-4 rounded-lg",children:[u.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Single Dealership Plan"}),u.jsxs("p",{children:[u.jsx("strong",{children:"Price:"})," $250/month"]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Features:"})," Complete dealership management, unlimited users, advanced analytics"]})]}),u.jsxs("div",{className:"bg-gray-700/50 p-4 rounded-lg",children:[u.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Dealer Group Plan"}),u.jsxs("p",{children:[u.jsx("strong",{children:"Price:"})," Custom pricing"]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Features:"})," Multi-location management, enterprise features, dedicated support"]})]})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"2. Billing and Payment Terms"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Billing Cycle:"})," Subscriptions are billed monthly or annually based on your selection"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Payment Due:"})," Payment is due at the beginning of each billing period"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Auto-Renewal:"})," Subscriptions automatically renew unless cancelled"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Payment Methods:"})," We accept major credit cards and ACH transfers"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Currency:"})," All prices are in USD unless otherwise specified"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Taxes:"})," Applicable taxes will be added to your subscription fee"]})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"3. Free Trial Terms"}),u.jsx("p",{children:"Free trials are available for eligible plans with the following conditions:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[u.jsx("li",{children:"Trial duration varies by plan (typically 30 days)"}),u.jsx("li",{children:"Full access to plan features during trial period"}),u.jsx("li",{children:"Credit card required for trial activation"}),u.jsx("li",{children:"Automatic conversion to paid subscription unless cancelled"}),u.jsx("li",{children:"One trial per customer/organization"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"4. Subscription Changes"}),u.jsx("p",{children:"You may upgrade, downgrade, or modify your subscription at any time:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Upgrades:"})," Take effect immediately with prorated billing"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Downgrades:"})," Take effect at the next billing cycle"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Feature Limitations:"})," Downgrading may result in loss of data or features"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Billing Adjustments:"})," Credits or charges applied as appropriate"]})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"5. Cancellation Policy"}),u.jsx("p",{children:"You may cancel your subscription at any time with the following terms:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[u.jsx("li",{children:"Cancellation takes effect at the end of the current billing period"}),u.jsx("li",{children:"No refunds for partial billing periods"}),u.jsx("li",{children:"Access continues until the end of the paid period"}),u.jsx("li",{children:"Data export available for 30 days after cancellation"}),u.jsx("li",{children:"Account reactivation possible within 90 days"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"6. Refund Policy"}),u.jsx("p",{children:"Refunds are provided under the following circumstances:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Service Issues:"})," Significant service outages or technical problems"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Billing Errors:"})," Incorrect charges or duplicate billing"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Cancellation:"})," Within 7 days of initial subscription for annual plans"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Approval Required:"})," All refunds subject to review and approval"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Processing Time:"})," Refunds processed within 5-10 business days"]})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"7. Service Level Agreement"}),u.jsx("p",{children:"We strive to provide reliable service with the following commitments:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Uptime:"})," 99.5% monthly uptime target"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Support Response:"})," Business hours support for paid plans"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Data Backup:"})," Daily automated backups"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Maintenance:"})," Scheduled maintenance with advance notice"]})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"8. Data and Export"}),u.jsx("p",{children:"Your data management rights and options:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Data Ownership:"})," You retain ownership of all your data"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Export Options:"})," Standard export formats available"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Data Retention:"})," Data kept for 90 days after cancellation"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Deletion:"})," Permanent deletion available upon request"]})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"9. Price Changes"}),u.jsx("p",{children:"We may modify subscription prices with the following notice:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[u.jsxs("li",{children:[u.jsx("strong",{children:"Advance Notice:"})," 30 days notice for price increases"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Existing Subscriptions:"})," Current rates honored through billing cycle"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Grandfathering:"})," Limited-time promotional rates may expire"]}),u.jsxs("li",{children:[u.jsx("strong",{children:"Cancellation Option:"})," Right to cancel before price increase takes effect"]})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"10. Disputes and Resolution"}),u.jsx("p",{children:"For billing disputes or subscription issues:"}),u.jsxs("ul",{className:"list-disc list-inside space-y-2 mt-2",children:[u.jsx("li",{children:"Contact our billing support team first"}),u.jsx("li",{children:"Provide detailed information about the dispute"}),u.jsx("li",{children:"We will investigate and respond within 5 business days"}),u.jsx("li",{children:"Escalation procedures available if needed"})]})]}),u.jsxs("section",{children:[u.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"11. Contact Information"}),u.jsx("p",{children:"For subscription-related questions or support:"}),u.jsxs("div",{className:"mt-2 bg-gray-700/50 p-4 rounded-lg",children:[u.jsxs("p",{children:[u.jsx("strong",{children:"Billing Support:"})," billing@thedasboard.com"]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Technical Support:"})," support@thedasboard.com"]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Phone:"})," Available for enterprise customers"]})]})]})]})]})]})})]})}function mc(){const e=pe(),{t:s}=tc(),a=[{name:s("about.team.members.tyler.name"),role:s("about.team.members.tyler.role"),bio:s("about.team.members.tyler.bio")},{name:s("about.team.members.sarah.name"),role:s("about.team.members.sarah.role"),bio:s("about.team.members.sarah.bio")},{name:s("about.team.members.claude.name"),role:s("about.team.members.claude.role"),bio:s("about.team.members.claude.bio")},{name:s("about.team.members.annie.name"),role:s("about.team.members.annie.role"),bio:s("about.team.members.annie.bio")}];return u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:[u.jsx("div",{className:"bg-gray-900/50 border-b border-gray-700",children:u.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"flex justify-between items-center py-6",children:[u.jsxs("button",{onClick:()=>e("/"),className:"flex items-center space-x-2 text-blue-400 hover:text-blue-300 transition-colors",children:[u.jsx(cs,{className:"w-5 h-5"}),u.jsx("span",{children:s("nav.home")})]}),u.jsx("div",{className:"flex items-center space-x-4",children:u.jsx(lc,{})})]})})}),u.jsxs("section",{className:"py-20 px-6 max-w-7xl mx-auto",children:[u.jsxs("div",{className:"text-center mb-16",children:[u.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-6 bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent",children:s("about.title")}),u.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto",children:s("about.subtitle")})]}),u.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl p-8 mb-16",children:[u.jsx("h2",{className:"text-2xl font-bold mb-4 text-blue-400",children:s("about.founderVision.title")}),u.jsx("p",{className:"text-gray-300 text-lg mb-4",children:s("about.founderVision.paragraph1")}),u.jsx("p",{className:"text-gray-300 text-lg mb-4",children:s("about.founderVision.paragraph2")}),u.jsx("p",{className:"text-gray-300 text-lg",children:s("about.founderVision.paragraph3")})]}),u.jsxs("div",{children:[u.jsx("h2",{className:"text-3xl font-bold text-center mb-12 bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent",children:s("about.team.title")}),u.jsx("div",{className:"grid md:grid-cols-2 gap-8",children:a.map((e,s)=>u.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl p-6 flex gap-4 transition-all duration-300 hover:scale-[1.02]",children:[u.jsx("div",{className:"w-24 h-24 bg-gray-700 rounded-full flex items-center justify-center flex-shrink-0 border-2 border-blue-400/30",children:u.jsx("span",{className:"text-2xl text-blue-400",children:e.name.split(" ").map(e=>e[0]).join("")})}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-xl font-bold text-white",children:e.name}),u.jsx("p",{className:"text-blue-400 mb-2",children:e.role}),u.jsx("p",{className:"text-gray-300",children:e.bio})]})]},s))})]}),u.jsxs("div",{className:"mt-16",children:[u.jsx("h2",{className:"text-3xl font-bold text-center mb-12 bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent",children:s("about.values.title")}),u.jsx("div",{className:"grid md:grid-cols-3 gap-8",children:[{title:s("about.values.customerFocused.title"),description:s("about.values.customerFocused.description")},{title:s("about.values.dataDriven.title"),description:s("about.values.dataDriven.description")},{title:s("about.values.continuousImprovement.title"),description:s("about.values.continuousImprovement.description")}].map((e,s)=>u.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl p-6 transition-all duration-300 hover:scale-[1.02]",children:[u.jsx("h3",{className:"text-xl font-semibold mb-3 text-blue-400",children:e.title}),u.jsx("p",{className:"text-gray-300",children:e.description})]},s))})]})]}),u.jsx("section",{className:"py-20 px-6 max-w-7xl mx-auto bg-gray-800/30 mt-16 border-t border-b border-blue-400/20",children:u.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[u.jsx("h2",{className:"text-3xl font-bold mb-6 bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent",children:s("about.contact.title")}),u.jsx("p",{className:"text-xl text-gray-300 mb-8",children:s("about.contact.subtitle")}),u.jsxs("div",{className:"space-y-4",children:[u.jsxs("p",{className:"text-gray-300",children:[u.jsx("span",{className:"font-bold",children:s("about.contact.email")})," ",u.jsx("a",{href:"mailto:contact@thedasboard.com",className:"text-blue-400 hover:underline transition-colors duration-300",children:"contact@thedasboard.com"})]}),u.jsxs("p",{className:"text-gray-300",children:[u.jsx("span",{className:"font-bold",children:s("about.contact.phone")})," (555) 123-4567"]})]}),u.jsx("div",{className:"mt-8",children:u.jsx("button",{onClick:()=>e("/signup"),className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 px-8 py-3 rounded-md text-lg font-medium transition-all duration-300 hover:scale-105 hover:shadow-[0_0_15px_rgba(59,130,246,0.5)]",children:s("home.cta.startTrial")})})]})})]})}function hc(){const e=pe(),{t:s}=tc();return u.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:[u.jsx("div",{className:"bg-gray-900/50 border-b border-gray-700",children:u.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"flex justify-between items-center py-6",children:[u.jsxs("button",{onClick:()=>e("/"),className:"flex items-center space-x-2 text-blue-400 hover:text-blue-300 transition-colors",children:[u.jsx(cs,{className:"w-5 h-5"}),u.jsx("span",{children:s("nav.home")})]}),u.jsx("div",{className:"flex items-center space-x-4",children:u.jsx(lc,{})})]})})}),u.jsxs("section",{className:"py-20 px-6 max-w-7xl mx-auto",children:[u.jsxs("div",{className:"text-center mb-16",children:[u.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-6 bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent",children:"Dashboard Screenshots"}),u.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto",children:"Explore our different dashboard solutions designed for various roles in your dealership"})]}),u.jsxs("div",{className:"grid lg:grid-cols-2 gap-8 mb-16",children:[u.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl p-6 transition-all duration-300 hover:scale-[1.01] relative z-0",children:[u.jsx("h3",{className:"text-xl font-semibold mb-4 text-blue-400",children:"Finance Manager Dashboard"}),u.jsx("div",{className:"relative overflow-hidden rounded-lg border border-gray-600",children:u.jsx("img",{src:"/images/FINANCEMANAGER_DASH.JPG",alt:"Finance Manager Dashboard",className:"w-full h-auto object-cover transition-transform duration-300 hover:scale-105"})}),u.jsx("p",{className:"text-gray-300 mt-4",children:"Comprehensive financial tracking and deal management for finance managers."})]}),u.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl p-6 transition-all duration-300 hover:scale-[1.01] relative z-0",children:[u.jsx("h3",{className:"text-xl font-semibold mb-4 text-blue-400",children:"Sales Manager Dashboard"}),u.jsx("div",{className:"relative overflow-hidden rounded-lg border border-gray-600",children:u.jsx("img",{src:"/images/SALESMANAGER_DASH.JPG",alt:"Sales Manager Dashboard",className:"w-full h-auto object-cover transition-transform duration-300 hover:scale-105"})}),u.jsx("p",{className:"text-gray-300 mt-4",children:"Team performance tracking and sales analytics for managers."})]}),u.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl p-6 transition-all duration-300 hover:scale-[1.01] relative z-0",children:[u.jsx("h3",{className:"text-xl font-semibold mb-4 text-blue-400",children:"Salesperson Dashboard"}),u.jsx("div",{className:"relative overflow-hidden rounded-lg border border-gray-600",children:u.jsx("img",{src:"/images/SALESPERSON_DASH1.JPG",alt:"Salesperson Dashboard",className:"w-full h-auto object-cover transition-transform duration-300 hover:scale-105"})}),u.jsx("p",{className:"text-gray-300 mt-4",children:"Individual performance tracking and goal management for sales staff."})]}),u.jsxs("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl p-6 transition-all duration-300 hover:scale-[1.01] relative z-0",children:[u.jsx("h3",{className:"text-xl font-semibold mb-4 text-blue-400",children:"Advanced Salesperson View"}),u.jsx("div",{className:"relative overflow-hidden rounded-lg border border-gray-600",children:u.jsx("img",{src:"/images/SALESPERSON_DASH_2.JPG",alt:"Advanced Salesperson Dashboard",className:"w-full h-auto object-cover transition-transform duration-300 hover:scale-105"})}),u.jsx("p",{className:"text-gray-300 mt-4",children:"Enhanced analytics and detailed performance metrics for experienced sales professionals."})]})]}),u.jsxs("div",{className:"bg-gray-800/30 rounded-xl p-8 border border-gray-700",children:[u.jsx("h2",{className:"text-2xl font-bold text-center mb-8 text-blue-400",children:"Key Dashboard Features"}),u.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"text-center",children:[u.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Real-time Analytics"}),u.jsx("p",{className:"text-gray-300",children:"Live performance tracking and metrics updates"})]}),u.jsxs("div",{className:"text-center",children:[u.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Deal Management"}),u.jsx("p",{className:"text-gray-300",children:"Comprehensive deal logging and tracking system"})]}),u.jsxs("div",{className:"text-center",children:[u.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Team Coordination"}),u.jsx("p",{className:"text-gray-300",children:"Dynamic scheduling and team management tools"})]}),u.jsxs("div",{className:"text-center",children:[u.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Pay Calculation"}),u.jsx("p",{className:"text-gray-300",children:"Real-time earnings tracking with pay plans"})]}),u.jsxs("div",{className:"text-center",children:[u.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Performance Insights"}),u.jsx("p",{className:"text-gray-300",children:"Detailed analytics for informed decision making"})]}),u.jsxs("div",{className:"text-center",children:[u.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Multi-role Support"}),u.jsx("p",{className:"text-gray-300",children:"Customized dashboards for different user roles"})]})]})]})]}),u.jsxs("section",{className:"py-16 px-6 max-w-7xl mx-auto text-center",children:[u.jsx("h2",{className:"text-3xl font-bold mb-6 bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent",children:"Ready to Get Started?"}),u.jsx("p",{className:"text-xl text-gray-300 mb-8 max-w-2xl mx-auto",children:"Experience these powerful dashboards for yourself. Start your free trial today!"}),u.jsxs("div",{className:"space-x-4",children:[u.jsx("button",{onClick:()=>e("/signup"),className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 px-8 py-3 rounded-md text-lg font-medium transition-all duration-300 hover:scale-105 hover:shadow-[0_0_15px_rgba(59,130,246,0.5)]",children:s("home.cta.startTrial")}),u.jsx("button",{onClick:()=>e("/pricing"),className:"border border-blue-500 text-blue-400 hover:bg-blue-500 hover:text-white px-8 py-3 rounded-md text-lg font-medium transition-all duration-300",children:"View Pricing"})]})]})]})}const uc="1.0.0",xc="production",pc="http://localhost:3000",gc=(e,s={})=>{const a=(new Date).toISOString();console.log(`[App][${a}] ${e}`,c(o({},s),{app_version:uc,environment:xc,timestamp:a}))},fc=he.createContext(void 0),jc=({children:e})=>{const[s,a]=he.useState(null),[t,r]=he.useState(null),{setDealershipContext:l}=It();he.useEffect(()=>{s&&(gc("Setting dealership context",{dealership_id:s,dealership_name:t}),l(s))},[s,t,l]);const n={currentDealershipId:s,setCurrentDealershipId:a,currentDealershipName:t,setCurrentDealershipName:r};return u.jsx(fc.Provider,{value:n,children:e})};function vc(){const e=xe(),s=we(),{user:a,role:t}=It();return he.useEffect(()=>{gc("Navigation event",{path:e.pathname,search:e.search,type:s,state:e.state?"present":"none",hash:e.hash||"none",user_id:null==a?void 0:a.id,user_email:null==a?void 0:a.email,user_role:t});const r="undefined"!=typeof window&&window.performance,l=r?window.performance.now():0,n=r?window.performance.timeOrigin+window.performance.now():0;return()=>{if(r){const s=window.performance.now(),a=s-l;gc("Route render completed",{path:e.pathname,render_time_ms:a.toFixed(2),total_time_ms:(s-n).toFixed(2)}),a>1e3&&console.warn(`[Performance Warning] Slow render (${a.toFixed(2)}ms) for ${e.pathname}`)}}},[e,s,a,t]),null}function bc({to:e,replace:s=!1,state:a}){const{user:t,role:r}=It();return he.useEffect(()=>{gc("Redirect triggered",{from:window.location.pathname,to:e,replace:s,has_state:void 0!==a,user_id:null==t?void 0:t.id,user_email:null==t?void 0:t.email,user_role:r})},[e,s,a,t,r]),u.jsx(ge,{to:e,replace:s,state:a})}function Nc(){var e,s,a,t,r,l;const{role:n,loading:i,userRole:o,user:c,hasSession:d,dealershipId:m,currentDealershipName:h,logAccessAttempt:x,isGroupAdmin:p,authCheckComplete:g}=It(),f=xe();if(he.useEffect(()=>{"testfinance@example.com"!==(null==c?void 0:c.email)&&"finance1@exampletest.com"!==(null==c?void 0:c.email)||console.warn("[FINANCE DEBUG] Finance user detected in RoleBasedRedirect:",{email:c.email,userRole:o,role:n,dealershipId:m,isGroupAdmin:p,userMetadata:c.user_metadata})},[c,o,n,m,p]),he.useEffect(()=>{console.warn("[DEBUG REDIRECT] Role-based redirect check",{role:n,user_role:o,user_email:null==c?void 0:c.email,dealership_id:m,dealership_name:h,is_group_admin:p,loading:i,auth_check_complete:g,has_session:d,path:f.pathname})},[n,i,f,o,c,d,m,h,p,g]),wt()){const e=yt();if(e)return console.log("[ROLE REDIRECT] Direct auth user detected, redirecting to appropriate route",{email:e.email,role:e.role,redirectPath:Dt(e)}),u.jsx(ge,{to:Dt(e),replace:!0})}if(i||!g)return gc("Role redirect - Still loading or auth check incomplete",{path:f.pathname,loading:i,authCheckComplete:g}),u.jsx("div",{children:"Loading..."});if(!c||!d)return gc("Role redirect - Not authenticated",{path:f.pathname,redirect_to:"/"}),x(f.pathname,!1,{reason:"No authenticated session",redirect_to:"/"}),u.jsx(ge,{to:"/",replace:!0});gc("Role redirect - User authenticated",{user_email:c.email,role:n,user_role:o,is_admin:"admin"===n||"admin"===o,is_group_admin:p,user_metadata:c.user_metadata?"present":"missing",dealership_id:m,dealership_name:h});const j=(n||o||"").toLowerCase();console.warn("[DEBUG REDIRECT] User role determined:",{roleValue:j,isGroupAdmin:p,email:c.email,dealershipId:m});let v="/dashboard/sales",b="Default to sales dashboard";return"admin@thedasboard.com"===(null==c?void 0:c.email)?(v="/master-admin",b="Main admin account"):"testadmin@example.com"!==(null==c?void 0:c.email)||"admin"!==j&&"master_admin"!==j?p?(v="/group-admin",b="Group admin flag is set to true",console.warn("[DEBUG REDIRECT] User is redirected to Group Admin Dashboard because is_group_admin=true",{user_id:c.id,email:c.email,is_group_admin:p,role:j})):"dealer_group_admin"===j||"group_dealer_admin"===j||j.includes("group_admin")||j.includes("group")||j.includes("dealergroup_admin")?(v="/group-admin",b="Dealer group admin role",console.warn("[DEBUG REDIRECT] User is redirected to Group Admin Dashboard because of role name",{user_id:c.id,email:c.email,role:j})):"single_dealer_admin"===j||"dealership_admin"===j||j.includes("dealership_admin")||"admin"===j?(v="/dashboard/admin",b="Single dealership admin role",console.log("[AUTH DEBUG] User is redirected to Dealership Admin Dashboard",{user_id:c.id,email:c.email,dealership_id:m,role:j})):"single_finance_manager"===j||"finance_manager"===j&&((null==(e=null==c?void 0:c.email)?void 0:e.includes("finance"))||(null==(s=null==c?void 0:c.email)?void 0:s.includes("testfinance")))?(v="/dashboard/single-finance",b="Single finance manager role (email-based routing)",console.log("[AUTH DEBUG] User is redirected to Single Finance Manager Dashboard",{user_id:c.id,email:c.email,role:j})):"finance_manager"===j||j.includes("finance")?(v="/dashboard/finance",b="Finance manager role (regular)"):"sales_manager"===j||j.includes("sales_manager")?(v="/dashboard/sales-manager",b="Sales manager role"):"general_manager"===j||j.includes("general")?(v="/dashboard/gm",b="General manager role"):"area_vice_president"===j||j.includes("vice_president")?(v="/avp-full-dashboard",b="Area Vice President role"):(v="/dashboard/sales",b="Sales role (default)"):(v="/master-admin",b="Test admin account with admin role"),console.warn("[DEBUG REDIRECT] Final redirection decision:",{redirectPath:v,redirectReason:b,roleValue:j,isGroupAdmin:p,email:c.email,userEmail:c.email,isTestFinanceUser:"testfinance@example.com"===c.email||"finance1@exampletest.com"===c.email,roleConditions:{isSingleFinanceManager:"single_finance_manager"===j,isFinanceManagerWithEmail:"finance_manager"===j&&((null==(a=null==c?void 0:c.email)?void 0:a.includes("finance"))||(null==(t=null==c?void 0:c.email)?void 0:t.includes("testfinance"))),combinedFinanceCondition:"single_finance_manager"===j||"finance_manager"===j&&((null==(r=null==c?void 0:c.email)?void 0:r.includes("finance"))||(null==(l=null==c?void 0:c.email)?void 0:l.includes("testfinance")))}}),x(v,!0,{source_path:f.pathname,reason:b,role:j}),u.jsx(ge,{to:v,replace:!0})}function yc({children:e}){var s,a;const{user:t,isGroupAdmin:r,loading:l,userRole:n,authCheckComplete:i}=It(),o=xe();if(wt()){const s=yt();if(s&&s.isGroupAdmin)return console.log("[GROUP ADMIN ACCESS] Direct auth user granted access to group admin",{email:s.email,role:s.role}),u.jsx(u.Fragment,{children:e})}if(l||!i)return console.log("[GROUP ADMIN ACCESS] Still loading auth state"),u.jsx("div",{children:"Loading..."});if("/group-admin"===o.pathname){const l=(null==n?void 0:n.toLowerCase().includes("group"))||(null==n?void 0:n.toLowerCase().includes("dealer_group_admin")),i=(null==(s=null==t?void 0:t.email)?void 0:s.toLowerCase().includes("group"))&&(null==(a=null==t?void 0:t.email)?void 0:a.toLowerCase().includes("@exampletest.com"));return r||l||i?(console.warn("[GROUP ADMIN ACCESS] Access granted - User is identified as a group admin",{by_flag:r,by_role:l,by_email:i,email:null==t?void 0:t.email,role:n}),u.jsx(u.Fragment,{children:e})):(console.warn("[GROUP ADMIN ACCESS] Access denied - User is not a group admin"),u.jsx(ge,{to:"/dashboard",replace:!0}))}return u.jsx(Kt,{requiredRoles:["admin","dealer_group_admin","dealership_admin","area_vice_president"],children:e})}function wc(){return he.useEffect(()=>{console.log("[ResetAuth] Clearing all auth state..."),ta.auth.signOut().then(()=>{console.log("[ResetAuth] Signed out from Supabase")}).catch(e=>{console.error("[ResetAuth] Error signing out from Supabase:",e)});try{console.log("[ResetAuth] Clearing localStorage and sessionStorage"),"undefined"!=typeof window&&window.localStorage&&window.localStorage.clear(),"undefined"!=typeof window&&window.sessionStorage&&window.sessionStorage.clear(),"undefined"!=typeof document&&document.cookie.split(";").forEach(e=>{const[s]=e.trim().split("=");document.cookie=`${s}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`}),console.log("[ResetAuth] All storage cleared")}catch(e){console.error("[ResetAuth] Error clearing storage:",e)}return setTimeout(()=>{console.log("[ResetAuth] Redirecting to login page"),"undefined"!=typeof window&&(window.location.href="/")},1e3),()=>{console.log("[ResetAuth] Reset component unmounted")}},[]),u.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[u.jsx("h1",{children:"Resetting Auth State..."}),u.jsx("p",{children:"Clearing all authentication state and redirecting to login page."})]})}function Sc(){return he.useEffect(()=>{const e="undefined"!=typeof window&&window.URLSearchParams?new window.URLSearchParams(window.location.search):null;"undefined"==typeof window||"/logout"===window.location.pathname||e&&(e.has("noredirect")||e.has("forcelogin"))||h(null,null,function*(){var e,s;try{const{data:a}=yield ta.auth.getSession();if(null==(e=null==a?void 0:a.session)?void 0:e.user){console.warn("[App] Found authenticated user on app load:",a.session.user.email);const e="undefined"!=typeof window&&window.URLSearchParams?new window.URLSearchParams(window.location.search):null;if(e&&(e.has("noredirect")||e.has("forcelogin")))return void console.log("[App] Skipping redirect due to special parameter");const t=a.session.user.email||"",r=t.toLowerCase().includes("group")&&t.toLowerCase().includes("@exampletest.com"),l=!!(null==(s=a.session.user.user_metadata)?void 0:s.is_group_admin);r||l?(console.warn("[App] FAILSAFE - Detected group admin user, redirecting"),"undefined"!=typeof window&&"/group-admin"!==window.location.pathname&&(console.warn("[App] Forcing redirection to group admin dashboard"),window.location.href="/group-admin")):"testadmin@example.com"===t.toLowerCase()&&(console.warn("[App] FAILSAFE - Detected test admin user"),"undefined"!=typeof window&&"/master-admin"!==window.location.pathname&&(console.warn("[App] Forcing redirection to master admin dashboard"),window.location.href="/master-admin"))}}catch(a){console.error("[App] Error in failsafe auth check:",a)}})},[]),he.useEffect(()=>{gc("Application initialized",{version:uc,environment:xc,app_url:"http://localhost:5173",marketing_url:pc,user_agent:"undefined"!=typeof window&&window.navigator?window.navigator.userAgent:"unknown",language:"undefined"!=typeof window&&window.navigator?window.navigator.language:"unknown",screen_size:"undefined"!=typeof window?`${window.innerWidth}x${window.innerHeight}`:"unknown"});const{data:{subscription:e}}=ta.auth.onAuthStateChange((e,s)=>h(null,null,function*(){if(console.warn("[DEBUG AUTH] Auth state changed:",e),"SIGNED_IN"===e&&(null==s?void 0:s.user)){console.warn(`[DEBUG AUTH] User signed in: ${s.user.email}`);const{data:e,error:a}=yield ta.from("profiles").select("is_group_admin, role").eq("id",s.user.id).maybeSingle();!a&&e&&(console.warn("[DEBUG AUTH] User profile data:",e),console.warn(`[DEBUG AUTH] is_group_admin: ${e.is_group_admin}, role: ${e.role}`),e.is_group_admin?console.warn("[DEBUG AUTH] User is a group admin, should be redirected to /group-admin"):console.warn("[DEBUG AUTH] User is NOT a group admin"))}})),s=()=>{gc("Network status change",{online:"undefined"==typeof window||!window.navigator||window.navigator.onLine})};return"undefined"!=typeof window&&(window.addEventListener("online",s),window.addEventListener("offline",s)),()=>{e.unsubscribe(),"undefined"!=typeof window&&(window.removeEventListener("online",s),window.removeEventListener("offline",s))}},[]),u.jsx(ac,{children:u.jsx(aa,{client:Xt,children:u.jsxs(mt,{children:[u.jsx(Et,{children:u.jsx(jc,{children:u.jsx(ye,{children:u.jsx(bi,{children:u.jsxs(ji,{children:[u.jsx(vc,{}),u.jsxs(ve,{children:[u.jsx(be,{path:"/",element:u.jsx(nc,{})}),u.jsx(be,{path:"/about",element:u.jsx(mc,{})}),u.jsx(be,{path:"/screenshots",element:u.jsx(hc,{})}),u.jsx(be,{path:"/pricing",element:u.jsx(ic,{})}),u.jsx(be,{path:"/auth",element:u.jsx(Ht,{})}),u.jsx(be,{path:"/legal/terms",element:u.jsx(oc,{})}),u.jsx(be,{path:"/legal/privacy",element:u.jsx(cc,{})}),u.jsx(be,{path:"/legal/subscription",element:u.jsx(dc,{})}),u.jsx(be,{path:"/signup",element:u.jsx(Ko,{})}),u.jsx(be,{path:"/signup/single-finance",element:u.jsx(Zo,{})}),u.jsx(be,{path:"/signup/dealership",element:u.jsx(Qo,{})}),u.jsx(be,{path:"/signup/dealer-group",element:u.jsx(Xo,{})}),u.jsx(be,{path:"/logout",element:u.jsx(yi,{})}),u.jsx(be,{path:"/direct-login",element:u.jsx(vi,{})}),u.jsx(be,{path:"/force-login",element:u.jsx(Ni,{})}),u.jsx(be,{path:"/reset",element:u.jsx(wc,{})}),u.jsx(be,{path:"/debug-auth",element:u.jsx(gi,{})}),u.jsx(be,{path:"/auth-debug",element:u.jsx(fi,{})}),u.jsx(be,{path:"/dashboard",element:u.jsx(Kt,{children:u.jsx(Nc,{})})}),u.jsx(be,{path:"/marketing",element:u.jsx(bc,{to:pc})}),u.jsx(be,{path:"/master-admin",element:u.jsx(Kt,{requiredRoles:["admin"],children:u.jsx(Zt,{title:"Master Admin Panel",children:u.jsx(Ho,{})})})}),u.jsx(be,{path:"/group-admin",element:u.jsx(yc,{children:u.jsx(Zt,{title:"Group Admin Dashboard",children:u.jsx(mi,{})})})}),u.jsx(be,{path:"/avp-full-dashboard",element:u.jsx(Kt,{requiredRoles:["area_vice_president"],children:u.jsx(Zt,{title:"Area VP Full Dashboard",children:u.jsx(oi,{})})})}),u.jsx(be,{path:"/dashboard/admin",element:u.jsx(Kt,{requiredRoles:["admin","dealership_admin","single_dealer_admin"],children:u.jsx(si,{})})}),u.jsx(be,{path:"/dashboard/sales",element:u.jsx(Kt,{requiredRoles:["salesperson"],children:u.jsx(Zt,{children:u.jsx(mr,{})})})}),u.jsx(be,{path:"/dashboard/finance/*",element:u.jsx(Kt,{requiredRoles:["finance_manager","single_finance_manager"],children:u.jsx(Zt,{children:u.jsx(vr,{})})})}),u.jsx(be,{path:"/dashboard/single-finance/*",element:u.jsx(Kt,{requiredRoles:["finance_manager","single_finance_manager"],children:u.jsx(Zt,{children:u.jsx(To,{})})})}),u.jsx(be,{path:"/dashboard/finance-director/*",element:u.jsx(Kt,{requiredRoles:["finance_director"],children:u.jsx(Zt,{children:u.jsx(Fo,{})})})}),u.jsx(be,{path:"/finance-manager/log-deal",element:u.jsx(Kt,{requiredRoles:["finance_manager","single_finance_manager"],children:u.jsx(Zt,{children:u.jsx(zo,{})})})}),u.jsx(be,{path:"/deal-log",element:u.jsx(Kt,{requiredRoles:["finance_manager","single_finance_manager"],children:u.jsx(Zt,{children:u.jsx(ii,{})})})}),u.jsx(be,{path:"/finance-deal-log",element:u.jsx(Kt,{requiredRoles:["finance_manager","single_finance_manager"],children:u.jsx(Zt,{children:u.jsx(ii,{dashboardType:"finance"})})})}),u.jsx(be,{path:"/single-finance-deal-log",element:u.jsx(Kt,{requiredRoles:["finance_manager","single_finance_manager"],children:u.jsx(Zt,{children:u.jsx(ii,{dashboardType:"single-finance"})})})}),u.jsx(be,{path:"/dashboard/sales-manager/*",element:u.jsx(Kt,{requiredRoles:["sales_manager"],children:u.jsx(Zt,{children:u.jsxs(ve,{children:[u.jsx(be,{path:"/",element:u.jsx(on,{})}),u.jsx(be,{path:"team",element:u.jsx(Ci,{})}),u.jsx(be,{path:"goals",element:u.jsx(Ai,{})}),u.jsx(be,{path:"schedule",element:u.jsx(Ri,{})}),u.jsx(be,{path:"sales-report",element:u.jsx(_o,{})})]})})})}),u.jsx(be,{path:"/dashboard/gm",element:u.jsx(Kt,{requiredRoles:["general_manager"],children:u.jsx(Zt,{children:u.jsx(cn,{})})})}),u.jsx(be,{path:"/dealership/:dealershipId/*",element:u.jsx(_c,{})}),u.jsx(be,{path:"/test-login-redirect",element:u.jsx(wi,{})}),u.jsx(be,{path:"/group-admin-bypass",element:u.jsx(Si,{})}),u.jsx(be,{path:"/dashboard-selector",element:u.jsx(_i,{})}),u.jsx(be,{path:"*",element:u.jsx(bc,{to:"/dashboard"})})]}),u.jsx(Qt,{})]})})})})}),!1]})})})}function _c(){const{dealershipId:e}=Se(),s=e?parseInt(e,10):null;return s?(gc("Rendering dealership layout",{dealership_id:s}),u.jsx(Dc,{dealershipId:s})):(gc("Invalid dealership ID in URL",{dealership_id:e}),u.jsx(ge,{to:"/dashboard",replace:!0}))}function Dc({dealershipId:e}){const{setCurrentDealershipId:s,setCurrentDealershipName:a}=(()=>{const e=he.useContext(fc);if(void 0===e)throw new Error("useDealership must be used within a DealershipProvider");return e})(),[t,r]=he.useState(!0);return he.useEffect(()=>{s(e),ta.from("dealerships").select("name").eq("id",e).single().then(({data:s,error:t})=>{t?console.error("Error fetching dealership name:",t):s&&(a(s.name),gc("Set dealership name in context",{dealership_id:e,dealership_name:s.name})),r(!1)})},[e,s,a]),t?u.jsx("div",{className:"flex h-screen items-center justify-center",children:u.jsx(Ge,{className:"h-8 w-8 animate-spin"})}):u.jsxs(ve,{children:[u.jsx(be,{path:"sales",element:u.jsx(Kt,{requiredRoles:["salesperson"],requiredDealership:e,children:u.jsx(Zt,{children:u.jsx(mr,{})})})}),u.jsx(be,{path:"finance",element:u.jsx(Kt,{requiredRoles:["finance_manager"],requiredDealership:e,children:u.jsx(Zt,{children:u.jsx(vr,{})})})}),u.jsx(be,{path:"sales-manager",element:u.jsx(Kt,{requiredRoles:["sales_manager"],requiredDealership:e,children:u.jsx(Zt,{children:u.jsx(on,{})})})}),u.jsx(be,{path:"gm",element:u.jsx(Kt,{requiredRoles:["general_manager"],requiredDealership:e,children:u.jsx(Zt,{children:u.jsx(cn,{})})})}),u.jsx(be,{path:"admin",element:u.jsx(Kt,{requiredRoles:["admin","dealership_admin"],requiredDealership:e,children:u.jsx(si,{})})}),u.jsx(be,{path:"deal-log",element:u.jsx(Kt,{requiredRoles:["finance_manager"],requiredDealership:e,children:u.jsx(Zt,{children:u.jsx(ii,{})})})}),u.jsx(be,{path:"*",element:u.jsx(ge,{to:`/dealership/${e}/sales`,replace:!0})})]})}r.createRoot(document.getElementById("root")).render(u.jsx(Ne.StrictMode,{children:u.jsx(Sc,{})}))}},function(){return ra||(0,ta[t(ta)[0]])((ra={exports:{}}).exports,ra),ra.exports});export default la();
//# sourceMappingURL=index.BDBsfRbO.js.map
